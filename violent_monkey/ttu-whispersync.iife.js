// ==UserScript==
// @author      Renji-xD
// @name        ttu-whispersync
// @namespace   https://github.com/Renji-XD
// @match       https://reader.ttsu.app/*
// @match       http://localhost:5173/*
// @version     1.0.0
// @description Listen to audiobooks with ttu ebook-reader
// @icon https://raw.githubusercontent.com/Renji-XD/ttu-whispersync/main/src/assets/icons/icon64.png
// @run-at      document-idle
// @noframes
// @grant       none
// @downloadURL https://raw.githubusercontent.com/Renji-XD/ttu-whispersync/main/violent_monkey/ttu-whispersync.iife.js
// @supportURL  https://github.com/Renji-XD/ttu-whispersync/issues
// @homepageURL https://github.com/Renji-XD/ttu-whispersync
// ==/UserScript==
var J8=Object.defineProperty;var ew=(kn,gt,Vn)=>gt in kn?J8(kn,gt,{enumerable:!0,configurable:!0,writable:!0,value:Vn}):kn[gt]=Vn;var Cn=(kn,gt,Vn)=>(ew(kn,typeof gt!="symbol"?gt+"":gt,Vn),Vn),vh=(kn,gt,Vn)=>{if(!gt.has(kn))throw TypeError("Cannot "+Vn)};var Qt=(kn,gt,Vn)=>(vh(kn,gt,"read from private field"),Vn?Vn.call(kn):gt.get(kn)),Oi=(kn,gt,Vn)=>{if(gt.has(kn))throw TypeError("Cannot add the same private member more than once");gt instanceof WeakSet?gt.add(kn):gt.set(kn,Vn)},xo=(kn,gt,Vn,Qs)=>(vh(kn,gt,"write to private field"),Qs?Qs.call(kn,Vn):gt.set(kn,Vn),Vn);(function(){"use strict";var Tr,Ii,vi,as,ls,tl,wr;var kn=typeof document<"u"?document.currentScript:null;function gt(){}function Vn(e,n){for(const t in n)e[t]=n[t];return e}function Qs(e){return e()}function tc(){return Object.create(null)}function _n(e){e.forEach(Qs)}function Vr(e){return typeof e=="function"}function pn(e,n){return e!=e?n==n:e!==n||e&&typeof e=="object"||typeof e=="function"}let Ho;function fs(e,n){return e===n?!0:(Ho||(Ho=document.createElement("a")),Ho.href=n,e===Ho.href)}function Eh(e){return Object.keys(e).length===0}function Jr(e,...n){if(e==null){for(const r of n)r(void 0);return gt}const t=e.subscribe(...n);return t.unsubscribe?()=>t.unsubscribe():t}function It(e){let n;return Jr(e,t=>n=t)(),n}function we(e,n,t){e.$$.on_destroy.push(Jr(n,t))}function ds(e,n,t,r){if(e){const i=nc(e,n,t,r);return e[0](i)}}function nc(e,n,t,r){return e[1]&&r?Vn(t.ctx.slice(),e[1](r(n))):t.ctx}function hs(e,n,t,r){if(e[2]&&r){const i=e[2](r(t));if(n.dirty===void 0)return i;if(typeof i=="object"){const s=[],o=Math.max(n.dirty.length,i.length);for(let a=0;a<o;a+=1)s[a]=n.dirty[a]|i[a];return s}return n.dirty|i}return n.dirty}function ps(e,n,t,r,i,s){if(i){const o=nc(n,t,r,s);e.p(o,i)}}function ms(e){if(e.ctx.length>32){const n=[],t=e.ctx.length/32;for(let r=0;r<t;r++)n[r]=-1;return n}return-1}function pe(e,n,t){return e.set(t),n}function Uo(e){return e&&Vr(e.destroy)?e.destroy:gt}let rc=typeof window<"u"?e=>requestAnimationFrame(e):gt;const ic=typeof window<"u"?window:typeof globalThis<"u"?globalThis:globalThis||void 0||self;function oe(e,n){e.appendChild(n)}function de(e,n,t){e.insertBefore(n,t||null)}function fe(e){e.parentNode&&e.parentNode.removeChild(e)}function _e(e){return document.createElement(e)}function Di(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Nt(e){return document.createTextNode(e)}function me(){return Nt(" ")}function ur(){return Nt("")}function qe(e,n,t,r){return e.addEventListener(n,t,r),()=>e.removeEventListener(n,t,r)}function Wo(e){return function(n){return n.preventDefault(),e.call(this,n)}}function Js(e){return function(n){return n.stopPropagation(),e.call(this,n)}}function re(e,n,t){t==null?e.removeAttribute(n):e.getAttribute(n)!==t&&e.setAttribute(n,t)}function sc(e){return e===""?null:+e}function Sh(e){return Array.from(e.childNodes)}function en(e,n){n=""+n,e.data!==n&&(e.data=n)}function _s(e,n){e.value=n??""}function xn(e,n,t,r){t==null?e.style.removeProperty(n):e.style.setProperty(n,t,r?"important":"")}function oc(e,n,t){for(let r=0;r<e.options.length;r+=1){const i=e.options[r];if(i.__value===n){i.selected=!0;return}}(!t||n!==void 0)&&(e.selectedIndex=-1)}function kh(e){const n=e.querySelector(":checked");return n&&n.__value}function lt(e,n,t){e.classList.toggle(n,!!t)}function Th(e,n,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:n,bubbles:t,cancelable:r})}class Ah{constructor(n=!1){Cn(this,"is_svg",!1);Cn(this,"e");Cn(this,"n");Cn(this,"t");Cn(this,"a");this.is_svg=n,this.e=this.n=null}c(n){this.h(n)}m(n,t,r=null){this.e||(this.is_svg?this.e=Di(t.nodeName):this.e=_e(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(n)),this.i(r)}h(n){this.e.innerHTML=n,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(n){for(let t=0;t<this.n.length;t+=1)de(this.t,this.n[t],n)}p(n){this.d(),this.h(n),this.i(this.a)}d(){this.n.forEach(fe)}}function ac(e,n){return new e(n)}let eo;function to(e){eo=e}function no(){if(!eo)throw new Error("Function called outside component initialization");return eo}function jo(e){no().$$.on_mount.push(e)}function Go(e){no().$$.on_destroy.push(e)}function ei(){const e=no();return(n,t,{cancelable:r=!1}={})=>{const i=e.$$.callbacks[n];if(i){const s=Th(n,t,{cancelable:r});return i.slice().forEach(o=>{o.call(e,s)}),!s.defaultPrevented}return!0}}function Mh(e,n){return no().$$.context.set(e,n),n}function Ni(e){return no().$$.context.get(e)}function cr(e,n){const t=e.$$.callbacks[n.type];t&&t.slice().forEach(r=>r.call(this,n))}const gs=[],Gt=[];let bs=[];const ol=[],lc=Promise.resolve();let al=!1;function uc(){al||(al=!0,lc.then(cc))}function qn(){return uc(),lc}function Fi(e){bs.push(e)}function Zn(e){ol.push(e)}const ll=new Set;let ws=0;function cc(){if(ws!==0)return;const e=eo;do{try{for(;ws<gs.length;){const n=gs[ws];ws++,to(n),Ch(n.$$)}}catch(n){throw gs.length=0,ws=0,n}for(to(null),gs.length=0,ws=0;Gt.length;)Gt.pop()();for(let n=0;n<bs.length;n+=1){const t=bs[n];ll.has(t)||(ll.add(t),t())}bs.length=0}while(gs.length);for(;ol.length;)ol.pop()();al=!1,ll.clear(),to(e)}function Ch(e){if(e.fragment!==null){e.update(),_n(e.before_update);const n=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,n),e.after_update.forEach(Fi)}}function Rh(e){const n=[],t=[];bs.forEach(r=>e.indexOf(r)===-1?n.push(r):t.push(r)),t.forEach(r=>r()),bs=n}const zo=new Set;let $i;function rn(){$i={r:0,c:[],p:$i}}function sn(){$i.r||_n($i.c),$i=$i.p}function te(e,n){e&&e.i&&(zo.delete(e),e.i(n))}function ue(e,n,t,r){if(e&&e.o){if(zo.has(e))return;zo.add(e),$i.c.push(()=>{zo.delete(e),r&&(t&&e.d(1),r())}),e.o(n)}else r&&r()}function xr(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Xo(e,n){e.d(1),n.delete(e.key)}function Lh(e,n){ue(e,1,1,()=>{n.delete(e.key)})}function ro(e,n,t,r,i,s,o,a,l,c,u,f){let m=e.length,g=s.length,_=m;const E={};for(;_--;)E[e[_].key]=_;const S=[],b=new Map,v=new Map,y=[];for(_=g;_--;){const M=f(i,s,_),L=t(M);let D=o.get(L);D?r&&y.push(()=>D.p(M,n)):(D=c(L,M),D.c()),b.set(L,S[_]=D),L in E&&v.set(L,Math.abs(_-E[L]))}const A=new Set,d=new Set;function p(M){te(M,1),M.m(a,u),o.set(M.key,M),u=M.first,g--}for(;m&&g;){const M=S[g-1],L=e[m-1],D=M.key,O=L.key;M===L?(u=M.first,m--,g--):b.has(O)?!o.has(D)||A.has(D)?p(M):d.has(O)?m--:v.get(D)>v.get(O)?(d.add(D),p(M)):(A.add(O),m--):(l(L,o),m--)}for(;m--;){const M=e[m];b.has(M.key)||l(M,o)}for(;g;)p(S[g-1]);return _n(y),S}function fc(e,n){const t={},r={},i={$$scope:1};let s=e.length;for(;s--;){const o=e[s],a=n[s];if(a){for(const l in o)l in a||(r[l]=1);for(const l in a)i[l]||(t[l]=a[l],i[l]=1);e[s]=a}else for(const l in o)i[l]=1}for(const o in r)o in t||(t[o]=void 0);return t}function dc(e){return typeof e=="object"&&e!==null?e:{}}function Kn(e,n,t){const r=e.$$.props[n];r!==void 0&&(e.$$.bound[r]=t,t(e.$$.ctx[r]))}function Te(e){e&&e.c()}function Ee(e,n,t){const{fragment:r,after_update:i}=e.$$;r&&r.m(n,t),Fi(()=>{const s=e.$$.on_mount.map(Qs).filter(Vr);e.$$.on_destroy?e.$$.on_destroy.push(...s):_n(s),e.$$.on_mount=[]}),i.forEach(Fi)}function Se(e,n){const t=e.$$;t.fragment!==null&&(Rh(t.after_update),_n(t.on_destroy),t.fragment&&t.fragment.d(n),t.on_destroy=t.fragment=null,t.ctx=[])}function Ph(e,n){e.$$.dirty[0]===-1&&(gs.push(e),uc(),e.$$.dirty.fill(0)),e.$$.dirty[n/31|0]|=1<<n%31}function wn(e,n,t,r,i,s,o=null,a=[-1]){const l=eo;to(e);const c=e.$$={fragment:null,ctx:[],props:s,update:gt,not_equal:i,bound:tc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(l?l.$$.context:[])),callbacks:tc(),dirty:a,skip_bound:!1,root:n.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=t?t(e,n.props||{},(f,m,...g)=>{const _=g.length?g[0]:m;return c.ctx&&i(c.ctx[f],c.ctx[f]=_)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](_),u&&Ph(e,f)),m}):[],c.update(),u=!0,_n(c.before_update),c.fragment=r?r(c.ctx):!1,n.target){if(n.hydrate){const f=Sh(n.target);c.fragment&&c.fragment.l(f),f.forEach(fe)}else c.fragment&&c.fragment.c();n.intro&&te(e.$$.fragment),Ee(e,n.target,n.anchor),cc()}to(l)}class vn{constructor(){Cn(this,"$$");Cn(this,"$$set")}$destroy(){Se(this,1),this.$destroy=gt}$on(n,t){if(!Vr(t))return gt;const r=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return r.push(t),()=>{const i=r.indexOf(t);i!==-1&&r.splice(i,1)}}$set(n){this.$$set&&!Eh(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const Bh="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Bh);function Ih(e){let n,t,r,i,s,o,a;return{c(){n=_e("button"),t=_e("div"),r=Nt(e[1]),i=me(),s=_e("input"),re(t,"class","pointer-events-none whitespace-pre-wrap p-4"),re(n,"class",e[7]),re(n,"style",e[6]),re(s,"class","hidden"),re(s,"type","file"),s.multiple=e[2],re(s,"accept",e[5])},m(l,c){de(l,n,c),oe(n,t),oe(t,r),de(l,i,c),de(l,s,c),e[28](s),o||(a=[qe(n,"dragenter",e[26]),qe(n,"dragleave",e[27]),qe(n,"dragover",Wo(e[25])),qe(n,"drop",Wo(e[10])),qe(n,"click",e[8]),qe(s,"change",e[9])],o=!0)},p(l,c){c[0]&2&&en(r,l[1]),c[0]&128&&re(n,"class",l[7]),c[0]&64&&re(n,"style",l[6]),c[0]&4&&(s.multiple=l[2]),c[0]&32&&re(s,"accept",l[5])},i:gt,o:gt,d(l){l&&(fe(n),fe(i),fe(s)),e[28](null),o=!1,_n(a)}}}function ul(e,n){const t=e,r=n.split("/");return t.filePath=n,t.parentFolder=r.length>2?r[r.length-2]:"/",t}function Oh(e){return e.isFile}function Dh(e){return e.isDirectory}function Nh(e){return new Promise((n,t)=>{e.file(r=>n(r),t)})}function hc(e){return new Promise((n,t)=>{e.readEntries(n,t)})}function Fh(e,n,t){let r,i,s,o,a,{disabled:l=!1}=n,{width:c="100%"}=n,{height:u="120px"}=n,{classes:f=""}=n,{dragClasses:m=""}=n,{label:g="Drag-and-drop files / folders to this zone or click it to select them"}=n,{allowRootFiles:_=!1}=n,{multiple:E=!1}=n,{preferNativeFilesystem:S=!1}=n,{fileFormatsDescription:b="Allowed files"}=n,{filePickerId:v="Dropzone"}=n,{fileFormats:y=[]}=n,{oldHandles:A=[]}=n,{oldFiles:d=[]}=n,{accepts:p=""}=n,{types:M=""}=n;const L=ei(),D="showOpenFilePicker"in window&&S;let O,x=!1;function Y(){if(!l){if(D)return L("start"),N();O.click()}}async function R({currentTarget:I}){var he;if(l||!((he=I.files)!=null&&he.length))return;const H=[...I.files],K={files:[],errors:[]};for(let ee=0,{length:ae}=H;ee<ae;ee+=1){const ge=ul(H[ee],"/"),Le=`.${ge.name.split(".").pop()}`;try{(!s.size||s.has(Le))&&(!a||a.test(ge.type))&&!d.find(He=>He===ge)&&K.files.push({file:ge,extension:Le})}catch({message:He}){K.errors.push(`Error on file ${ge.name} - ${He}`)}}I.value="",ne(K)}function w({dataTransfer:I}){if(t(3,x=!1),l||!I)return;const H=I.items,K=[];L("start");for(let he=0,{length:ee}=H;he<ee;he+=1){const ae=H[he];if(ae.kind==="file"){const ge=D?ae.getAsFileSystemHandle():ae.webkitGetAsEntry();ge&&K.push(Promise.resolve(ge))}}X(K)}async function N(){try{const I=[...s],H=await window.showOpenFilePicker({multiple:E,id:v,excludeAcceptAllOption:!!s.size,...s.size?{types:[{description:b,accept:{"*/*":I}}]}:{}});X(H.map(K=>Promise.resolve(K)))}catch(I){I.name==="AbortError"?ne():ne({files:[],errors:[`Error selecting file(s) - ${I.message}`]})}}async function X(I){const H={files:[],errors:[]};for(let K=0,{length:he}=I;K<he;K+=1){try{const ee=await I[K];if(ee){const ae=await q(ee);H.files.push(...ae.files),H.errors.push(...ae.errors)}}catch({message:ee}){H.errors.push(`Error processing entry - ${ee}`)}if(H.files.length&&!E)break}ne(H)}async function q(I,H="/"){const K={files:[],errors:[]};if(I instanceof FileSystemFileHandle){const he=`.${I.name.split(".").pop()}`;let ee=!1;if(s.size&&!s.has(he))return K;for(let ae=0,{length:ge}=A;ae<ge&&!ee;ae+=1)ee=await A[ae].isSameEntry(I).catch(()=>!1);return ee||await I.getFile().then(ae=>{const ge=ul(ae,H);(_||ge.filePath!=="/")&&(!a||a.test(ge.type))&&!d.find(Le=>Le===ge)&&K.files.push({file:ge,handle:I,extension:he})}).catch(({message:ae})=>K.errors.push(`Error reading file ${I.name} - ${ae}`)),K}else if(Oh(I)){const he=`.${I.name.split(".").pop()}`;return s.size&&!s.has(he)||await Nh(I).then(ee=>{const ae=ul(ee,I.fullPath);(_||ae.filePath!=="/")&&(!a||a.test(ae.type))&&!d.find(ge=>ge===ae)&&K.files.push({file:ae,extension:he})}).catch(({message:ee})=>K.errors.push(`Error reading file ${I.name} - ${ee}`)),K}else if(I instanceof FileSystemDirectoryHandle){const he=I.entries();let ee=await he.next().catch(({message:ae})=>(K.errors.push(`Error reading directory ${I.name} - ${ae}`),{done:!0,value:[]}));for(;!ee.done;){const[ae,ge]=ee.value,Le=await q(ge,`${H}${H==="/"?"":"/"}${I.name}${ge.kind==="file"?`/${ae}`:""}`);if(K.errors.push(...Le.errors),!K.files.length||E){const He=E?Le.files.length:1;for(let De=0;De<He;De++)K.files.push(Le.files[De])}ee=!K.files.length||E?await he.next().catch(({message:He})=>(K.errors.push(`Error reading directory ${I.name} - ${He}`),{done:!0,value:[]})):{done:!0,value:[]}}return K}else if(Dh(I))return Z(I.createReader(),I.fullPath||I.name);return K}async function Z(I,H){const K={files:[],errors:[]};let he=await hc(I).catch(({message:ee})=>(K.errors.push(`Error reading directory ${H} - ${ee}`),[]));for(;he.length;){for(let ee=0,ae=he.length;ee<ae;ee+=1){const ge=he[ee];try{const Le=await q(he[ee],ge.fullPath);if(K.errors.push(...Le.errors),!K.files.length||E){const He=E?Le.files.length:1;for(let De=0;De<He;De++)K.files.push(Le.files[De])}}catch({message:Le}){K.errors.push(`Error reading file ${ge.name} - ${Le}`)}if(K.files.length&&!E)break}he=!K.files.length||E?await hc(I).catch(({message:ee})=>(K.errors.push(`Error reading directory ${H} - ${ee}`),[])):[]}return K}function ne(I={files:[],errors:[]}){I.files.length||I.errors.length?L("result",I):L("stop")}function U(I){cr.call(this,e,I)}const F=()=>{l||t(3,x=!0)},C=()=>{l||t(3,x=!1)};function P(I){Gt[I?"unshift":"push"](()=>{O=I,t(4,O)})}return e.$$set=I=>{"disabled"in I&&t(0,l=I.disabled),"width"in I&&t(11,c=I.width),"height"in I&&t(12,u=I.height),"classes"in I&&t(13,f=I.classes),"dragClasses"in I&&t(14,m=I.dragClasses),"label"in I&&t(1,g=I.label),"allowRootFiles"in I&&t(15,_=I.allowRootFiles),"multiple"in I&&t(2,E=I.multiple),"preferNativeFilesystem"in I&&t(16,S=I.preferNativeFilesystem),"fileFormatsDescription"in I&&t(17,b=I.fileFormatsDescription),"filePickerId"in I&&t(18,v=I.filePickerId),"fileFormats"in I&&t(19,y=I.fileFormats),"oldHandles"in I&&t(20,A=I.oldHandles),"oldFiles"in I&&t(21,d=I.oldFiles),"accepts"in I&&t(22,p=I.accepts),"types"in I&&t(23,M=I.types)},e.$$.update=()=>{e.$$.dirty[0]&24584&&t(7,r=`dropzone flex justify-center items-center relative ${f||""} ${x?m:""}`),e.$$.dirty[0]&6144&&t(6,i=`width: ${c}; height: ${u};`),e.$$.dirty[0]&524288&&t(24,s=y.length?new Set(y):new Set),e.$$.dirty[0]&20971520&&t(5,o=p||[...s].join(",")||"*"),e.$$.dirty[0]&8388608&&(a=M?new RegExp(M):void 0)},[l,g,E,x,O,o,i,r,Y,R,w,c,u,f,m,_,S,b,v,y,A,d,p,M,s,U,F,C,P]}class $h extends vn{constructor(n){super(),wn(this,n,Fh,Ih,pn,{disabled:0,width:11,height:12,classes:13,dragClasses:14,label:1,allowRootFiles:15,multiple:2,preferNativeFilesystem:16,fileFormatsDescription:17,filePickerId:18,fileFormats:19,oldHandles:20,oldFiles:21,accepts:22,types:23},null,[-1,-1])}}function Vh(e){let n,t,r,i,s;return{c(){n=Di("svg"),t=Di("path"),re(t,"d",e[1]),re(n,"tabindex","0"),re(n,"role","button"),xn(n,"width",e[2]),xn(n,"height",e[3]),re(n,"viewBox","0 0 24 24"),re(n,"fill","currentColor"),re(n,"class",r=`icon ${e[4]}`)},m(o,a){de(o,n,a),oe(n,t),e[7](n),i||(s=[qe(n,"click",e[5]),qe(n,"keyup",e[6])],i=!0)},p(o,[a]){a&2&&re(t,"d",o[1]),a&4&&xn(n,"width",o[2]),a&8&&xn(n,"height",o[3]),a&16&&r!==(r=`icon ${o[4]}`)&&re(n,"class",r)},i:gt,o:gt,d(o){o&&fe(n),e[7](null),i=!1,_n(s)}}}function xh(e,n,t){let{path:r}=n,{width:i="1.4rem"}=n,{height:s="1.4rem"}=n,{element:o=void 0}=n,{class:a=""}=n;function l(f){cr.call(this,e,f)}function c(f){cr.call(this,e,f)}function u(f){Gt[f?"unshift":"push"](()=>{o=f,t(0,o)})}return e.$$set=f=>{"path"in f&&t(1,r=f.path),"width"in f&&t(2,i=f.width),"height"in f&&t(3,s=f.height),"element"in f&&t(0,o=f.element),"class"in f&&t(4,a=f.class)},[o,r,i,s,a,l,c,u]}class At extends vn{constructor(n){super(),wn(this,n,xh,Vh,pn,{path:1,width:2,height:3,element:0,class:4})}}var pc={},Yo={};Yo.byteLength=Wh,Yo.toByteArray=Gh,Yo.fromByteArray=Yh;for(var Hr=[],Ar=[],Hh=typeof Uint8Array<"u"?Uint8Array:Array,cl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vs=0,Uh=cl.length;vs<Uh;++vs)Hr[vs]=cl[vs],Ar[cl.charCodeAt(vs)]=vs;Ar[45]=62,Ar[95]=63;function mc(e){var n=e.length;if(n%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=e.indexOf("=");t===-1&&(t=n);var r=t===n?0:4-t%4;return[t,r]}function Wh(e){var n=mc(e),t=n[0],r=n[1];return(t+r)*3/4-r}function jh(e,n,t){return(n+t)*3/4-t}function Gh(e){var n,t=mc(e),r=t[0],i=t[1],s=new Hh(jh(e,r,i)),o=0,a=i>0?r-4:r,l;for(l=0;l<a;l+=4)n=Ar[e.charCodeAt(l)]<<18|Ar[e.charCodeAt(l+1)]<<12|Ar[e.charCodeAt(l+2)]<<6|Ar[e.charCodeAt(l+3)],s[o++]=n>>16&255,s[o++]=n>>8&255,s[o++]=n&255;return i===2&&(n=Ar[e.charCodeAt(l)]<<2|Ar[e.charCodeAt(l+1)]>>4,s[o++]=n&255),i===1&&(n=Ar[e.charCodeAt(l)]<<10|Ar[e.charCodeAt(l+1)]<<4|Ar[e.charCodeAt(l+2)]>>2,s[o++]=n>>8&255,s[o++]=n&255),s}function zh(e){return Hr[e>>18&63]+Hr[e>>12&63]+Hr[e>>6&63]+Hr[e&63]}function Xh(e,n,t){for(var r,i=[],s=n;s<t;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(zh(r));return i.join("")}function Yh(e){for(var n,t=e.length,r=t%3,i=[],s=16383,o=0,a=t-r;o<a;o+=s)i.push(Xh(e,o,o+s>a?a:o+s));return r===1?(n=e[t-1],i.push(Hr[n>>2]+Hr[n<<4&63]+"==")):r===2&&(n=(e[t-2]<<8)+e[t-1],i.push(Hr[n>>10]+Hr[n>>4&63]+Hr[n<<2&63]+"=")),i.join("")}var fl={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */fl.read=function(e,n,t,r,i){var s,o,a=i*8-r-1,l=(1<<a)-1,c=l>>1,u=-7,f=t?i-1:0,m=t?-1:1,g=e[n+f];for(f+=m,s=g&(1<<-u)-1,g>>=-u,u+=a;u>0;s=s*256+e[n+f],f+=m,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[n+f],f+=m,u-=8);if(s===0)s=1-c;else{if(s===l)return o?NaN:(g?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-c}return(g?-1:1)*o*Math.pow(2,s-r)},fl.write=function(e,n,t,r,i,s){var o,a,l,c=s*8-i-1,u=(1<<c)-1,f=u>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=r?0:s-1,_=r?1:-1,E=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(a=isNaN(n)?1:0,o=u):(o=Math.floor(Math.log(n)/Math.LN2),n*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+f>=1?n+=m/l:n+=m*Math.pow(2,1-f),n*l>=2&&(o++,l/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(n*l-1)*Math.pow(2,i),o=o+f):(a=n*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[t+g]=a&255,g+=_,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;e[t+g]=o&255,g+=_,o/=256,c-=8);e[t+g-_]|=E*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const n=Yo,t=fl,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=d,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=l(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function l(){try{const W=new s(1),k={foo:function(){return 42}};return Object.setPrototypeOf(k,s.prototype),Object.setPrototypeOf(W,k),W.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function c(W){if(W>i)throw new RangeError('The value "'+W+'" is invalid for option "size"');const k=new s(W);return Object.setPrototypeOf(k,u.prototype),k}function u(W,k,h){if(typeof W=="number"){if(typeof k=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return _(W)}return f(W,k,h)}u.poolSize=8192;function f(W,k,h){if(typeof W=="string")return E(W,k);if(o.isView(W))return b(W);if(W==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof W);if(Je(W,o)||W&&Je(W.buffer,o)||typeof a<"u"&&(Je(W,a)||W&&Je(W.buffer,a)))return v(W,k,h);if(typeof W=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const T=W.valueOf&&W.valueOf();if(T!=null&&T!==W)return u.from(T,k,h);const $=y(W);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof W[Symbol.toPrimitive]=="function")return u.from(W[Symbol.toPrimitive]("string"),k,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof W)}u.from=function(W,k,h){return f(W,k,h)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function m(W){if(typeof W!="number")throw new TypeError('"size" argument must be of type number');if(W<0)throw new RangeError('The value "'+W+'" is invalid for option "size"')}function g(W,k,h){return m(W),W<=0?c(W):k!==void 0?typeof h=="string"?c(W).fill(k,h):c(W).fill(k):c(W)}u.alloc=function(W,k,h){return g(W,k,h)};function _(W){return m(W),c(W<0?0:A(W)|0)}u.allocUnsafe=function(W){return _(W)},u.allocUnsafeSlow=function(W){return _(W)};function E(W,k){if((typeof k!="string"||k==="")&&(k="utf8"),!u.isEncoding(k))throw new TypeError("Unknown encoding: "+k);const h=p(W,k)|0;let T=c(h);const $=T.write(W,k);return $!==h&&(T=T.slice(0,$)),T}function S(W){const k=W.length<0?0:A(W.length)|0,h=c(k);for(let T=0;T<k;T+=1)h[T]=W[T]&255;return h}function b(W){if(Je(W,s)){const k=new s(W);return v(k.buffer,k.byteOffset,k.byteLength)}return S(W)}function v(W,k,h){if(k<0||W.byteLength<k)throw new RangeError('"offset" is outside of buffer bounds');if(W.byteLength<k+(h||0))throw new RangeError('"length" is outside of buffer bounds');let T;return k===void 0&&h===void 0?T=new s(W):h===void 0?T=new s(W,k):T=new s(W,k,h),Object.setPrototypeOf(T,u.prototype),T}function y(W){if(u.isBuffer(W)){const k=A(W.length)|0,h=c(k);return h.length===0||W.copy(h,0,0,k),h}if(W.length!==void 0)return typeof W.length!="number"||ze(W.length)?c(0):S(W);if(W.type==="Buffer"&&Array.isArray(W.data))return S(W.data)}function A(W){if(W>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return W|0}function d(W){return+W!=W&&(W=0),u.alloc(+W)}u.isBuffer=function(k){return k!=null&&k._isBuffer===!0&&k!==u.prototype},u.compare=function(k,h){if(Je(k,s)&&(k=u.from(k,k.offset,k.byteLength)),Je(h,s)&&(h=u.from(h,h.offset,h.byteLength)),!u.isBuffer(k)||!u.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(k===h)return 0;let T=k.length,$=h.length;for(let j=0,J=Math.min(T,$);j<J;++j)if(k[j]!==h[j]){T=k[j],$=h[j];break}return T<$?-1:$<T?1:0},u.isEncoding=function(k){switch(String(k).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(k,h){if(!Array.isArray(k))throw new TypeError('"list" argument must be an Array of Buffers');if(k.length===0)return u.alloc(0);let T;if(h===void 0)for(h=0,T=0;T<k.length;++T)h+=k[T].length;const $=u.allocUnsafe(h);let j=0;for(T=0;T<k.length;++T){let J=k[T];if(Je(J,s))j+J.length>$.length?(u.isBuffer(J)||(J=u.from(J)),J.copy($,j)):s.prototype.set.call($,J,j);else if(u.isBuffer(J))J.copy($,j);else throw new TypeError('"list" argument must be an Array of Buffers');j+=J.length}return $};function p(W,k){if(u.isBuffer(W))return W.length;if(o.isView(W)||Je(W,o))return W.byteLength;if(typeof W!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof W);const h=W.length,T=arguments.length>2&&arguments[2]===!0;if(!T&&h===0)return 0;let $=!1;for(;;)switch(k){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return V(W).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return Ke(W).length;default:if($)return T?-1:V(W).length;k=(""+k).toLowerCase(),$=!0}}u.byteLength=p;function M(W,k,h){let T=!1;if((k===void 0||k<0)&&(k=0),k>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,k>>>=0,h<=k))return"";for(W||(W="utf8");;)switch(W){case"hex":return C(this,k,h);case"utf8":case"utf-8":return q(this,k,h);case"ascii":return U(this,k,h);case"latin1":case"binary":return F(this,k,h);case"base64":return X(this,k,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,k,h);default:if(T)throw new TypeError("Unknown encoding: "+W);W=(W+"").toLowerCase(),T=!0}}u.prototype._isBuffer=!0;function L(W,k,h){const T=W[k];W[k]=W[h],W[h]=T}u.prototype.swap16=function(){const k=this.length;if(k%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<k;h+=2)L(this,h,h+1);return this},u.prototype.swap32=function(){const k=this.length;if(k%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<k;h+=4)L(this,h,h+3),L(this,h+1,h+2);return this},u.prototype.swap64=function(){const k=this.length;if(k%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<k;h+=8)L(this,h,h+7),L(this,h+1,h+6),L(this,h+2,h+5),L(this,h+3,h+4);return this},u.prototype.toString=function(){const k=this.length;return k===0?"":arguments.length===0?q(this,0,k):M.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(k){if(!u.isBuffer(k))throw new TypeError("Argument must be a Buffer");return this===k?!0:u.compare(this,k)===0},u.prototype.inspect=function(){let k="";const h=e.INSPECT_MAX_BYTES;return k=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(k+=" ... "),"<Buffer "+k+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(k,h,T,$,j){if(Je(k,s)&&(k=u.from(k,k.offset,k.byteLength)),!u.isBuffer(k))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof k);if(h===void 0&&(h=0),T===void 0&&(T=k?k.length:0),$===void 0&&($=0),j===void 0&&(j=this.length),h<0||T>k.length||$<0||j>this.length)throw new RangeError("out of range index");if($>=j&&h>=T)return 0;if($>=j)return-1;if(h>=T)return 1;if(h>>>=0,T>>>=0,$>>>=0,j>>>=0,this===k)return 0;let J=j-$,Q=T-h;const ce=Math.min(J,Q),ie=this.slice($,j),le=k.slice(h,T);for(let ve=0;ve<ce;++ve)if(ie[ve]!==le[ve]){J=ie[ve],Q=le[ve];break}return J<Q?-1:Q<J?1:0};function D(W,k,h,T,$){if(W.length===0)return-1;if(typeof h=="string"?(T=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,ze(h)&&(h=$?0:W.length-1),h<0&&(h=W.length+h),h>=W.length){if($)return-1;h=W.length-1}else if(h<0)if($)h=0;else return-1;if(typeof k=="string"&&(k=u.from(k,T)),u.isBuffer(k))return k.length===0?-1:O(W,k,h,T,$);if(typeof k=="number")return k=k&255,typeof s.prototype.indexOf=="function"?$?s.prototype.indexOf.call(W,k,h):s.prototype.lastIndexOf.call(W,k,h):O(W,[k],h,T,$);throw new TypeError("val must be string, number or Buffer")}function O(W,k,h,T,$){let j=1,J=W.length,Q=k.length;if(T!==void 0&&(T=String(T).toLowerCase(),T==="ucs2"||T==="ucs-2"||T==="utf16le"||T==="utf-16le")){if(W.length<2||k.length<2)return-1;j=2,J/=2,Q/=2,h/=2}function ce(le,ve){return j===1?le[ve]:le.readUInt16BE(ve*j)}let ie;if($){let le=-1;for(ie=h;ie<J;ie++)if(ce(W,ie)===ce(k,le===-1?0:ie-le)){if(le===-1&&(le=ie),ie-le+1===Q)return le*j}else le!==-1&&(ie-=ie-le),le=-1}else for(h+Q>J&&(h=J-Q),ie=h;ie>=0;ie--){let le=!0;for(let ve=0;ve<Q;ve++)if(ce(W,ie+ve)!==ce(k,ve)){le=!1;break}if(le)return ie}return-1}u.prototype.includes=function(k,h,T){return this.indexOf(k,h,T)!==-1},u.prototype.indexOf=function(k,h,T){return D(this,k,h,T,!0)},u.prototype.lastIndexOf=function(k,h,T){return D(this,k,h,T,!1)};function x(W,k,h,T){h=Number(h)||0;const $=W.length-h;T?(T=Number(T),T>$&&(T=$)):T=$;const j=k.length;T>j/2&&(T=j/2);let J;for(J=0;J<T;++J){const Q=parseInt(k.substr(J*2,2),16);if(ze(Q))return J;W[h+J]=Q}return J}function Y(W,k,h,T){return et(V(k,W.length-h),W,h,T)}function R(W,k,h,T){return et(ye(k),W,h,T)}function w(W,k,h,T){return et(Ke(k),W,h,T)}function N(W,k,h,T){return et(Ae(k,W.length-h),W,h,T)}u.prototype.write=function(k,h,T,$){if(h===void 0)$="utf8",T=this.length,h=0;else if(T===void 0&&typeof h=="string")$=h,T=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(T)?(T=T>>>0,$===void 0&&($="utf8")):($=T,T=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const j=this.length-h;if((T===void 0||T>j)&&(T=j),k.length>0&&(T<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");$||($="utf8");let J=!1;for(;;)switch($){case"hex":return x(this,k,h,T);case"utf8":case"utf-8":return Y(this,k,h,T);case"ascii":case"latin1":case"binary":return R(this,k,h,T);case"base64":return w(this,k,h,T);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,k,h,T);default:if(J)throw new TypeError("Unknown encoding: "+$);$=(""+$).toLowerCase(),J=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(W,k,h){return k===0&&h===W.length?n.fromByteArray(W):n.fromByteArray(W.slice(k,h))}function q(W,k,h){h=Math.min(W.length,h);const T=[];let $=k;for(;$<h;){const j=W[$];let J=null,Q=j>239?4:j>223?3:j>191?2:1;if($+Q<=h){let ce,ie,le,ve;switch(Q){case 1:j<128&&(J=j);break;case 2:ce=W[$+1],(ce&192)===128&&(ve=(j&31)<<6|ce&63,ve>127&&(J=ve));break;case 3:ce=W[$+1],ie=W[$+2],(ce&192)===128&&(ie&192)===128&&(ve=(j&15)<<12|(ce&63)<<6|ie&63,ve>2047&&(ve<55296||ve>57343)&&(J=ve));break;case 4:ce=W[$+1],ie=W[$+2],le=W[$+3],(ce&192)===128&&(ie&192)===128&&(le&192)===128&&(ve=(j&15)<<18|(ce&63)<<12|(ie&63)<<6|le&63,ve>65535&&ve<1114112&&(J=ve))}}J===null?(J=65533,Q=1):J>65535&&(J-=65536,T.push(J>>>10&1023|55296),J=56320|J&1023),T.push(J),$+=Q}return ne(T)}const Z=4096;function ne(W){const k=W.length;if(k<=Z)return String.fromCharCode.apply(String,W);let h="",T=0;for(;T<k;)h+=String.fromCharCode.apply(String,W.slice(T,T+=Z));return h}function U(W,k,h){let T="";h=Math.min(W.length,h);for(let $=k;$<h;++$)T+=String.fromCharCode(W[$]&127);return T}function F(W,k,h){let T="";h=Math.min(W.length,h);for(let $=k;$<h;++$)T+=String.fromCharCode(W[$]);return T}function C(W,k,h){const T=W.length;(!k||k<0)&&(k=0),(!h||h<0||h>T)&&(h=T);let $="";for(let j=k;j<h;++j)$+=ut[W[j]];return $}function P(W,k,h){const T=W.slice(k,h);let $="";for(let j=0;j<T.length-1;j+=2)$+=String.fromCharCode(T[j]+T[j+1]*256);return $}u.prototype.slice=function(k,h){const T=this.length;k=~~k,h=h===void 0?T:~~h,k<0?(k+=T,k<0&&(k=0)):k>T&&(k=T),h<0?(h+=T,h<0&&(h=0)):h>T&&(h=T),h<k&&(h=k);const $=this.subarray(k,h);return Object.setPrototypeOf($,u.prototype),$};function I(W,k,h){if(W%1!==0||W<0)throw new RangeError("offset is not uint");if(W+k>h)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(k,h,T){k=k>>>0,h=h>>>0,T||I(k,h,this.length);let $=this[k],j=1,J=0;for(;++J<h&&(j*=256);)$+=this[k+J]*j;return $},u.prototype.readUintBE=u.prototype.readUIntBE=function(k,h,T){k=k>>>0,h=h>>>0,T||I(k,h,this.length);let $=this[k+--h],j=1;for(;h>0&&(j*=256);)$+=this[k+--h]*j;return $},u.prototype.readUint8=u.prototype.readUInt8=function(k,h){return k=k>>>0,h||I(k,1,this.length),this[k]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(k,h){return k=k>>>0,h||I(k,2,this.length),this[k]|this[k+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(k,h){return k=k>>>0,h||I(k,2,this.length),this[k]<<8|this[k+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(k,h){return k=k>>>0,h||I(k,4,this.length),(this[k]|this[k+1]<<8|this[k+2]<<16)+this[k+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(k,h){return k=k>>>0,h||I(k,4,this.length),this[k]*16777216+(this[k+1]<<16|this[k+2]<<8|this[k+3])},u.prototype.readBigUInt64LE=nt(function(k){k=k>>>0,Re(k,"offset");const h=this[k],T=this[k+7];(h===void 0||T===void 0)&&Xe(k,this.length-8);const $=h+this[++k]*2**8+this[++k]*2**16+this[++k]*2**24,j=this[++k]+this[++k]*2**8+this[++k]*2**16+T*2**24;return BigInt($)+(BigInt(j)<<BigInt(32))}),u.prototype.readBigUInt64BE=nt(function(k){k=k>>>0,Re(k,"offset");const h=this[k],T=this[k+7];(h===void 0||T===void 0)&&Xe(k,this.length-8);const $=h*2**24+this[++k]*2**16+this[++k]*2**8+this[++k],j=this[++k]*2**24+this[++k]*2**16+this[++k]*2**8+T;return(BigInt($)<<BigInt(32))+BigInt(j)}),u.prototype.readIntLE=function(k,h,T){k=k>>>0,h=h>>>0,T||I(k,h,this.length);let $=this[k],j=1,J=0;for(;++J<h&&(j*=256);)$+=this[k+J]*j;return j*=128,$>=j&&($-=Math.pow(2,8*h)),$},u.prototype.readIntBE=function(k,h,T){k=k>>>0,h=h>>>0,T||I(k,h,this.length);let $=h,j=1,J=this[k+--$];for(;$>0&&(j*=256);)J+=this[k+--$]*j;return j*=128,J>=j&&(J-=Math.pow(2,8*h)),J},u.prototype.readInt8=function(k,h){return k=k>>>0,h||I(k,1,this.length),this[k]&128?(255-this[k]+1)*-1:this[k]},u.prototype.readInt16LE=function(k,h){k=k>>>0,h||I(k,2,this.length);const T=this[k]|this[k+1]<<8;return T&32768?T|4294901760:T},u.prototype.readInt16BE=function(k,h){k=k>>>0,h||I(k,2,this.length);const T=this[k+1]|this[k]<<8;return T&32768?T|4294901760:T},u.prototype.readInt32LE=function(k,h){return k=k>>>0,h||I(k,4,this.length),this[k]|this[k+1]<<8|this[k+2]<<16|this[k+3]<<24},u.prototype.readInt32BE=function(k,h){return k=k>>>0,h||I(k,4,this.length),this[k]<<24|this[k+1]<<16|this[k+2]<<8|this[k+3]},u.prototype.readBigInt64LE=nt(function(k){k=k>>>0,Re(k,"offset");const h=this[k],T=this[k+7];(h===void 0||T===void 0)&&Xe(k,this.length-8);const $=this[k+4]+this[k+5]*2**8+this[k+6]*2**16+(T<<24);return(BigInt($)<<BigInt(32))+BigInt(h+this[++k]*2**8+this[++k]*2**16+this[++k]*2**24)}),u.prototype.readBigInt64BE=nt(function(k){k=k>>>0,Re(k,"offset");const h=this[k],T=this[k+7];(h===void 0||T===void 0)&&Xe(k,this.length-8);const $=(h<<24)+this[++k]*2**16+this[++k]*2**8+this[++k];return(BigInt($)<<BigInt(32))+BigInt(this[++k]*2**24+this[++k]*2**16+this[++k]*2**8+T)}),u.prototype.readFloatLE=function(k,h){return k=k>>>0,h||I(k,4,this.length),t.read(this,k,!0,23,4)},u.prototype.readFloatBE=function(k,h){return k=k>>>0,h||I(k,4,this.length),t.read(this,k,!1,23,4)},u.prototype.readDoubleLE=function(k,h){return k=k>>>0,h||I(k,8,this.length),t.read(this,k,!0,52,8)},u.prototype.readDoubleBE=function(k,h){return k=k>>>0,h||I(k,8,this.length),t.read(this,k,!1,52,8)};function H(W,k,h,T,$,j){if(!u.isBuffer(W))throw new TypeError('"buffer" argument must be a Buffer instance');if(k>$||k<j)throw new RangeError('"value" argument is out of bounds');if(h+T>W.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(k,h,T,$){if(k=+k,h=h>>>0,T=T>>>0,!$){const Q=Math.pow(2,8*T)-1;H(this,k,h,T,Q,0)}let j=1,J=0;for(this[h]=k&255;++J<T&&(j*=256);)this[h+J]=k/j&255;return h+T},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(k,h,T,$){if(k=+k,h=h>>>0,T=T>>>0,!$){const Q=Math.pow(2,8*T)-1;H(this,k,h,T,Q,0)}let j=T-1,J=1;for(this[h+j]=k&255;--j>=0&&(J*=256);)this[h+j]=k/J&255;return h+T},u.prototype.writeUint8=u.prototype.writeUInt8=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,1,255,0),this[h]=k&255,h+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,2,65535,0),this[h]=k&255,this[h+1]=k>>>8,h+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,2,65535,0),this[h]=k>>>8,this[h+1]=k&255,h+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,4,4294967295,0),this[h+3]=k>>>24,this[h+2]=k>>>16,this[h+1]=k>>>8,this[h]=k&255,h+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,4,4294967295,0),this[h]=k>>>24,this[h+1]=k>>>16,this[h+2]=k>>>8,this[h+3]=k&255,h+4};function K(W,k,h,T,$){be(k,T,$,W,h,7);let j=Number(k&BigInt(4294967295));W[h++]=j,j=j>>8,W[h++]=j,j=j>>8,W[h++]=j,j=j>>8,W[h++]=j;let J=Number(k>>BigInt(32)&BigInt(4294967295));return W[h++]=J,J=J>>8,W[h++]=J,J=J>>8,W[h++]=J,J=J>>8,W[h++]=J,h}function he(W,k,h,T,$){be(k,T,$,W,h,7);let j=Number(k&BigInt(4294967295));W[h+7]=j,j=j>>8,W[h+6]=j,j=j>>8,W[h+5]=j,j=j>>8,W[h+4]=j;let J=Number(k>>BigInt(32)&BigInt(4294967295));return W[h+3]=J,J=J>>8,W[h+2]=J,J=J>>8,W[h+1]=J,J=J>>8,W[h]=J,h+8}u.prototype.writeBigUInt64LE=nt(function(k,h=0){return K(this,k,h,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=nt(function(k,h=0){return he(this,k,h,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(k,h,T,$){if(k=+k,h=h>>>0,!$){const ce=Math.pow(2,8*T-1);H(this,k,h,T,ce-1,-ce)}let j=0,J=1,Q=0;for(this[h]=k&255;++j<T&&(J*=256);)k<0&&Q===0&&this[h+j-1]!==0&&(Q=1),this[h+j]=(k/J>>0)-Q&255;return h+T},u.prototype.writeIntBE=function(k,h,T,$){if(k=+k,h=h>>>0,!$){const ce=Math.pow(2,8*T-1);H(this,k,h,T,ce-1,-ce)}let j=T-1,J=1,Q=0;for(this[h+j]=k&255;--j>=0&&(J*=256);)k<0&&Q===0&&this[h+j+1]!==0&&(Q=1),this[h+j]=(k/J>>0)-Q&255;return h+T},u.prototype.writeInt8=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,1,127,-128),k<0&&(k=255+k+1),this[h]=k&255,h+1},u.prototype.writeInt16LE=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,2,32767,-32768),this[h]=k&255,this[h+1]=k>>>8,h+2},u.prototype.writeInt16BE=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,2,32767,-32768),this[h]=k>>>8,this[h+1]=k&255,h+2},u.prototype.writeInt32LE=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,4,2147483647,-2147483648),this[h]=k&255,this[h+1]=k>>>8,this[h+2]=k>>>16,this[h+3]=k>>>24,h+4},u.prototype.writeInt32BE=function(k,h,T){return k=+k,h=h>>>0,T||H(this,k,h,4,2147483647,-2147483648),k<0&&(k=4294967295+k+1),this[h]=k>>>24,this[h+1]=k>>>16,this[h+2]=k>>>8,this[h+3]=k&255,h+4},u.prototype.writeBigInt64LE=nt(function(k,h=0){return K(this,k,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=nt(function(k,h=0){return he(this,k,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ee(W,k,h,T,$,j){if(h+T>W.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function ae(W,k,h,T,$){return k=+k,h=h>>>0,$||ee(W,k,h,4),t.write(W,k,h,T,23,4),h+4}u.prototype.writeFloatLE=function(k,h,T){return ae(this,k,h,!0,T)},u.prototype.writeFloatBE=function(k,h,T){return ae(this,k,h,!1,T)};function ge(W,k,h,T,$){return k=+k,h=h>>>0,$||ee(W,k,h,8),t.write(W,k,h,T,52,8),h+8}u.prototype.writeDoubleLE=function(k,h,T){return ge(this,k,h,!0,T)},u.prototype.writeDoubleBE=function(k,h,T){return ge(this,k,h,!1,T)},u.prototype.copy=function(k,h,T,$){if(!u.isBuffer(k))throw new TypeError("argument should be a Buffer");if(T||(T=0),!$&&$!==0&&($=this.length),h>=k.length&&(h=k.length),h||(h=0),$>0&&$<T&&($=T),$===T||k.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(T<0||T>=this.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("sourceEnd out of bounds");$>this.length&&($=this.length),k.length-h<$-T&&($=k.length-h+T);const j=$-T;return this===k&&typeof s.prototype.copyWithin=="function"?this.copyWithin(h,T,$):s.prototype.set.call(k,this.subarray(T,$),h),j},u.prototype.fill=function(k,h,T,$){if(typeof k=="string"){if(typeof h=="string"?($=h,h=0,T=this.length):typeof T=="string"&&($=T,T=this.length),$!==void 0&&typeof $!="string")throw new TypeError("encoding must be a string");if(typeof $=="string"&&!u.isEncoding($))throw new TypeError("Unknown encoding: "+$);if(k.length===1){const J=k.charCodeAt(0);($==="utf8"&&J<128||$==="latin1")&&(k=J)}}else typeof k=="number"?k=k&255:typeof k=="boolean"&&(k=Number(k));if(h<0||this.length<h||this.length<T)throw new RangeError("Out of range index");if(T<=h)return this;h=h>>>0,T=T===void 0?this.length:T>>>0,k||(k=0);let j;if(typeof k=="number")for(j=h;j<T;++j)this[j]=k;else{const J=u.isBuffer(k)?k:u.from(k,$),Q=J.length;if(Q===0)throw new TypeError('The value "'+k+'" is invalid for argument "value"');for(j=0;j<T-h;++j)this[j+h]=J[j%Q]}return this};const Le={};function He(W,k,h){Le[W]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:k.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${W}]`,this.stack,delete this.name}get code(){return W}set code($){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:$,writable:!0})}toString(){return`${this.name} [${W}]: ${this.message}`}}}He("ERR_BUFFER_OUT_OF_BOUNDS",function(W){return W?`${W} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),He("ERR_INVALID_ARG_TYPE",function(W,k){return`The "${W}" argument must be of type number. Received type ${typeof k}`},TypeError),He("ERR_OUT_OF_RANGE",function(W,k,h){let T=`The value of "${W}" is out of range.`,$=h;return Number.isInteger(h)&&Math.abs(h)>2**32?$=De(String(h)):typeof h=="bigint"&&($=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&($=De($)),$+="n"),T+=` It must be ${k}. Received ${$}`,T},RangeError);function De(W){let k="",h=W.length;const T=W[0]==="-"?1:0;for(;h>=T+4;h-=3)k=`_${W.slice(h-3,h)}${k}`;return`${W.slice(0,h)}${k}`}function Ue(W,k,h){Re(k,"offset"),(W[k]===void 0||W[k+h]===void 0)&&Xe(k,W.length-(h+1))}function be(W,k,h,T,$,j){if(W>h||W<k){const J=typeof k=="bigint"?"n":"";let Q;throw j>3?k===0||k===BigInt(0)?Q=`>= 0${J} and < 2${J} ** ${(j+1)*8}${J}`:Q=`>= -(2${J} ** ${(j+1)*8-1}${J}) and < 2 ** ${(j+1)*8-1}${J}`:Q=`>= ${k}${J} and <= ${h}${J}`,new Le.ERR_OUT_OF_RANGE("value",Q,W)}Ue(T,$,j)}function Re(W,k){if(typeof W!="number")throw new Le.ERR_INVALID_ARG_TYPE(k,"number",W)}function Xe(W,k,h){throw Math.floor(W)!==W?(Re(W,h),new Le.ERR_OUT_OF_RANGE(h||"offset","an integer",W)):k<0?new Le.ERR_BUFFER_OUT_OF_BOUNDS:new Le.ERR_OUT_OF_RANGE(h||"offset",`>= ${h?1:0} and <= ${k}`,W)}const Ne=/[^+/0-9A-Za-z-_]/g;function B(W){if(W=W.split("=")[0],W=W.trim().replace(Ne,""),W.length<2)return"";for(;W.length%4!==0;)W=W+"=";return W}function V(W,k){k=k||1/0;let h;const T=W.length;let $=null;const j=[];for(let J=0;J<T;++J){if(h=W.charCodeAt(J),h>55295&&h<57344){if(!$){if(h>56319){(k-=3)>-1&&j.push(239,191,189);continue}else if(J+1===T){(k-=3)>-1&&j.push(239,191,189);continue}$=h;continue}if(h<56320){(k-=3)>-1&&j.push(239,191,189),$=h;continue}h=($-55296<<10|h-56320)+65536}else $&&(k-=3)>-1&&j.push(239,191,189);if($=null,h<128){if((k-=1)<0)break;j.push(h)}else if(h<2048){if((k-=2)<0)break;j.push(h>>6|192,h&63|128)}else if(h<65536){if((k-=3)<0)break;j.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((k-=4)<0)break;j.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return j}function ye(W){const k=[];for(let h=0;h<W.length;++h)k.push(W.charCodeAt(h)&255);return k}function Ae(W,k){let h,T,$;const j=[];for(let J=0;J<W.length&&!((k-=2)<0);++J)h=W.charCodeAt(J),T=h>>8,$=h%256,j.push($),j.push(T);return j}function Ke(W){return n.toByteArray(B(W))}function et(W,k,h,T){let $;for($=0;$<T&&!($+h>=k.length||$>=W.length);++$)k[$+h]=W[$];return $}function Je(W,k){return W instanceof k||W!=null&&W.constructor!=null&&W.constructor.name!=null&&W.constructor.name===k.name}function ze(W){return W!==W}const ut=function(){const W="0123456789abcdef",k=new Array(256);for(let h=0;h<16;++h){const T=h*16;for(let $=0;$<16;++$)k[T+$]=W[h]+W[$]}return k}();function nt(W){return typeof BigInt>"u"?Ye:W}function Ye(){throw new Error("BigInt not supported")}})(pc);const _c=pc.Buffer,qh=Zh();var Ur=(e=>(e.NONE="none",e.READER="Reader",e.SUBTITLES="Subtitles",e.PLAYER="Player",e.EXPORT="Export",e.ANKI="Anki",e.KEYBINDINGS="Keybindings",e))(Ur||{}),qo=(e=>(e.DISABLED="Disabled",e.PAUSE="Pause on open",e))(qo||{}),rr=(e=>(e.DISABLED="Disabled",e.CLICK="On click",e.HOLD="On hold",e))(rr||{}),Qn=(e=>(e.HIDDEN="Hidden",e.ALWAYS="Always visible",e.HOVER="On hover",e.TOGGLE="Toggle on hold",e))(Qn||{}),yr=(e=>(e.DISABLED="Disabled",e.MODERATE="Moderate",e.STRICT="Strict",e))(yr||{}),Jn=(e=>(e.RECORDER="Recorder",e.FFMPEG="FFMPEG",e))(Jn||{}),Ei=(e=>(e.MP3="mp3",e.OGG="ogg",e.OPUS="opus",e))(Ei||{}),Vi=(e=>(e.BEFORE="Insert before",e.AFTER="Insert after",e.REPLACE="Replace",e))(Vi||{}),Wr=(e=>(e.DISABLED="Disabled",e.DECK="Deck",e.SUBDECK="Deck and children",e.COLLECTION="Collection",e))(Wr||{}),ti=(e=>(e.ORIGINAL="Original",e.LEADING_TRAILING="Leading/Trailing removed",e.ALL="All removed",e))(ti||{});function Zh(){return{"ttu-whispersync-reader-line-highlight-color":"#fffa82","ttu-whispersync-reader-line-text-highlight-color":"#000000","ttu-whispersync-reader-enable-line-highlight":!0,"ttu-whispersync-reader-enable-auto-reload":!0,"ttu-whispersync-reader-enable-auto-scroll":!0,"ttu-whispersync-reader-enable-tracker-auto-pause":!0,"ttu-whispersync-reader-prevent-action-on-selection":!0,"ttu-whispersync-reader-click-action":"None","ttu-whispersync-reader-menu-open-mode":"On click","ttu-whispersync-reader-menu-pause-mode":"Pause on open","ttu-whispersync-reader-menu-open-time":500,"ttu-whispersync-subtitles-enable-persist":!1,"ttu-whispersync-subtitles-enable-auto-scroll":!0,"ttu-whispersync-subtitles-copy-font-family":!0,"ttu-whispersync-subtitles-copy-font-size":!1,"ttu-whispersync-subtitles-copy-line-height":!1,"ttu-whispersync-subtitles-prevent-action-on-selection":!0,"ttu-whispersync-subtitles-click-action":"Restart playback","ttu-whispersync-subtitles-actions-visibility":"On hover","ttu-whispersync-subtitles-actions-visibility-time":500,"ttu-whispersync-subtitles-global-start-padding":0,"ttu-whispersync-subtitles-global-end-padding":0,"ttu-whispersync-subtitles-font-family":"Noto Serif JP","ttu-whispersync-subtitles-font-size":20,"ttu-whispersync-subtitles-line-height":1.65,"ttu-whispersync-player-enable-cover":!0,"ttu-whispersync-player-enable-chapters":!0,"ttu-whispersync-player-enable-wake-lock":!1,"ttu-whispersync-player-enable-dictionary-detection":!1,"ttu-whispersync-player-auto-pause-mode":"Disabled","ttu-whispersync-player-rewind-time":5,"ttu-whispersync-player-alt-rewind-time":10,"ttu-whispersync-player-fast-forward-time":5,"ttu-whispersync-player-alt-fast-forward-time":10,"ttu-whispersync-export-field-mode":"Insert after","ttu-whispersync-export-audio-processor":"Recorder","ttu-whispersync-export-audio-format":"mp3","ttu-whispersync-export-audio-bitrate":128,"ttu-whispersync-enable-ffmpeg-log":!1,"ttu-whispersync-anki-add-subtitle-tag":!1,"ttu-whispersync-anki-add-audio-tag":!1,"ttu-whispersync-anki-tag-list":"","ttu-whispersync-anki-duplicate-mode":"Disabled","ttu-whispersync-anki-url":"http://localhost:8765","ttu-whispersync-anki-key":"","ttu-whispersync-anki-deck":"","ttu-whispersync-anki-model":"","ttu-whispersync-anki-sentence-field":"","ttu-whispersync-anki-sound-field":"","ttu-whispersync-match-line-ignore-rp":!1,"ttu-whispersync-match-line-space-mode":"All removed","ttu-whispersync-match-line-lookahead":5,"ttu-whispersync-match-line-similarity-threshold":.6,"ttu-whispersync-match-line-max-attempts":30}}function Zo(e){return qh[e]}var yn;(function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"})(yn||(yn={}));const Kh=(()=>{let e=0;return()=>e++})(),Qh=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Jh=new Error("called FFmpeg.terminate()");class ep{constructor(){Oi(this,Tr,null);Oi(this,Ii,{});Oi(this,vi,{});Oi(this,as,[]);Oi(this,ls,[]);Cn(this,"loaded",!1);Oi(this,tl,()=>{Qt(this,Tr)&&(Qt(this,Tr).onmessage=({data:{id:n,type:t,data:r}})=>{switch(t){case yn.LOAD:this.loaded=!0,Qt(this,Ii)[n](r);break;case yn.MOUNT:case yn.UNMOUNT:case yn.EXEC:case yn.WRITE_FILE:case yn.READ_FILE:case yn.DELETE_FILE:case yn.RENAME:case yn.CREATE_DIR:case yn.LIST_DIR:case yn.DELETE_DIR:Qt(this,Ii)[n](r);break;case yn.LOG:Qt(this,as).forEach(i=>i(r));break;case yn.PROGRESS:Qt(this,ls).forEach(i=>i(r));break;case yn.ERROR:Qt(this,vi)[n](r);break}delete Qt(this,Ii)[n],delete Qt(this,vi)[n]})});Oi(this,wr,({type:n,data:t},r=[],i)=>Qt(this,Tr)?new Promise((s,o)=>{const a=Kh();Qt(this,Tr)&&Qt(this,Tr).postMessage({id:a,type:n,data:t},r),Qt(this,Ii)[a]=s,Qt(this,vi)[a]=o,i==null||i.addEventListener("abort",()=>{o(new DOMException(`Message # ${a} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Qh));Cn(this,"load",({classWorkerURL:n,...t}={},{signal:r}={})=>(Qt(this,Tr)||(xo(this,Tr,n?new Worker(new URL(n,kn&&kn.src||new URL("ttu-whispersync.iife.js",document.baseURI).href),{type:"module"}):new Worker(new URL(""+new URL("worker-lPYB70QI.js",document.currentScript&&document.currentScript.src||document.baseURI).href,kn&&kn.src||new URL("ttu-whispersync.iife.js",document.baseURI).href),{type:"module"})),Qt(this,tl).call(this)),Qt(this,wr).call(this,{type:yn.LOAD,data:t},void 0,r)));Cn(this,"exec",(n,t=-1,{signal:r}={})=>Qt(this,wr).call(this,{type:yn.EXEC,data:{args:n,timeout:t}},void 0,r));Cn(this,"terminate",()=>{const n=Object.keys(Qt(this,vi));for(const t of n)Qt(this,vi)[t](Jh),delete Qt(this,vi)[t],delete Qt(this,Ii)[t];Qt(this,Tr)&&(Qt(this,Tr).terminate(),xo(this,Tr,null),this.loaded=!1)});Cn(this,"writeFile",(n,t,{signal:r}={})=>{const i=[];return t instanceof Uint8Array&&i.push(t.buffer),Qt(this,wr).call(this,{type:yn.WRITE_FILE,data:{path:n,data:t}},i,r)});Cn(this,"mount",(n,t,r)=>{const i=[];return Qt(this,wr).call(this,{type:yn.MOUNT,data:{fsType:n,options:t,mountPoint:r}},i)});Cn(this,"unmount",n=>{const t=[];return Qt(this,wr).call(this,{type:yn.UNMOUNT,data:{mountPoint:n}},t)});Cn(this,"readFile",(n,t="binary",{signal:r}={})=>Qt(this,wr).call(this,{type:yn.READ_FILE,data:{path:n,encoding:t}},void 0,r));Cn(this,"deleteFile",(n,{signal:t}={})=>Qt(this,wr).call(this,{type:yn.DELETE_FILE,data:{path:n}},void 0,t));Cn(this,"rename",(n,t,{signal:r}={})=>Qt(this,wr).call(this,{type:yn.RENAME,data:{oldPath:n,newPath:t}},void 0,r));Cn(this,"createDir",(n,{signal:t}={})=>Qt(this,wr).call(this,{type:yn.CREATE_DIR,data:{path:n}},void 0,t));Cn(this,"listDir",(n,{signal:t}={})=>Qt(this,wr).call(this,{type:yn.LIST_DIR,data:{path:n}},void 0,t));Cn(this,"deleteDir",(n,{signal:t}={})=>Qt(this,wr).call(this,{type:yn.DELETE_DIR,data:{path:n}},void 0,t))}on(n,t){n==="log"?Qt(this,as).push(t):n==="progress"&&Qt(this,ls).push(t)}off(n,t){n==="log"?xo(this,as,Qt(this,as).filter(r=>r!==t)):n==="progress"&&xo(this,ls,Qt(this,ls).filter(r=>r!==t))}}Tr=new WeakMap,Ii=new WeakMap,vi=new WeakMap,as=new WeakMap,ls=new WeakMap,tl=new WeakMap,wr=new WeakMap;const ys=[];function tp(e,n){return{subscribe:Tn(e,n).subscribe}}function Tn(e,n=gt){let t;const r=new Set;function i(a){if(pn(e,a)&&(e=a,t)){const l=!ys.length;for(const c of r)c[1](),ys.push(c,e);if(l){for(let c=0;c<ys.length;c+=2)ys[c][0](ys[c+1]);ys.length=0}}}function s(a){i(a(e))}function o(a,l=gt){const c=[a,l];return r.add(c),r.size===1&&(t=n(i,s)||gt),a(e),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:i,update:s,subscribe:o}}function np(e,n,t){const r=!Array.isArray(e),i=r?[e]:e;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=n.length<2;return tp(t,(o,a)=>{let l=!1;const c=[];let u=0,f=gt;const m=()=>{if(u)return;f();const _=n(r?c[0]:c,o,a);s?o(_):f=Vr(_)?_:gt},g=i.map((_,E)=>Jr(_,S=>{c[E]=S,u&=~(1<<E),l&&m()},()=>{u|=1<<E}));return l=!0,m(),function(){_n(g),f(),l=!1}})}var nn=(e=>(e.AUDIOBOOK="Audiobook",e.MATCH="Match",e.CHAPTERS="Chapters",e.SETTINGS="Settings",e))(nn||{});function rp(){const{subscribe:e,set:n,update:t}=Tn([]);return{subscribe:e,set:n,add:r=>{t(i=>(i.push(r),i))}}}function fr(e,n=0){return{id:"-1",originalStartSeconds:e,startSeconds:e,startTime:"",originalEndSeconds:n,endSeconds:n,endTime:"",originalText:"",text:"",subIndex:-1}}function dl(e,n){return(t,r)=>{const i=r??Zo(t),s=ip()(t,i,e),{subscribe:o,set:a}=Tn(s);function l(m){window.localStorage.setItem(t,n(m)),a(m)}function c(){let m=i;return o(_=>m=_)(),m}function u(){return t}function f(){return l(i),i}return{subscribe:o,set:l,get:c,key:u,reset:f}}}function ip(){return(e,n,t)=>{const r=window.localStorage.getItem(e);return r?t(r):n}}function Hn(){return dl(e=>!!+e,e=>e?"1":"0")}function sr(){return dl(e=>+e,e=>`${e}`)}function sp(e,n){e(n)}function In(e){return Tn(e,n=>sp(n,e))}function Rn(){return dl(e=>e,e=>e)}const xi=Tn(!1),Et=In(!0),kt=In(""),io=rp(),dn=In(!1),Es=Tn(),Pr=In({id:0,title:"",elementHtml:"",lastBookModified:0}),Ss=In({matchedBy:"",matchedOn:0}),zn=In({title:""}),ni=In(),Xn=In(new Map),so=Tn(),ks=Tn(""),oo=Tn(""),Ts=Tn([]),Si=Tn(!1),Ko=Tn(!1),Qo=In(0),jr=In(),ki=Tn(!1),As=Tn(""),Ms=Tn(""),Cs=Tn(""),Jo=Tn(""),ea=Tn(""),ao=Tn(""),lo=Tn(""),Hi=Tn(""),Ui=Tn(""),ta=Tn(""),gc=Rn()("ttu-whispersync-menu-position","left"),Wi=In(nn.AUDIOBOOK),na=In(new Set),ra=In(new Set),ri=In({previous:"",current:"",useTimeFallback:!0}),gn=In(!0),ii=In(0),si=In(0),uo=In(!1),co=In(1),hl=In(),fo=In(),St={readerLineHighlightColor$:Rn()("ttu-whispersync-reader-line-highlight-color"),readerLineTextHighlightColor$:Rn()("ttu-whispersync-reader-line-text-highlight-color"),readerEnableLineHighlight$:Hn()("ttu-whispersync-reader-enable-line-highlight"),readerEnableAutoReload$:Hn()("ttu-whispersync-reader-enable-auto-reload"),readerEnableAutoScroll$:Hn()("ttu-whispersync-reader-enable-auto-scroll"),readerEnableTrackerAutoPause$:Hn()("ttu-whispersync-reader-enable-tracker-auto-pause"),readerPreventActionOnSelection$:Hn()("ttu-whispersync-reader-prevent-action-on-selection"),readerClickAction$:Rn()("ttu-whispersync-reader-click-action"),readerMenuOpenMode$:Rn()("ttu-whispersync-reader-menu-open-mode"),readerMenuPauseMode$:Rn()("ttu-whispersync-reader-menu-pause-mode"),readerMenuOpenTime$:sr()("ttu-whispersync-reader-menu-open-time"),readerTrackerPauseThreshold$:sr()("ttu-whispersync-reader-tracker-pause-threshold"),subtitlesEnablePersist$:Hn()("ttu-whispersync-subtitles-enable-persist"),subtitlesEnableAutoScroll$:Hn()("ttu-whispersync-subtitles-enable-auto-scroll"),subtitlesCopyFontFamily$:Hn()("ttu-whispersync-subtitles-copy-font-family"),subtitlesCopyFontSize$:Hn()("ttu-whispersync-subtitles-copy-font-size"),subtitlesCopyLineHeight$:Hn()("ttu-whispersync-subtitles-copy-line-height"),subtitlePreventActionOnSelection$:Hn()("ttu-whispersync-subtitles-prevent-action-on-selection"),subtitlesClickAction$:Rn()("ttu-whispersync-subtitles-click-action"),subtitlesActionsVisibility$:Rn()("ttu-whispersync-subtitles-actions-visibility"),subtitlesActionsVisibilityTime$:sr()("ttu-whispersync-subtitles-actions-visibility-time"),subtitlesGlobalStartPadding$:sr()("ttu-whispersync-subtitles-global-start-padding"),subtitlesGlobalEndPadding$:sr()("ttu-whispersync-subtitles-global-end-padding"),subtitlesFontFamily$:Rn()("ttu-whispersync-subtitles-font-family"),subtitlesFontSize$:sr()("ttu-whispersync-subtitles-font-size"),subtitlesLineHeight$:sr()("ttu-whispersync-subtitles-line-height"),playerEnableCover$:Hn()("ttu-whispersync-player-enable-cover"),playerEnableChapters$:Hn()("ttu-whispersync-player-enable-chapters"),playerEnableWakeLock$:Hn()("ttu-whispersync-player-enable-wake-lock"),playerEnableDictionaryDetection$:Hn()("ttu-whispersync-player-enable-dictionary-detection"),playerAutoPauseMode$:Rn()("ttu-whispersync-player-auto-pause-mode"),playerRewindTime$:sr()("ttu-whispersync-player-rewind-time"),playerAltRewindTime$:sr()("ttu-whispersync-player-alt-rewind-time"),playerFastForwardTime$:sr()("ttu-whispersync-player-fast-forward-time"),playerAltFastForwardTime$:sr()("ttu-whispersync-player-alt-fast-forward-time"),exportFieldMode$:Rn()("ttu-whispersync-export-field-mode"),exportAudioProcessor$:Rn()("ttu-whispersync-export-audio-processor"),exportAudioFormat$:Rn()("ttu-whispersync-export-audio-format"),exportAudioBitrate$:sr()("ttu-whispersync-export-audio-bitrate"),enableFFMPEGLog$:Hn()("ttu-whispersync-enable-ffmpeg-log"),ankiAddSubtitleTag$:Hn()("ttu-whispersync-anki-add-subtitle-tag"),ankiAddAudioTag$:Hn()("ttu-whispersync-anki-add-audio-tag"),ankiTagList$:Rn()("ttu-whispersync-anki-tag-list"),ankiDuplicateMode$:Rn()("ttu-whispersync-anki-duplicate-mode"),ankiUrl$:Rn()("ttu-whispersync-anki-url"),ankiKey$:Rn()("ttu-whispersync-anki-key"),ankiDeck$:Rn()("ttu-whispersync-anki-deck"),ankiModel$:Rn()("ttu-whispersync-anki-model"),ankiSentenceField$:Rn()("ttu-whispersync-anki-sentence-field"),ankiSoundField$:Rn()("ttu-whispersync-anki-sound-field"),matchLineIgnoreRp$:Hn()("ttu-whispersync-match-line-ignore-rp"),matchLineSpaceMode$:Rn()("ttu-whispersync-match-line-space-mode"),matchLineLookAhead$:sr()("ttu-whispersync-match-line-lookahead"),matchLineSimilarityThreshold$:sr()("ttu-whispersync-match-line-similarity-threshold"),matchLineMaxAttempts$:sr()("ttu-whispersync-match-line-max-attempts")};async function bc({currentTarget:e},n,t){const r=e.hasAttribute("min"),i=e.hasAttribute("max"),s=r?Number.parseFloat(e.min):0,o=i?Number.parseFloat(e.max):0;let a=Number.parseFloat(e.value);(Number.isNaN(a)||r&&a<s||i&&a>o)&&(a=n),await new Promise(l=>setTimeout(l)),t==null||t.set(a),await qn(),e.value=`${a}`}async function op({currentTarget:e},n,t){let r=e.value||"";r||(r=n),t==null||t.set(r),await qn(),e.value=r}class wc extends Error{constructor(){super(...arguments);Cn(this,"name","AbortError")}}const ho="ttu-whispersync-line-highlight-",ia=new Set(["rp","rt"]);function sa(e,n){let{body:t}=e.parseFromString(n,"text/html");if(t.childNodes.length||({body:t}=e.parseFromString(n,"text/xml")),!t.childNodes.length)throw new Error("Failed to parse html");return t}function pl(e,n){if(!e.contentWindow)throw new Error("Sandbox has no content window");const t=new MessageChannel;return t.port1.start(),new Promise((r,i)=>{t.port1.addEventListener("message",({data:s})=>{if(t.port1.close(),s.error)return i(new Error(s.error));r(s)},!1),e.contentWindow.postMessage(n,"*",[t.port2])})}function oi(e){const n=Math.floor(e/3600),t=e-n*3600,r=Math.floor(t/60),i=t-r*60,s=Math.floor(i),o=Math.round((i-s)*1e3);return[n,r,s,o]}function dr(e){const[n,t,r,i]=oi(e);return`${`${n}`.padStart(2,"0")}:${`${t}`.padStart(2,"0")}:${`${r}`.padStart(2,"0")},${`${i}`.padStart(3,"0")}`}function oa(){return`span[class^='${ho}']`}function vc(e){var n;return((n=[...e.classList].find(t=>t.startsWith(ho)))==null?void 0:n.replace(ho,""))||"not existing"}function po(e){return`span.${ho}${e}`}function ap(e){return`${ho}${e}`}function lp(e,n){return bc(e,n,void 0)}function yc(e,n){return bc(e,Zo(n.key()),n)}function up(e,n){return op(e,Zo(n.key()),n)}function ai(e,n,t){return Math.min(n,Math.max(t,e))}function aa(e){if(e){if(typeof e.throwIfAborted=="function")e.throwIfAborted();else if(e.aborted)throw new wc("user aborted")}}function ml(e,n,t,r=!1){const i=e.createElement("a");i.href=URL.createObjectURL(n),r?i.target="_blank":(i.rel="noopener",i.download=t),setTimeout(()=>{URL.revokeObjectURL(i.href)},1e4),setTimeout(()=>{i.click()})}function Rs(e){const[n,t,r]=oi(e);return`${`${n}`.padStart(2,"0")}:${`${t}`.padStart(2,"0")}:${`${r}`.padStart(2,"0")}`}function mo(e,n,t=!0){return t?Math.floor(e/n*100):Math.round((e/n*100+Number.EPSILON)*100)/100}function cp(e){const n=e.split(":"),t=Number.parseInt(n[0],10),r=Number.parseInt(n[1],10),i=Number.parseInt(n[2],10);return Math.floor(t*3600)+Math.floor(r*60)+i}function Ec(e){return`${e.getFullYear()}-${`${e.getMonth()+1}`.padStart(2,"0")}-${`${e.getDate()}`.padStart(2,"0")}`}const fp="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IFI9Imh0dHBzOi8vdW5wa2cuY29tL0BmZm1wZWcvY29yZUAwLjEyLjYvZGlzdC91bWQvZmZtcGVnLWNvcmUuanMiO3ZhciBFOyhmdW5jdGlvbih0KXt0LkxPQUQ9IkxPQUQiLHQuRVhFQz0iRVhFQyIsdC5XUklURV9GSUxFPSJXUklURV9GSUxFIix0LlJFQURfRklMRT0iUkVBRF9GSUxFIix0LkRFTEVURV9GSUxFPSJERUxFVEVfRklMRSIsdC5SRU5BTUU9IlJFTkFNRSIsdC5DUkVBVEVfRElSPSJDUkVBVEVfRElSIix0LkxJU1RfRElSPSJMSVNUX0RJUiIsdC5ERUxFVEVfRElSPSJERUxFVEVfRElSIix0LkVSUk9SPSJFUlJPUiIsdC5ET1dOTE9BRD0iRE9XTkxPQUQiLHQuUFJPR1JFU1M9IlBST0dSRVNTIix0LkxPRz0iTE9HIix0Lk1PVU5UPSJNT1VOVCIsdC5VTk1PVU5UPSJVTk1PVU5UIn0pKEV8fChFPXt9KSk7Y29uc3QgYT1uZXcgRXJyb3IoInVua25vd24gbWVzc2FnZSB0eXBlIiksZj1uZXcgRXJyb3IoImZmbXBlZyBpcyBub3QgbG9hZGVkLCBjYWxsIGBhd2FpdCBmZm1wZWcubG9hZCgpYCBmaXJzdCIpLHU9bmV3IEVycm9yKCJmYWlsZWQgdG8gaW1wb3J0IGZmbXBlZy1jb3JlLmpzIik7bGV0IHI7Y29uc3QgTz1hc3luYyh7Y29yZVVSTDp0LHdhc21VUkw6bix3b3JrZXJVUkw6ZX0pPT57Y29uc3Qgbz0hcjt0cnl7dHx8KHQ9UiksaW1wb3J0U2NyaXB0cyh0KX1jYXRjaHtpZih0fHwodD1SLnJlcGxhY2UoIi91bWQvIiwiL2VzbS8iKSksc2VsZi5jcmVhdGVGRm1wZWdDb3JlPShhd2FpdCBpbXBvcnQodCkpLmRlZmF1bHQsIXNlbGYuY3JlYXRlRkZtcGVnQ29yZSl0aHJvdyB1fWNvbnN0IHM9dCxjPW58fHQucmVwbGFjZSgvLmpzJC9nLCIud2FzbSIpLGI9ZXx8dC5yZXBsYWNlKC8uanMkL2csIi53b3JrZXIuanMiKTtyZXR1cm4gcj1hd2FpdCBzZWxmLmNyZWF0ZUZGbXBlZ0NvcmUoe21haW5TY3JpcHRVcmxPckJsb2I6YCR7c30jJHtidG9hKEpTT04uc3RyaW5naWZ5KHt3YXNtVVJMOmMsd29ya2VyVVJMOmJ9KSl9YH0pLHIuc2V0TG9nZ2VyKGk9PnNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6RS5MT0csZGF0YTppfSkpLHIuc2V0UHJvZ3Jlc3MoaT0+c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpFLlBST0dSRVNTLGRhdGE6aX0pKSxvfSxsPSh7YXJnczp0LHRpbWVvdXQ6bj0tMX0pPT57ci5zZXRUaW1lb3V0KG4pLHIuZXhlYyguLi50KTtjb25zdCBlPXIucmV0O3JldHVybiByLnJlc2V0KCksZX0sbT0oe3BhdGg6dCxkYXRhOm59KT0+KHIuRlMud3JpdGVGaWxlKHQsbiksITApLEQ9KHtwYXRoOnQsZW5jb2Rpbmc6bn0pPT5yLkZTLnJlYWRGaWxlKHQse2VuY29kaW5nOm59KSxTPSh7cGF0aDp0fSk9PihyLkZTLnVubGluayh0KSwhMCksST0oe29sZFBhdGg6dCxuZXdQYXRoOm59KT0+KHIuRlMucmVuYW1lKHQsbiksITApLEw9KHtwYXRoOnR9KT0+KHIuRlMubWtkaXIodCksITApLE49KHtwYXRoOnR9KT0+e2NvbnN0IG49ci5GUy5yZWFkZGlyKHQpLGU9W107Zm9yKGNvbnN0IG8gb2Ygbil7Y29uc3Qgcz1yLkZTLnN0YXQoYCR7dH0vJHtvfWApLGM9ci5GUy5pc0RpcihzLm1vZGUpO2UucHVzaCh7bmFtZTpvLGlzRGlyOmN9KX1yZXR1cm4gZX0sQT0oe3BhdGg6dH0pPT4oci5GUy5ybWRpcih0KSwhMCksdz0oe2ZzVHlwZTp0LG9wdGlvbnM6bixtb3VudFBvaW50OmV9KT0+e2NvbnN0IG89dCxzPXIuRlMuZmlsZXN5c3RlbXNbb107cmV0dXJuIHM/KHIuRlMubW91bnQocyxuLGUpLCEwKTohMX0saz0oe21vdW50UG9pbnQ6dH0pPT4oci5GUy51bm1vdW50KHQpLCEwKTtzZWxmLm9ubWVzc2FnZT1hc3luYyh7ZGF0YTp7aWQ6dCx0eXBlOm4sZGF0YTplfX0pPT57Y29uc3Qgbz1bXTtsZXQgczt0cnl7aWYobiE9PUUuTE9BRCYmIXIpdGhyb3cgZjtzd2l0Y2gobil7Y2FzZSBFLkxPQUQ6cz1hd2FpdCBPKGUpO2JyZWFrO2Nhc2UgRS5FWEVDOnM9bChlKTticmVhaztjYXNlIEUuV1JJVEVfRklMRTpzPW0oZSk7YnJlYWs7Y2FzZSBFLlJFQURfRklMRTpzPUQoZSk7YnJlYWs7Y2FzZSBFLkRFTEVURV9GSUxFOnM9UyhlKTticmVhaztjYXNlIEUuUkVOQU1FOnM9SShlKTticmVhaztjYXNlIEUuQ1JFQVRFX0RJUjpzPUwoZSk7YnJlYWs7Y2FzZSBFLkxJU1RfRElSOnM9TihlKTticmVhaztjYXNlIEUuREVMRVRFX0RJUjpzPUEoZSk7YnJlYWs7Y2FzZSBFLk1PVU5UOnM9dyhlKTticmVhaztjYXNlIEUuVU5NT1VOVDpzPWsoZSk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBhfX1jYXRjaChjKXtzZWxmLnBvc3RNZXNzYWdlKHtpZDp0LHR5cGU6RS5FUlJPUixkYXRhOmMudG9TdHJpbmcoKX0pO3JldHVybn1zIGluc3RhbmNlb2YgVWludDhBcnJheSYmby5wdXNoKHMuYnVmZmVyKSxzZWxmLnBvc3RNZXNzYWdlKHtpZDp0LHR5cGU6bixkYXRhOnN9LG8pfX0pKCk7Cg==",hr=new ep,_l=!!window.chrome&&!!chrome.runtime&&chrome.runtime.id,Sc=_l?"src/assets/js":"https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/esm",kc=new Map([["ogg","libvorbis"],["opus","opus"],["mp3","libmp3lame"]]);function gl(e,n){return fetch(e).then(t=>{if(!t.ok)throw new Error(`Failed to download from ${e}`);return t.arrayBuffer()}).then(t=>{const r=new Blob([t],{type:n});return URL.createObjectURL(r)})}function bl(e,n=!1){return n?fp:_l?chrome.runtime.getURL(`${Sc}/${e}`):`${Sc}/${e}`}function Tc(e){console.log(e.type,e.message)}async function Ac(){if(hr.loaded)return;const e=[];try{if(!_l&&!navigator.onLine)throw new Error("Need to be online for initialization");const n=[],t=await Promise.allSettled([gl(bl("ffmpeg-core.js"),"text/javascript"),gl(bl("ffmpeg-core.wasm"),"application/wasm"),gl(bl("ffmpeg.worker.js",!0),"text/javascript")]);for(let r=0,{length:i}=t;r<i;r+=1){const s=t[r];s.status==="rejected"?n.push(s.reason.message):e.push(s.value)}if(n.length)throw new Error(n.join("; "));await hr.load({coreURL:e[0],wasmURL:e[1],classWorkerURL:e[2]})}catch({message:n}){throw St.exportAudioProcessor$.set(Jn.RECORDER),new Error(`Error loading FFMPEG - ${n}`)}finally{for(let n=0,{length:t}=e;n<t;n+=1)URL.revokeObjectURL(e[n])}}async function Mc(e){if(hr.loaded)try{if(await wl(!0),e){const n=e.name.split(".").pop(),t=await e.arrayBuffer();await hr.writeFile(`audio_input.${n}`,new Uint8Array(t))}}catch({message:n}){throw new Error(`Failed to update files in FFMPEG - ${n}`)}}async function wl(e=!1){if(!hr.loaded)return;const t=(await hr.listDir("/")).filter(r=>!r.isDir&&(e&&r.name.startsWith("audio_input")||r.name.startsWith("audio_output")));return Promise.allSettled(t.map(r=>hr.deleteFile(r.name)))}async function Cc(e,n,t=!0,r=void 0,i="mp3",s=128,o=!1){const a=e.name.split(".").pop(),l=It(St.enableFFMPEGLog$),c=n.length===1?`audio_output_0.${i}`:`audio_output.${i}`;let u="",f="",m=[],g;try{l&&hr.on("log",Tc);for(let E=0,{length:S}=n;E<S;E+=1){aa(r);const b=n[E],v=`audio_output_${E}.${i}`,y=["-hide_banner","-y","-ss",`${b.startSeconds}`,"-i",`audio_input.${a}`,"-t",`${b.endSeconds-b.startSeconds}`,...i===Ei.OPUS?["-strict","-2"]:[],"-vn","-acodec",kc.get(i)||"libmp3lame",...o?["-b:a",`${s}k`]:[],"-write_xing","0",v];l&&console.log(y),m.push("-i",v),f+=`[${E}:a]`,await hr.exec(y)}if(n.length>1){m.push("-filter_complex"),f=`${f}concat=n=${n.length}:v=0:a=1`;const E=["-hide_banner","-y",...m,f,...i===Ei.OPUS?["-strict","-2"]:[],"-vn","-acodec",kc.get(i)||"libmp3lame",...o?["-b:a",`${s}k`]:[],"-write_xing","0",c];l&&console.log(E),await hr.exec(E)}g=(await hr.readFile(c)).buffer}catch(_){!(r&&r.aborted)&&_.name!=="AbortError"&&(u=typeof _=="string"?`Audio creation failed - ${_}`:`Audio creation failed${_.message?` - ${_.message}`:""}`)}if(t&&await wl(),l&&hr.off("log",Tc),u)throw new Error(u);return aa(r),g}function dp(){hr.loaded&&hr.terminate()}let vl=!1,_o="";async function Gr(e,n,t=!0){if(t&&await hp(e),(n==null?void 0:n.action)==="multi"&&_o)for(let r=0,{length:i}=n.params.actions;r<i;r+=1)n.params.actions[r].key=_o;return fetch(e,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({...n,version:6,..._o?{key:_o}:{}})}).then(r=>{if(!r.ok)throw new Error(`Request failed with status ${r.status}`);return r.json()}).then(r=>{let i=new Set;if(r.error&&i.add(r.error),(n==null?void 0:n.action)==="multi"&&Array.isArray(r.result))for(let s=0,{length:o}=r.result;s<o;s+=1){const{error:a}=r.result[s];a&&i.add(a)}if(i.size)throw new Error([...i].join("; "));return r.result})}async function hp(e){if(!vl){if(!It(xi)&&(await Gr(e,{action:"requestPermission"},!1)).permission!=="granted")throw new Error("Anki permission not granted");vl=!0}}async function pp(e,n,t,r,i){if(!e||!n||!t)return{isAnkiConfigValid:!1,ankiFields:[]};let s=[],o=!0;try{const[a,l]=await Lc(e);a.find(c=>n===c)||(St.ankiDeck$.set(""),o=!1),l.find(c=>t===c)||(St.ankiModel$.set(""),o=!1),o&&(s=await Pc(e,t),r&&!s.find(c=>c===r)&&(St.ankiSentenceField$.set(""),o=!1),i&&!s.find(c=>c===i)&&(St.ankiSoundField$.set(""),o=!1))}catch({message:a}){Bc(),kt.set(`Failed to verify Anki settings: ${a}`),o=!1,s=[]}return{isAnkiConfigValid:o,ankiFields:s}}async function mp(e,n){if(n)return;const t=await Gr(e,{action:"guiSelectedNotes"}).catch(()=>[]);return t.length&&await Gr(e,{action:"guiSelectNote",params:{note:"1"}}),t[t.length-1]}function Rc(e,n,t){let r="";return e===Vi.BEFORE?r=`${t}${t&&n?"<br/>":""}${n}`:e===Vi.AFTER?r=`${n}${t&&n?"<br/>":""}${t}`:r=t,r}async function _p(e,n){if(n)return Gr(e,{action:"guiSelectNote",params:{note:n}}).catch(()=>{})}function gp(e){_o=e}function Lc(e){return Gr(e,{action:"multi",params:{actions:[{action:"deckNames"},{action:"modelNames"}]}})}function Pc(e,n){return Gr(e,{action:"modelFieldNames",params:{modelName:n}})}function Bc(){St.ankiDeck$.set(""),St.ankiModel$.set(""),St.ankiSoundField$.set(""),St.ankiSentenceField$.set(""),vl=!1}async function bp(e,n){var x;const t=new AbortController,r=It(ni),i=It(St.exportAudioProcessor$)===Jn.FFMPEG;if(!r)return;i||gn.set(!0),kt.set(""),Qo.set(0),jr.set(t);const s=It(xi),o=It(so),a=It(St.exportAudioFormat$),l=It(St.exportAudioBitrate$),c=It(St.exportFieldMode$),u=It(St.ankiAddSubtitleTag$),f=It(St.ankiAddAudioTag$),m=It(St.ankiTagList$).trim(),g=m?m.split(",").map(Y=>Y.trim().replaceAll(" ","_").trim()):[],_=It(St.ankiDuplicateMode$),E=It(St.ankiUrl$),S=It(St.ankiDeck$),b=It(St.ankiModel$),v=It(St.ankiSentenceField$),y=It(St.ankiSoundField$),{isAnkiConfigValid:A,ankiFields:d}=await pp(E,S,b,v,y);let p;if(!A){const Y=It(kt);return kt.set(`${Y?`${Y}; `:""}Anki settings are invalid`)}if(n)try{const Y=await Gr(E,{action:"findNotes",params:{query:`added:1 "deck:${S}" "note:${b}"`}}),R=Y[Y.length-1];if(!R)throw new Error("No card added today");if([p]=await Gr(E,{action:"notesInfo",params:{notes:[R]}}),!p)throw new Error("Data for last added card not available")}catch({message:Y}){return kt.set(`Failed to get card for update: ${Y}`)}const M=await mp(E,s),L=r.name.split(/\.(?=[^\.]+$)/)[0],D=o?o.name.split(/\.(?=[^\.]+$)/)[0]:"";let O=0;for(let Y=0,{length:R}=e;Y<R;Y+=1){aa(t.signal);const w=e[Y],N=`${L}-${w[0].id}${w.length>1?`-${w[w.length-1].id}`:""}.${a}`,X=w.map(F=>F.text.trim()).join("<br/>")||"",q=new Set(p?p.tags:[]),Z={note:{fields:{},tags:[],audio:[]}};let ne="",U;try{if(y&&o){if(i?U=await Cc(o,w,!1,t.signal,a,l,!0):U=await new Promise((I,H)=>hl.set({subtitles:w,action:ct.TOGGLE_PLAY_PAUSE,recorderSuccess:I,recorderFailure:H})),!U)throw new Error("No audio file returned");ne=_c.from(U).toString("base64")}u&&q.add(L.trim().replaceAll(" ","_").trim()),f&&D&&q.add(D.trim().replaceAll(" ","_").trim());const F=[...new Set([...q,...g])],C=_!==Wr.DISABLED?{allowDuplicate:!1,duplicateScope:_===Wr.DECK||_===Wr.SUBDECK?"deck":"collection",duplicateScopeOptions:{checkChildren:_===Wr.SUBDECK}}:{allowDuplicate:!0};C.duplicateScopeOptions&&_===Wr.DECK&&(C.duplicateScopeOptions.deckName=S),Z.note=p?{...Z.note,id:p.noteId,tags:F}:{...Z.note,deckName:S,modelName:b,options:C,tags:F};for(let I=0,{length:H}=d;I<H;I+=1){const K=d[I],he=K===v&&X,ee=K===y&&ne,ae=p&&((x=p.fields[K])==null?void 0:x.value)||"";if(he||ee){let ge="",Le="";he&&(ge+=X),ee&&(s?Le=await Gr(E,{action:"storeMediaFile",params:{data:ne,filename:N}}):(Z.note.audio=[{data:ne,deleteExisting:!0,filename:N,fields:[""]}],Le=N),ge=Rc(Vi.AFTER,ge,`[sound:${Le}]`)),Z.note.fields[K]=Rc(c,ae,ge)}else Z.note.fields[K]=ae}const P=await Gr(E,{action:n?"updateNote":"addNote",params:Z});if(!n&&!P)throw new Error("Got failure response")}catch(F){if(!t.signal.aborted&&F.name!=="AbortError")console.log(`Failed to create card for subtitle(s) ${w.map(C=>C.id).join(", ")}: ${F.message}`),O+=1;else break}Qo.set(Math.min(100,mo(Y+1,R)))}await wl(),await _p(E,M),O&&kt.set(`${O} Export(s) failed`)}const wp=e=>({}),Ic=e=>({}),vp=e=>({}),Oc=e=>({}),yp=e=>({}),Dc=e=>({});function Ep(e){let n,t,r,i,s,o,a;const l=e[1].header,c=ds(l,e,e[0],Dc),u=e[1].content,f=ds(u,e,e[0],Oc),m=e[1].footer,g=ds(m,e,e[0],Ic);return{c(){n=_e("section"),t=_e("h2"),c&&c.c(),r=me(),i=_e("div"),f&&f.c(),s=me(),o=_e("footer"),g&&g.c(),re(t,"class","weight-medium mb-5 text-xl"),re(i,"class","slot-content"),re(o,"class","flex flex-wrap items-center justify-end pt-5"),re(n,"class","mdc-elevation--z24 p-6 rounded")},m(_,E){de(_,n,E),oe(n,t),c&&c.m(t,null),oe(n,r),oe(n,i),f&&f.m(i,null),oe(n,s),oe(n,o),g&&g.m(o,null),a=!0},p(_,[E]){c&&c.p&&(!a||E&1)&&ps(c,l,_,_[0],a?hs(l,_[0],E,yp):ms(_[0]),Dc),f&&f.p&&(!a||E&1)&&ps(f,u,_,_[0],a?hs(u,_[0],E,vp):ms(_[0]),Oc),g&&g.p&&(!a||E&1)&&ps(g,m,_,_[0],a?hs(m,_[0],E,wp):ms(_[0]),Ic)},i(_){a||(te(c,_),te(f,_),te(g,_),a=!0)},o(_){ue(c,_),ue(f,_),ue(g,_),a=!1},d(_){_&&fe(n),c&&c.d(_),f&&f.d(_),g&&g.d(_)}}}function Sp(e,n,t){let{$$slots:r={},$$scope:i}=n;return e.$$set=s=>{"$$scope"in s&&t(0,i=s.$$scope)},[i,r]}class la extends vn{constructor(n){super(),wn(this,n,Sp,Ep,pn,{})}}var kp="M18,16V13H15V22H13V2H15V11H18V8L22,12L18,16M2,12L6,16V13H9V22H11V2H9V11H6V8L2,12Z",Tp="M13 20.5C13 21.03 13.09 21.53 13.26 22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H7V9L9.5 7.5L12 9V2H18C19.1 2 20 2.89 20 4V11H16.5V16.11C14.5 16.57 13 18.36 13 20.5M20 13H18.5V18.21C18.19 18.07 17.86 18 17.5 18C16.12 18 15 19.12 15 20.5S16.12 23 17.5 23 20 21.88 20 20.5V15H22V13H20Z",Nc="M12 2C17.5 2 22 6.5 22 12S17.5 22 12 22 2 17.5 2 12 6.5 2 12 2M12 4C10.1 4 8.4 4.6 7.1 5.7L18.3 16.9C19.3 15.5 20 13.8 20 12C20 7.6 16.4 4 12 4M16.9 18.3L5.7 7.1C4.6 8.4 4 10.1 4 12C4 16.4 7.6 20 12 20C13.9 20 15.6 19.4 16.9 18.3Z",Ap="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z",Fc="M21 13.1C20.9 13.1 20.7 13.2 20.6 13.3L19.6 14.3L21.7 16.4L22.7 15.4C22.9 15.2 22.9 14.8 22.7 14.6L21.4 13.3C21.3 13.2 21.2 13.1 21 13.1M19.1 14.9L13 20.9V23H15.1L21.2 16.9L19.1 14.9M11 21.9C5.9 21.4 2 17.1 2 12C2 6.5 6.5 2 12 2C17.3 2 21.6 6.1 22 11.3C21.7 11.2 21.4 11.1 21 11.1C20.2 11.1 19.6 11.5 19.2 11.9L16.5 14.6L12.5 12.2V7H11V13L15.4 15.7L11 20.1V21.9Z",$c="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",yl="M18,14H20V17H23V19H20V22H18V19H15V17H18V14M12,3C16.42,3 20,4.79 20,7C20,9.21 16.42,11 12,11C7.58,11 4,9.21 4,7C4,4.79 7.58,3 12,3M4,9C4,11.21 7.58,13 12,13C16.42,13 20,11.21 20,9V9L20,12.08L19,12C16.41,12 14.2,13.64 13.36,15.94L12,16C7.58,16 4,14.21 4,12V9M4,14C4,16.21 7.58,18 12,18H13C13,19.05 13.27,20.04 13.75,20.9L12,21C7.58,21 4,19.21 4,17V14Z",Mp="M15.46,15.88L16.88,14.46L19,16.59L21.12,14.47L22.53,15.88L20.41,18L22.54,20.12L21.12,21.54L19,19.41L16.88,21.53L15.47,20.12L17.59,18L15.46,15.88M12,3C16.42,3 20,4.79 20,7C20,9.21 16.42,11 12,11C7.58,11 4,9.21 4,7C4,4.79 7.58,3 12,3M4,9C4,11.21 7.58,13 12,13C16.42,13 20,11.21 20,9V12.08L19,12C16.41,12 14.2,13.64 13.36,15.94L12,16C7.58,16 4,14.21 4,12V9M4,14C4,16.21 7.58,18 12,18H13C13,19.05 13.27,20.04 13.75,20.9L12,21C7.58,21 4,19.21 4,17V14Z",El="M19,12V13.5A4,4 0 0,1 23,17.5C23,18.32 22.75,19.08 22.33,19.71L21.24,18.62C21.41,18.28 21.5,17.9 21.5,17.5A2.5,2.5 0 0,0 19,15V16.5L16.75,14.25L19,12M19,23V21.5A4,4 0 0,1 15,17.5C15,16.68 15.25,15.92 15.67,15.29L16.76,16.38C16.59,16.72 16.5,17.1 16.5,17.5A2.5,2.5 0 0,0 19,20V18.5L21.25,20.75L19,23M12,3C16.42,3 20,4.79 20,7C20,9.21 16.42,11 12,11C7.58,11 4,9.21 4,7C4,4.79 7.58,3 12,3M4,9C4,11.21 7.58,13 12,13C13.11,13 14.17,12.89 15.14,12.68C14.19,13.54 13.5,14.67 13.18,15.96L12,16C7.58,16 4,14.21 4,12V9M20,9V11H19.5L18.9,11.03C19.6,10.43 20,9.74 20,9M4,14C4,16.21 7.58,18 12,18L13,17.97C13.09,19.03 13.42,20 13.95,20.88L12,21C7.58,21 4,19.21 4,17V14Z",Cp="M12,14A2,2 0 0,1 14,16A2,2 0 0,1 12,18A2,2 0 0,1 10,16A2,2 0 0,1 12,14M23.46,8.86L21.87,15.75L15,14.16L18.8,11.78C17.39,9.5 14.87,8 12,8C8.05,8 4.77,10.86 4.12,14.63L2.15,14.28C2.96,9.58 7.06,6 12,6C15.58,6 18.73,7.89 20.5,10.72L23.46,8.86Z",Rp="M15 13H16.5V15.82L18.94 17.23L18.19 18.53L15 16.69V13M23 16C23 19.87 19.87 23 16 23C14.09 23 12.36 22.24 11.1 21H8C6.9 21 6 20.1 6 19V7H18V9.29C20.89 10.15 23 12.83 23 16M16 11C13.24 11 11 13.24 11 16C11 18.76 13.24 21 16 21C18.76 21 21 18.76 21 16C21 13.24 18.76 11 16 11M19 4V6H5V4H8.5L9.5 3H14.5L15.5 4H19Z",Lp="M15,16H19V18H15V16M15,8H22V10H15V8M15,12H21V14H15V12M3,18A2,2 0 0,0 5,20H11A2,2 0 0,0 13,18V8H3V18M14,5H11L10,4H6L5,5H2V7H14V5Z",Sl="M19,10H5V8H19V10M19,16H5V14H19V16Z",ua="M13.09 20C13.21 20.72 13.46 21.39 13.81 22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H14L20 8V13.09C19.67 13.04 19.34 13 19 13C18.66 13 18.33 13.04 18 13.09V9H13V4H6V20H13.09M23 17L20 14.5V16H16V18H20V19.5L23 17M18 18.5L15 21L18 23.5V22H22V20H18V18.5Z",ca="M13.81 22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H14L20 8V13.09C19.67 13.04 19.34 13 19 13S18.33 13.04 18 13.09V9H13V4H6V20H13.09C13.21 20.72 13.46 21.39 13.81 22M23 18H20V15H18V18H15V20H18V23H20V20H23V18Z",Ls="M5,3A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5.5L18.5,3H17V9A1,1 0 0,1 16,10H8A1,1 0 0,1 7,9V3H5M12,4V9H15V4H12M7,12H17A1,1 0 0,1 18,13V19H6V13A1,1 0 0,1 7,12Z",go="M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z",Vc="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",ji="M14,19H18V5H14M6,19H10V5H6V19Z",Ps="M8,5.14V19.14L19,12.14L8,5.14Z",kl="M3,5V19L11,12M13,19H16V5H13M18,5V19H21V5",Pp="M15,6V8H3V6H15M15,10V12H3V10H15M3,16V14H11V16H3M17,6H22V8H19V17A3,3 0 0,1 16,20A3,3 0 0,1 13,17A3,3 0 0,1 16,14C16.35,14 16.69,14.07 17,14.18V6M16,16A1,1 0 0,0 15,17A1,1 0 0,0 16,18A1,1 0 0,0 17,17A1,1 0 0,0 16,16Z",xc="M3 10H14V12H3V10M3 6H14V8H3V6M3 14H10V16H3V14M16 13V21L22 17L16 13Z",Tl="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z",Hc="M17,17H7V14L3,18L7,22V19H19V13H17M7,7H17V10L21,6L17,2V5H5V11H7V7Z",Bp="M2,5.27L3.28,4L20,20.72L18.73,22L15.73,19H7V22L3,18L7,14V17H13.73L7,10.27V11H5V8.27L2,5.27M17,13H19V17.18L17,15.18V13M17,5V2L21,6L17,10V7H8.82L6.82,5H17Z",Uc="M6,5.75L10.25,10H7V16H13.5L15.5,18H7A2,2 0 0,1 5,16V10H1.75L6,5.75M18,18.25L13.75,14H17V8H10.5L8.5,6H17A2,2 0 0,1 19,8V14H22.25L18,18.25Z",bo="M13,3A9,9 0 0,0 4,12H1L4.89,15.89L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3Z",Al="M4,3H5V5H3V4A1,1 0 0,1 4,3M20,3A1,1 0 0,1 21,4V5H19V3H20M15,5V3H17V5H15M11,5V3H13V5H11M7,5V3H9V5H7M21,20A1,1 0 0,1 20,21H19V19H21V20M15,21V19H17V21H15M11,21V19H13V21H11M7,21V19H9V21H7M4,21A1,1 0 0,1 3,20V19H5V21H4M3,15H5V17H3V15M21,15V17H19V15H21M3,11H5V13H3V11M21,11V13H19V11H21M3,7H5V9H3V7M21,7V9H19V7H21Z",Ml="M21 20C21 20.55 20.55 21 20 21H19V19H21V20M15 21V19H17V21H15M11 21V19H13V21H11M7 21V19H9V21H7M4 21C3.45 21 3 20.55 3 20V19H5V21H4M3 15H5V17H3V15M21 15V17H19V15H21M14.59 8L12 10.59L9.41 8L8 9.41L10.59 12L8 14.59L9.41 16L12 13.41L14.59 16L16 14.59L13.41 12L16 9.41L14.59 8M3 11H5V13H3V11M21 11V13H19V11H21M3 7H5V9H3V7M21 7V9H19V7H21M4 3H5V5H3V4C3 3.45 3.45 3 4 3M20 3C20.55 3 21 3.45 21 4V5H19V3H20M15 5V3H17V5H15M11 5V3H13V5H11M7 5V3H9V5H7Z",Ip="M20,5V19L13,12M6,5V19H4V5M13,5V19L6,12",Op="M4,5V19L11,12M18,5V19H20V5M11,5V19L18,12",Dp="M16,18H18V6H16M6,18L14.5,12L6,6V18Z",Np="M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z",Fp="M12,16A3,3 0 0,1 9,13C9,11.88 9.61,10.9 10.5,10.39L20.21,4.77L14.68,14.35C14.18,15.33 13.17,16 12,16M12,3C13.81,3 15.5,3.5 16.97,4.32L14.87,5.53C14,5.19 13,5 12,5A8,8 0 0,0 4,13C4,15.21 4.89,17.21 6.34,18.65H6.35C6.74,19.04 6.74,19.67 6.35,20.06C5.96,20.45 5.32,20.45 4.93,20.07V20.07C3.12,18.26 2,15.76 2,13A10,10 0 0,1 12,3M22,13C22,15.76 20.88,18.26 19.07,20.07V20.07C18.68,20.45 18.05,20.45 17.66,20.06C17.27,19.67 17.27,19.04 17.66,18.65V18.65C19.11,17.2 20,15.21 20,13C20,12 19.81,11 19.46,10.1L20.67,8C21.5,9.5 22,11.18 22,13Z",Cl="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z",Rl="M12,15.39L8.24,17.66L9.23,13.38L5.91,10.5L10.29,10.13L12,6.09L13.71,10.13L18.09,10.5L14.77,13.38L15.76,17.66M22,9.24L14.81,8.63L12,2L9.19,8.63L2,9.24L7.45,13.97L5.82,21L12,17.27L18.18,21L16.54,13.97L22,9.24Z",$p="M21,9L17,5V8H10V10H17V13M7,11L3,15L7,19V16H14V14H7V11Z",Vp="M21,6V8H3V6H21M3,18H12V16H3V18M3,13H21V11H3V13Z",xp="M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z",Ll="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M9,8H11V17H9V8M13,8H15V17H13V8Z",Wc="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z",jc="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z",Gc="M12,4L9.91,6.09L12,8.18M4.27,3L3,4.27L7.73,9H3V15H7L12,20V13.27L16.25,17.53C15.58,18.04 14.83,18.46 14,18.7V20.77C15.38,20.45 16.63,19.82 17.68,18.96L19.73,21L21,19.73L12,10.73M19,12C19,12.94 18.8,13.82 18.46,14.64L19.97,16.15C20.62,14.91 21,13.5 21,12C21,7.72 18,4.14 14,3.23V5.29C16.89,6.15 19,8.83 19,12M16.5,12C16.5,10.23 15.5,8.71 14,7.97V10.18L16.45,12.63C16.5,12.43 16.5,12.21 16.5,12Z";/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */function Un(e,n,t,r){return new(t||(t=Promise))(function(i,s){function o(c){try{l(r.next(c))}catch(u){s(u)}}function a(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){var u;c.done?i(c.value):(u=c.value,u instanceof t?u:new t(function(f){f(u)})).then(o,a)}l((r=r.apply(e,n||[])).next())})}let wo=class{constructor(){this.listeners={}}on(n,t,r){if(this.listeners[n]||(this.listeners[n]=new Set),this.listeners[n].add(t),r==null?void 0:r.once){const i=()=>{this.un(n,i),this.un(n,t)};return this.on(n,i),i}return()=>this.un(n,t)}un(n,t){var r;(r=this.listeners[n])===null||r===void 0||r.delete(t)}once(n,t){return this.on(n,t,{once:!0})}unAll(){this.listeners={}}emit(n,...t){this.listeners[n]&&this.listeners[n].forEach(r=>r(...t))}};const zc={decode:function(e,n){return Un(this,void 0,void 0,function*(){const t=new AudioContext({sampleRate:n});return t.decodeAudioData(e).finally(()=>t.close())})},createBuffer:function(e,n){return typeof e[0]=="number"&&(e=[e]),function(t){const r=t[0];if(r.some(i=>i>1||i<-1)){const i=r.length;let s=0;for(let o=0;o<i;o++){const a=Math.abs(r[o]);a>s&&(s=a)}for(const o of t)for(let a=0;a<i;a++)o[a]/=s}}(e),{duration:n,length:e[0].length,sampleRate:e[0].length/n,numberOfChannels:e.length,getChannelData:t=>e==null?void 0:e[t],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function Xc(e,n){const t=n.xmlns?document.createElementNS(n.xmlns,e):document.createElement(e);for(const[r,i]of Object.entries(n))if(r==="children")for(const[s,o]of Object.entries(n))typeof o=="string"?t.appendChild(document.createTextNode(o)):t.appendChild(Xc(s,o));else r==="style"?Object.assign(t.style,i):r==="textContent"?t.textContent=i:t.setAttribute(r,i.toString());return t}function Yc(e,n,t){const r=Xc(e,n||{});return t==null||t.appendChild(r),r}var Hp=Object.freeze({__proto__:null,createElement:Yc,default:Yc});const Up={fetchBlob:function(e,n,t){return Un(this,void 0,void 0,function*(){const r=yield fetch(e,t);if(r.status>=400)throw new Error(`Failed to fetch ${e}: ${r.status} (${r.statusText})`);return function(i,s){Un(this,void 0,void 0,function*(){if(!i.body||!i.headers)return;const o=i.body.getReader(),a=Number(i.headers.get("Content-Length"))||0;let l=0;const c=f=>Un(this,void 0,void 0,function*(){l+=(f==null?void 0:f.length)||0;const m=Math.round(l/a*100);s(m)}),u=()=>Un(this,void 0,void 0,function*(){let f;try{f=yield o.read()}catch{return}f.done||(c(f.value),yield u())});u()})}(r.clone(),n),r.blob()})}};class Wp extends wo{constructor(n){super(),this.isExternalMedia=!1,n.media?(this.media=n.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),n.mediaControls&&(this.media.controls=!0),n.autoplay&&(this.media.autoplay=!0),n.playbackRate!=null&&this.onMediaEvent("canplay",()=>{n.playbackRate!=null&&(this.media.playbackRate=n.playbackRate)},{once:!0})}onMediaEvent(n,t,r){return this.media.addEventListener(n,t,r),()=>this.media.removeEventListener(n,t,r)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const n=this.getSrc();n.startsWith("blob:")&&URL.revokeObjectURL(n)}canPlayType(n){return this.media.canPlayType(n)!==""}setSrc(n,t){if(this.getSrc()===n)return;this.revokeSrc();const r=t instanceof Blob&&this.canPlayType(t.type)?URL.createObjectURL(t):n;this.media.src=r}destroy(){this.media.pause(),this.isExternalMedia||(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(n){this.media=n}play(){return Un(this,void 0,void 0,function*(){return this.media.play()})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(n){this.media.currentTime=n}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(n){this.media.volume=n}getMuted(){return this.media.muted}setMuted(n){this.media.muted=n}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(n,t){t!=null&&(this.media.preservesPitch=t),this.media.playbackRate=n}getMediaElement(){return this.media}setSinkId(n){return this.media.setSinkId(n)}}class fa extends wo{constructor(n,t){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.options=n;const r=this.parentFromOptionsContainer(n.container);this.parent=r;const[i,s]=this.initHtml();r.appendChild(i),this.container=i,this.scrollContainer=s.querySelector(".scroll"),this.wrapper=s.querySelector(".wrapper"),this.canvasWrapper=s.querySelector(".canvases"),this.progressWrapper=s.querySelector(".progress"),this.cursor=s.querySelector(".cursor"),t&&s.appendChild(t),this.initEvents()}parentFromOptionsContainer(n){let t;if(typeof n=="string"?t=document.querySelector(n):n instanceof HTMLElement&&(t=n),!t)throw new Error("Container not found");return t}initEvents(){const n=r=>{const i=this.wrapper.getBoundingClientRect(),s=r.clientX-i.left,o=r.clientX-i.left;return[s/i.width,o/i.height]};this.wrapper.addEventListener("click",r=>{const[i,s]=n(r);this.emit("click",i,s)}),this.wrapper.addEventListener("dblclick",r=>{const[i,s]=n(r);this.emit("dblclick",i,s)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:r,scrollWidth:i,clientWidth:s}=this.scrollContainer,o=r/i,a=(r+s)/i;this.emit("scroll",o,a)});const t=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{t().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}onContainerResize(){const n=this.parent.clientWidth;n===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=n,this.reRender())}initDrag(){(function(n,t,r,i,s=3,o=0){if(!n)return()=>{};let a=()=>{};const l=c=>{if(c.button!==o)return;c.preventDefault(),c.stopPropagation();let u=c.clientX,f=c.clientY,m=!1;const g=v=>{v.preventDefault(),v.stopPropagation();const y=v.clientX,A=v.clientY,d=y-u,p=A-f;if(m||Math.abs(d)>s||Math.abs(p)>s){const M=n.getBoundingClientRect(),{left:L,top:D}=M;m||(r==null||r(u-L,f-D),m=!0),t(d,p,y-L,A-D),u=y,f=A}},_=v=>{if(m){const y=v.clientX,A=v.clientY,d=n.getBoundingClientRect(),{left:p,top:M}=d;i==null||i(y-p,A-M)}a()},E=v=>{v.relatedTarget&&v.relatedTarget!==document.documentElement||_(v)},S=v=>{m&&(v.stopPropagation(),v.preventDefault())},b=v=>{m&&v.preventDefault()};document.addEventListener("pointermove",g),document.addEventListener("pointerup",_),document.addEventListener("pointerout",E),document.addEventListener("pointercancel",E),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("click",S,{capture:!0}),a=()=>{document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",_),document.removeEventListener("pointerout",E),document.removeEventListener("pointercancel",E),document.removeEventListener("touchmove",b),setTimeout(()=>{document.removeEventListener("click",S,{capture:!0})},10)}};n.addEventListener("pointerdown",l)})(this.wrapper,(n,t,r)=>{this.emit("drag",Math.max(0,Math.min(1,r/this.wrapper.getBoundingClientRect().width)))},n=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,n/this.wrapper.getBoundingClientRect().width)))},n=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,n/this.wrapper.getBoundingClientRect().width)))})}getHeight(n){return n==null?128:isNaN(Number(n))?n==="auto"&&this.parent.clientHeight||128:Number(n)}initHtml(){const n=document.createElement("div"),t=n.attachShadow({mode:"open"});return t.innerHTML=`
      <style>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height)}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[n,t]}setOptions(n){if(this.options.container!==n.container){const t=this.parentFromOptionsContainer(n.container);t.appendChild(this.container),this.parent=t}n.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=n,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}setScroll(n){this.scrollContainer.scrollLeft=n}setScrollPercentage(n){const{scrollWidth:t}=this.scrollContainer,r=t*n;this.setScroll(r)}destroy(){var n;this.container.remove(),(n=this.resizeObserver)===null||n===void 0||n.disconnect()}createDelay(n=10){let t,r;const i=()=>{t&&clearTimeout(t),r&&r()};return this.timeouts.push(i),()=>new Promise((s,o)=>{i(),r=o,t=setTimeout(()=>{t=void 0,r=void 0,s()},n)})}convertColorValues(n){if(!Array.isArray(n))return n||"";if(n.length<2)return n[0]||"";const t=document.createElement("canvas"),r=t.getContext("2d"),i=t.height*(window.devicePixelRatio||1),s=r.createLinearGradient(0,0,0,i),o=1/(n.length-1);return n.forEach((a,l)=>{const c=l*o;s.addColorStop(c,a)}),s}renderBarWaveform(n,t,r,i){const s=n[0],o=n[1]||n[0],a=s.length,{width:l,height:c}=r.canvas,u=c/2,f=window.devicePixelRatio||1,m=t.barWidth?t.barWidth*f:1,g=t.barGap?t.barGap*f:t.barWidth?m/2:0,_=t.barRadius||0,E=l/(m+g)/a,S=_&&"roundRect"in r?"roundRect":"rect";r.beginPath();let b=0,v=0,y=0;for(let A=0;A<=a;A++){const d=Math.round(A*E);if(d>b){const L=Math.round(v*u*i),D=L+Math.round(y*u*i)||1;let O=u-L;t.barAlign==="top"?O=0:t.barAlign==="bottom"&&(O=c-D),r[S](b*(m+g),O,m,D,_),b=d,v=0,y=0}const p=Math.abs(s[A]||0),M=Math.abs(o[A]||0);p>v&&(v=p),M>y&&(y=M)}r.fill(),r.closePath()}renderLineWaveform(n,t,r,i){const s=o=>{const a=n[o]||n[0],l=a.length,{height:c}=r.canvas,u=c/2,f=r.canvas.width/l;r.moveTo(0,u);let m=0,g=0;for(let _=0;_<=l;_++){const E=Math.round(_*f);if(E>m){const b=u+(Math.round(g*u*i)||1)*(o===0?-1:1);r.lineTo(m,b),m=E,g=0}const S=Math.abs(a[_]||0);S>g&&(g=S)}r.lineTo(m,u)};r.beginPath(),s(0),s(1),r.fill(),r.closePath()}renderWaveform(n,t,r){if(r.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction)return void t.renderFunction(n,r);let i=t.barHeight||1;if(t.normalize){const s=Array.from(n[0]).reduce((o,a)=>Math.max(o,Math.abs(a)),0);i=s?1/s:1}t.barWidth||t.barGap||t.barAlign?this.renderBarWaveform(n,t,r,i):this.renderLineWaveform(n,t,r,i)}renderSingleCanvas(n,t,r,i,s,o,a,l){const c=window.devicePixelRatio||1,u=document.createElement("canvas"),f=n[0].length;u.width=Math.round(r*(o-s)/f),u.height=i*c,u.style.width=`${Math.floor(u.width/c)}px`,u.style.height=`${i}px`,u.style.left=`${Math.floor(s*r/c/f)}px`,a.appendChild(u);const m=u.getContext("2d");if(this.renderWaveform(n.map(g=>g.slice(s,o)),t,m),u.width>0&&u.height>0){const g=u.cloneNode(),_=g.getContext("2d");_.drawImage(u,0,0),_.globalCompositeOperation="source-in",_.fillStyle=this.convertColorValues(t.progressColor),_.fillRect(0,0,u.width,u.height),l.appendChild(g)}}renderChannel(n,t,r){return Un(this,void 0,void 0,function*(){const i=document.createElement("div"),s=this.getHeight(t.height);i.style.height=`${s}px`,this.canvasWrapper.style.minHeight=`${s}px`,this.canvasWrapper.appendChild(i);const o=i.cloneNode();this.progressWrapper.appendChild(o);const a=n[0].length,l=(b,v)=>{this.renderSingleCanvas(n,t,r,s,Math.max(0,b),Math.min(v,a),i,o)};if(!this.isScrollable)return void l(0,a);const{scrollLeft:c,scrollWidth:u,clientWidth:f}=this.scrollContainer,m=a/u;let g=Math.min(fa.MAX_CANVAS_WIDTH,f);if(t.barWidth||t.barGap){const b=t.barWidth||.5,v=b+(t.barGap||b/2);g%v!=0&&(g=Math.floor(g/v)*v)}const _=Math.floor(Math.abs(c)*m),E=Math.floor(_+g*m),S=E-_;S<=0||(l(_,E),yield Promise.all([Un(this,void 0,void 0,function*(){if(_===0)return;const b=this.createDelay();for(let v=_;v>=0;v-=S)yield b(),l(Math.max(0,v-S),v)}),Un(this,void 0,void 0,function*(){if(E===a)return;const b=this.createDelay();for(let v=E;v<a;v+=S)yield b(),l(v,Math.min(a,v+S))})]))})}render(n){return Un(this,void 0,void 0,function*(){this.timeouts.forEach(a=>a()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const t=window.devicePixelRatio||1,r=this.scrollContainer.clientWidth,i=Math.ceil(n.duration*(this.options.minPxPerSec||0));this.isScrollable=i>r;const s=this.options.fillParent&&!this.isScrollable,o=(s?r:i)*t;this.wrapper.style.width=s?"100%":`${i}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=n,this.emit("render");try{if(this.options.splitChannels)yield Promise.all(Array.from({length:n.numberOfChannels}).map((a,l)=>{var c;const u=Object.assign(Object.assign({},this.options),(c=this.options.splitChannels)===null||c===void 0?void 0:c[l]);return this.renderChannel([n.getChannelData(l)],u,o)}));else{const a=[n.getChannelData(0)];n.numberOfChannels>1&&a.push(n.getChannelData(1)),yield this.renderChannel(a,this.options,o)}}catch{return}this.emit("rendered")})}reRender(){if(!this.audioData)return;const{scrollWidth:n}=this.scrollContainer,{right:t}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&n!==this.scrollContainer.scrollWidth){const{right:r}=this.progressWrapper.getBoundingClientRect();let i=r-t;i*=2,i=i<0?Math.floor(i):Math.ceil(i),i/=2,this.scrollContainer.scrollLeft+=i}}zoom(n){this.options.minPxPerSec=n,this.reRender()}scrollIntoView(n,t=!1){const{scrollLeft:r,scrollWidth:i,clientWidth:s}=this.scrollContainer,o=n*i,a=r,l=r+s,c=s/2;if(this.isDragging)o+30>l?this.scrollContainer.scrollLeft+=30:o-30<a&&(this.scrollContainer.scrollLeft-=30);else{(o<a||o>l)&&(this.scrollContainer.scrollLeft=o-(this.options.autoCenter?c:0));const u=o-r-c;t&&this.options.autoCenter&&u>0&&(this.scrollContainer.scrollLeft+=Math.min(u,10))}{const u=this.scrollContainer.scrollLeft,f=u/i,m=(u+s)/i;this.emit("scroll",f,m)}}renderProgress(n,t){if(isNaN(n))return;const r=100*n;this.canvasWrapper.style.clipPath=`polygon(${r}% 0, 100% 0, 100% 100%, ${r}% 100%)`,this.progressWrapper.style.width=`${r}%`,this.cursor.style.left=`${r}%`,this.cursor.style.transform=`translateX(-${Math.round(r)===100?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(n,t)}exportImage(n,t,r){return Un(this,void 0,void 0,function*(){const i=this.canvasWrapper.querySelectorAll("canvas");if(!i.length)throw new Error("No waveform data");if(r==="dataURL"){const s=Array.from(i).map(o=>o.toDataURL(n,t));return Promise.resolve(s)}return Promise.all(Array.from(i).map(s=>new Promise((o,a)=>{s.toBlob(l=>{l?o(l):a(new Error("Could not export image"))},n,t)})))})}}fa.MAX_CANVAS_WIDTH=4e3;class jp extends wo{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class qc extends wo{constructor(n=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=n,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return Un(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(n){if(this.currentSrc=n,this._duration=void 0,!n)return this.buffer=null,void this.emit("emptied");fetch(n).then(t=>{if(t.status>=400)throw new Error(`Failed to fetch ${n}: ${t.status} (${t.statusText})`);return t.arrayBuffer()}).then(t=>this.currentSrc!==n?null:this.audioContext.decodeAudioData(t)).then(t=>{this.currentSrc===n&&(this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})}_play(){var n;if(!this.paused)return;this.paused=!1,(n=this.bufferNode)===null||n===void 0||n.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let t=this.playedDuration*this._playbackRate;t>=this.duration&&(t=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,t),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var n;this.paused=!0,(n=this.bufferNode)===null||n===void 0||n.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return Un(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(n){var t,r;const i=n-this.currentTime;(t=this.bufferNode)===null||t===void 0||t.stop(this.audioContext.currentTime+i),(r=this.bufferNode)===null||r===void 0||r.addEventListener("ended",()=>{this.bufferNode=null,this.pause()},{once:!0})}setSinkId(n){return Un(this,void 0,void 0,function*(){return this.audioContext.setSinkId(n)})}get playbackRate(){return this._playbackRate}set playbackRate(n){this._playbackRate=n,this.bufferNode&&(this.bufferNode.playbackRate.value=n)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(n){const t=!this.paused;t&&this._pause(),this.playedDuration=n/this._playbackRate,t&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var n,t;return(n=this._duration)!==null&&n!==void 0?n:((t=this.buffer)===null||t===void 0?void 0:t.duration)||0}set duration(n){this._duration=n}get volume(){return this.gainNode.gain.value}set volume(n){this.gainNode.gain.value=n,this.emit("volumechange")}get muted(){return this._muted}set muted(n){this._muted!==n&&(this._muted=n,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(n){return/^(audio|video)\//.test(n)}getGainNode(){return this.gainNode}getChannelData(){const n=[];if(!this.buffer)return n;const t=this.buffer.numberOfChannels;for(let r=0;r<t;r++)n.push(this.buffer.getChannelData(r));return n}}const Gp={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class vo extends Wp{static create(n){return new vo(n)}constructor(n){const t=n.media||(n.backend==="WebAudio"?new qc:void 0);super({media:t,mediaControls:n.mediaControls,autoplay:n.autoplay,playbackRate:n.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.options=Object.assign({},Gp,n),this.timer=new jp;const r=t?void 0:this.getMediaElement();this.renderer=new fa(this.options,r),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins(),Promise.resolve().then(()=>{this.emit("init");const i=this.options.url||this.getSrc()||"";(i||this.options.peaks&&this.options.duration)&&this.load(i,this.options.peaks,this.options.duration).catch(()=>null)})}updateProgress(n=this.getCurrentTime()){return this.renderer.renderProgress(n/this.getDuration(),this.isPlaying()),n}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){const n=this.updateProgress();this.emit("timeupdate",n),this.emit("audioprocess",n)}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{const n=this.updateProgress();this.emit("timeupdate",n)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("emptied",()=>{this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",n=>{this.emit("error",n.error)}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(n,t)=>{this.options.interact&&(this.seekTo(n),this.emit("interaction",n*this.getDuration()),this.emit("click",n,t))}),this.renderer.on("dblclick",(n,t)=>{this.emit("dblclick",n,t)}),this.renderer.on("scroll",(n,t)=>{const r=this.getDuration();this.emit("scroll",n*r,t*r)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",n=>{this.emit("dragstart",n)}),this.renderer.on("dragend",n=>{this.emit("dragend",n)}));{let n;this.subscriptions.push(this.renderer.on("drag",t=>{if(!this.options.interact)return;let r;this.renderer.renderProgress(t),clearTimeout(n),this.isPlaying()?r=0:this.options.dragToSeek===!0?r=200:typeof this.options.dragToSeek=="object"&&this.options.dragToSeek!==void 0&&(r=this.options.dragToSeek.debounceTime),n=setTimeout(()=>{this.seekTo(t)},r),this.emit("interaction",t*this.getDuration()),this.emit("drag",t)}))}}initPlugins(){var n;!((n=this.options.plugins)===null||n===void 0)&&n.length&&this.options.plugins.forEach(t=>{this.registerPlugin(t)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(n=>n()),this.mediaSubscriptions=[]}setOptions(n){this.options=Object.assign({},this.options,n),this.renderer.setOptions(this.options),n.audioRate&&this.setPlaybackRate(n.audioRate),n.mediaControls!=null&&(this.getMediaElement().controls=n.mediaControls)}registerPlugin(n){return n._init(this),this.plugins.push(n),this.subscriptions.push(n.once("destroy",()=>{this.plugins=this.plugins.filter(t=>t!==n)})),n}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}setScrollTime(n){const t=n/this.getDuration();this.renderer.setScrollPercentage(t)}getActivePlugins(){return this.plugins}loadAudio(n,t,r,i){return Un(this,void 0,void 0,function*(){if(this.emit("load",n),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!t&&!r){const o=a=>this.emit("loading",a);t=yield Up.fetchBlob(n,o,this.options.fetchParams)}this.setSrc(n,t);const s=i||this.getDuration()||(yield new Promise(o=>{this.onMediaEvent("loadedmetadata",()=>o(this.getDuration()),{once:!0})}));if(!n&&!t){const o=this.getMediaElement();o instanceof qc&&(o.duration=s)}if(r)this.decodedData=zc.createBuffer(r,s||0);else if(t){const o=yield t.arrayBuffer();this.decodedData=yield zc.decode(o,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(n,t,r){return Un(this,void 0,void 0,function*(){try{return yield this.loadAudio(n,void 0,t,r)}catch(i){throw this.emit("error",i),i}})}loadBlob(n,t,r){return Un(this,void 0,void 0,function*(){try{return yield this.loadAudio("blob",n,t,r)}catch(i){throw this.emit("error",i),i}})}zoom(n){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(n),this.emit("zoom",n)}getDecodedData(){return this.decodedData}exportPeaks({channels:n=2,maxLength:t=8e3,precision:r=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const i=Math.min(n,this.decodedData.numberOfChannels),s=[];for(let o=0;o<i;o++){const a=this.decodedData.getChannelData(o),l=[],c=Math.round(a.length/t);for(let u=0;u<t;u++){const f=a.slice(u*c,(u+1)*c);let m=0;for(let g=0;g<f.length;g++){const _=f[g];Math.abs(_)>Math.abs(m)&&(m=_)}l.push(Math.round(m*r)/r)}s.push(l)}return s}getDuration(){let n=super.getDuration()||0;return n!==0&&n!==1/0||!this.decodedData||(n=this.decodedData.duration),n}toggleInteraction(n){this.options.interact=n}setTime(n){super.setTime(n),this.updateProgress(n),this.emit("timeupdate",n)}seekTo(n){const t=this.getDuration()*n;this.setTime(t)}playPause(){return Un(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(n){this.setTime(this.getCurrentTime()+n)}empty(){this.load("",[[0]],.001)}setMediaElement(n){this.unsubscribePlayerEvents(),super.setMediaElement(n),this.initPlayerEvents()}exportImage(n="image/png",t=1,r="dataURL"){return Un(this,void 0,void 0,function*(){return this.renderer.exportImage(n,t,r)})}destroy(){this.emit("destroy"),this.plugins.forEach(n=>n.destroy()),this.subscriptions.forEach(n=>n()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}vo.BasePlugin=class extends wo{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}_init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}},vo.dom=Hp;class Zc{constructor(){this.listeners={}}on(n,t,r){if(this.listeners[n]||(this.listeners[n]=new Set),this.listeners[n].add(t),r==null?void 0:r.once){const i=()=>{this.un(n,i),this.un(n,t)};return this.on(n,i),i}return()=>this.un(n,t)}un(n,t){var r;(r=this.listeners[n])===null||r===void 0||r.delete(t)}once(n,t){return this.on(n,t,{once:!0})}unAll(){this.listeners={}}emit(n,...t){this.listeners[n]&&this.listeners[n].forEach(r=>r(...t))}}class zp extends Zc{constructor(n){super(),this.subscriptions=[],this.options=n}onInit(){}_init(n){this.wavesurfer=n,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(n=>n())}}function da(e,n,t,r,i=3,s=0){if(!e)return()=>{};let o=()=>{};const a=l=>{if(l.button!==s)return;l.preventDefault(),l.stopPropagation();let c=l.clientX,u=l.clientY,f=!1;const m=b=>{b.preventDefault(),b.stopPropagation();const v=b.clientX,y=b.clientY,A=v-c,d=y-u;if(f||Math.abs(A)>i||Math.abs(d)>i){const p=e.getBoundingClientRect(),{left:M,top:L}=p;f||(t==null||t(c-M,u-L),f=!0),n(A,d,v-M,y-L),c=v,u=y}},g=b=>{if(f){const v=b.clientX,y=b.clientY,A=e.getBoundingClientRect(),{left:d,top:p}=A;r==null||r(v-d,y-p)}o()},_=b=>{b.relatedTarget&&b.relatedTarget!==document.documentElement||g(b)},E=b=>{f&&(b.stopPropagation(),b.preventDefault())},S=b=>{f&&b.preventDefault()};document.addEventListener("pointermove",m),document.addEventListener("pointerup",g),document.addEventListener("pointerout",_),document.addEventListener("pointercancel",_),document.addEventListener("touchmove",S,{passive:!1}),document.addEventListener("click",E,{capture:!0}),o=()=>{document.removeEventListener("pointermove",m),document.removeEventListener("pointerup",g),document.removeEventListener("pointerout",_),document.removeEventListener("pointercancel",_),document.removeEventListener("touchmove",S),setTimeout(()=>{document.removeEventListener("click",E,{capture:!0})},10)}};return e.addEventListener("pointerdown",a),()=>{o(),e.removeEventListener("pointerdown",a)}}function Kc(e,n){const t=n.xmlns?document.createElementNS(n.xmlns,e):document.createElement(e);for(const[r,i]of Object.entries(n))if(r==="children")for(const[s,o]of Object.entries(n))typeof o=="string"?t.appendChild(document.createTextNode(o)):t.appendChild(Kc(s,o));else r==="style"?Object.assign(t.style,i):r==="textContent"?t.textContent=i:t.setAttribute(r,i.toString());return t}function yo(e,n,t){const r=Kc(e,n||{});return t==null||t.appendChild(r),r}class Qc extends Zc{constructor(n,t,r=0){var i,s,o,a,l,c,u,f;super(),this.totalDuration=t,this.numberOfChannels=r,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.id=n.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(n.start),this.end=this.clampPosition((i=n.end)!==null&&i!==void 0?i:n.start),this.drag=(s=n.drag)===null||s===void 0||s,this.resize=(o=n.resize)===null||o===void 0||o,this.color=(a=n.color)!==null&&a!==void 0?a:"rgba(0, 0, 0, 0.1)",this.minLength=(l=n.minLength)!==null&&l!==void 0?l:this.minLength,this.maxLength=(c=n.maxLength)!==null&&c!==void 0?c:this.maxLength,this.channelIdx=(u=n.channelIdx)!==null&&u!==void 0?u:-1,this.contentEditable=(f=n.contentEditable)!==null&&f!==void 0?f:this.contentEditable,this.element=this.initElement(),this.setContent(n.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(n){return Math.max(0,Math.min(this.totalDuration,n))}setPart(){const n=this.start===this.end;this.element.setAttribute("part",`${n?"marker":"region"} ${this.id}`)}addResizeHandles(n){const t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},r=yo("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},t),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},n),i=yo("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},t),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},n);da(r,s=>this.onResize(s,"start"),()=>null,()=>this.onEndResizing(),1),da(i,s=>this.onResize(s,"end"),()=>null,()=>this.onEndResizing(),1)}removeResizeHandles(n){const t=n.querySelector('[part*="region-handle-left"]'),r=n.querySelector('[part*="region-handle-right"]');t&&n.removeChild(t),r&&n.removeChild(r)}initElement(){const n=this.start===this.end;let t=0,r=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(r=100/this.numberOfChannels,t=r*this.channelIdx);const i=yo("div",{style:{position:"absolute",top:`${t}%`,height:`${r}%`,backgroundColor:n?"none":this.color,borderLeft:n?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!n&&this.resize&&this.addResizeHandles(i),i}renderPosition(){const n=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*n+"%",this.element.style.right=100*t+"%"}toggleCursor(n){var t;this.drag&&(!((t=this.element)===null||t===void 0)&&t.style)&&(this.element.style.cursor=n?"grabbing":"grab")}initMouseEvents(){const{element:n}=this;n&&(n.addEventListener("click",t=>this.emit("click",t)),n.addEventListener("mouseenter",t=>this.emit("over",t)),n.addEventListener("mouseleave",t=>this.emit("leave",t)),n.addEventListener("dblclick",t=>this.emit("dblclick",t)),n.addEventListener("pointerdown",()=>this.toggleCursor(!0)),n.addEventListener("pointerup",()=>this.toggleCursor(!1)),da(n,t=>this.onMove(t),()=>this.toggleCursor(!0),()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")}),this.contentEditable&&this.content&&(this.content.addEventListener("click",t=>this.onContentClick(t)),this.content.addEventListener("blur",()=>this.onContentBlur())))}_onUpdate(n,t){if(!this.element.parentElement)return;const{width:r}=this.element.parentElement.getBoundingClientRect(),i=n/r*this.totalDuration,s=t&&t!=="start"?this.start:this.start+i,o=t&&t!=="end"?this.end:this.end+i,a=o-s;s>=0&&o<=this.totalDuration&&s<=o&&a>=this.minLength&&a<=this.maxLength&&(this.start=s,this.end=o,this.renderPosition(),this.emit("update",t))}onMove(n){this.drag&&this._onUpdate(n)}onResize(n,t){this.resize&&this._onUpdate(n,t)}onEndResizing(){this.resize&&this.emit("update-end")}onContentClick(n){n.stopPropagation(),n.target.focus(),this.emit("click",n)}onContentBlur(){this.emit("update-end")}_setTotalDuration(n){this.totalDuration=n,this.renderPosition()}play(){this.emit("play")}setContent(n){var t;if((t=this.content)===null||t===void 0||t.remove(),n){if(typeof n=="string"){const r=this.start===this.end;this.content=yo("div",{style:{padding:`0.2em ${r?.2:.4}em`,display:"inline-block"},textContent:n})}else this.content=n;this.contentEditable&&(this.content.contentEditable="true"),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content)}else this.content=void 0}setOptions(n){var t,r;if(n.color&&(this.color=n.color,this.element.style.backgroundColor=this.color),n.drag!==void 0&&(this.drag=n.drag,this.element.style.cursor=this.drag?"grab":"default"),n.start!==void 0||n.end!==void 0){const i=this.start===this.end;this.start=this.clampPosition((t=n.start)!==null&&t!==void 0?t:this.start),this.end=this.clampPosition((r=n.end)!==null&&r!==void 0?r:i?this.start:this.end),this.renderPosition(),this.setPart()}if(n.content&&this.setContent(n.content),n.id&&(this.id=n.id,this.setPart()),n.resize!==void 0&&n.resize!==this.resize){const i=this.start===this.end;this.resize=n.resize,this.resize&&!i?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}}remove(){this.emit("remove"),this.element.remove(),this.element=null}}class Pl extends zp{constructor(n){super(n),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(n){return new Pl(n)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let n=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",t=>{const r=this.regions.filter(i=>i.start<=t&&(i.end===i.start?i.start+.05:i.end)>=t);r.forEach(i=>{n.includes(i)||this.emit("region-in",i)}),n.forEach(i=>{r.includes(i)||this.emit("region-out",i)}),n=r}))}initRegionsContainer(){return yo("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"3",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(n){if(!n.content)return;const t=n.content,r=t.getBoundingClientRect(),i=this.regions.map(s=>{if(s===n||!s.content)return 0;const o=s.content.getBoundingClientRect();return r.left<o.left+o.width&&o.left<r.left+r.width?o.height:0}).reduce((s,o)=>s+o,0);t.style.marginTop=`${i}px`}adjustScroll(n){var t,r;const i=(r=(t=this.wavesurfer)===null||t===void 0?void 0:t.getWrapper())===null||r===void 0?void 0:r.parentElement;if(!i)return;const{clientWidth:s,scrollWidth:o}=i;if(o<=s)return;const a=i.getBoundingClientRect(),l=n.element.getBoundingClientRect(),c=l.left-a.left,u=l.right-a.left;c<0?i.scrollLeft+=c:u>s&&(i.scrollLeft+=u-s)}saveRegion(n){this.regionsContainer.appendChild(n.element),this.avoidOverlapping(n),this.regions.push(n);const t=[n.on("update",r=>{r||this.adjustScroll(n)}),n.on("update-end",()=>{this.avoidOverlapping(n),this.emit("region-updated",n)}),n.on("play",()=>{var r,i;(r=this.wavesurfer)===null||r===void 0||r.play(),(i=this.wavesurfer)===null||i===void 0||i.setTime(n.start)}),n.on("click",r=>{this.emit("region-clicked",n,r)}),n.on("dblclick",r=>{this.emit("region-double-clicked",n,r)}),n.once("remove",()=>{t.forEach(r=>r()),this.regions=this.regions.filter(r=>r!==n),this.emit("region-removed",n)})];this.subscriptions.push(...t),this.emit("region-created",n)}addRegion(n){var t,r;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const i=this.wavesurfer.getDuration(),s=(r=(t=this.wavesurfer)===null||t===void 0?void 0:t.getDecodedData())===null||r===void 0?void 0:r.numberOfChannels,o=new Qc(n,i,s);return i?this.saveRegion(o):this.subscriptions.push(this.wavesurfer.once("ready",a=>{o._setTotalDuration(a),this.saveRegion(o)})),o}enableDragSelection(n,t=3){var r;const i=(r=this.wavesurfer)===null||r===void 0?void 0:r.getWrapper();if(!(i&&i instanceof HTMLElement))return()=>{};let s=null,o=0;return da(i,(a,l,c)=>{s&&s._onUpdate(a,c>o?"end":"start")},a=>{var l,c;if(o=a,!this.wavesurfer)return;const u=this.wavesurfer.getDuration(),f=(c=(l=this.wavesurfer)===null||l===void 0?void 0:l.getDecodedData())===null||c===void 0?void 0:c.numberOfChannels,{width:m}=this.wavesurfer.getWrapper().getBoundingClientRect(),g=a/m*u,_=(a+5)/m*u;s=new Qc(Object.assign(Object.assign({},n),{start:g,end:_}),u,f),this.regionsContainer.appendChild(s.element)},()=>{s&&(this.saveRegion(s),s=null)},t)}clearRegions(){this.regions.forEach(n=>n.remove())}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}function Xp(e){let n;return{c(){n=Nt("Edit Subtitle")},m(t,r){de(t,n,r)},d(t){t&&fe(n)}}}function Jc(e){let n,t,r,i,s;return t=new At({props:{path:Sl}}),{c(){n=_e("button"),Te(t.$$.fragment),re(n,"title",ct.ALIGN_SUBTITLE),re(n,"class","m-l-s")},m(o,a){de(o,n,a),Ee(t,n,null),r=!0,i||(s=qe(n,"click",e[10]),i=!0)},p:gt,i(o){r||(te(t.$$.fragment,o),r=!0)},o(o){ue(t.$$.fragment,o),r=!1},d(o){o&&fe(n),Se(t),i=!1,s()}}}function Yp(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v=e[0].text+"",y,A,d,p,M;i=new At({props:{path:ji}}),c=new At({props:{path:Hc}}),m=new At({props:{path:bo}});let L=e[8].matchedBy&&Jc(e);return{c(){n=_e("div"),t=_e("div"),r=_e("button"),Te(i.$$.fragment),a=me(),l=_e("button"),Te(c.$$.fragment),u=me(),f=_e("button"),Te(m.$$.fragment),g=me(),_=_e("div"),E=me(),S=_e("div"),b=_e("div"),y=Nt(v),A=me(),L&&L.c(),re(r,"title",s=e[5]?"Pause playback":"Already paused"),r.disabled=o=!e[5],re(l,"title","Play active subtitle"),re(l,"class","m-l-s"),re(f,"title","Restore time"),re(f,"class","m-l-s"),re(_,"class","waveform w-full h-full"),re(S,"class","flex items-center"),re(n,"class","w-full p-x-xs"),re(n,"slot","content")},m(D,O){de(D,n,O),oe(n,t),oe(t,r),Ee(i,r,null),oe(t,a),oe(t,l),Ee(c,l,null),oe(t,u),oe(t,f),Ee(m,f,null),oe(n,g),oe(n,_),e[20](_),oe(n,E),oe(n,S),oe(S,b),oe(b,y),oe(S,A),L&&L.m(S,null),d=!0,p||(M=[qe(r,"click",e[14]),qe(l,"click",e[18]),qe(f,"click",e[19]),qe(n,"touchstart",Js(e[17]))],p=!0)},p(D,O){(!d||O&32&&s!==(s=D[5]?"Pause playback":"Already paused"))&&re(r,"title",s),(!d||O&32&&o!==(o=!D[5]))&&(r.disabled=o),(!d||O&1)&&v!==(v=D[0].text+"")&&en(y,v),D[8].matchedBy?L?(L.p(D,O),O&256&&te(L,1)):(L=Jc(D),L.c(),te(L,1),L.m(S,null)):L&&(rn(),ue(L,1,1,()=>{L=null}),sn())},i(D){d||(te(i.$$.fragment,D),te(c.$$.fragment,D),te(m.$$.fragment,D),te(L),d=!0)},o(D){ue(i.$$.fragment,D),ue(c.$$.fragment,D),ue(m.$$.fragment,D),ue(L),d=!1},d(D){D&&fe(n),Se(i),Se(c),Se(m),e[20](null),L&&L.d(),p=!1,_n(M)}}}function qp(e){let n,t,r,i,s,o;return{c(){n=_e("div"),t=_e("button"),t.textContent="Cancel",r=me(),i=_e("button"),i.textContent="Save",re(n,"class","flex grow justify-between p-x-xs"),re(n,"slot","footer")},m(a,l){de(a,n,l),oe(n,t),oe(n,r),oe(n,i),s||(o=[qe(t,"click",e[11]),qe(i,"click",e[12])],s=!0)},p:gt,d(a){a&&fe(n),s=!1,_n(o)}}}function Zp(e){let n,t,r,i;return n=new la({props:{$$slots:{footer:[qp],content:[Yp],header:[Xp]},$$scope:{ctx:e}}}),{c(){Te(n.$$.fragment),t=me(),r=_e("div"),r.innerHTML='<span class="spinner"></span>',re(r,"class","backdrop"),lt(r,"hidden",!e[3])},m(s,o){Ee(n,s,o),de(s,t,o),de(s,r,o),i=!0},p(s,[o]){const a={};o&1073742327&&(a.$$scope={dirty:o,ctx:s}),n.$set(a),(!i||o&8)&&lt(r,"hidden",!s[3])},i(s){i||(te(n.$$.fragment,s),i=!0)},o(s){ue(n.$$.fragment,s),i=!1},d(s){s&&(fe(t),fe(r)),Se(n,s)}}}function Kp(e,n,t){let r,i,s;we(e,so,q=>t(23,r=q)),we(e,Xn,q=>t(24,i=q)),we(e,Ss,q=>t(8,s=q));let{activeSubtitle:o}=n,{subtitleRegions:a}=n,{resolver:l}=n;const c=a[0].startSeconds,u=getComputedStyle(document.documentElement).getPropertyValue("--ttu-whispersync-color"),f=ei();let m,g,_,E=!0,S,b,v=!1,y=-1,A;jo(D),Go(()=>{A==null||A(),g==null||g.destroy(),URL.revokeObjectURL(S)});function d(q){q>y&&x()}async function p(){t(3,E=!0),await Ln(ct.ALIGN_SUBTITLE,o,{persistAlignment:!1,ignoreSkipKeyListener:!0}),t(0,o=i.get(o.id)),t(3,E=!1)}function M(){if(o.text!==o.originalText)return t(0,o.text=o.originalText,o),Y({wasCanceled:!1,subtitle:o});Y({wasCanceled:!0})}function L(){const q=b.start+c,Z=b.end+c;Y({wasCanceled:!1,subtitle:{...o,adjustedStartSeconds:q,startSeconds:q,startTime:dr(q),adjustedEndSeconds:Z,endSeconds:Z,endTime:dr(Z)}})}async function D(){try{if(!r)throw new Error("Audio file required");const q=await Cc(r,[fr(a[0].startSeconds,a[a.length-1].endSeconds)]);if(!q)throw new Error("No audio file returned");S=URL.createObjectURL(new Blob([q],{type:"audio/mpeg"})),t(2,g=vo.create({container:m,waveColor:u,url:S})),_=g.registerPlugin(Pl.create()),g.once("decode",()=>{for(let Z=0,{length:ne}=a;Z<ne;Z+=1){const U=a[Z];if(U.subIndex===-1)continue;const F=o.id===U.id,C=_.addRegion(O(U,F));F?(C.element.part.add("active"),C.on("update",x),t(4,b=C)):C.element.part.add("inactive")}}),g.on("interaction",Z=>{A==null||A(),Z>=b.start&&Z<=b.end&&(t(6,y=b.end),t(7,A=g.on("timeupdate",d))),g.play()}),g.on("play",()=>t(5,v=!0)),g.on("pause",()=>t(5,v=!1)),g.once("ready",()=>{t(3,E=!1)})}catch({message:q}){t(3,E=!1),Y({wasCanceled:!1,error:`Failed to create waveform: ${q}`})}}function O(q,Z=!0){return{start:q.startSeconds-c,end:q.endSeconds-c,color:u,drag:Z,resize:Z,id:q.id}}function x(){g.pause(),A==null||A(),t(6,y=-1)}function Y(q){l==null||l(q),f("close")}function R(q){cr.call(this,e,q)}const w=()=>{A==null||A(),t(6,y=b.end),t(7,A=g.on("timeupdate",d)),g.setTime(b.start),g.play()},N=()=>{x(),b.setOptions(O(o)),b.element.part.add("active")};function X(q){Gt[q?"unshift":"push"](()=>{m=q,t(1,m)})}return e.$$set=q=>{"activeSubtitle"in q&&t(0,o=q.activeSubtitle),"subtitleRegions"in q&&t(15,a=q.subtitleRegions),"resolver"in q&&t(16,l=q.resolver)},[o,m,g,E,b,v,y,A,s,d,p,M,L,O,x,a,l,R,w,N,X]}class Qp extends vn{constructor(n){super(),wn(this,n,Kp,Zp,pn,{activeSubtitle:0,subtitleRegions:15,resolver:16})}}function Jp(e){let n,t,r,i;return{c(){n=_e("input"),re(n,"type","number"),re(n,"class","time-input"),re(n,"min",e[1]),re(n,"max",e[2]),re(n,"step",e[3])},m(s,o){de(s,n,o),_s(n,e[0]),r||(i=[qe(n,"input",e[7]),qe(n,"change",e[5]),Uo(t=Il.call(null,n,{document,isSkipped:e[4]}))],r=!0)},p(s,[o]){o&2&&re(n,"min",s[1]),o&4&&re(n,"max",s[2]),o&8&&re(n,"step",s[3]),o&1&&sc(n.value)!==s[0]&&_s(n,s[0]),t&&Vr(t.update)&&o&16&&t.update.call(null,{document,isSkipped:s[4]})},i:gt,o:gt,d(s){s&&fe(n),r=!1,_n(i)}}}function e2(e,n,t){let r;we(e,dn,m=>t(4,r=m));let{value:i}=n,{defaultValue:s}=n,{min:o=0}=n,{max:a=59}=n,{step:l=1}=n;const c=ei();async function u(m){await lp(m,s),c("changed")}function f(){i=sc(this.value),t(0,i)}return e.$$set=m=>{"value"in m&&t(0,i=m.value),"defaultValue"in m&&t(6,s=m.defaultValue),"min"in m&&t(1,o=m.min),"max"in m&&t(2,a=m.max),"step"in m&&t(3,l=m.step)},[i,o,a,l,r,u,s,f]}class Br extends vn{constructor(n){super(),wn(this,n,e2,Jp,pn,{value:0,defaultValue:6,min:1,max:2,step:3})}}function e1(e){let n,t,r=!1,i,s=!0,o,a;function l(){cancelAnimationFrame(i),n.paused||(i=rc(l),r=!0),e[34].call(n)}return{c(){n=_e("audio"),n.controls=!0,re(n,"class","hidden"),fs(n.src,t=e[10])||re(n,"src",t),e[1]===void 0&&Fi(()=>e[33].call(n))},m(c,u){de(c,n,u),e[36](n),o||(a=[qe(n,"durationchange",e[33]),qe(n,"timeupdate",l),qe(n,"play",e[35]),qe(n,"pause",e[35]),qe(n,"loadedmetadata",e[26]),qe(n,"timeupdate",e[27])],o=!0)},p(c,u){u[0]&1024&&!fs(n.src,t=c[10])&&re(n,"src",t),!r&&u[0]&8192&&!isNaN(c[13])&&(n.currentTime=c[13]),r=!1,u[0]&16384&&s!==(s=c[14])&&n[s?"pause":"play"]()},d(c){c&&fe(n),e[36](null),o=!1,_n(a)}}}function t2(e){let n;return{c(){n=Nt("Edit Subtitle")},m(t,r){de(t,n,r)},d(t){t&&fe(n)}}}function t1(e){let n,t,r,i,s,o,a,l;return t=new At({props:{path:e[14]?Ps:ji}}),s=new At({props:{path:Hc}}),{c(){n=_e("button"),Te(t.$$.fragment),r=me(),i=_e("button"),Te(s.$$.fragment),re(n,"title","Toggle playback"),re(i,"title","Replay"),re(i,"class","m-l-s")},m(c,u){de(c,n,u),Ee(t,n,null),de(c,r,u),de(c,i,u),Ee(s,i,null),o=!0,a||(l=[qe(n,"click",e[37]),qe(i,"click",e[38])],a=!0)},p(c,u){const f={};u[0]&16384&&(f.path=c[14]?Ps:ji),t.$set(f)},i(c){o||(te(t.$$.fragment,c),te(s.$$.fragment,c),o=!0)},o(c){ue(t.$$.fragment,c),ue(s.$$.fragment,c),o=!1},d(c){c&&(fe(n),fe(r),fe(i)),Se(t),Se(s),a=!1,_n(l)}}}function n1(e){let n,t,r,i,s;return t=new At({props:{path:Sl}}),{c(){n=_e("button"),Te(t.$$.fragment),re(n,"title",ct.ALIGN_SUBTITLE),re(n,"class","m-l-s")},m(o,a){de(o,n,a),Ee(t,n,null),r=!0,i||(s=qe(n,"click",e[29]),i=!0)},p:gt,i(o){r||(te(t.$$.fragment,o),r=!0)},o(o){ue(t.$$.fragment,o),r=!1},d(o){o&&fe(n),Se(t),i=!1,s()}}}function n2(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y,R,w,N,X,q,Z,ne,U,F,C,P,I,H,K,he,ee,ae,ge,Le,He,De,Ue,be=e[0].text+"",Re,Xe,Ne,B,V,ye=e[10]&&t1(e);s=new At({props:{path:bo}});function Ae(ie){e[40](ie)}let Ke={defaultValue:e[18],max:e[16]};e[2]!==void 0&&(Ke.value=e[2]),u=new Br({props:Ke}),Gt.push(()=>Kn(u,"value",Ae)),u.$on("changed",e[28]);function et(ie){e[41](ie)}let Je={defaultValue:e[19]};e[3]!==void 0&&(Je.value=e[3]),E=new Br({props:Je}),Gt.push(()=>Kn(E,"value",et)),E.$on("changed",e[28]);function ze(ie){e[42](ie)}let ut={defaultValue:e[20]};e[4]!==void 0&&(ut.value=e[4]),A=new Br({props:ut}),Gt.push(()=>Kn(A,"value",ze)),A.$on("changed",e[28]);function nt(ie){e[43](ie)}let Ye={defaultValue:e[21],max:999,step:100};e[5]!==void 0&&(Ye.value=e[5]),D=new Br({props:Ye}),Gt.push(()=>Kn(D,"value",nt)),D.$on("changed",e[28]);function W(ie){e[44](ie)}let k={defaultValue:e[22],max:e[16]};e[6]!==void 0&&(k.value=e[6]),N=new Br({props:k}),Gt.push(()=>Kn(N,"value",W)),N.$on("changed",e[28]);function h(ie){e[45](ie)}let T={defaultValue:e[23]};e[7]!==void 0&&(T.value=e[7]),U=new Br({props:T}),Gt.push(()=>Kn(U,"value",h)),U.$on("changed",e[28]);function $(ie){e[46](ie)}let j={defaultValue:e[24]};e[8]!==void 0&&(j.value=e[8]),H=new Br({props:j}),Gt.push(()=>Kn(H,"value",$)),H.$on("changed",e[28]);function J(ie){e[47](ie)}let Q={defaultValue:e[25],max:999,step:100};e[9]!==void 0&&(Q.value=e[9]),ge=new Br({props:Q}),Gt.push(()=>Kn(ge,"value",J)),ge.$on("changed",e[28]);let ce=e[17].matchedBy&&n1(e);return{c(){n=_e("div"),t=_e("div"),ye&&ye.c(),r=me(),i=_e("button"),Te(s.$$.fragment),o=me(),a=_e("div"),l=_e("div"),c=_e("div"),Te(u.$$.fragment),m=me(),g=_e("span"),g.textContent=":",_=me(),Te(E.$$.fragment),b=me(),v=_e("span"),v.textContent=":",y=me(),Te(A.$$.fragment),p=me(),M=_e("span"),M.textContent=",",L=me(),Te(D.$$.fragment),x=me(),Y=_e("span"),Y.textContent="-",R=me(),w=_e("div"),Te(N.$$.fragment),q=me(),Z=_e("span"),Z.textContent=":",ne=me(),Te(U.$$.fragment),C=me(),P=_e("span"),P.textContent=":",I=me(),Te(H.$$.fragment),he=me(),ee=_e("span"),ee.textContent=",",ae=me(),Te(ge.$$.fragment),He=me(),De=_e("div"),Ue=_e("div"),Re=Nt(be),Xe=me(),ce&&ce.c(),re(i,"title","Restore time"),lt(i,"m-l-s",e[10]),re(t,"class","m-b-s"),re(c,"class","flex"),re(Y,"class","m-b"),re(w,"class","flex"),re(l,"class","flex items-center time-edit m-b-s"),re(De,"class","flex items-center m-t-b"),re(a,"class","flex flex-col"),re(n,"slot","content")},m(ie,le){de(ie,n,le),oe(n,t),ye&&ye.m(t,null),oe(t,r),oe(t,i),Ee(s,i,null),oe(n,o),oe(n,a),oe(a,l),oe(l,c),Ee(u,c,null),oe(c,m),oe(c,g),oe(c,_),Ee(E,c,null),oe(c,b),oe(c,v),oe(c,y),Ee(A,c,null),oe(c,p),oe(c,M),oe(c,L),Ee(D,c,null),oe(l,x),oe(l,Y),oe(l,R),oe(l,w),Ee(N,w,null),oe(w,q),oe(w,Z),oe(w,ne),Ee(U,w,null),oe(w,C),oe(w,P),oe(w,I),Ee(H,w,null),oe(w,he),oe(w,ee),oe(w,ae),Ee(ge,w,null),oe(a,He),oe(a,De),oe(De,Ue),oe(Ue,Re),oe(De,Xe),ce&&ce.m(De,null),Ne=!0,B||(V=qe(i,"click",e[39]),B=!0)},p(ie,le){ie[10]?ye?(ye.p(ie,le),le[0]&1024&&te(ye,1)):(ye=t1(ie),ye.c(),te(ye,1),ye.m(t,r)):ye&&(rn(),ue(ye,1,1,()=>{ye=null}),sn()),(!Ne||le[0]&1024)&&lt(i,"m-l-s",ie[10]);const ve={};le[0]&65536&&(ve.max=ie[16]),!f&&le[0]&4&&(f=!0,ve.value=ie[2],Zn(()=>f=!1)),u.$set(ve);const ke={};!S&&le[0]&8&&(S=!0,ke.value=ie[3],Zn(()=>S=!1)),E.$set(ke);const Pe={};!d&&le[0]&16&&(d=!0,Pe.value=ie[4],Zn(()=>d=!1)),A.$set(Pe);const Ze={};!O&&le[0]&32&&(O=!0,Ze.value=ie[5],Zn(()=>O=!1)),D.$set(Ze);const ft={};le[0]&65536&&(ft.max=ie[16]),!X&&le[0]&64&&(X=!0,ft.value=ie[6],Zn(()=>X=!1)),N.$set(ft);const $e={};!F&&le[0]&128&&(F=!0,$e.value=ie[7],Zn(()=>F=!1)),U.$set($e);const dt={};!K&&le[0]&256&&(K=!0,dt.value=ie[8],Zn(()=>K=!1)),H.$set(dt);const Be={};!Le&&le[0]&512&&(Le=!0,Be.value=ie[9],Zn(()=>Le=!1)),ge.$set(Be),(!Ne||le[0]&1)&&be!==(be=ie[0].text+"")&&en(Re,be),ie[17].matchedBy?ce?(ce.p(ie,le),le[0]&131072&&te(ce,1)):(ce=n1(ie),ce.c(),te(ce,1),ce.m(De,null)):ce&&(rn(),ue(ce,1,1,()=>{ce=null}),sn())},i(ie){Ne||(te(ye),te(s.$$.fragment,ie),te(u.$$.fragment,ie),te(E.$$.fragment,ie),te(A.$$.fragment,ie),te(D.$$.fragment,ie),te(N.$$.fragment,ie),te(U.$$.fragment,ie),te(H.$$.fragment,ie),te(ge.$$.fragment,ie),te(ce),Ne=!0)},o(ie){ue(ye),ue(s.$$.fragment,ie),ue(u.$$.fragment,ie),ue(E.$$.fragment,ie),ue(A.$$.fragment,ie),ue(D.$$.fragment,ie),ue(N.$$.fragment,ie),ue(U.$$.fragment,ie),ue(H.$$.fragment,ie),ue(ge.$$.fragment,ie),ue(ce),Ne=!1},d(ie){ie&&fe(n),ye&&ye.d(),Se(s),Se(u),Se(E),Se(A),Se(D),Se(N),Se(U),Se(H),Se(ge),ce&&ce.d(),B=!1,V()}}}function r2(e){let n,t,r,i,s,o;return{c(){n=_e("div"),t=_e("button"),t.textContent="Cancel",r=me(),i=_e("button"),i.textContent="Save",re(n,"class","flex grow justify-between"),re(n,"slot","footer")},m(a,l){de(a,n,l),oe(n,t),oe(n,r),oe(n,i),s||(o=[qe(t,"click",e[30]),qe(i,"click",e[31])],s=!0)},p:gt,d(a){a&&fe(n),s=!1,_n(o)}}}function i2(e){let n,t,r,i,s,o=e[10]&&e1(e);return t=new la({props:{$$slots:{footer:[r2],content:[n2],header:[t2]},$$scope:{ctx:e}}}),{c(){o&&o.c(),n=me(),Te(t.$$.fragment),r=me(),i=_e("div"),i.innerHTML='<span class="spinner"></span>',re(i,"class","backdrop"),lt(i,"hidden",!e[12])},m(a,l){o&&o.m(a,l),de(a,n,l),Ee(t,a,l),de(a,r,l),de(a,i,l),s=!0},p(a,l){a[10]?o?o.p(a,l):(o=e1(a),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null);const c={};l[0]&255997|l[1]&4194304&&(c.$$scope={dirty:l,ctx:a}),t.$set(c),(!s||l[0]&4096)&&lt(i,"hidden",!a[12])},i(a){s||(te(t.$$.fragment,a),s=!0)},o(a){ue(t.$$.fragment,a),s=!1},d(a){a&&(fe(n),fe(r),fe(i)),o&&o.d(a),Se(t,a)}}}function s2(e,n,t){let r,i,s,o,a,l;we(e,Xn,V=>t(49,o=V)),we(e,oo,V=>t(10,a=V)),we(e,Ss,V=>t(17,l=V));let{activeSubtitle:c}=n,{resolver:u}=n;const{isIOS:f}=Ni("context"),[m,g,_,E]=oi(c.startSeconds),[S,b,v,y]=oi(c.endSeconds),A=ei();let d,p=!!a,M=c.startSeconds,L=0,D=!0,[O,x,Y,R]=[m,g,_,E],[w,N,X,q]=[S,b,v,y];async function Z(){if(!f){t(11,d.currentTime=c.startSeconds,d),t(12,p=!1);return}let V=0,ye;const Ae=new Promise(et=>{ye=et,d.addEventListener("loadeddata",et,{once:!0,capture:!1})});await new Promise(et=>{const Je=setInterval(async()=>{try{V+=1,d.play(),setTimeout(ye,1e4),await Ae,d.pause(),clearInterval(Je),et()}catch{}V>20&&(clearInterval(Je),ye(void 0),et())},500)}),t(11,d.currentTime=c.startSeconds,d),await qn(),t(12,p=!1)}function ne(){M>i&&(t(14,D=!0),t(13,M=r))}async function U(){t(14,D=!0),a&&r>L&&t(2,[O,x,Y,R]=oi(i),O,t(3,x),t(4,Y),t(5,R)),a&&i>L&&t(6,[w,N,X,q]=oi(L),w,t(7,N),t(8,X),t(9,q)),await qn(),r>i&&(t(2,[O,x,Y,R]=oi(i),O,t(3,x),t(4,Y),t(5,R)),t(6,[w,N,X,q]=oi(r),w,t(7,N),t(8,X),t(9,q)),await qn()),t(13,M=r)}async function F(){t(12,p=!0),await Ln(ct.ALIGN_SUBTITLE,c,{persistAlignment:!1,ignoreSkipKeyListener:!0}),t(0,c=o.get(c.id)),t(12,p=!1)}function C(){if(c.text!==c.originalText)return t(0,c.text=c.originalText,c),I({wasCanceled:!1,subtitle:c});I({wasCanceled:!0})}async function P(){await qn();const V=r,ye=i;I({wasCanceled:!1,subtitle:{...c,adjustedStartSeconds:V,startSeconds:V,startTime:dr(V),adjustedEndSeconds:ye,endSeconds:ye,endTime:dr(ye)}})}function I(V){u==null||u(V),A("close")}function H(){L=this.duration,t(1,L)}function K(){M=this.currentTime,t(13,M)}function he(){D=this.paused,t(14,D)}function ee(V){Gt[V?"unshift":"push"](()=>{d=V,t(11,d)})}const ae=()=>t(14,D=!D),ge=()=>{t(13,M=r),t(14,D=!1)},Le=()=>{t(14,D=!0),t(2,[O,x,Y,R]=[m,g,_,E],O,t(3,x),t(4,Y),t(5,R)),t(6,[w,N,X,q]=[S,b,v,y],w,t(7,N),t(8,X),t(9,q))};function He(V){O=V,t(2,O)}function De(V){x=V,t(3,x)}function Ue(V){Y=V,t(4,Y)}function be(V){R=V,t(5,R)}function Re(V){w=V,t(6,w)}function Xe(V){N=V,t(7,N)}function Ne(V){X=V,t(8,X)}function B(V){q=V,t(9,q)}return e.$$set=V=>{"activeSubtitle"in V&&t(0,c=V.activeSubtitle),"resolver"in V&&t(32,u=V.resolver)},e.$$.update=()=>{e.$$.dirty[0]&60&&t(15,r=O*3600+x*60+Y+R/1e3),e.$$.dirty[0]&960&&(i=w*3600+N*60+X+q/1e3),e.$$.dirty[0]&1026&&t(16,s=a?Math.floor(L/3600):999)},[c,L,O,x,Y,R,w,N,X,q,a,d,p,M,D,r,s,l,m,g,_,E,S,b,v,y,Z,ne,U,F,C,P,u,H,K,he,ee,ae,ge,Le,He,De,Ue,be,Re,Xe,Ne,B]}class o2 extends vn{constructor(n){super(),wn(this,n,s2,i2,pn,{activeSubtitle:0,resolver:32},null,[-1,-1])}}function Bl(e,n){e.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"skipKeyDownListener",params:{value:n}}})),dn.set(n)}function r1(e,n){const t=It(e);t.has(n)?t.delete(n):t.add(n),e.set(t)}async function a2(e){gn.set(!0);const n=It(Si)&&It(St.exportAudioProcessor$)===Jn.FFMPEG,t=n?Qp:o2,r=It(Xn),i=[...r.values()],s={activeSubtitle:JSON.parse(JSON.stringify(e))};if(n){const a=i.slice(Math.max(0,e.subIndex-1),e.subIndex+2);if(e.subIndex===0){const l=Math.max(0,e.startSeconds-10);a.unshift(fr(l))}else if(e.subIndex===r.size-1){const l=ai(0,It(si),e.endSeconds+10);a.push(fr(l,l))}s.subtitleRegions=JSON.parse(JSON.stringify(a))}const o=await new Promise(a=>{io.add({component:t,props:{...s,resolver:a}})});if(o.error)return kt.set(o.error);o.wasCanceled||!o.subtitle||(r.set(e.id,o.subtitle),Xn.set(r),fo.set({subtitles:[o.subtitle]}),It(St.subtitlesEnablePersist$)&&(kt.set(""),i[o.subtitle.subIndex]=o.subtitle,await Ti({name:It(ni).name,subtitles:i}).catch(({message:a})=>kt.set(a))))}async function l2(e,n){var t;try{kt.set(""),await new Promise(o=>window.setTimeout(o,100));const r=sa(new DOMParser,It(Pr).elementHtml),i=It(Xn);let s=!1;for(let o=0,{length:a}=e;o<a;o+=1){const l=i.get(e[o].id),c=r.querySelectorAll(po(l.id));let u="";for(let f=0,{length:m}=c;f<m;f+=1){const g=c[f],_=(((t=g.parentElement)==null?void 0:t.tagName)||"").toLowerCase();ia.has(_)||(u+=g.innerText.trim())}u!==l.originalText&&(l.text=u,i.set(l.id,l),s=!0)}if(!s||(Xn.set(i),!n||!It(St.subtitlesEnablePersist$)))return;kt.set(""),await Ti({name:It(ni).name,subtitles:[...i.values()]})}catch({message:r}){kt.set(`Failed to align: ${r}`)}}async function u2(e){const n=[],t=It(Xn),r=It(si),i=It(St.subtitlesGlobalStartPadding$)/1e3,s=It(St.subtitlesGlobalEndPadding$)/1e3;let o=!1;for(let a=0,{length:l}=e;a<l;a+=1){const c=e[a],u=Math.max(0,c.originalStartSeconds+i),f=r?ai(0,r,c.originalEndSeconds+s):Math.max(0,c.originalEndSeconds+s),m=c.text!==c.originalText,g=Number.isFinite(c.adjustedStartSeconds)&&c.adjustedStartSeconds!==u||Number.isFinite(c.adjustedEndSeconds)&&c.adjustedEndSeconds!==f;if(delete c.adjustedStartSeconds,delete c.adjustedEndSeconds,m||g){const _={...c,startSeconds:u,startTime:dr(u),endSeconds:f,endTime:dr(f),text:c.originalText};t.set(c.id,_),o=!0,g&&n.push(_)}}o&&(Xn.set(t),fo.set({subtitles:n}),It(St.subtitlesEnablePersist$)&&(kt.set(""),await Ti({name:It(ni).name,subtitles:[...t.values()]}).catch(({message:a})=>kt.set(a))))}function c2(e,n){if(n)return JSON.parse(JSON.stringify([e]));const t=[];for(let r=0,{length:i}=e;r<i;r+=1)t.push([e[r]]);return JSON.parse(JSON.stringify(t))}var ct=(e=>(e.NONE="None",e.RESTART_PLAYBACK="Restart playback",e.TOGGLE_PLAY_PAUSE="Toggle play and pause",e.TOGGLE_PLAYBACK_LOOP="Toggle playback loop",e.TOGGLE_BOOKMARK="Toggle bookmark",e.TOGGLE_MERGE="Toggle for merge",e.ALIGN_SUBTITLE="Align with book text",e.EDIT_SUBTITLE="Edit subtitle",e.RESTORE_SUBTITLE="Restore original text and time",e.EXPORT_NEW="Create new card",e.EXPORT_UPDATE="Update last created card",e.CANCEL_EXPORT="Cancel Export",e))(ct||{});function f2(e,n){const t=r=>{!r.defaultPrevented&&!e.contains(r.target)&&n(r)};return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function Il(e,{document:n,isSkipped:t}){const r=()=>Bl(n,!0),i=()=>Bl(n,!1);return t||(e.addEventListener("focus",r,!1),e.addEventListener("blur",i,!1)),{destroy(){e.removeEventListener("focus",r,!1),e.removeEventListener("blur",i,!1),t||Bl(n,!1)}}}async function Ln(e,n,t={mergeSubtitles:!1,skipUpdates:!1,keepPauseState:!1,persistAlignment:!0,ignoreSkipKeyListener:!1}){if(e==="None"||!n||!t.ignoreSkipKeyListener&&It(dn))return;const r=Array.isArray(n)?n:[n],i=It(jr),s=It(ki);r.length&&(!s&&(e==="Restart playback"||e==="Toggle play and pause"||e==="Toggle playback loop")?hl.set({action:e,subtitles:r,skipUpdates:t.skipUpdates,keepPauseState:t.keepPauseState}):e==="Toggle bookmark"?r1(na,r[0].id):e==="Toggle for merge"?r1(ra,r[0].id):!i&&e==="Edit subtitle"?await a2(r[0]):!i&&e==="Align with book text"&&It(Ss).matchedBy?await l2(r,t.persistAlignment):!i&&e==="Restore original text and time"?await u2(r):!i&&(e==="Create new card"||e==="Update last created card")&&It(Ko)?await bp(c2(r,t.mergeSubtitles),e==="Update last created card").finally(()=>{Qo.set(0),jr.set(void 0)}):i&&!i.signal.aborted&&e==="Cancel Export"&&(i.abort("user aborted"),jr.set(i)))}async function Ti(e){const n=It(zn);try{await It(Es).put("subtitle",{subtitleData:e,title:n.title,lastSubtitleDataModified:Date.now()}),n.subtitleData=e,document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"sync",syncType:"subtitle"}}))}catch({message:t}){throw new Error(`Failed to persist subtitles - ${t}`)}finally{zn.set(n)}}function d2(e,n){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r,i,s,o,a=[],l=!0,c=!1;try{if(s=(t=t.call(e)).next,n===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=s.call(t)).done)&&(a.push(r.value),a.length!==n);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw i}}return a}}function i1(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,r)}return t}function Er(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?i1(Object(t),!0).forEach(function(r){ha(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i1(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function h2(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s1(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l1(r.key),r)}}function p2(e,n,t){return n&&s1(e.prototype,n),t&&s1(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ha(e,n,t){return n=l1(n),n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function m2(e,n){if(e==null)return{};var t={},r=Object.keys(e),i,s;for(s=0;s<r.length;s++)i=r[s],!(n.indexOf(i)>=0)&&(t[i]=e[i]);return t}function _2(e,n){if(e==null)return{};var t=m2(e,n),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],!(n.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}function g2(e,n){return b2(e)||d2(e,n)||o1(e,n)||w2()}function b2(e){if(Array.isArray(e))return e}function o1(e,n){if(e){if(typeof e=="string")return a1(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return a1(e,n)}}function a1(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function w2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function v2(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=o1(e))||n&&e&&typeof e.length=="number"){t&&(e=t);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(o)throw a}}}}function y2(e,n){if(typeof e!="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var r=t.call(e,n||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function l1(e){var n=y2(e,"string");return typeof n=="symbol"?n:String(n)}var E2=["AudioCount","Audio_Channels_Total","BitDepth_Detected","BitDepth","BitDepth_Stored","Channels","Channels_Original","Chapters_Pos_Begin","Chapters_Pos_End","Comic_Position_Total","Count","DataSize","ElementCount","EPG_Positions_Begin","EPG_Positions_End","FirstPacketOrder","FooterSize","Format_Settings_GMC","Format_Settings_RefFrames","FrameCount","FrameRate_Den","FrameRate_Num","GeneralCount","HeaderSize","Height_CleanAperture","Height","Height_Offset","Height_Original","ImageCount","Matrix_Channels","MenuCount","OtherCount","Part_Position","Part_Position_Total","Played_Count","Reel_Position","Reel_Position_Total","Resolution","Sampled_Height","Sampled_Width","SamplingCount","Season_Position","Season_Position_Total","Source_FrameCount","Source_SamplingCount","Source_StreamSize_Encoded","Source_StreamSize","Status","Stored_Height","Stored_Width","StreamCount","StreamKindID","StreamKindPos","StreamOrder","StreamSize_Demuxed","StreamSize_Encoded","StreamSize","TextCount","Track_Position","Track_Position_Total","Video0_Delay","VideoCount","Width_CleanAperture","Width","Width_Offset","Width_Original"],S2=["BitRate_Encoded","BitRate_Maximum","BitRate_Minimum","BitRate","BitRate_Nominal","Bits-Pixel_Frame","BitsPixel_Frame","Compression_Ratio","Delay","Delay_Original","DisplayAspectRatio_CleanAperture","DisplayAspectRatio","DisplayAspectRatio_Original","Duration_End_Command","Duration_End","Duration_FirstFrame","Duration_LastFrame","Duration","Duration_Start2End","Duration_Start_Command","Duration_Start","Events_MinDuration","FrameRate_Maximum","FrameRate_Minimum","FrameRate","FrameRate_Nominal","FrameRate_Original_Den","FrameRate_Original","FrameRate_Original_Num","FrameRate_Real","Interleave_Duration","Interleave_Preload","Interleave_VideoFrames","OverallBitRate_Maximum","OverallBitRate_Minimum","OverallBitRate","OverallBitRate_Nominal","PixelAspectRatio_CleanAperture","PixelAspectRatio","PixelAspectRatio_Original","SamplesPerFrame","SamplingRate","Source_Duration_FirstFrame","Source_Duration_LastFrame","Source_Duration","TimeStamp_FirstFrame","Video_Delay"],Ol={coverData:!1,chunkSize:256*1024,format:"object",full:!1},k2=function(){function e(n,t){h2(this,e),this.mediainfoModule=n,this.options=t,this.mediainfoModuleInstance=new n.MediaInfo(t.format==="object"?"JSON":t.format,t.coverData,t.full)}return p2(e,[{key:"analyzeData",value:function(t,r,i){var s=this;if(i===void 0)return new Promise(function(c,u){var f=function(g,_){return _?u(_):c(g)};s.analyzeData(t,r,f)});var o=0,a=function(u){var f=function _(){var E=function(A){m(A)?_():g()},S;try{var b,v=Math.min((b=s.options.chunkSize)!==null&&b!==void 0?b:Ol.chunkSize,u-o);S=r(v,o)}catch(y){if(y instanceof Error)return i("",y);if(typeof y=="string")return i("",new Error(y))}S instanceof Promise?S.then(E).catch(function(y){return i("",y)}):S!==void 0&&E(S)},m=function(E){if(E.length===0||s.openBufferContinue(E,E.length))return!1;var S=s.openBufferContinueGotoGet();return S===-1?o+=E.length:(o=S,s.openBufferInit(u,S)),!0},g=function(){s.openBufferFinalize();var E=s.inform();s.options.format==="object"?i(s.parseResultJson(E)):i(E)};s.openBufferInit(u,o),f()},l=t();l instanceof Promise?l.then(a).catch(function(c){return i(null,c)}):a(l)}},{key:"close",value:function(){var t;this.mediainfoModuleInstance&&this.mediainfoModuleInstance.close(),this.mediainfoModule&&typeof((t=this.mediainfoModule)===null||t===void 0?void 0:t.destroy)=="function"&&this.mediainfoModule.destroy(this.mediainfoModuleInstance)}},{key:"inform",value:function(){return this.mediainfoModuleInstance.inform()}},{key:"openBufferContinue",value:function(t,r){return!!(this.mediainfoModuleInstance.open_buffer_continue(t,r)&8)}},{key:"openBufferContinueGotoGet",value:function(){var t=-1,r=this.mediainfoModuleInstance.open_buffer_continue_goto_get_lower(),i=this.mediainfoModuleInstance.open_buffer_continue_goto_get_upper();return r==-1&&i==-1?t=-1:r<0?t=r+4294967296+i*4294967296:t=r+i*4294967296,t}},{key:"openBufferFinalize",value:function(){this.mediainfoModuleInstance.open_buffer_finalize()}},{key:"openBufferInit",value:function(t,r){this.mediainfoModuleInstance.open_buffer_init(t,r)}},{key:"parseResultJson",value:function(t){var r=E2,i=S2,s=JSON.parse(t);if(s.media){var o=Er(Er({},s.media),{},{track:[]});if(s.media.track&&Array.isArray(s.media.track)){var a=v2(s.media.track),l;try{for(a.s();!(l=a.n()).done;){for(var c=l.value,u={"@type":c["@type"]},f=0,m=Object.entries(c);f<m.length;f++){var g=g2(m[f],2),_=g[0],E=g[1];_!=="@type"&&(typeof E=="string"&&r.includes(_)?u=Er(Er({},u),{},ha({},_,parseInt(E,10))):typeof E=="string"&&i.includes(_)?u=Er(Er({},u),{},ha({},_,parseFloat(E))):u=Er(Er({},u),{},ha({},_,E)))}o.track.push(u)}}catch(S){a.e(S)}finally{a.f()}}return Er(Er({},s),{},{media:o})}return s}}]),e}(),T2=(()=>{var e=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return function(n={}){var t=n,r,i;t.ready=new Promise((G,z)=>{r=G,i=z});var s=Object.assign({},t),o="./this.program",a=!0,l="";function c(G){return t.locateFile?t.locateFile(G,l):l+G}typeof document<"u"&&document.currentScript&&(l=document.currentScript.src),e&&(l=e),l.indexOf("blob:")!==0?l=l.substr(0,l.replace(/[?#].*/,"").lastIndexOf("/")+1):l="",t.print||console.log.bind(console);var u=t.printErr||console.error.bind(console);Object.assign(t,s),s=null,t.arguments&&t.arguments,t.thisProgram&&(o=t.thisProgram),t.quit&&t.quit;var f;t.wasmBinary&&(f=t.wasmBinary),t.noExitRuntime,typeof WebAssembly!="object"&&C("no native wasm support detected");var m,g,_=!1,E,S,b,v,y,A,d,p;function M(){var G=m.buffer;t.HEAP8=E=new Int8Array(G),t.HEAP16=b=new Int16Array(G),t.HEAP32=y=new Int32Array(G),t.HEAPU8=S=new Uint8Array(G),t.HEAPU16=v=new Uint16Array(G),t.HEAPU32=A=new Uint32Array(G),t.HEAPF32=d=new Float32Array(G),t.HEAPF64=p=new Float64Array(G)}var L,D=[],O=[],x=[];function Y(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)N(t.preRun.shift());Le(D)}function R(){Le(O)}function w(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)q(t.postRun.shift());Le(x)}function N(G){D.unshift(G)}function X(G){O.unshift(G)}function q(G){x.unshift(G)}var Z=0,ne=null;function U(G){Z++,t.monitorRunDependencies&&t.monitorRunDependencies(Z)}function F(G){if(Z--,t.monitorRunDependencies&&t.monitorRunDependencies(Z),Z==0&&ne){var z=ne;ne=null,z()}}function C(G){t.onAbort&&t.onAbort(G),G="Aborted("+G+")",u(G),_=!0,G+=". Build with -sASSERTIONS for more info.";var z=new WebAssembly.RuntimeError(G);throw i(z),z}var P="data:application/octet-stream;base64,";function I(G){return G.startsWith(P)}var H;H="MediaInfoModule.wasm",I(H)||(H=c(H));function K(G){if(G==H&&f)return new Uint8Array(f);throw"both async and sync fetching of the wasm failed"}function he(G){return!f&&a&&typeof fetch=="function"?fetch(G,{credentials:"same-origin"}).then(z=>{if(!z.ok)throw"failed to load wasm binary file at '"+G+"'";return z.arrayBuffer()}).catch(()=>K(G)):Promise.resolve().then(()=>K(G))}function ee(G,z,se){return he(G).then(Me=>WebAssembly.instantiate(Me,z)).then(Me=>Me).then(se,Me=>{u("failed to asynchronously prepare wasm: "+Me),C(Me)})}function ae(G,z,se,Me){return!G&&typeof WebAssembly.instantiateStreaming=="function"&&!I(z)&&typeof fetch=="function"?fetch(z,{credentials:"same-origin"}).then(Fe=>{var tt=WebAssembly.instantiateStreaming(Fe,se);return tt.then(Me,function(rt){return u("wasm streaming compile failed: "+rt),u("falling back to ArrayBuffer instantiation"),ee(z,se,Me)})}):ee(z,se,Me)}function ge(){var G={a:Q8};function z(Me,Fe){var tt=Me.exports;return g=tt,m=g.u,M(),L=g.x,X(g.v),F(),tt}U();function se(Me){z(Me.instance)}if(t.instantiateWasm)try{return t.instantiateWasm(G,z)}catch(Me){u("Module.instantiateWasm callback failed with error: "+Me),i(Me)}return ae(f,H,G,se).catch(i),{}}var Le=G=>{for(;G.length>0;)G.shift()(t)};function He(G,z,se,Me,Fe){}function De(G){switch(G){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${G}`)}}function Ue(){for(var G=new Array(256),z=0;z<256;++z)G[z]=String.fromCharCode(z);be=G}var be=void 0;function Re(G){for(var z="",se=G;S[se];)z+=be[S[se++]];return z}var Xe={},Ne={},B={},V=void 0;function ye(G){throw new V(G)}var Ae=void 0;function Ke(G){throw new Ae(G)}function et(G,z,se){G.forEach(function(it){B[it]=z});function Me(it){var vt=se(it);vt.length!==G.length&&Ke("Mismatched type converter count");for(var mt=0;mt<G.length;++mt)ze(G[mt],vt[mt])}var Fe=new Array(z.length),tt=[],rt=0;z.forEach((it,vt)=>{Ne.hasOwnProperty(it)?Fe[vt]=Ne[it]:(tt.push(it),Xe.hasOwnProperty(it)||(Xe[it]=[]),Xe[it].push(()=>{Fe[vt]=Ne[it],++rt,rt===tt.length&&Me(Fe)}))}),tt.length===0&&Me(Fe)}function Je(G,z,se={}){var Me=z.name;if(G||ye(`type "${Me}" must have a positive integer typeid pointer`),Ne.hasOwnProperty(G)){if(se.ignoreDuplicateRegistrations)return;ye(`Cannot register type '${Me}' twice`)}if(Ne[G]=z,delete B[G],Xe.hasOwnProperty(G)){var Fe=Xe[G];delete Xe[G],Fe.forEach(tt=>tt())}}function ze(G,z,se={}){if(!("argPackAdvance"in z))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Je(G,z,se)}function ut(G,z,se,Me,Fe){var tt=De(se);z=Re(z),ze(G,{name:z,fromWireType:function(rt){return!!rt},toWireType:function(rt,it){return it?Me:Fe},argPackAdvance:8,readValueFromPointer:function(rt){var it;if(se===1)it=E;else if(se===2)it=b;else if(se===4)it=y;else throw new TypeError("Unknown boolean type size: "+z);return this.fromWireType(it[rt>>tt])},destructorFunction:null})}function nt(G){if(!(this instanceof Bt)||!(G instanceof Bt))return!1;for(var z=this.$$.ptrType.registeredClass,se=this.$$.ptr,Me=G.$$.ptrType.registeredClass,Fe=G.$$.ptr;z.baseClass;)se=z.upcast(se),z=z.baseClass;for(;Me.baseClass;)Fe=Me.upcast(Fe),Me=Me.baseClass;return z===Me&&se===Fe}function Ye(G){return{count:G.count,deleteScheduled:G.deleteScheduled,preservePointerOnDelete:G.preservePointerOnDelete,ptr:G.ptr,ptrType:G.ptrType,smartPtr:G.smartPtr,smartPtrType:G.smartPtrType}}function W(G){function z(se){return se.$$.ptrType.registeredClass.name}ye(z(G)+" instance already deleted")}var k=!1;function h(G){}function T(G){G.smartPtr?G.smartPtrType.rawDestructor(G.smartPtr):G.ptrType.registeredClass.rawDestructor(G.ptr)}function $(G){G.count.value-=1;var z=G.count.value===0;z&&T(G)}function j(G,z,se){if(z===se)return G;if(se.baseClass===void 0)return null;var Me=j(G,z,se.baseClass);return Me===null?null:se.downcast(Me)}var J={};function Q(){return Object.keys(Ze).length}function ce(){var G=[];for(var z in Ze)Ze.hasOwnProperty(z)&&G.push(Ze[z]);return G}var ie=[];function le(){for(;ie.length;){var G=ie.pop();G.$$.deleteScheduled=!1,G.delete()}}var ve=void 0;function ke(G){ve=G,ie.length&&ve&&ve(le)}function Pe(){t.getInheritedInstanceCount=Q,t.getLiveInheritedInstances=ce,t.flushPendingDeletes=le,t.setDelayFunction=ke}var Ze={};function ft(G,z){for(z===void 0&&ye("ptr should not be undefined");G.baseClass;)z=G.upcast(z),G=G.baseClass;return z}function $e(G,z){return z=ft(G,z),Ze[z]}function dt(G,z){(!z.ptrType||!z.ptr)&&Ke("makeClassHandle requires ptr and ptrType");var se=!!z.smartPtrType,Me=!!z.smartPtr;return se!==Me&&Ke("Both smartPtrType and smartPtr must be specified"),z.count={value:1},Qe(Object.create(G,{$$:{value:z}}))}function Be(G){var z=this.getPointee(G);if(!z)return this.destructor(G),null;var se=$e(this.registeredClass,z);if(se!==void 0){if(se.$$.count.value===0)return se.$$.ptr=z,se.$$.smartPtr=G,se.clone();var Me=se.clone();return this.destructor(G),Me}function Fe(){return this.isSmartPointer?dt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:z,smartPtrType:this,smartPtr:G}):dt(this.registeredClass.instancePrototype,{ptrType:this,ptr:G})}var tt=this.registeredClass.getActualType(z),rt=J[tt];if(!rt)return Fe.call(this);var it;this.isConst?it=rt.constPointerType:it=rt.pointerType;var vt=j(z,this.registeredClass,it.registeredClass);return vt===null?Fe.call(this):this.isSmartPointer?dt(it.registeredClass.instancePrototype,{ptrType:it,ptr:vt,smartPtrType:this,smartPtr:G}):dt(it.registeredClass.instancePrototype,{ptrType:it,ptr:vt})}var Qe=function(G){return typeof FinalizationRegistry>"u"?(Qe=z=>z,G):(k=new FinalizationRegistry(z=>{$(z.$$)}),Qe=z=>{var se=z.$$,Me=!!se.smartPtr;if(Me){var Fe={$$:se};k.register(z,Fe,z)}return z},h=z=>k.unregister(z),Qe(G))};function wt(){if(this.$$.ptr||W(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var G=Qe(Object.create(Object.getPrototypeOf(this),{$$:{value:Ye(this.$$)}}));return G.$$.count.value+=1,G.$$.deleteScheduled=!1,G}function We(){this.$$.ptr||W(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ye("Object already scheduled for deletion"),h(this),$(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function at(){return!this.$$.ptr}function je(){return this.$$.ptr||W(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ye("Object already scheduled for deletion"),ie.push(this),ie.length===1&&ve&&ve(le),this.$$.deleteScheduled=!0,this}function _t(){Bt.prototype.isAliasOf=nt,Bt.prototype.clone=wt,Bt.prototype.delete=We,Bt.prototype.isDeleted=at,Bt.prototype.deleteLater=je}function Bt(){}var ot=48,ht=57;function Rt(G){if(G===void 0)return"_unknown";G=G.replace(/[^a-zA-Z0-9_]/g,"$");var z=G.charCodeAt(0);return z>=ot&&z<=ht?`_${G}`:G}function Xt(G,z){return G=Rt(G),{[G]:function(){return z.apply(this,arguments)}}[G]}function mn(G,z,se){if(G[z].overloadTable===void 0){var Me=G[z];G[z]=function(){return G[z].overloadTable.hasOwnProperty(arguments.length)||ye(`Function '${se}' called with an invalid number of arguments (${arguments.length}) - expects one of (${G[z].overloadTable})!`),G[z].overloadTable[arguments.length].apply(this,arguments)},G[z].overloadTable=[],G[z].overloadTable[Me.argCount]=Me}}function Jt(G,z,se){t.hasOwnProperty(G)?((se===void 0||t[G].overloadTable!==void 0&&t[G].overloadTable[se]!==void 0)&&ye(`Cannot register public name '${G}' twice`),mn(t,G,G),t.hasOwnProperty(se)&&ye(`Cannot register multiple overloads of a function with the same number of arguments (${se})!`),t[G].overloadTable[se]=z):(t[G]=z,se!==void 0&&(t[G].numArguments=se))}function $t(G,z,se,Me,Fe,tt,rt,it){this.name=G,this.constructor=z,this.instancePrototype=se,this.rawDestructor=Me,this.baseClass=Fe,this.getActualType=tt,this.upcast=rt,this.downcast=it,this.pureVirtualFunctions=[]}function bn(G,z,se){for(;z!==se;)z.upcast||ye(`Expected null or instance of ${se.name}, got an instance of ${z.name}`),G=z.upcast(G),z=z.baseClass;return G}function Sn(G,z){if(z===null)return this.isReference&&ye(`null is not a valid ${this.name}`),0;z.$$||ye(`Cannot pass "${Ks(z)}" as a ${this.name}`),z.$$.ptr||ye(`Cannot pass deleted object as a pointer of type ${this.name}`);var se=z.$$.ptrType.registeredClass,Me=bn(z.$$.ptr,se,this.registeredClass);return Me}function En(G,z){var se;if(z===null)return this.isReference&&ye(`null is not a valid ${this.name}`),this.isSmartPointer?(se=this.rawConstructor(),G!==null&&G.push(this.rawDestructor,se),se):0;z.$$||ye(`Cannot pass "${Ks(z)}" as a ${this.name}`),z.$$.ptr||ye(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&z.$$.ptrType.isConst&&ye(`Cannot convert argument of type ${z.$$.smartPtrType?z.$$.smartPtrType.name:z.$$.ptrType.name} to parameter type ${this.name}`);var Me=z.$$.ptrType.registeredClass;if(se=bn(z.$$.ptr,Me,this.registeredClass),this.isSmartPointer)switch(z.$$.smartPtr===void 0&&ye("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:z.$$.smartPtrType===this?se=z.$$.smartPtr:ye(`Cannot convert argument of type ${z.$$.smartPtrType?z.$$.smartPtrType.name:z.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:se=z.$$.smartPtr;break;case 2:if(z.$$.smartPtrType===this)se=z.$$.smartPtr;else{var Fe=z.clone();se=this.rawShare(se,lr.toHandle(function(){Fe.delete()})),G!==null&&G.push(this.rawDestructor,se)}break;default:ye("Unsupporting sharing policy")}return se}function Yt(G,z){if(z===null)return this.isReference&&ye(`null is not a valid ${this.name}`),0;z.$$||ye(`Cannot pass "${Ks(z)}" as a ${this.name}`),z.$$.ptr||ye(`Cannot pass deleted object as a pointer of type ${this.name}`),z.$$.ptrType.isConst&&ye(`Cannot convert argument of type ${z.$$.ptrType.name} to parameter type ${this.name}`);var se=z.$$.ptrType.registeredClass,Me=bn(z.$$.ptr,se,this.registeredClass);return Me}function Ht(G){return this.fromWireType(y[G>>2])}function Vt(G){return this.rawGetPointee&&(G=this.rawGetPointee(G)),G}function Ft(G){this.rawDestructor&&this.rawDestructor(G)}function Ge(G){G!==null&&G.delete()}function bt(){Ve.prototype.getPointee=Vt,Ve.prototype.destructor=Ft,Ve.prototype.argPackAdvance=8,Ve.prototype.readValueFromPointer=Ht,Ve.prototype.deleteObject=Ge,Ve.prototype.fromWireType=Be}function Ve(G,z,se,Me,Fe,tt,rt,it,vt,mt,Ut){this.name=G,this.registeredClass=z,this.isReference=se,this.isConst=Me,this.isSmartPointer=Fe,this.pointeeType=tt,this.sharingPolicy=rt,this.rawGetPointee=it,this.rawConstructor=vt,this.rawShare=mt,this.rawDestructor=Ut,!Fe&&z.baseClass===void 0?Me?(this.toWireType=Sn,this.destructorFunction=null):(this.toWireType=Yt,this.destructorFunction=null):this.toWireType=En}function Ie(G,z,se){t.hasOwnProperty(G)||Ke("Replacing nonexistant public symbol"),t[G].overloadTable!==void 0&&se!==void 0?t[G].overloadTable[se]=z:(t[G]=z,t[G].argCount=se)}var Mt=(G,z,se)=>{var Me=t["dynCall_"+G];return se&&se.length?Me.apply(null,[z].concat(se)):Me.call(null,z)},Tt=G=>L.get(G),Zt=(G,z,se)=>{if(G.includes("j"))return Mt(G,z,se);var Me=Tt(z).apply(null,se);return Me},yt=(G,z)=>{var se=[];return function(){return se.length=0,Object.assign(se,arguments),Zt(G,z,se)}};function jt(G,z){G=Re(G);function se(){return G.includes("j")?yt(G,z):Tt(z)}var Me=se();return typeof Me!="function"&&ye(`unknown function pointer with signature ${G}: ${z}`),Me}function cn(G,z){var se=Xt(z,function(Me){this.name=z,this.message=Me;var Fe=new Error(Me).stack;Fe!==void 0&&(this.stack=this.toString()+`
`+Fe.replace(/^Error(:[^\n]*)?\n/,""))});return se.prototype=Object.create(G.prototype),se.prototype.constructor=se,se.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},se}var Oe=void 0;function Lt(G){var z=bh(G),se=Re(z);return yi(z),se}function Ot(G,z){var se=[],Me={};function Fe(tt){if(!Me[tt]&&!Ne[tt]){if(B[tt]){B[tt].forEach(Fe);return}se.push(tt),Me[tt]=!0}}throw z.forEach(Fe),new Oe(`${G}: `+se.map(Lt).join([", "]))}function Dt(G,z,se,Me,Fe,tt,rt,it,vt,mt,Ut,ln,Wt){Ut=Re(Ut),tt=jt(Fe,tt),it&&(it=jt(rt,it)),mt&&(mt=jt(vt,mt)),Wt=jt(ln,Wt);var fn=Rt(Ut);Jt(fn,function(){Ot(`Cannot construct ${Ut} due to unbound types`,[Me])}),et([G,z,se],Me?[Me]:[],function($n){$n=$n[0];var Yn,tr;Me?(Yn=$n.registeredClass,tr=Yn.instancePrototype):tr=Bt.prototype;var Lr=Xt(fn,function(){if(Object.getPrototypeOf(this)!==pt)throw new V("Use 'new' to construct "+Ut);if(Pt.constructor_body===void 0)throw new V(Ut+" has no accessible constructor");var sl=Pt.constructor_body[arguments.length];if(sl===void 0)throw new V(`Tried to invoke ctor of ${Ut} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Pt.constructor_body).toString()}) parameters instead!`);return sl.apply(this,arguments)}),pt=Object.create(tr,{constructor:{value:Lr}});Lr.prototype=pt;var Pt=new $t(Ut,Lr,pt,Wt,Yn,tt,it,mt);Pt.baseClass&&(Pt.baseClass.__derivedClasses===void 0&&(Pt.baseClass.__derivedClasses=[]),Pt.baseClass.__derivedClasses.push(Pt));var vr=new Ve(Ut,Pt,!0,!1,!1),nr=new Ve(Ut+"*",Pt,!1,!1,!1),cs=new Ve(Ut+" const*",Pt,!1,!0,!1);return J[G]={pointerType:nr,constPointerType:cs},Ie(fn,Lr),[vr,nr,cs]})}function tn(G,z){for(var se=[],Me=0;Me<G;Me++)se.push(A[z+Me*4>>2]);return se}function hn(G){for(;G.length;){var z=G.pop(),se=G.pop();se(z)}}function er(G,z){if(!(G instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof G} which is not a function`);var se=Xt(G.name||"unknownFunctionName",function(){});se.prototype=G.prototype;var Me=new se,Fe=G.apply(Me,z);return Fe instanceof Object?Fe:Me}function zt(G,z,se,Me,Fe,tt){var rt=z.length;rt<2&&ye("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var it=z[1]!==null&&se!==null,vt=!1,mt=1;mt<z.length;++mt)if(z[mt]!==null&&z[mt].destructorFunction===void 0){vt=!0;break}for(var Ut=z[0].name!=="void",ln="",Wt="",mt=0;mt<rt-2;++mt)ln+=(mt!==0?", ":"")+"arg"+mt,Wt+=(mt!==0?", ":"")+"arg"+mt+"Wired";var fn=`
        return function ${Rt(G)}(${ln}) {
        if (arguments.length !== ${rt-2}) {
          throwBindingError('function ${G} called with ${arguments.length} arguments, expected ${rt-2} args!');
        }`;vt&&(fn+=`var destructors = [];
`);var $n=vt?"destructors":"null",Yn=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],tr=[ye,Me,Fe,hn,z[0],z[1]];it&&(fn+="var thisWired = classParam.toWireType("+$n+`, this);
`);for(var mt=0;mt<rt-2;++mt)fn+="var arg"+mt+"Wired = argType"+mt+".toWireType("+$n+", arg"+mt+"); // "+z[mt+2].name+`
`,Yn.push("argType"+mt),tr.push(z[mt+2]);if(it&&(Wt="thisWired"+(Wt.length>0?", ":"")+Wt),fn+=(Ut||tt?"var rv = ":"")+"invoker(fn"+(Wt.length>0?", ":"")+Wt+`);
`,vt)fn+=`runDestructors(destructors);
`;else for(var mt=it?1:2;mt<z.length;++mt){var Lr=mt===1?"thisWired":"arg"+(mt-2)+"Wired";z[mt].destructorFunction!==null&&(fn+=Lr+"_dtor("+Lr+"); // "+z[mt].name+`
`,Yn.push(Lr+"_dtor"),tr.push(z[mt].destructorFunction))}return Ut&&(fn+=`var ret = retType.fromWireType(rv);
return ret;
`),fn+=`}
`,Yn.push(fn),er(Function,Yn).apply(null,tr)}function Ce(G,z,se,Me,Fe,tt){var rt=tn(z,se);Fe=jt(Me,Fe),et([],[G],function(it){it=it[0];var vt=`constructor ${it.name}`;if(it.registeredClass.constructor_body===void 0&&(it.registeredClass.constructor_body=[]),it.registeredClass.constructor_body[z-1]!==void 0)throw new V(`Cannot register multiple constructors with identical number of parameters (${z-1}) for class '${it.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return it.registeredClass.constructor_body[z-1]=()=>{Ot(`Cannot construct ${it.name} due to unbound types`,rt)},et([],rt,function(mt){return mt.splice(1,0,null),it.registeredClass.constructor_body[z-1]=zt(vt,mt,null,Fe,tt),[]}),[]})}function Ct(G,z,se,Me,Fe,tt,rt,it,vt){var mt=tn(se,Me);z=Re(z),tt=jt(Fe,tt),et([],[G],function(Ut){Ut=Ut[0];var ln=`${Ut.name}.${z}`;z.startsWith("@@")&&(z=Symbol[z.substring(2)]),it&&Ut.registeredClass.pureVirtualFunctions.push(z);function Wt(){Ot(`Cannot call ${ln} due to unbound types`,mt)}var fn=Ut.registeredClass.instancePrototype,$n=fn[z];return $n===void 0||$n.overloadTable===void 0&&$n.className!==Ut.name&&$n.argCount===se-2?(Wt.argCount=se-2,Wt.className=Ut.name,fn[z]=Wt):(mn(fn,z,ln),fn[z].overloadTable[se-2]=Wt),et([],mt,function(Yn){var tr=zt(ln,Yn,Ut,tt,rt,vt);return fn[z].overloadTable===void 0?(tr.argCount=se-2,fn[z]=tr):fn[z].overloadTable[se-2]=tr,[]}),[]})}function un(){Object.assign(Kt.prototype,{get(G){return this.allocated[G]},has(G){return this.allocated[G]!==void 0},allocate(G){var z=this.freelist.pop()||this.allocated.length;return this.allocated[z]=G,z},free(G){this.allocated[G]=void 0,this.freelist.push(G)}})}function Kt(){this.allocated=[void 0],this.freelist=[]}var qt=new Kt;function Nn(G){G>=qt.reserved&&--qt.get(G).refcount===0&&qt.free(G)}function Gn(){for(var G=0,z=qt.reserved;z<qt.allocated.length;++z)qt.allocated[z]!==void 0&&++G;return G}function Mn(){qt.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),qt.reserved=qt.allocated.length,t.count_emval_handles=Gn}var lr={toValue:G=>(G||ye("Cannot use deleted val. handle = "+G),qt.get(G).value),toHandle:G=>{switch(G){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return qt.allocate({refcount:1,value:G})}}};function us(G,z){z=Re(z),ze(G,{name:z,fromWireType:function(se){var Me=lr.toValue(se);return Nn(se),Me},toWireType:function(se,Me){return lr.toHandle(Me)},argPackAdvance:8,readValueFromPointer:Ht,destructorFunction:null})}function Ks(G){if(G===null)return"null";var z=typeof G;return z==="object"||z==="array"||z==="function"?G.toString():""+G}function w8(G,z){switch(z){case 2:return function(se){return this.fromWireType(d[se>>2])};case 3:return function(se){return this.fromWireType(p[se>>3])};default:throw new TypeError("Unknown float type: "+G)}}function v8(G,z,se){var Me=De(se);z=Re(z),ze(G,{name:z,fromWireType:function(Fe){return Fe},toWireType:function(Fe,tt){return tt},argPackAdvance:8,readValueFromPointer:w8(z,Me),destructorFunction:null})}function y8(G,z,se){switch(z){case 0:return se?function(Fe){return E[Fe]}:function(Fe){return S[Fe]};case 1:return se?function(Fe){return b[Fe>>1]}:function(Fe){return v[Fe>>1]};case 2:return se?function(Fe){return y[Fe>>2]}:function(Fe){return A[Fe>>2]};default:throw new TypeError("Unknown integer type: "+G)}}function E8(G,z,se,Me,Fe){z=Re(z);var tt=De(se),rt=ln=>ln;if(Me===0){var it=32-8*se;rt=ln=>ln<<it>>>it}var vt=z.includes("unsigned"),mt=(ln,Wt)=>{},Ut;vt?Ut=function(ln,Wt){return mt(Wt,this.name),Wt>>>0}:Ut=function(ln,Wt){return mt(Wt,this.name),Wt},ze(G,{name:z,fromWireType:rt,toWireType:Ut,argPackAdvance:8,readValueFromPointer:y8(z,tt,Me!==0),destructorFunction:null})}function S8(G,z,se){var Me=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Fe=Me[z];function tt(rt){rt=rt>>2;var it=A,vt=it[rt],mt=it[rt+1];return new Fe(it.buffer,mt,vt)}se=Re(se),ze(G,{name:se,fromWireType:tt,argPackAdvance:8,readValueFromPointer:tt},{ignoreDuplicateRegistrations:!0})}var fh=(G,z,se,Me)=>{if(!(Me>0))return 0;for(var Fe=se,tt=se+Me-1,rt=0;rt<G.length;++rt){var it=G.charCodeAt(rt);if(it>=55296&&it<=57343){var vt=G.charCodeAt(++rt);it=65536+((it&1023)<<10)|vt&1023}if(it<=127){if(se>=tt)break;z[se++]=it}else if(it<=2047){if(se+1>=tt)break;z[se++]=192|it>>6,z[se++]=128|it&63}else if(it<=65535){if(se+2>=tt)break;z[se++]=224|it>>12,z[se++]=128|it>>6&63,z[se++]=128|it&63}else{if(se+3>=tt)break;z[se++]=240|it>>18,z[se++]=128|it>>12&63,z[se++]=128|it>>6&63,z[se++]=128|it&63}}return z[se]=0,se-Fe},dh=(G,z,se)=>fh(G,S,z,se),Qu=G=>{for(var z=0,se=0;se<G.length;++se){var Me=G.charCodeAt(se);Me<=127?z++:Me<=2047?z+=2:Me>=55296&&Me<=57343?(z+=4,++se):z+=3}return z},hh=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,k8=(G,z,se)=>{for(var Me=z+se,Fe=z;G[Fe]&&!(Fe>=Me);)++Fe;if(Fe-z>16&&G.buffer&&hh)return hh.decode(G.subarray(z,Fe));for(var tt="";z<Fe;){var rt=G[z++];if(!(rt&128)){tt+=String.fromCharCode(rt);continue}var it=G[z++]&63;if((rt&224)==192){tt+=String.fromCharCode((rt&31)<<6|it);continue}var vt=G[z++]&63;if((rt&240)==224?rt=(rt&15)<<12|it<<6|vt:rt=(rt&7)<<18|it<<12|vt<<6|G[z++]&63,rt<65536)tt+=String.fromCharCode(rt);else{var mt=rt-65536;tt+=String.fromCharCode(55296|mt>>10,56320|mt&1023)}}return tt},Ju=(G,z)=>G?k8(S,G,z):"";function T8(G,z){z=Re(z);var se=z==="std::string";ze(G,{name:z,fromWireType:function(Me){var Fe=A[Me>>2],tt=Me+4,rt;if(se)for(var it=tt,vt=0;vt<=Fe;++vt){var mt=tt+vt;if(vt==Fe||S[mt]==0){var Ut=mt-it,ln=Ju(it,Ut);rt===void 0?rt=ln:(rt+="\0",rt+=ln),it=mt+1}}else{for(var Wt=new Array(Fe),vt=0;vt<Fe;++vt)Wt[vt]=String.fromCharCode(S[tt+vt]);rt=Wt.join("")}return yi(Me),rt},toWireType:function(Me,Fe){Fe instanceof ArrayBuffer&&(Fe=new Uint8Array(Fe));var tt,rt=typeof Fe=="string";rt||Fe instanceof Uint8Array||Fe instanceof Uint8ClampedArray||Fe instanceof Int8Array||ye("Cannot pass non-string to std::string"),se&&rt?tt=Qu(Fe):tt=Fe.length;var it=rl(4+tt+1),vt=it+4;if(A[it>>2]=tt,se&&rt)dh(Fe,vt,tt+1);else if(rt)for(var mt=0;mt<tt;++mt){var Ut=Fe.charCodeAt(mt);Ut>255&&(yi(vt),ye("String has UTF-16 code units that do not fit in 8 bits")),S[vt+mt]=Ut}else for(var mt=0;mt<tt;++mt)S[vt+mt]=Fe[mt];return Me!==null&&Me.push(yi,it),it},argPackAdvance:8,readValueFromPointer:Ht,destructorFunction:function(Me){yi(Me)}})}var ph=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,A8=(G,z)=>{for(var se=G,Me=se>>1,Fe=Me+z/2;!(Me>=Fe)&&v[Me];)++Me;if(se=Me<<1,se-G>32&&ph)return ph.decode(S.subarray(G,se));for(var tt="",rt=0;!(rt>=z/2);++rt){var it=b[G+rt*2>>1];if(it==0)break;tt+=String.fromCharCode(it)}return tt},M8=(G,z,se)=>{if(se===void 0&&(se=2147483647),se<2)return 0;se-=2;for(var Me=z,Fe=se<G.length*2?se/2:G.length,tt=0;tt<Fe;++tt){var rt=G.charCodeAt(tt);b[z>>1]=rt,z+=2}return b[z>>1]=0,z-Me},C8=G=>G.length*2,R8=(G,z)=>{for(var se=0,Me="";!(se>=z/4);){var Fe=y[G+se*4>>2];if(Fe==0)break;if(++se,Fe>=65536){var tt=Fe-65536;Me+=String.fromCharCode(55296|tt>>10,56320|tt&1023)}else Me+=String.fromCharCode(Fe)}return Me},L8=(G,z,se)=>{if(se===void 0&&(se=2147483647),se<4)return 0;for(var Me=z,Fe=Me+se-4,tt=0;tt<G.length;++tt){var rt=G.charCodeAt(tt);if(rt>=55296&&rt<=57343){var it=G.charCodeAt(++tt);rt=65536+((rt&1023)<<10)|it&1023}if(y[z>>2]=rt,z+=4,z+4>Fe)break}return y[z>>2]=0,z-Me},P8=G=>{for(var z=0,se=0;se<G.length;++se){var Me=G.charCodeAt(se);Me>=55296&&Me<=57343&&++se,z+=4}return z},B8=function(G,z,se){se=Re(se);var Me,Fe,tt,rt,it;z===2?(Me=A8,Fe=M8,rt=C8,tt=()=>v,it=1):z===4&&(Me=R8,Fe=L8,rt=P8,tt=()=>A,it=2),ze(G,{name:se,fromWireType:function(vt){for(var mt=A[vt>>2],Ut=tt(),ln,Wt=vt+4,fn=0;fn<=mt;++fn){var $n=vt+4+fn*z;if(fn==mt||Ut[$n>>it]==0){var Yn=$n-Wt,tr=Me(Wt,Yn);ln===void 0?ln=tr:(ln+="\0",ln+=tr),Wt=$n+z}}return yi(vt),ln},toWireType:function(vt,mt){typeof mt!="string"&&ye(`Cannot pass non-string to C++ string type ${se}`);var Ut=rt(mt),ln=rl(4+Ut+z);return A[ln>>2]=Ut>>it,Fe(mt,ln+4,Ut+z),vt!==null&&vt.push(yi,ln),ln},argPackAdvance:8,readValueFromPointer:Ht,destructorFunction:function(vt){yi(vt)}})};function I8(G,z){z=Re(z),ze(G,{isVoid:!0,name:z,argPackAdvance:0,fromWireType:function(){},toWireType:function(se,Me){}})}function O8(G,z){return z+2097152>>>0<4194305-!!G?(G>>>0)+z*4294967296:NaN}function D8(G,z,se){var Me=O8(G,z),Fe=new Date(Me*1e3);y[se>>2]=Fe.getUTCSeconds(),y[se+4>>2]=Fe.getUTCMinutes(),y[se+8>>2]=Fe.getUTCHours(),y[se+12>>2]=Fe.getUTCDate(),y[se+16>>2]=Fe.getUTCMonth(),y[se+20>>2]=Fe.getUTCFullYear()-1900,y[se+24>>2]=Fe.getUTCDay();var tt=Date.UTC(Fe.getUTCFullYear(),0,1,0,0,0,0),rt=(Fe.getTime()-tt)/(1e3*60*60*24)|0;y[se+28>>2]=rt}var mh=G=>{var z=Qu(G)+1,se=rl(z);return se&&dh(G,se,z),se},N8=(G,z,se)=>{var Me=new Date().getFullYear(),Fe=new Date(Me,0,1),tt=new Date(Me,6,1),rt=Fe.getTimezoneOffset(),it=tt.getTimezoneOffset(),vt=Math.max(rt,it);A[G>>2]=vt*60,y[z>>2]=+(rt!=it);function mt($n){var Yn=$n.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Yn?Yn[1]:"GMT"}var Ut=mt(Fe),ln=mt(tt),Wt=mh(Ut),fn=mh(ln);it<rt?(A[se>>2]=Wt,A[se+4>>2]=fn):(A[se>>2]=fn,A[se+4>>2]=Wt)},F8=()=>{C("")};function $8(){return Date.now()}var V8=()=>2147483648,x8=G=>{var z=m.buffer,se=G-z.byteLength+65535>>>16;try{return m.grow(se),M(),1}catch{}},H8=G=>{var z=S.length;G>>>=0;var se=V8();if(G>se)return!1;for(var Me=(vt,mt)=>vt+(mt-vt%mt)%mt,Fe=1;Fe<=4;Fe*=2){var tt=z*(1+.2/Fe);tt=Math.min(tt,G+100663296);var rt=Math.min(se,Me(Math.max(G,tt),65536)),it=x8(rt);if(it)return!0}return!1},ec={},U8=()=>o||"./this.program",Vo=()=>{if(!Vo.strings){var G=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",z={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:G,_:U8()};for(var se in ec)ec[se]===void 0?delete z[se]:z[se]=ec[se];var Me=[];for(var se in z)Me.push(`${se}=${z[se]}`);Vo.strings=Me}return Vo.strings},W8=(G,z)=>{for(var se=0;se<G.length;++se)E[z++>>0]=G.charCodeAt(se);E[z>>0]=0},j8=(G,z)=>{var se=0;return Vo().forEach(function(Me,Fe){var tt=z+se;A[G+Fe*4>>2]=tt,W8(Me,tt),se+=Me.length+1}),0},G8=(G,z)=>{var se=Vo();A[G>>2]=se.length;var Me=0;return se.forEach(function(Fe){Me+=Fe.length+1}),A[z>>2]=Me,0},nl=G=>G%4===0&&(G%100!==0||G%400===0),z8=(G,z)=>{for(var se=0,Me=0;Me<=z;se+=G[Me++]);return se},_h=[31,29,31,30,31,30,31,31,30,31,30,31],gh=[31,28,31,30,31,30,31,31,30,31,30,31],X8=(G,z)=>{for(var se=new Date(G.getTime());z>0;){var Me=nl(se.getFullYear()),Fe=se.getMonth(),tt=(Me?_h:gh)[Fe];if(z>tt-se.getDate())z-=tt-se.getDate()+1,se.setDate(1),Fe<11?se.setMonth(Fe+1):(se.setMonth(0),se.setFullYear(se.getFullYear()+1));else return se.setDate(se.getDate()+z),se}return se};function Y8(G,z,se){var Me=se>0?se:Qu(G)+1,Fe=new Array(Me),tt=fh(G,Fe,0,Fe.length);return z&&(Fe.length=tt),Fe}var q8=(G,z)=>{E.set(G,z)},Z8=(G,z,se,Me)=>{var Fe=y[Me+40>>2],tt={tm_sec:y[Me>>2],tm_min:y[Me+4>>2],tm_hour:y[Me+8>>2],tm_mday:y[Me+12>>2],tm_mon:y[Me+16>>2],tm_year:y[Me+20>>2],tm_wday:y[Me+24>>2],tm_yday:y[Me+28>>2],tm_isdst:y[Me+32>>2],tm_gmtoff:y[Me+36>>2],tm_zone:Fe?Ju(Fe):""},rt=Ju(se),it={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var vt in it)rt=rt.replace(new RegExp(vt,"g"),it[vt]);var mt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Ut=["January","February","March","April","May","June","July","August","September","October","November","December"];function ln(pt,Pt,vr){for(var nr=typeof pt=="number"?pt.toString():pt||"";nr.length<Pt;)nr=vr[0]+nr;return nr}function Wt(pt,Pt){return ln(pt,Pt,"0")}function fn(pt,Pt){function vr(cs){return cs<0?-1:cs>0?1:0}var nr;return(nr=vr(pt.getFullYear()-Pt.getFullYear()))===0&&(nr=vr(pt.getMonth()-Pt.getMonth()))===0&&(nr=vr(pt.getDate()-Pt.getDate())),nr}function $n(pt){switch(pt.getDay()){case 0:return new Date(pt.getFullYear()-1,11,29);case 1:return pt;case 2:return new Date(pt.getFullYear(),0,3);case 3:return new Date(pt.getFullYear(),0,2);case 4:return new Date(pt.getFullYear(),0,1);case 5:return new Date(pt.getFullYear()-1,11,31);case 6:return new Date(pt.getFullYear()-1,11,30)}}function Yn(pt){var Pt=X8(new Date(pt.tm_year+1900,0,1),pt.tm_yday),vr=new Date(Pt.getFullYear(),0,4),nr=new Date(Pt.getFullYear()+1,0,4),cs=$n(vr),sl=$n(nr);return fn(cs,Pt)<=0?fn(sl,Pt)<=0?Pt.getFullYear()+1:Pt.getFullYear():Pt.getFullYear()-1}var tr={"%a":pt=>mt[pt.tm_wday].substring(0,3),"%A":pt=>mt[pt.tm_wday],"%b":pt=>Ut[pt.tm_mon].substring(0,3),"%B":pt=>Ut[pt.tm_mon],"%C":pt=>{var Pt=pt.tm_year+1900;return Wt(Pt/100|0,2)},"%d":pt=>Wt(pt.tm_mday,2),"%e":pt=>ln(pt.tm_mday,2," "),"%g":pt=>Yn(pt).toString().substring(2),"%G":pt=>Yn(pt),"%H":pt=>Wt(pt.tm_hour,2),"%I":pt=>{var Pt=pt.tm_hour;return Pt==0?Pt=12:Pt>12&&(Pt-=12),Wt(Pt,2)},"%j":pt=>Wt(pt.tm_mday+z8(nl(pt.tm_year+1900)?_h:gh,pt.tm_mon-1),3),"%m":pt=>Wt(pt.tm_mon+1,2),"%M":pt=>Wt(pt.tm_min,2),"%n":()=>`
`,"%p":pt=>pt.tm_hour>=0&&pt.tm_hour<12?"AM":"PM","%S":pt=>Wt(pt.tm_sec,2),"%t":()=>"	","%u":pt=>pt.tm_wday||7,"%U":pt=>{var Pt=pt.tm_yday+7-pt.tm_wday;return Wt(Math.floor(Pt/7),2)},"%V":pt=>{var Pt=Math.floor((pt.tm_yday+7-(pt.tm_wday+6)%7)/7);if((pt.tm_wday+371-pt.tm_yday-2)%7<=2&&Pt++,Pt){if(Pt==53){var nr=(pt.tm_wday+371-pt.tm_yday)%7;nr!=4&&(nr!=3||!nl(pt.tm_year))&&(Pt=1)}}else{Pt=52;var vr=(pt.tm_wday+7-pt.tm_yday-1)%7;(vr==4||vr==5&&nl(pt.tm_year%400-1))&&Pt++}return Wt(Pt,2)},"%w":pt=>pt.tm_wday,"%W":pt=>{var Pt=pt.tm_yday+7-(pt.tm_wday+6)%7;return Wt(Math.floor(Pt/7),2)},"%y":pt=>(pt.tm_year+1900).toString().substring(2),"%Y":pt=>pt.tm_year+1900,"%z":pt=>{var Pt=pt.tm_gmtoff,vr=Pt>=0;return Pt=Math.abs(Pt)/60,Pt=Pt/60*100+Pt%60,(vr?"+":"-")+("0000"+Pt).slice(-4)},"%Z":pt=>pt.tm_zone,"%%":()=>"%"};rt=rt.replace(/%%/g,"\0\0");for(var vt in tr)rt.includes(vt)&&(rt=rt.replace(new RegExp(vt,"g"),tr[vt](tt)));rt=rt.replace(/\0\0/g,"%");var Lr=Y8(rt,!1);return Lr.length>z?0:(q8(Lr,G),Lr.length-1)},K8=(G,z,se,Me,Fe)=>Z8(G,z,se,Me);Ue(),V=t.BindingError=class extends Error{constructor(z){super(z),this.name="BindingError"}},Ae=t.InternalError=class extends Error{constructor(z){super(z),this.name="InternalError"}},_t(),Pe(),bt(),Oe=t.UnboundTypeError=cn(Error,"UnboundTypeError"),un(),Mn();var Q8={k:He,h:ut,t:Dt,s:Ce,d:Ct,r:us,g:v8,c:E8,b:S8,f:T8,e:B8,i:I8,j:D8,p:N8,a:F8,q:$8,o:H8,m:j8,n:G8,l:K8};ge();var rl=G=>(rl=g.w)(G),yi=G=>(yi=g.y)(G),bh=G=>(bh=g.z)(G);t.__embind_initialize_bindings=()=>(t.__embind_initialize_bindings=g.A)(),t.dynCall_iiijj=(G,z,se,Me,Fe,tt,rt)=>(t.dynCall_iiijj=g.B)(G,z,se,Me,Fe,tt,rt),t.dynCall_viijii=(G,z,se,Me,Fe,tt,rt)=>(t.dynCall_viijii=g.C)(G,z,se,Me,Fe,tt,rt),t.dynCall_iiiiij=(G,z,se,Me,Fe,tt,rt)=>(t.dynCall_iiiiij=g.D)(G,z,se,Me,Fe,tt,rt),t.dynCall_iiiiijj=(G,z,se,Me,Fe,tt,rt,it,vt)=>(t.dynCall_iiiiijj=g.E)(G,z,se,Me,Fe,tt,rt,it,vt),t.dynCall_iiiiiijj=(G,z,se,Me,Fe,tt,rt,it,vt,mt)=>(t.dynCall_iiiiiijj=g.F)(G,z,se,Me,Fe,tt,rt,it,vt,mt);var il;ne=function G(){il||wh(),il||(ne=G)};function wh(){if(Z>0||(Y(),Z>0))return;function G(){il||(il=!0,t.calledRun=!0,!_&&(R(),r(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),w()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),G()},1)):G()}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return wh(),n.ready}})(),A2=["locateFile"],u1=function(){};function M2(e,n){try{var t=new URL(n);if(t.pathname==="/")return"".concat(n,"mediainfo.js/dist/").concat(e)}catch{}return"".concat(n,"../").concat(e)}function c1(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(t===void 0)return new Promise(function(l,c){return c1(n,l,c)});var i=Er(Er(Er({},Ol),n),{},{format:(e=n.format)!==null&&e!==void 0?e:Ol.format}),s=i.locateFile,o=_2(i,A2),a={print:u1,printErr:u1,locateFile:s||M2,onAbort:function(c){r&&r(c)}};T2(a).then(function(l){return t(new k2(l,o))}).catch(function(l){r&&r(l)})}const f1=new Map([["/9j/","image/jpg"],["iVBORw0KGgo","image/png"],["UklGR","image/webp"],["R0lGODdh","image/gif"],["R0lGODlh","image/gif"]]);let Eo;function C2(e){if(!e)return;const t=[...f1.keys()].find(r=>e.startsWith(r))||"";return f1.get(t)}function Dl(e,n,t){return new Promise((r,i)=>{if(Eo&&!n)return r();if(!t&&!navigator.onLine)return i(new Error("Need to be online for initialization"));c1({coverData:e,format:"object",locateFile:()=>t||"https://cdn.jsdelivr.net/npm/mediainfo.js@0.2.1/dist/MediaInfoModule.wasm"},s=>{if(Eo)try{Eo.close()}catch{}Eo=s,r()},({message:s})=>i(new Error(`Failed to create MediaInfo instance - ${s}`)))})}async function R2(e,n,t=""){return await Dl(n,!1,t),new Promise((r,i)=>{const s=()=>e.size,o=(a,l)=>new Promise((c,u)=>{const f=new FileReader;f.addEventListener("loadend",m=>{if(m.target){if(m.target.error)return u(new Error(`Error reading file - ${m.target.error.message}`))}else return u(new Error("No FileReader data"));c(new Uint8Array(m.target.result))}),f.addEventListener("error",()=>{u(new Error("Error reading file"))}),f.readAsArrayBuffer(e.slice(l,l+a))});Eo.analyzeData(s,o).then(a=>r(a)).catch(({message:a})=>i(new Error(`Failed to get audio metadata - ${a}`)))})}function L2(e){if(!e)return"";const n=C2(e);return n?URL.createObjectURL(new Blob([_c.from(e,"base64")],{type:n})):""}class P2{constructor(){Cn(this,"seperator",",")}timestampToSeconds(n){const[t,r]=n.split(","),i=parseInt(r),[s,o,a]=t.split(":").map(c=>parseInt(c)),l=i*.001+a+60*o+3600*s;return Math.round(l*1e3)/1e3}correctFormat(n){let t=n.replace(".",",");var r=null,i=null,s=null,o=null,[a,l]=t.split(",");o=this.fixed_str_digit(3,l);var[c,u,f]=a.split(":");return r=this.fixed_str_digit(2,c,!1),i=this.fixed_str_digit(2,u,!1),s=this.fixed_str_digit(2,f,!1),`${r}:${i}:${s},${o}`}fixed_str_digit(n,t,r=!0){if(t.length==n)return t;if(t.length>n)return t.slice(0,n);if(t.length<n)return r?t.padEnd(n,"0"):t.padStart(n,"0")}tryComma(n){n=n.replace(/\r/g,"");var t=/(\d+)\n(\d{1,2}:\d{2}:\d{2},\d{1,3}) --> (\d{1,2}:\d{2}:\d{2},\d{1,3})/g;let r=n.split(t);return r.shift(),r}tryDot(n){n=n.replace(/\r/g,"");var t=/(\d+)\n(\d{1,2}:\d{2}:\d{2}\.\d{1,3}) --> (\d{1,2}:\d{2}:\d{2}\.\d{1,3})/g;let r=n.split(t);return r.shift(),this.seperator=".",r}fromSrt(n){var t=n,r=this.tryComma(t);r.length==0&&(r=this.tryDot(t));for(var i=[],s=0;s<r.length;s+=4){const a=this.correctFormat(r[s+1].trim()),l=this.correctFormat(r[s+2].trim());var o={id:r[s].trim(),startTime:a,startSeconds:this.timestampToSeconds(a),endTime:l,endSeconds:this.timestampToSeconds(l),text:r[s+3].trim()};i.push(o)}return i}toSrt(n){var t="";const r=`\r
`;for(var i=0;i<n.length;i++){var s=n[i];t+=s.id+r,t+=s.startTime+" --> "+s.endTime+r,t+=s.text.replace(`
`,r)+r+r}return t}}async function d1(e,n={mode:"read"}){if(await e.queryPermission(n)==="granted"||await e.requestPermission(n)==="granted")return!0;throw new Error("File access not granted")}function B2(e){return new Promise((n,t)=>{const r=new FileReader;r.addEventListener("loadend",i=>{if(i.target){if(i.target.error)return t(new Error(`Error reading file - ${i.target.error.message}`))}else return t(new Error("No FileReader data"));n(i.target.result)}),r.addEventListener("error",()=>{t(new Error("Error reading file"))}),r.readAsText(e)})}function I2(e,n){const t=n.createElement("audio"),r=n.createElement("track");return r.default=!0,t.append(r),new Promise((i,s)=>{r.addEventListener("load",()=>i([...t.textTracks[0].cues||[]])),r.addEventListener("error",()=>s(new Error("Failed to load vtt track"))),r.src=e})}async function h1(e,n={mode:"read"}){const t=[];for(let i=0,{length:s}=e;i<s;i+=1){const o=e[i];o&&t.push(d1(o,n))}if((await Promise.all(t)).some(i=>!i))throw new Error("File access not granted");return!0}async function pa(e,n,t=!1){const r=new Map;let i="";try{gn.set(!0);const s=It(St.subtitlesGlobalStartPadding$)/1e3,o=It(St.subtitlesGlobalEndPadding$)/1e3,a=It(si);if(e.name.endsWith(".srt")||e.name.endsWith(".txt")){const l=new P2,c=await B2(e),u=[...l.fromSrt(c)];for(let f=0,{length:m}=u;f<m;f+=1){const g=u[f],_=Math.max(0,g.startSeconds+s),E=a?ai(0,a,g.endSeconds+o):Math.max(0,g.endSeconds+o),S=g.text.trim();r.set(g.id,{id:g.id,originalStartSeconds:g.startSeconds,startSeconds:_,startTime:dr(_),originalEndSeconds:g.endSeconds,endSeconds:E,endTime:dr(E),originalText:S,text:S,subIndex:f})}}else if(e.name.endsWith(".vtt")){i=URL.createObjectURL(e);const l=await I2(i,n);for(let c=0,{length:u}=l;c<u;c+=1){const f=l[c],m=`${c+1}`,g=Math.max(0,f.startTime+s),_=a?ai(0,a,f.endTime+o):Math.max(0,f.endTime+o),E=f.text.trim();r.set(m,{id:m,originalStartSeconds:f.startTime,startSeconds:g,startTime:dr(g),originalEndSeconds:f.endTime,endSeconds:_,endTime:dr(_),originalText:E,text:E,subIndex:c})}}else throw new Error("File needs to be .srt,.txt or .vtt");return t&&li(e,r),r}finally{URL.revokeObjectURL(i)}}function li(e=void 0,n=new Map){na.set(new Set),ra.set(new Set),ni.set(e),Xn.set(n),fo.set({subtitles:[...n.values()],replaceTrack:!0})}async function Bs(e,n,t=!1,r=!1,i="",s=""){const o=It(St.playerEnableCover$),a=It(St.playerEnableChapters$),l=[];let c="",u="",f=[],m;if(r||(gn.set(!0),It(St.exportAudioProcessor$)===Jn.FFMPEG&&await Ac().catch(({message:g})=>l.push(`FFMEPG failure: ${g}`))),o||a)try{if(m=await(n?pl(n,{action:"getAudioMetadata",url:chrome.runtime.getURL("src/assets/js/MediaInfoModule_0.2.1.wasm"),file:e,enableCover:o}):R2(e,o)),!(m!=null&&m.media))throw new Error("No media metadata found");const g=m.media.track.find(_=>_["@type"]==="General");if(!g)throw new Error("No general track found");if(a)for(let _=0,{length:E}=m.media.track;_<E;_+=1){const S=m.media.track[_],b=Object.keys(S.extra||{});if(!(S["@type"]!=="Menu"||!b.length||!b[0].match(/_(\d{2}_\d{2}_\d{2}_\d{3})/)))for(let v=0,{length:y}=b;v<y;v+=1){const A=b[v],d=A.split("_"),p=S.extra[A],M=Number.parseInt(d[1],10)*3600+Number.parseInt(d[2],10)*60+Number.parseInt(d[3],10)+Number.parseInt(d[4],10)/1e3;f.push({key:`${p}_${M}`,label:p,startSeconds:M,startText:Rs(M)})}}o&&(c=L2(g.Cover_Data))}catch({message:g}){l.push(`MediaInfo failure: ${g}`)}if(!r)try{u=URL.createObjectURL(e),t&&await Ai(i,s,e,{coverUrl:c,chapters:f,audioSourceUrl:u})}catch({message:g}){URL.revokeObjectURL(c),URL.revokeObjectURL(u),l.push(g)}if(l.length)throw new Error(l.join("; "));return{coverUrl:c,audioSourceUrl:u,chapters:f}}async function Ai(e,n,t=void 0,r={coverUrl:"",chapters:[],audioSourceUrl:""}){await Mc(t),Si.set(!1),so.set(t),ks.set(r.coverUrl),oo.set(r.audioSourceUrl),Ts.set(r.chapters),t||ri.set({previous:"",current:"",useTimeFallback:!1}),URL.revokeObjectURL(e),URL.revokeObjectURL(n)}async function p1(e,n,t,r){const[i]=await e.showOpenFilePicker({excludeAcceptAllOption:!0,id:"ttu-whispersync-file",types:[{description:n,accept:{"*/*":t}}]});if(!await d1(i))throw new Error("File access not granted");const o=await(r?r.isSameEntry(i):Promise.resolve(!1));let a;return o||(a=await i.getFile()),{handle:i,file:a}}function O2(e){return new Int8Array(e)}function m1(e){return new Int16Array(e)}function _1(e){return new Int32Array(e)}function g1(e){return new Float32Array(e)}function D2(e){return new Float64Array(e)}function b1(e){if(e.length==1)return g1(e[0]);var n=e[0];e=e.slice(1);for(var t=[],r=0;r<n;r++)t.push(b1(e));return t}function w1(e){if(e.length==1)return _1(e[0]);var n=e[0];e=e.slice(1);for(var t=[],r=0;r<n;r++)t.push(w1(e));return t}function v1(e){if(e.length==1)return m1(e[0]);var n=e[0];e=e.slice(1);for(var t=[],r=0;r<n;r++)t.push(v1(e));return t}function y1(e){if(e.length==1)return new Array(e[0]);var n=e[0];e=e.slice(1);for(var t=[],r=0;r<n;r++)t.push(y1(e));return t}var E1={};E1.fill=function(e,n,t,r){if(arguments.length==2)for(var i=0;i<e.length;i++)e[i]=arguments[1];else for(var i=n;i<t;i++)e[i]=r};var So={};So.arraycopy=function(e,n,t,r,i){for(var s=n+i;n<s;)t[r++]=e[n++]},So.out={},So.out.println=function(e){console.log(e)},So.out.printf=function(){console.log.apply(console,arguments)};var ma={};ma.SQRT2=1.4142135623730951,ma.FAST_LOG10=function(e){return Math.log10(e)},ma.FAST_LOG10_X=function(e,n){return Math.log10(e)*n};function ui(e){this.ordinal=e}ui.short_block_allowed=new ui(0),ui.short_block_coupled=new ui(1),ui.short_block_dispensed=new ui(2),ui.short_block_forced=new ui(3);var S1={};S1.MAX_VALUE=34028235e31;function Sr(e){this.ordinal=e}Sr.vbr_off=new Sr(0),Sr.vbr_mt=new Sr(1),Sr.vbr_rh=new Sr(2),Sr.vbr_abr=new Sr(3),Sr.vbr_mtrh=new Sr(4),Sr.vbr_default=Sr.vbr_mtrh;var N2=function(e){},An={System:So,VbrMode:Sr,Float:S1,ShortBlock:ui,Util:ma,Arrays:E1,new_array_n:y1,new_byte:O2,new_double:D2,new_float:g1,new_float_n:b1,new_int:_1,new_int_n:w1,new_short:m1,new_short_n:v1,assert:N2},Nl,k1;function F2(){if(k1)return Nl;k1=1;var e=An,n=e.System,t=e.Util,r=e.Arrays,i=e.new_float,s=ir();function o(){var a=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*t.SQRT2*.5/2384e-9,.017876148*t.SQRT2*.5/2384e-9,.003134727*t.SQRT2*.5/2384e-9,.002457142*t.SQRT2*.5/2384e-9,971317e-9*t.SQRT2*.5/2384e-9,218868e-9*t.SQRT2*.5/2384e-9,101566e-9*t.SQRT2*.5/2384e-9,13828e-9*t.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],l=12,c=36,u=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],f=u[s.SHORT_TYPE],m=u[s.SHORT_TYPE],g=u[s.SHORT_TYPE],_=u[s.SHORT_TYPE],E=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function S(y,A,d){for(var p=10,M=A+238-14-286,L=-15;L<0;L++){var D,O,x;D=a[p+-10],O=y[M+-224]*D,x=y[A+224]*D,D=a[p+-9],O+=y[M+-160]*D,x+=y[A+160]*D,D=a[p+-8],O+=y[M+-96]*D,x+=y[A+96]*D,D=a[p+-7],O+=y[M+-32]*D,x+=y[A+32]*D,D=a[p+-6],O+=y[M+32]*D,x+=y[A+-32]*D,D=a[p+-5],O+=y[M+96]*D,x+=y[A+-96]*D,D=a[p+-4],O+=y[M+160]*D,x+=y[A+-160]*D,D=a[p+-3],O+=y[M+224]*D,x+=y[A+-224]*D,D=a[p+-2],O+=y[A+-256]*D,x-=y[M+256]*D,D=a[p+-1],O+=y[A+-192]*D,x-=y[M+192]*D,D=a[p+0],O+=y[A+-128]*D,x-=y[M+128]*D,D=a[p+1],O+=y[A+-64]*D,x-=y[M+64]*D,D=a[p+2],O+=y[A+0]*D,x-=y[M+0]*D,D=a[p+3],O+=y[A+64]*D,x-=y[M+-64]*D,D=a[p+4],O+=y[A+128]*D,x-=y[M+-128]*D,D=a[p+5],O+=y[A+192]*D,x-=y[M+-192]*D,O*=a[p+6],D=x-O,d[30+L*2]=x+O,d[31+L*2]=a[p+7]*D,p+=18,A--,M++}{var O,x,Y,R;x=y[A+-16]*a[p+-10],O=y[A+-32]*a[p+-2],x+=(y[A+-48]-y[A+16])*a[p+-9],O+=y[A+-96]*a[p+-1],x+=(y[A+-80]+y[A+48])*a[p+-8],O+=y[A+-160]*a[p+0],x+=(y[A+-112]-y[A+80])*a[p+-7],O+=y[A+-224]*a[p+1],x+=(y[A+-144]+y[A+112])*a[p+-6],O-=y[A+32]*a[p+2],x+=(y[A+-176]-y[A+144])*a[p+-5],O-=y[A+96]*a[p+3],x+=(y[A+-208]+y[A+176])*a[p+-4],O-=y[A+160]*a[p+4],x+=(y[A+-240]-y[A+208])*a[p+-3],O-=y[A+224],Y=O-x,R=O+x,x=d[14],O=d[15]-x,d[31]=R+x,d[30]=Y+O,d[15]=Y-O,d[14]=R-x}{var w;w=d[28]-d[0],d[0]+=d[28],d[28]=w*a[p+-2*18+7],w=d[29]-d[1],d[1]+=d[29],d[29]=w*a[p+-2*18+7],w=d[26]-d[2],d[2]+=d[26],d[26]=w*a[p+-4*18+7],w=d[27]-d[3],d[3]+=d[27],d[27]=w*a[p+-4*18+7],w=d[24]-d[4],d[4]+=d[24],d[24]=w*a[p+-6*18+7],w=d[25]-d[5],d[5]+=d[25],d[25]=w*a[p+-6*18+7],w=d[22]-d[6],d[6]+=d[22],d[22]=w*t.SQRT2,w=d[23]-d[7],d[7]+=d[23],d[23]=w*t.SQRT2-d[7],d[7]-=d[6],d[22]-=d[7],d[23]-=d[22],w=d[6],d[6]=d[31]-w,d[31]=d[31]+w,w=d[7],d[7]=d[30]-w,d[30]=d[30]+w,w=d[22],d[22]=d[15]-w,d[15]=d[15]+w,w=d[23],d[23]=d[14]-w,d[14]=d[14]+w,w=d[20]-d[8],d[8]+=d[20],d[20]=w*a[p+-10*18+7],w=d[21]-d[9],d[9]+=d[21],d[21]=w*a[p+-10*18+7],w=d[18]-d[10],d[10]+=d[18],d[18]=w*a[p+-12*18+7],w=d[19]-d[11],d[11]+=d[19],d[19]=w*a[p+-12*18+7],w=d[16]-d[12],d[12]+=d[16],d[16]=w*a[p+-14*18+7],w=d[17]-d[13],d[13]+=d[17],d[17]=w*a[p+-14*18+7],w=-d[20]+d[24],d[20]+=d[24],d[24]=w*a[p+-12*18+7],w=-d[21]+d[25],d[21]+=d[25],d[25]=w*a[p+-12*18+7],w=d[4]-d[8],d[4]+=d[8],d[8]=w*a[p+-12*18+7],w=d[5]-d[9],d[5]+=d[9],d[9]=w*a[p+-12*18+7],w=d[0]-d[12],d[0]+=d[12],d[12]=w*a[p+-4*18+7],w=d[1]-d[13],d[1]+=d[13],d[13]=w*a[p+-4*18+7],w=d[16]-d[28],d[16]+=d[28],d[28]=w*a[p+-4*18+7],w=-d[17]+d[29],d[17]+=d[29],d[29]=w*a[p+-4*18+7],w=t.SQRT2*(d[2]-d[10]),d[2]+=d[10],d[10]=w,w=t.SQRT2*(d[3]-d[11]),d[3]+=d[11],d[11]=w,w=t.SQRT2*(-d[18]+d[26]),d[18]+=d[26],d[26]=w-d[18],w=t.SQRT2*(-d[19]+d[27]),d[19]+=d[27],d[27]=w-d[19],w=d[2],d[19]-=d[3],d[3]-=w,d[2]=d[31]-w,d[31]+=w,w=d[3],d[11]-=d[19],d[18]-=w,d[3]=d[30]-w,d[30]+=w,w=d[18],d[27]-=d[11],d[19]-=w,d[18]=d[15]-w,d[15]+=w,w=d[19],d[10]-=w,d[19]=d[14]-w,d[14]+=w,w=d[10],d[11]-=w,d[10]=d[23]-w,d[23]+=w,w=d[11],d[26]-=w,d[11]=d[22]-w,d[22]+=w,w=d[26],d[27]-=w,d[26]=d[7]-w,d[7]+=w,w=d[27],d[27]=d[6]-w,d[6]+=w,w=t.SQRT2*(d[0]-d[4]),d[0]+=d[4],d[4]=w,w=t.SQRT2*(d[1]-d[5]),d[1]+=d[5],d[5]=w,w=t.SQRT2*(d[16]-d[20]),d[16]+=d[20],d[20]=w,w=t.SQRT2*(d[17]-d[21]),d[17]+=d[21],d[21]=w,w=-t.SQRT2*(d[8]-d[12]),d[8]+=d[12],d[12]=w-d[8],w=-t.SQRT2*(d[9]-d[13]),d[9]+=d[13],d[13]=w-d[9],w=-t.SQRT2*(d[25]-d[29]),d[25]+=d[29],d[29]=w-d[25],w=-t.SQRT2*(d[24]+d[28]),d[24]-=d[28],d[28]=w-d[24],w=d[24]-d[16],d[24]=w,w=d[20]-w,d[20]=w,w=d[28]-w,d[28]=w,w=d[25]-d[17],d[25]=w,w=d[21]-w,d[21]=w,w=d[29]-w,d[29]=w,w=d[17]-d[1],d[17]=w,w=d[9]-w,d[9]=w,w=d[25]-w,d[25]=w,w=d[5]-w,d[5]=w,w=d[21]-w,d[21]=w,w=d[13]-w,d[13]=w,w=d[29]-w,d[29]=w,w=d[1]-d[0],d[1]=w,w=d[16]-w,d[16]=w,w=d[17]-w,d[17]=w,w=d[8]-w,d[8]=w,w=d[9]-w,d[9]=w,w=d[24]-w,d[24]=w,w=d[25]-w,d[25]=w,w=d[4]-w,d[4]=w,w=d[5]-w,d[5]=w,w=d[20]-w,d[20]=w,w=d[21]-w,d[21]=w,w=d[12]-w,d[12]=w,w=d[13]-w,d[13]=w,w=d[28]-w,d[28]=w,w=d[29]-w,d[29]=w,w=d[0],d[0]+=d[31],d[31]-=w,w=d[1],d[1]+=d[30],d[30]-=w,w=d[16],d[16]+=d[15],d[15]-=w,w=d[17],d[17]+=d[14],d[14]-=w,w=d[8],d[8]+=d[23],d[23]-=w,w=d[9],d[9]+=d[22],d[22]-=w,w=d[24],d[24]+=d[7],d[7]-=w,w=d[25],d[25]+=d[6],d[6]-=w,w=d[4],d[4]+=d[27],d[27]-=w,w=d[5],d[5]+=d[26],d[26]-=w,w=d[20],d[20]+=d[11],d[11]-=w,w=d[21],d[21]+=d[10],d[10]-=w,w=d[12],d[12]+=d[19],d[19]-=w,w=d[13],d[13]+=d[18],d[18]-=w,w=d[28],d[28]+=d[3],d[3]-=w,w=d[29],d[29]+=d[2],d[2]-=w}}function b(y,A){for(var d=0;d<3;d++){var p,M,L,D,O,x;D=y[A+2*3]*u[s.SHORT_TYPE][0]-y[A+5*3],p=y[A+0*3]*u[s.SHORT_TYPE][2]-y[A+3*3],M=D+p,L=D-p,D=y[A+5*3]*u[s.SHORT_TYPE][0]+y[A+2*3],p=y[A+3*3]*u[s.SHORT_TYPE][2]+y[A+0*3],O=D+p,x=-D+p,p=(y[A+1*3]*u[s.SHORT_TYPE][1]-y[A+4*3])*2069978111953089e-26,D=(y[A+4*3]*u[s.SHORT_TYPE][1]+y[A+1*3])*2069978111953089e-26,y[A+3*0]=M*190752519173728e-25+p,y[A+3*5]=-O*190752519173728e-25+D,L=L*.8660254037844387*1907525191737281e-26,O=O*.5*1907525191737281e-26+D,y[A+3*1]=L-O,y[A+3*2]=L+O,M=M*.5*1907525191737281e-26-p,x=x*.8660254037844387*1907525191737281e-26,y[A+3*3]=M+x,y[A+3*4]=M-x,A++}}function v(y,A,d){var p,M;{var L,D,O,x,Y,R,w,N;L=d[17]-d[9],O=d[15]-d[11],x=d[14]-d[12],Y=d[0]+d[8],R=d[1]+d[7],w=d[2]+d[6],N=d[3]+d[5],y[A+17]=Y+w-N-(R-d[4]),M=(Y+w-N)*m[19]+(R-d[4]),p=(L-O-x)*m[18],y[A+5]=p+M,y[A+6]=p-M,D=(d[16]-d[10])*m[18],R=R*m[19]+d[4],p=L*m[12]+D+O*m[13]+x*m[14],M=-Y*m[16]+R-w*m[17]+N*m[15],y[A+1]=p+M,y[A+2]=p-M,p=L*m[13]-D-O*m[14]+x*m[12],M=-Y*m[17]+R-w*m[15]+N*m[16],y[A+9]=p+M,y[A+10]=p-M,p=L*m[14]-D+O*m[12]-x*m[13],M=Y*m[15]-R+w*m[16]-N*m[17],y[A+13]=p+M,y[A+14]=p-M}{var X,q,Z,ne,U,F,C,P;X=d[8]-d[0],Z=d[6]-d[2],ne=d[5]-d[3],U=d[17]+d[9],F=d[16]+d[10],C=d[15]+d[11],P=d[14]+d[12],y[A+0]=U+C+P+(F+d[13]),p=(U+C+P)*m[19]-(F+d[13]),M=(X-Z+ne)*m[18],y[A+11]=p+M,y[A+12]=p-M,q=(d[7]-d[1])*m[18],F=d[13]-F*m[19],p=U*m[15]-F+C*m[16]+P*m[17],M=X*m[14]+q+Z*m[12]+ne*m[13],y[A+3]=p+M,y[A+4]=p-M,p=-U*m[17]+F-C*m[15]-P*m[16],M=X*m[13]+q-Z*m[14]-ne*m[12],y[A+7]=p+M,y[A+8]=p-M,p=-U*m[16]+F-C*m[17]-P*m[15],M=X*m[12]-q+Z*m[13]-ne*m[14],y[A+15]=p+M,y[A+16]=p-M}}this.mdct_sub48=function(y,A,d){for(var p=A,M=286,L=0;L<y.channels_out;L++){for(var D=0;D<y.mode_gr;D++){for(var O,x=y.l3_side.tt[D][L],Y=x.xr,R=0,w=y.sb_sample[L][1-D],N=0,X=0;X<18/2;X++)for(S(p,M,w[N]),S(p,M+32,w[N+1]),N+=2,M+=64,O=1;O<32;O+=2)w[N-1][O]*=-1;for(O=0;O<32;O++,R+=18){var q=x.block_type,Z=y.sb_sample[L][D],ne=y.sb_sample[L][1-D];if(x.mixed_block_flag!=0&&O<2&&(q=0),y.amp_filter[O]<1e-12)r.fill(Y,R+0,R+18,0);else{if(y.amp_filter[O]<1)for(var X=0;X<18;X++)ne[X][E[O]]*=y.amp_filter[O];if(q==s.SHORT_TYPE){for(var X=-l/4;X<0;X++){var U=u[s.SHORT_TYPE][X+3];Y[R+X*3+9]=Z[9+X][E[O]]*U-Z[8-X][E[O]],Y[R+X*3+18]=Z[14-X][E[O]]*U+Z[15+X][E[O]],Y[R+X*3+10]=Z[15+X][E[O]]*U-Z[14-X][E[O]],Y[R+X*3+19]=ne[2-X][E[O]]*U+ne[3+X][E[O]],Y[R+X*3+11]=ne[3+X][E[O]]*U-ne[2-X][E[O]],Y[R+X*3+20]=ne[8-X][E[O]]*U+ne[9+X][E[O]]}b(Y,R)}else{for(var F=i(18),X=-c/4;X<0;X++){var C,P;C=u[q][X+27]*ne[X+9][E[O]]+u[q][X+36]*ne[8-X][E[O]],P=u[q][X+9]*Z[X+9][E[O]]-u[q][X+18]*Z[8-X][E[O]],F[X+9]=C-P*f[3+X+9],F[X+18]=C*f[3+X+9]+P}v(Y,R,F)}}if(q!=s.SHORT_TYPE&&O!=0)for(var X=7;X>=0;--X){var I,H;I=Y[R+X]*g[20+X]+Y[R+-1-X]*_[28+X],H=Y[R+X]*_[28+X]-Y[R+-1-X]*g[20+X],Y[R+-1-X]=I,Y[R+X]=H}}}if(p=d,M=286,y.mode_gr==1)for(var K=0;K<18;K++)n.arraycopy(y.sb_sample[L][1][K],0,y.sb_sample[L][0][K],0,32)}}}return Nl=o,Nl}var Fl,T1;function A1(){if(T1)return Fl;T1=1;var e=ir(),n=An,t=n.System,r=n.new_float,i=n.new_float_n;function s(){this.l=r(e.SBMAX_l),this.s=i([e.SBMAX_s,3]);var o=this;this.assign=function(a){t.arraycopy(a.l,0,o.l,0,e.SBMAX_l);for(var l=0;l<e.SBMAX_s;l++)for(var c=0;c<3;c++)o.s[l][c]=a.s[l][c]}}return Fl=s,Fl}var $l,M1;function $2(){if(M1)return $l;M1=1;var e=A1();function n(){this.thm=new e,this.en=new e}return $l=n,$l}function Ir(e){var n=e;this.ordinal=function(){return n}}Ir.STEREO=new Ir(0),Ir.JOINT_STEREO=new Ir(1),Ir.DUAL_CHANNEL=new Ir(2),Ir.MONO=new Ir(3),Ir.NOT_SET=new Ir(4);var ko=Ir,Vl,C1;function ir(){if(C1)return Vl;C1=1;var e=An,n=e.System,t=e.VbrMode,r=e.new_array_n,i=e.new_float,s=e.new_float_n,o=e.new_int,a=e.assert;l.ENCDELAY=576,l.POSTDELAY=1152,l.MDCTDELAY=48,l.FFTOFFSET=224+l.MDCTDELAY,l.DECDELAY=528,l.SBLIMIT=32,l.CBANDS=64,l.SBPSY_l=21,l.SBPSY_s=12,l.SBMAX_l=22,l.SBMAX_s=13,l.PSFB21=6,l.PSFB12=6,l.BLKSIZE=1024,l.HBLKSIZE=l.BLKSIZE/2+1,l.BLKSIZE_s=256,l.HBLKSIZE_s=l.BLKSIZE_s/2+1,l.NORM_TYPE=0,l.START_TYPE=1,l.SHORT_TYPE=2,l.STOP_TYPE=3,l.MPG_MD_LR_LR=0,l.MPG_MD_LR_I=1,l.MPG_MD_MS_LR=2,l.MPG_MD_MS_I=3,l.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function l(){var c=F2(),u=$2(),f=ko,m=l.FFTOFFSET,g=l.MPG_MD_MS_LR,_=null;this.psy=null;var E=null,S=null,b=null;this.setModules=function(p,M,L,D){_=p,this.psy=M,E=M,S=D,b=L};var v=new c;function y(p){var M,L;if(p.ATH.useAdjust==0){p.ATH.adjust=1;return}if(L=p.loudness_sq[0][0],M=p.loudness_sq[1][0],p.channels_out==2?(L+=p.loudness_sq[0][1],M+=p.loudness_sq[1][1]):(L+=L,M+=M),p.mode_gr==2&&(L=Math.max(L,M)),L*=.5,L*=p.ATH.aaSensitivityP,L>.03125)p.ATH.adjust>=1?p.ATH.adjust=1:p.ATH.adjust<p.ATH.adjustLimit&&(p.ATH.adjust=p.ATH.adjustLimit),p.ATH.adjustLimit=1;else{var D=31.98*L+625e-6;p.ATH.adjust>=D?(p.ATH.adjust*=D*.075+.925,p.ATH.adjust<D&&(p.ATH.adjust=D)):p.ATH.adjustLimit>=D?p.ATH.adjust=D:p.ATH.adjust<p.ATH.adjustLimit&&(p.ATH.adjust=p.ATH.adjustLimit),p.ATH.adjustLimit=D}}function A(p){var M,L;for(a(0<=p.bitrate_index&&p.bitrate_index<16),a(0<=p.mode_ext&&p.mode_ext<4),p.bitrate_stereoMode_Hist[p.bitrate_index][4]++,p.bitrate_stereoMode_Hist[15][4]++,p.channels_out==2&&(p.bitrate_stereoMode_Hist[p.bitrate_index][p.mode_ext]++,p.bitrate_stereoMode_Hist[15][p.mode_ext]++),M=0;M<p.mode_gr;++M)for(L=0;L<p.channels_out;++L){var D=p.l3_side.tt[M][L].block_type|0;p.l3_side.tt[M][L].mixed_block_flag!=0&&(D=4),p.bitrate_blockType_Hist[p.bitrate_index][D]++,p.bitrate_blockType_Hist[p.bitrate_index][5]++,p.bitrate_blockType_Hist[15][D]++,p.bitrate_blockType_Hist[15][5]++}}function d(p,M){var L=p.internal_flags,D,O;if(L.lame_encode_frame_init==0){var x,Y,R=i(2014),w=i(2014);for(L.lame_encode_frame_init=1,x=0,Y=0;x<286+576*(1+L.mode_gr);++x)x<576*L.mode_gr?(R[x]=0,L.channels_out==2&&(w[x]=0)):(R[x]=M[0][Y],L.channels_out==2&&(w[x]=M[1][Y]),++Y);for(O=0;O<L.mode_gr;O++)for(D=0;D<L.channels_out;D++)L.l3_side.tt[O][D].block_type=l.SHORT_TYPE;v.mdct_sub48(L,R,w),a(576>=l.FFTOFFSET),a(L.mf_size>=l.BLKSIZE+p.framesize-l.FFTOFFSET),a(L.mf_size>=512+p.framesize-32)}}this.lame_encode_mp3_frame=function(p,M,L,D,O,x){var Y,R=r([2,2]);R[0][0]=new u,R[0][1]=new u,R[1][0]=new u,R[1][1]=new u;var w=r([2,2]);w[0][0]=new u,w[0][1]=new u,w[1][0]=new u,w[1][1]=new u;var N,X=[null,null],q=p.internal_flags,Z=s([2,4]),ne=[.5,.5],U=[[0,0],[0,0]],F=[[0,0],[0,0]],C,P,I;if(X[0]=M,X[1]=L,q.lame_encode_frame_init==0&&d(p,X),q.padding=0,(q.slot_lag-=q.frac_SpF)<0&&(q.slot_lag+=p.out_samplerate,q.padding=1),q.psymodel!=0){var H,K=[null,null],he=0,ee=o(2);for(I=0;I<q.mode_gr;I++){for(P=0;P<q.channels_out;P++)K[P]=X[P],he=576+I*576-l.FFTOFFSET;if(p.VBR==t.vbr_mtrh||p.VBR==t.vbr_mt?H=E.L3psycho_anal_vbr(p,K,he,I,R,w,U[I],F[I],Z[I],ee):H=E.L3psycho_anal_ns(p,K,he,I,R,w,U[I],F[I],Z[I],ee),H!=0)return-4;for(p.mode==f.JOINT_STEREO&&(ne[I]=Z[I][2]+Z[I][3],ne[I]>0&&(ne[I]=Z[I][3]/ne[I])),P=0;P<q.channels_out;P++){var ae=q.l3_side.tt[I][P];ae.block_type=ee[P],ae.mixed_block_flag=0}}}else for(I=0;I<q.mode_gr;I++)for(P=0;P<q.channels_out;P++)q.l3_side.tt[I][P].block_type=l.NORM_TYPE,q.l3_side.tt[I][P].mixed_block_flag=0,F[I][P]=U[I][P]=700;if(y(q),v.mdct_sub48(q,X[0],X[1]),q.mode_ext=l.MPG_MD_LR_LR,p.force_ms)q.mode_ext=l.MPG_MD_MS_LR;else if(p.mode==f.JOINT_STEREO){var ge=0,Le=0;for(I=0;I<q.mode_gr;I++)for(P=0;P<q.channels_out;P++)ge+=F[I][P],Le+=U[I][P];if(ge<=1*Le){var He=q.l3_side.tt[0],De=q.l3_side.tt[q.mode_gr-1];He[0].block_type==He[1].block_type&&De[0].block_type==De[1].block_type&&(q.mode_ext=l.MPG_MD_MS_LR)}}if(q.mode_ext==g?(N=w,C=F):(N=R,C=U),p.analysis&&q.pinfo!=null)for(I=0;I<q.mode_gr;I++)for(P=0;P<q.channels_out;P++)q.pinfo.ms_ratio[I]=q.ms_ratio[I],q.pinfo.ms_ener_ratio[I]=ne[I],q.pinfo.blocktype[I][P]=q.l3_side.tt[I][P].block_type,q.pinfo.pe[I][P]=C[I][P],n.arraycopy(q.l3_side.tt[I][P].xr,0,q.pinfo.xr[I][P],0,576),q.mode_ext==g&&(q.pinfo.ers[I][P]=q.pinfo.ers[I][P+2],n.arraycopy(q.pinfo.energy[I][P+2],0,q.pinfo.energy[I][P],0,q.pinfo.energy[I][P].length));if(p.VBR==t.vbr_off||p.VBR==t.vbr_abr){var Ue,be;for(Ue=0;Ue<18;Ue++)q.nsPsy.pefirbuf[Ue]=q.nsPsy.pefirbuf[Ue+1];for(be=0,I=0;I<q.mode_gr;I++)for(P=0;P<q.channels_out;P++)be+=C[I][P];for(q.nsPsy.pefirbuf[18]=be,be=q.nsPsy.pefirbuf[9],Ue=0;Ue<9;Ue++)be+=(q.nsPsy.pefirbuf[Ue]+q.nsPsy.pefirbuf[18-Ue])*l.fircoef[Ue];for(be=670*5*q.mode_gr*q.channels_out/be,I=0;I<q.mode_gr;I++)for(P=0;P<q.channels_out;P++)C[I][P]*=be}if(q.iteration_loop.iteration_loop(p,C,ne,N),_.format_bitstream(p),Y=_.copy_buffer(q,D,O,x,1),p.bWriteVbrTag&&S.addVbrFrame(p),p.analysis&&q.pinfo!=null){for(P=0;P<q.channels_out;P++){var Re;for(Re=0;Re<m;Re++)q.pinfo.pcmdata[P][Re]=q.pinfo.pcmdata[P][Re+p.framesize];for(Re=m;Re<1600;Re++)q.pinfo.pcmdata[P][Re]=X[P][Re-m]}b.set_frame_pinfo(p,N)}return A(q),Y}}return Vl=l,Vl}var R1=An,L1=R1.Util,P1=R1.new_float,On=ir();function V2(){var e=P1(On.BLKSIZE),n=P1(On.BLKSIZE_s/2),t=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(s,o,a){var l=0,c,u,f;a<<=1;var m=o+a;c=4;do{var g,_,E,S,b,v,y;y=c>>1,S=c,b=c<<1,v=b+S,c=b<<1,u=o,f=u+y;do{var A,d,p,M;d=s[u+0]-s[u+S],A=s[u+0]+s[u+S],M=s[u+b]-s[u+v],p=s[u+b]+s[u+v],s[u+b]=A-p,s[u+0]=A+p,s[u+v]=d-M,s[u+S]=d+M,d=s[f+0]-s[f+S],A=s[f+0]+s[f+S],M=L1.SQRT2*s[f+v],p=L1.SQRT2*s[f+b],s[f+b]=A-p,s[f+0]=A+p,s[f+v]=d-M,s[f+S]=d+M,f+=c,u+=c}while(u<m);for(_=t[l+0],g=t[l+1],E=1;E<y;E++){var L,D;L=1-2*g*g,D=2*g*_,u=o+E,f=o+S-E;do{var O,x,Y,A,d,R,p,w,M,N;x=D*s[u+S]-L*s[f+S],O=L*s[u+S]+D*s[f+S],d=s[u+0]-O,A=s[u+0]+O,R=s[f+0]-x,Y=s[f+0]+x,x=D*s[u+v]-L*s[f+v],O=L*s[u+v]+D*s[f+v],M=s[u+b]-O,p=s[u+b]+O,N=s[f+b]-x,w=s[f+b]+x,x=g*p-_*N,O=_*p+g*N,s[u+b]=A-O,s[u+0]=A+O,s[f+v]=R-x,s[f+S]=R+x,x=_*w-g*M,O=g*w+_*M,s[f+b]=Y-O,s[f+0]=Y+O,s[u+v]=d-x,s[u+S]=d+x,f+=c,u+=c}while(u<m);L=_,_=L*t[l+0]-g*t[l+1],g=L*t[l+1]+g*t[l+0]}l+=2}while(c<a)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,o,a,l,c){for(var u=0;u<3;u++){var f=On.BLKSIZE_s/2,m=65535&576/3*(u+1),g=On.BLKSIZE_s/8-1;do{var _,E,S,b,v,y=i[g<<2]&255;_=n[y]*l[a][c+y+m],v=n[127-y]*l[a][c+y+m+128],E=_-v,_=_+v,S=n[y+64]*l[a][c+y+m+64],v=n[63-y]*l[a][c+y+m+192],b=S-v,S=S+v,f-=4,o[u][f+0]=_+S,o[u][f+2]=_-S,o[u][f+1]=E+b,o[u][f+3]=E-b,_=n[y+1]*l[a][c+y+m+1],v=n[126-y]*l[a][c+y+m+129],E=_-v,_=_+v,S=n[y+65]*l[a][c+y+m+65],v=n[62-y]*l[a][c+y+m+193],b=S-v,S=S+v,o[u][f+On.BLKSIZE_s/2+0]=_+S,o[u][f+On.BLKSIZE_s/2+2]=_-S,o[u][f+On.BLKSIZE_s/2+1]=E+b,o[u][f+On.BLKSIZE_s/2+3]=E-b}while(--g>=0);r(o[u],f,On.BLKSIZE_s/2)}},this.fft_long=function(s,o,a,l,c){var u=On.BLKSIZE/8-1,f=On.BLKSIZE/2;do{var m,g,_,E,S,b=i[u]&255;m=e[b]*l[a][c+b],S=e[b+512]*l[a][c+b+512],g=m-S,m=m+S,_=e[b+256]*l[a][c+b+256],S=e[b+768]*l[a][c+b+768],E=_-S,_=_+S,f-=4,o[f+0]=m+_,o[f+2]=m-_,o[f+1]=g+E,o[f+3]=g-E,m=e[b+1]*l[a][c+b+1],S=e[b+513]*l[a][c+b+513],g=m-S,m=m+S,_=e[b+257]*l[a][c+b+257],S=e[b+769]*l[a][c+b+769],E=_-S,_=_+S,o[f+On.BLKSIZE/2+0]=m+_,o[f+On.BLKSIZE/2+2]=m-_,o[f+On.BLKSIZE/2+1]=g+E,o[f+On.BLKSIZE/2+3]=g-E}while(--u>=0);r(o,f,On.BLKSIZE/2)},this.init_fft=function(s){for(var o=0;o<On.BLKSIZE;o++)e[o]=.42-.5*Math.cos(2*Math.PI*(o+.5)/On.BLKSIZE)+.08*Math.cos(4*Math.PI*(o+.5)/On.BLKSIZE);for(var o=0;o<On.BLKSIZE_s/2;o++)n[o]=.5*(1-Math.cos(2*Math.PI*(o+.5)/On.BLKSIZE_s))}}var x2=V2,ci=An,Is=ci.VbrMode,B1=ci.Float,Os=ci.ShortBlock,pr=ci.Util,H2=ci.Arrays,Fn=ci.new_float,Mr=ci.new_float_n,Gi=ci.new_int,xt=ci.assert,U2=x2,xe=ir();function W2(){var e=ko,n=new U2,t=2.302585092994046,r=2,i=16,s=2,o=16,a=.34,l=1/(14752*14752)/(xe.BLKSIZE/2),c=.01,u=.8,f=.6,m=.3,g=3.5,_=21,E=.2302585093;function S(h,T){for(var $=0,j=0;j<xe.BLKSIZE/2;++j)$+=h[j]*T.ATH.eql_w[j];return $*=l,$}function b(h,T,$,j,J,Q,ce,ie,le,ve,ke){var Pe=h.internal_flags;if(le<2)n.fft_long(Pe,j[J],le,ve,ke),n.fft_short(Pe,Q[ce],le,ve,ke);else if(le==2){for(var Ze=xe.BLKSIZE-1;Ze>=0;--Ze){var ft=j[J+0][Ze],$e=j[J+1][Ze];j[J+0][Ze]=(ft+$e)*pr.SQRT2*.5,j[J+1][Ze]=(ft-$e)*pr.SQRT2*.5}for(var dt=2;dt>=0;--dt)for(var Ze=xe.BLKSIZE_s-1;Ze>=0;--Ze){var ft=Q[ce+0][dt][Ze],$e=Q[ce+1][dt][Ze];Q[ce+0][dt][Ze]=(ft+$e)*pr.SQRT2*.5,Q[ce+1][dt][Ze]=(ft-$e)*pr.SQRT2*.5}}T[0]=j[J+0][0],T[0]*=T[0];for(var Ze=xe.BLKSIZE/2-1;Ze>=0;--Ze){var Be=j[J+0][xe.BLKSIZE/2-Ze],Qe=j[J+0][xe.BLKSIZE/2+Ze];T[xe.BLKSIZE/2-Ze]=(Be*Be+Qe*Qe)*.5}for(var dt=2;dt>=0;--dt){$[dt][0]=Q[ce+0][dt][0],$[dt][0]*=$[dt][0];for(var Ze=xe.BLKSIZE_s/2-1;Ze>=0;--Ze){var Be=Q[ce+0][dt][xe.BLKSIZE_s/2-Ze],Qe=Q[ce+0][dt][xe.BLKSIZE_s/2+Ze];$[dt][xe.BLKSIZE_s/2-Ze]=(Be*Be+Qe*Qe)*.5}}{for(var wt=0,Ze=11;Ze<xe.HBLKSIZE;Ze++)wt+=T[Ze];Pe.tot_ener[le]=wt}if(h.analysis){for(var Ze=0;Ze<xe.HBLKSIZE;Ze++)Pe.pinfo.energy[ie][le][Ze]=Pe.pinfo.energy_save[le][Ze],Pe.pinfo.energy_save[le][Ze]=T[Ze];Pe.pinfo.pe[ie][le]=Pe.pe[le]}h.athaa_loudapprox==2&&le<2&&(Pe.loudness_sq[ie][le]=Pe.loudness_sq_save[le],Pe.loudness_sq_save[le]=S(T,Pe))}var v=8,y=23,A=15,d,p,M,L=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function D(){d=Math.pow(10,(v+1)/16),p=Math.pow(10,(y+1)/16),M=Math.pow(10,A/10)}var O=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],x=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],Y=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function R(h,T,$,j,J,Q){var ce;if(T>h)if(T<h*p)ce=T/h;else return h+T;else{if(h>=T*p)return h+T;ce=h/T}if(h+=T,j+3<=6){if(ce>=d)return h;var ie=0|pr.FAST_LOG10_X(ce,16);return h*x[ie]}var ie=0|pr.FAST_LOG10_X(ce,16);if(Q!=0?T=J.ATH.cb_s[$]*J.ATH.adjust:T=J.ATH.cb_l[$]*J.ATH.adjust,h<M*T){if(h>T){var le,ve;return le=1,ie<=13&&(le=Y[ie]),ve=pr.FAST_LOG10_X(h/T,10/15),h*((O[ie]-le)*ve+le)}return ie>13?h:h*Y[ie]}return h*O[ie]}var w=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function N(h,T,$){var j;if(h<0&&(h=0),T<0&&(T=0),h<=0)return T;if(T<=0)return h;if(T>h?j=T/h:j=h/T,-2<=$&&$<=2){if(j>=d)return h+T;var J=0|pr.FAST_LOG10_X(j,16);return(h+T)*w[J]}return j<p?h+T:(h<T&&(h=T),h)}function X(h,T){var $=h.internal_flags;if($.channels_out>1){for(var j=0;j<xe.SBMAX_l;j++){var J=$.thm[0].l[j],Q=$.thm[1].l[j];$.thm[0].l[j]+=Q*T,$.thm[1].l[j]+=J*T}for(var j=0;j<xe.SBMAX_s;j++)for(var ce=0;ce<3;ce++){var J=$.thm[0].s[j][ce],Q=$.thm[1].s[j][ce];$.thm[0].s[j][ce]+=Q*T,$.thm[1].s[j][ce]+=J*T}}}function q(h){for(var T=0;T<xe.SBMAX_l;T++)if(!(h.thm[0].l[T]>1.58*h.thm[1].l[T]||h.thm[1].l[T]>1.58*h.thm[0].l[T])){var $=h.mld_l[T]*h.en[3].l[T],j=Math.max(h.thm[2].l[T],Math.min(h.thm[3].l[T],$));$=h.mld_l[T]*h.en[2].l[T];var J=Math.max(h.thm[3].l[T],Math.min(h.thm[2].l[T],$));h.thm[2].l[T]=j,h.thm[3].l[T]=J}for(var T=0;T<xe.SBMAX_s;T++)for(var Q=0;Q<3;Q++)if(!(h.thm[0].s[T][Q]>1.58*h.thm[1].s[T][Q]||h.thm[1].s[T][Q]>1.58*h.thm[0].s[T][Q])){var $=h.mld_s[T]*h.en[3].s[T][Q],j=Math.max(h.thm[2].s[T][Q],Math.min(h.thm[3].s[T][Q],$));$=h.mld_s[T]*h.en[2].s[T][Q];var J=Math.max(h.thm[3].s[T][Q],Math.min(h.thm[2].s[T][Q],$));h.thm[2].s[T][Q]=j,h.thm[3].s[T][Q]=J}}function Z(h,T,$){var j=T,J=Math.pow(10,$);T*=2,j*=2;for(var Q=0;Q<xe.SBMAX_l;Q++){var ce,ie,le,ve;if(ve=h.ATH.cb_l[h.bm_l[Q]]*J,ce=Math.min(Math.max(h.thm[0].l[Q],ve),Math.max(h.thm[1].l[Q],ve)),ie=Math.max(h.thm[2].l[Q],ve),le=Math.max(h.thm[3].l[Q],ve),ce*T<ie+le){var ke=ce*j/(ie+le);ie*=ke,le*=ke}h.thm[2].l[Q]=Math.min(ie,h.thm[2].l[Q]),h.thm[3].l[Q]=Math.min(le,h.thm[3].l[Q])}J*=xe.BLKSIZE_s/xe.BLKSIZE;for(var Q=0;Q<xe.SBMAX_s;Q++)for(var Pe=0;Pe<3;Pe++){var ce,ie,le,ve;if(ve=h.ATH.cb_s[h.bm_s[Q]]*J,ce=Math.min(Math.max(h.thm[0].s[Q][Pe],ve),Math.max(h.thm[1].s[Q][Pe],ve)),ie=Math.max(h.thm[2].s[Q][Pe],ve),le=Math.max(h.thm[3].s[Q][Pe],ve),ce*T<ie+le){var ke=ce*T/(ie+le);ie*=ke,le*=ke}h.thm[2].s[Q][Pe]=Math.min(h.thm[2].s[Q][Pe],ie),h.thm[3].s[Q][Pe]=Math.min(h.thm[3].s[Q][Pe],le)}}function ne(h,T,$,j,J){var Q,ce,ie=0,le=0;for(Q=ce=0;Q<xe.SBMAX_s;++ce,++Q){for(var ve=h.bo_s[Q],ke=h.npart_s,Pe=ve<ke?ve:ke;ce<Pe;)xt(T[ce]>=0),xt($[ce]>=0),ie+=T[ce],le+=$[ce],ce++;if(h.en[j].s[Q][J]=ie,h.thm[j].s[Q][J]=le,ce>=ke){++Q;break}xt(T[ce]>=0),xt($[ce]>=0);{var Ze=h.PSY.bo_s_weight[Q],ft=1-Ze;ie=Ze*T[ce],le=Ze*$[ce],h.en[j].s[Q][J]+=ie,h.thm[j].s[Q][J]+=le,ie=ft*T[ce],le=ft*$[ce]}}for(;Q<xe.SBMAX_s;++Q)h.en[j].s[Q][J]=0,h.thm[j].s[Q][J]=0}function U(h,T,$,j){var J,Q,ce=0,ie=0;for(J=Q=0;J<xe.SBMAX_l;++Q,++J){for(var le=h.bo_l[J],ve=h.npart_l,ke=le<ve?le:ve;Q<ke;)xt(T[Q]>=0),xt($[Q]>=0),ce+=T[Q],ie+=$[Q],Q++;if(h.en[j].l[J]=ce,h.thm[j].l[J]=ie,Q>=ve){++J;break}xt(T[Q]>=0),xt($[Q]>=0);{var Pe=h.PSY.bo_l_weight[J],Ze=1-Pe;ce=Pe*T[Q],ie=Pe*$[Q],h.en[j].l[J]+=ce,h.thm[j].l[J]+=ie,ce=Ze*T[Q],ie=Ze*$[Q]}}for(;J<xe.SBMAX_l;++J)h.en[j].l[J]=0,h.thm[j].l[J]=0}function F(h,T,$,j,J,Q){var ce=h.internal_flags,ie,le;for(le=ie=0;le<ce.npart_s;++le){for(var ve=0,ke=ce.numlines_s[le],Pe=0;Pe<ke;++Pe,++ie){var Ze=T[Q][ie];ve+=Ze}$[le]=ve}for(xt(le==ce.npart_s),ie=le=0;le<ce.npart_s;le++){var ft=ce.s3ind_s[le][0],$e=ce.s3_ss[ie++]*$[ft];for(++ft;ft<=ce.s3ind_s[le][1];)$e+=ce.s3_ss[ie]*$[ft],++ie,++ft;{var dt=s*ce.nb_s1[J][le];j[le]=Math.min($e,dt)}if(ce.blocktype_old[J&1]==xe.SHORT_TYPE){var dt=o*ce.nb_s2[J][le],Be=j[le];j[le]=Math.min(dt,Be)}ce.nb_s2[J][le]=ce.nb_s1[J][le],ce.nb_s1[J][le]=$e,xt(j[le]>=0)}for(;le<=xe.CBANDS;++le)$[le]=0,j[le]=0}function C(h,T,$,j){var J=h.internal_flags;h.short_blocks==Os.short_block_coupled&&!(T[0]!=0&&T[1]!=0)&&(T[0]=T[1]=0);for(var Q=0;Q<J.channels_out;Q++)j[Q]=xe.NORM_TYPE,h.short_blocks==Os.short_block_dispensed&&(T[Q]=1),h.short_blocks==Os.short_block_forced&&(T[Q]=0),T[Q]!=0?(xt(J.blocktype_old[Q]!=xe.START_TYPE),J.blocktype_old[Q]==xe.SHORT_TYPE&&(j[Q]=xe.STOP_TYPE)):(j[Q]=xe.SHORT_TYPE,J.blocktype_old[Q]==xe.NORM_TYPE&&(J.blocktype_old[Q]=xe.START_TYPE),J.blocktype_old[Q]==xe.STOP_TYPE&&(J.blocktype_old[Q]=xe.SHORT_TYPE)),$[Q]=J.blocktype_old[Q],J.blocktype_old[Q]=j[Q]}function P(h,T,$){return $>=1?h:$<=0?T:T>0?Math.pow(h/T,$)*T:0}var I=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function H(h,T){for(var $=309.07,j=0;j<xe.SBMAX_s-1;j++)for(var J=0;J<3;J++){var Q=h.thm.s[j][J];if(Q>0){var ce=Q*T,ie=h.en.s[j][J];ie>ce&&(ie>ce*1e10?$+=I[j]*(10*t):$+=I[j]*pr.FAST_LOG10(ie/ce))}}return $}var K=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function he(h,T){for(var $=281.0575,j=0;j<xe.SBMAX_l-1;j++){var J=h.thm.l[j];if(J>0){var Q=J*T,ce=h.en.l[j];ce>Q&&(ce>Q*1e10?$+=K[j]*(10*t):$+=K[j]*pr.FAST_LOG10(ce/Q))}}return $}function ee(h,T,$,j,J){var Q,ce;for(Q=ce=0;Q<h.npart_l;++Q){var ie=0,le=0,ve;for(ve=0;ve<h.numlines_l[Q];++ve,++ce){var ke=T[ce];ie+=ke,le<ke&&(le=ke)}$[Q]=ie,j[Q]=le,J[Q]=ie*h.rnumlines_l[Q],xt(h.rnumlines_l[Q]>=0),xt($[Q]>=0),xt(j[Q]>=0),xt(J[Q]>=0)}}function ae(h,T,$,j){var J=L.length-1,Q=0,ce=$[Q]+$[Q+1];if(ce>0){var ie=T[Q];ie<T[Q+1]&&(ie=T[Q+1]),xt(h.numlines_l[Q]+h.numlines_l[Q+1]-1>0),ce=20*(ie*2-ce)/(ce*(h.numlines_l[Q]+h.numlines_l[Q+1]-1));var le=0|ce;le>J&&(le=J),j[Q]=le}else j[Q]=0;for(Q=1;Q<h.npart_l-1;Q++)if(ce=$[Q-1]+$[Q]+$[Q+1],ce>0){var ie=T[Q-1];ie<T[Q]&&(ie=T[Q]),ie<T[Q+1]&&(ie=T[Q+1]),xt(h.numlines_l[Q-1]+h.numlines_l[Q]+h.numlines_l[Q+1]-1>0),ce=20*(ie*3-ce)/(ce*(h.numlines_l[Q-1]+h.numlines_l[Q]+h.numlines_l[Q+1]-1));var le=0|ce;le>J&&(le=J),j[Q]=le}else j[Q]=0;if(xt(Q==h.npart_l-1),ce=$[Q-1]+$[Q],ce>0){var ie=T[Q-1];ie<T[Q]&&(ie=T[Q]),xt(h.numlines_l[Q-1]+h.numlines_l[Q]-1>0),ce=20*(ie*2-ce)/(ce*(h.numlines_l[Q-1]+h.numlines_l[Q]-1));var le=0|ce;le>J&&(le=J),j[Q]=le}else j[Q]=0;xt(Q==h.npart_l-1)}var ge=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(h,T,$,j,J,Q,ce,ie,le,ve){var ke=h.internal_flags,Pe=Mr([2,xe.BLKSIZE]),Ze=Mr([2,3,xe.BLKSIZE_s]),ft=Fn(xe.CBANDS+1),$e=Fn(xe.CBANDS+1),dt=Fn(xe.CBANDS+2),Be=Gi(2),Qe=Gi(2),wt,We,at,je,_t,Bt,ot,ht,Rt=Mr([2,576]),Xt,mn=Gi(xe.CBANDS+2),Jt=Gi(xe.CBANDS+2);for(H2.fill(Jt,0),wt=ke.channels_out,h.mode==e.JOINT_STEREO&&(wt=4),h.VBR==Is.vbr_off?Xt=ke.ResvMax==0?0:ke.ResvSize/ke.ResvMax*.5:h.VBR==Is.vbr_rh||h.VBR==Is.vbr_mtrh||h.VBR==Is.vbr_mt?Xt=.6:Xt=1,We=0;We<ke.channels_out;We++){var $t=T[We],bn=$+576-350-_+192;for(je=0;je<576;je++){var Sn,En;for(Sn=$t[bn+je+10],En=0,_t=0;_t<(_-1)/2-1;_t+=2)Sn+=ge[_t]*($t[bn+je+_t]+$t[bn+je+_-_t]),En+=ge[_t+1]*($t[bn+je+_t+1]+$t[bn+je+_-_t-1]);Rt[We][je]=Sn+En}J[j][We].en.assign(ke.en[We]),J[j][We].thm.assign(ke.thm[We]),wt>2&&(Q[j][We].en.assign(ke.en[We+2]),Q[j][We].thm.assign(ke.thm[We+2]))}for(We=0;We<wt;We++){var Yt,Ht,Vt=Fn(12),Ft=[0,0,0,0],Ge=Fn(12),bt=1,Ve,Ie=Fn(xe.CBANDS),Mt=Fn(xe.CBANDS),Tt=[0,0,0,0],Zt=Fn(xe.HBLKSIZE),yt=Mr([3,xe.HBLKSIZE_s]);for(xt(ke.npart_s<=xe.CBANDS),xt(ke.npart_l<=xe.CBANDS),je=0;je<3;je++)Vt[je]=ke.nsPsy.last_en_subshort[We][je+6],xt(ke.nsPsy.last_en_subshort[We][je+4]>0),Ge[je]=Vt[je]/ke.nsPsy.last_en_subshort[We][je+4],Ft[0]+=Vt[je];if(We==2)for(je=0;je<576;je++){var jt,cn;jt=Rt[0][je],cn=Rt[1][je],Rt[0][je]=jt+cn,Rt[1][je]=jt-cn}{var Oe=Rt[We&1],Lt=0;for(je=0;je<9;je++){for(var Ot=Lt+64,Dt=1;Lt<Ot;Lt++)Dt<Math.abs(Oe[Lt])&&(Dt=Math.abs(Oe[Lt]));ke.nsPsy.last_en_subshort[We][je]=Vt[je+3]=Dt,Ft[1+je/3]+=Dt,Dt>Vt[je+3-2]?(xt(Vt[je+3-2]>0),Dt=Dt/Vt[je+3-2]):Vt[je+3-2]>Dt*10?Dt=Vt[je+3-2]/(Dt*10):Dt=0,Ge[je+3]=Dt}}if(h.analysis){var tn=Ge[0];for(je=1;je<12;je++)tn<Ge[je]&&(tn=Ge[je]);ke.pinfo.ers[j][We]=ke.pinfo.ers_save[We],ke.pinfo.ers_save[We]=tn}for(Ve=We==3?ke.nsPsy.attackthre_s:ke.nsPsy.attackthre,je=0;je<12;je++)Tt[je/3]==0&&Ge[je]>Ve&&(Tt[je/3]=je%3+1);for(je=1;je<4;je++){var hn;Ft[je-1]>Ft[je]?(xt(Ft[je]>0),hn=Ft[je-1]/Ft[je]):(xt(Ft[je-1]>0),hn=Ft[je]/Ft[je-1]),hn<1.7&&(Tt[je]=0,je==1&&(Tt[0]=0))}for(Tt[0]!=0&&ke.nsPsy.lastAttacks[We]!=0&&(Tt[0]=0),(ke.nsPsy.lastAttacks[We]==3||Tt[0]+Tt[1]+Tt[2]+Tt[3]!=0)&&(bt=0,Tt[1]!=0&&Tt[0]!=0&&(Tt[1]=0),Tt[2]!=0&&Tt[1]!=0&&(Tt[2]=0),Tt[3]!=0&&Tt[2]!=0&&(Tt[3]=0)),We<2?Qe[We]=bt:bt==0&&(Qe[0]=Qe[1]=0),le[We]=ke.tot_ener[We],Ht=Ze,Yt=Pe,b(h,Zt,yt,Yt,We&1,Ht,We&1,j,We,T,$),ee(ke,Zt,ft,Ie,Mt),ae(ke,Ie,Mt,mn),ht=0;ht<3;ht++){var er,zt;for(F(h,yt,$e,dt,We,ht),ne(ke,$e,dt,We,ht),ot=0;ot<xe.SBMAX_s;ot++){if(zt=ke.thm[We].s[ot][ht],zt*=u,Tt[ht]>=2||Tt[ht+1]==1){var Ce=ht!=0?ht-1:2,Dt=P(ke.thm[We].s[ot][Ce],zt,f*Xt);zt=Math.min(zt,Dt)}if(Tt[ht]==1){var Ce=ht!=0?ht-1:2,Dt=P(ke.thm[We].s[ot][Ce],zt,m*Xt);zt=Math.min(zt,Dt)}else if(ht!=0&&Tt[ht-1]==3||ht==0&&ke.nsPsy.lastAttacks[We]==3){var Ce=ht!=2?ht+1:0,Dt=P(ke.thm[We].s[ot][Ce],zt,m*Xt);zt=Math.min(zt,Dt)}er=Vt[ht*3+3]+Vt[ht*3+4]+Vt[ht*3+5],Vt[ht*3+5]*6<er&&(zt*=.5,Vt[ht*3+4]*6<er&&(zt*=.5)),ke.thm[We].s[ot][ht]=zt}}for(ke.nsPsy.lastAttacks[We]=Tt[2],Bt=0,at=0;at<ke.npart_l;at++){for(var Ct=ke.s3ind[at][0],un=ft[Ct]*L[mn[Ct]],Kt=ke.s3_ll[Bt++]*un;++Ct<=ke.s3ind[at][1];)un=ft[Ct]*L[mn[Ct]],Kt=R(Kt,ke.s3_ll[Bt++]*un,Ct,Ct-at,ke,0);Kt*=.158489319246111,ke.blocktype_old[We&1]==xe.SHORT_TYPE?dt[at]=Kt:dt[at]=P(Math.min(Kt,Math.min(r*ke.nb_1[We][at],i*ke.nb_2[We][at])),Kt,Xt),ke.nb_2[We][at]=ke.nb_1[We][at],ke.nb_1[We][at]=Kt}for(;at<=xe.CBANDS;++at)ft[at]=0,dt[at]=0;U(ke,ft,dt,We)}if((h.mode==e.STEREO||h.mode==e.JOINT_STEREO)&&h.interChRatio>0&&X(h,h.interChRatio),h.mode==e.JOINT_STEREO){var qt;q(ke),qt=h.msfix,Math.abs(qt)>0&&Z(ke,qt,h.ATHlower*ke.ATH.adjust)}for(C(h,Qe,ve,Be),We=0;We<wt;We++){var Nn,Gn=0,Mn,lr;We>1?(Nn=ie,Gn=-2,Mn=xe.NORM_TYPE,(ve[0]==xe.SHORT_TYPE||ve[1]==xe.SHORT_TYPE)&&(Mn=xe.SHORT_TYPE),lr=Q[j][We-2]):(Nn=ce,Gn=0,Mn=ve[We],lr=J[j][We]),Mn==xe.SHORT_TYPE?Nn[Gn+We]=H(lr,ke.masking_lower):Nn[Gn+We]=he(lr,ke.masking_lower),h.analysis&&(ke.pinfo.pe[j][We]=Nn[Gn+We])}return 0};function Le(h,T,$,j,J,Q,ce,ie){var le=h.internal_flags;if(j<2)n.fft_long(le,ce[ie],j,T,$);else if(j==2)for(var ve=xe.BLKSIZE-1;ve>=0;--ve){var ke=ce[ie+0][ve],Pe=ce[ie+1][ve];ce[ie+0][ve]=(ke+Pe)*pr.SQRT2*.5,ce[ie+1][ve]=(ke-Pe)*pr.SQRT2*.5}Q[0]=ce[ie+0][0],Q[0]*=Q[0];for(var ve=xe.BLKSIZE/2-1;ve>=0;--ve){var Ze=ce[ie+0][xe.BLKSIZE/2-ve],ft=ce[ie+0][xe.BLKSIZE/2+ve];Q[xe.BLKSIZE/2-ve]=(Ze*Ze+ft*ft)*.5}{for(var $e=0,ve=11;ve<xe.HBLKSIZE;ve++)$e+=Q[ve];le.tot_ener[j]=$e}if(h.analysis){for(var ve=0;ve<xe.HBLKSIZE;ve++)le.pinfo.energy[J][j][ve]=le.pinfo.energy_save[j][ve],le.pinfo.energy_save[j][ve]=Q[ve];le.pinfo.pe[J][j]=le.pe[j]}}function He(h,T,$,j,J,Q,ce,ie){var le=h.internal_flags;if(J==0&&j<2&&n.fft_short(le,ce[ie],j,T,$),j==2)for(var ve=xe.BLKSIZE_s-1;ve>=0;--ve){var ke=ce[ie+0][J][ve],Pe=ce[ie+1][J][ve];ce[ie+0][J][ve]=(ke+Pe)*pr.SQRT2*.5,ce[ie+1][J][ve]=(ke-Pe)*pr.SQRT2*.5}Q[J][0]=ce[ie+0][J][0],Q[J][0]*=Q[J][0];for(var ve=xe.BLKSIZE_s/2-1;ve>=0;--ve){var Ze=ce[ie+0][J][xe.BLKSIZE_s/2-ve],ft=ce[ie+0][J][xe.BLKSIZE_s/2+ve];Q[J][xe.BLKSIZE_s/2-ve]=(Ze*Ze+ft*ft)*.5}}function De(h,T,$,j){var J=h.internal_flags;h.athaa_loudapprox==2&&$<2&&(J.loudness_sq[T][$]=J.loudness_sq_save[$],J.loudness_sq_save[$]=S(j,J))}var Ue=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function be(h,T,$,j,J,Q,ce,ie,le,ve){for(var ke=Mr([2,576]),Pe=h.internal_flags,Ze=Pe.channels_out,ft=h.mode==e.JOINT_STEREO?4:Ze,$e=0;$e<Ze;$e++){firbuf=T[$e];for(var dt=$+576-350-_+192,Be=0;Be<576;Be++){var Qe,wt;Qe=firbuf[dt+Be+10],wt=0;for(var We=0;We<(_-1)/2-1;We+=2)Qe+=Ue[We]*(firbuf[dt+Be+We]+firbuf[dt+Be+_-We]),wt+=Ue[We+1]*(firbuf[dt+Be+We+1]+firbuf[dt+Be+_-We-1]);ke[$e][Be]=Qe+wt}J[j][$e].en.assign(Pe.en[$e]),J[j][$e].thm.assign(Pe.thm[$e]),ft>2&&(Q[j][$e].en.assign(Pe.en[$e+2]),Q[j][$e].thm.assign(Pe.thm[$e+2]))}for(var $e=0;$e<ft;$e++){var at=Fn(12),je=Fn(12),_t=[0,0,0,0],Bt=ke[$e&1],ot=0,ht=$e==3?Pe.nsPsy.attackthre_s:Pe.nsPsy.attackthre,Rt=1;if($e==2)for(var Be=0,We=576;We>0;++Be,--We){var Xt=ke[0][Be],mn=ke[1][Be];ke[0][Be]=Xt+mn,ke[1][Be]=Xt-mn}for(var Be=0;Be<3;Be++)je[Be]=Pe.nsPsy.last_en_subshort[$e][Be+6],xt(Pe.nsPsy.last_en_subshort[$e][Be+4]>0),at[Be]=je[Be]/Pe.nsPsy.last_en_subshort[$e][Be+4],_t[0]+=je[Be];for(var Be=0;Be<9;Be++){for(var Jt=ot+64,$t=1;ot<Jt;ot++)$t<Math.abs(Bt[ot])&&($t=Math.abs(Bt[ot]));Pe.nsPsy.last_en_subshort[$e][Be]=je[Be+3]=$t,_t[1+Be/3]+=$t,$t>je[Be+3-2]?(xt(je[Be+3-2]>0),$t=$t/je[Be+3-2]):je[Be+3-2]>$t*10?$t=je[Be+3-2]/($t*10):$t=0,at[Be+3]=$t}for(var Be=0;Be<3;++Be){var bn=je[Be*3+3]+je[Be*3+4]+je[Be*3+5],Sn=1;je[Be*3+5]*6<bn&&(Sn*=.5,je[Be*3+4]*6<bn&&(Sn*=.5)),ie[$e][Be]=Sn}if(h.analysis){for(var En=at[0],Be=1;Be<12;Be++)En<at[Be]&&(En=at[Be]);Pe.pinfo.ers[j][$e]=Pe.pinfo.ers_save[$e],Pe.pinfo.ers_save[$e]=En}for(var Be=0;Be<12;Be++)le[$e][Be/3]==0&&at[Be]>ht&&(le[$e][Be/3]=Be%3+1);for(var Be=1;Be<4;Be++){var Yt=_t[Be-1],Ht=_t[Be],Vt=Math.max(Yt,Ht);Vt<4e4&&Yt<1.7*Ht&&Ht<1.7*Yt&&(Be==1&&le[$e][0]<=le[$e][Be]&&(le[$e][0]=0),le[$e][Be]=0)}le[$e][0]<=Pe.nsPsy.lastAttacks[$e]&&(le[$e][0]=0),(Pe.nsPsy.lastAttacks[$e]==3||le[$e][0]+le[$e][1]+le[$e][2]+le[$e][3]!=0)&&(Rt=0,le[$e][1]!=0&&le[$e][0]!=0&&(le[$e][1]=0),le[$e][2]!=0&&le[$e][1]!=0&&(le[$e][2]=0),le[$e][3]!=0&&le[$e][2]!=0&&(le[$e][3]=0)),$e<2?ve[$e]=Rt:Rt==0&&(ve[0]=ve[1]=0),ce[$e]=Pe.tot_ener[$e]}}function Re(h,T,$){if($==0)for(var j=0;j<h.npart_s;j++)h.nb_s2[T][j]=h.nb_s1[T][j],h.nb_s1[T][j]=0}function Xe(h,T){for(var $=0;$<h.npart_l;$++)h.nb_2[T][$]=h.nb_1[T][$],h.nb_1[T][$]=0}function Ne(h,T,$,j){var J=L.length-1,Q=0,ce=$[Q]+$[Q+1];if(ce>0){var ie=T[Q];ie<T[Q+1]&&(ie=T[Q+1]),xt(h.numlines_s[Q]+h.numlines_s[Q+1]-1>0),ce=20*(ie*2-ce)/(ce*(h.numlines_s[Q]+h.numlines_s[Q+1]-1));var le=0|ce;le>J&&(le=J),j[Q]=le}else j[Q]=0;for(Q=1;Q<h.npart_s-1;Q++)if(ce=$[Q-1]+$[Q]+$[Q+1],xt(Q+1<h.npart_s),ce>0){var ie=T[Q-1];ie<T[Q]&&(ie=T[Q]),ie<T[Q+1]&&(ie=T[Q+1]),xt(h.numlines_s[Q-1]+h.numlines_s[Q]+h.numlines_s[Q+1]-1>0),ce=20*(ie*3-ce)/(ce*(h.numlines_s[Q-1]+h.numlines_s[Q]+h.numlines_s[Q+1]-1));var le=0|ce;le>J&&(le=J),j[Q]=le}else j[Q]=0;if(xt(Q==h.npart_s-1),ce=$[Q-1]+$[Q],ce>0){var ie=T[Q-1];ie<T[Q]&&(ie=T[Q]),xt(h.numlines_s[Q-1]+h.numlines_s[Q]-1>0),ce=20*(ie*2-ce)/(ce*(h.numlines_s[Q-1]+h.numlines_s[Q]-1));var le=0|ce;le>J&&(le=J),j[Q]=le}else j[Q]=0;xt(Q==h.npart_s-1)}function B(h,T,$,j,J,Q){var ce=h.internal_flags,ie=new float[xe.CBANDS],le=Fn(xe.CBANDS),ve,ke,Pe,Ze=new int[xe.CBANDS];for(Pe=ke=0;Pe<ce.npart_s;++Pe){var ft=0,$e=0,dt=ce.numlines_s[Pe];for(ve=0;ve<dt;++ve,++ke){var Be=T[Q][ke];ft+=Be,$e<Be&&($e=Be)}$[Pe]=ft,ie[Pe]=$e,le[Pe]=ft/dt,xt(le[Pe]>=0)}for(xt(Pe==ce.npart_s);Pe<xe.CBANDS;++Pe)ie[Pe]=0,le[Pe]=0;for(Ne(ce,ie,le,Ze),ke=Pe=0;Pe<ce.npart_s;Pe++){var Qe=ce.s3ind_s[Pe][0],wt=ce.s3ind_s[Pe][1],We,at,je,_t,Bt;for(We=Ze[Qe],at=1,_t=ce.s3_ss[ke]*$[Qe]*L[Ze[Qe]],++ke,++Qe;Qe<=wt;)We+=Ze[Qe],at+=1,je=ce.s3_ss[ke]*$[Qe]*L[Ze[Qe]],_t=N(_t,je,Qe-Pe),++ke,++Qe;We=(1+2*We)/(2*at),Bt=L[We]*.5,_t*=Bt,j[Pe]=_t,ce.nb_s2[J][Pe]=ce.nb_s1[J][Pe],ce.nb_s1[J][Pe]=_t,je=ie[Pe],je*=ce.minval_s[Pe],je*=Bt,j[Pe]>je&&(j[Pe]=je),ce.masking_lower>1&&(j[Pe]*=ce.masking_lower),j[Pe]>$[Pe]&&(j[Pe]=$[Pe]),ce.masking_lower<1&&(j[Pe]*=ce.masking_lower),xt(j[Pe]>=0)}for(;Pe<xe.CBANDS;++Pe)$[Pe]=0,j[Pe]=0}function V(h,T,$,j,J){var Q=Fn(xe.CBANDS),ce=Fn(xe.CBANDS),ie=Gi(xe.CBANDS+2),le;ee(h,T,$,Q,ce),ae(h,Q,ce,ie);var ve=0;for(le=0;le<h.npart_l;le++){var ke,Pe,Ze,ft,$e=h.s3ind[le][0],dt=h.s3ind[le][1],Be=0,Qe=0;for(Be=ie[$e],Qe+=1,Pe=h.s3_ll[ve]*$[$e]*L[ie[$e]],++ve,++$e;$e<=dt;)Be+=ie[$e],Qe+=1,ke=h.s3_ll[ve]*$[$e]*L[ie[$e]],ft=N(Pe,ke,$e-le),Pe=ft,++ve,++$e;if(Be=(1+2*Be)/(2*Qe),Ze=L[Be]*.5,Pe*=Ze,h.blocktype_old[J&1]==xe.SHORT_TYPE){var wt=r*h.nb_1[J][le];wt>0?j[le]=Math.min(Pe,wt):j[le]=Math.min(Pe,$[le]*m)}else{var We=i*h.nb_2[J][le],at=r*h.nb_1[J][le],wt;We<=0&&(We=Pe),at<=0&&(at=Pe),h.blocktype_old[J&1]==xe.NORM_TYPE?wt=Math.min(at,We):wt=at,j[le]=Math.min(Pe,wt)}h.nb_2[J][le]=h.nb_1[J][le],h.nb_1[J][le]=Pe,ke=Q[le],ke*=h.minval_l[le],ke*=Ze,j[le]>ke&&(j[le]=ke),h.masking_lower>1&&(j[le]*=h.masking_lower),j[le]>$[le]&&(j[le]=$[le]),h.masking_lower<1&&(j[le]*=h.masking_lower),xt(j[le]>=0)}for(;le<xe.CBANDS;++le)$[le]=0,j[le]=0}function ye(h,T){var $=h.internal_flags;h.short_blocks==Os.short_block_coupled&&!(T[0]!=0&&T[1]!=0)&&(T[0]=T[1]=0);for(var j=0;j<$.channels_out;j++)h.short_blocks==Os.short_block_dispensed&&(T[j]=1),h.short_blocks==Os.short_block_forced&&(T[j]=0)}function Ae(h,T,$){for(var j=h.internal_flags,J=0;J<j.channels_out;J++){var Q=xe.NORM_TYPE;T[J]!=0?(xt(j.blocktype_old[J]!=xe.START_TYPE),j.blocktype_old[J]==xe.SHORT_TYPE&&(Q=xe.STOP_TYPE)):(Q=xe.SHORT_TYPE,j.blocktype_old[J]==xe.NORM_TYPE&&(j.blocktype_old[J]=xe.START_TYPE),j.blocktype_old[J]==xe.STOP_TYPE&&(j.blocktype_old[J]=xe.SHORT_TYPE)),$[J]=j.blocktype_old[J],j.blocktype_old[J]=Q}}function Ke(h,T,$,j,J,Q,ce){for(var ie=Q*2,le=Q>0?Math.pow(10,J):1,ve,ke,Pe=0;Pe<ce;++Pe){var Ze=h[2][Pe],ft=h[3][Pe],$e=T[0][Pe],dt=T[1][Pe],Be=T[2][Pe],Qe=T[3][Pe];if($e<=1.58*dt&&dt<=1.58*$e){var wt=$[Pe]*ft,We=$[Pe]*Ze;ke=Math.max(Be,Math.min(Qe,wt)),ve=Math.max(Qe,Math.min(Be,We))}else ke=Be,ve=Qe;if(Q>0){var at,je,_t=j[Pe]*le;if(at=Math.min(Math.max($e,_t),Math.max(dt,_t)),Be=Math.max(ke,_t),Qe=Math.max(ve,_t),je=Be+Qe,je>0&&at*ie<je){var Bt=at*ie/je;Be*=Bt,Qe*=Bt}ke=Math.min(Be,ke),ve=Math.min(Qe,ve)}ke>Ze&&(ke=Ze),ve>ft&&(ve=ft),T[2][Pe]=ke,T[3][Pe]=ve}}this.L3psycho_anal_vbr=function(h,T,$,j,J,Q,ce,ie,le,ve){var ke=h.internal_flags,Pe,Ze,ft=Fn(xe.HBLKSIZE),$e=Mr([3,xe.HBLKSIZE_s]),dt=Mr([2,xe.BLKSIZE]),Be=Mr([2,3,xe.BLKSIZE_s]),Qe=Mr([4,xe.CBANDS]),wt=Mr([4,xe.CBANDS]),We=Mr([4,3]),at=.6,je=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],_t=Gi(2),Bt=h.mode==e.JOINT_STEREO?4:ke.channels_out;be(h,T,$,j,J,Q,le,We,je,_t),ye(h,_t);{for(var ot=0;ot<Bt;ot++){var ht=ot&1;Pe=dt,Le(h,T,$,ot,j,ft,Pe,ht),De(h,j,ot,ft),_t[ht]!=0?V(ke,ft,Qe[ot],wt[ot],ot):Xe(ke,ot)}_t[0]+_t[1]==2&&h.mode==e.JOINT_STEREO&&Ke(Qe,wt,ke.mld_cb_l,ke.ATH.cb_l,h.ATHlower*ke.ATH.adjust,h.msfix,ke.npart_l);for(var ot=0;ot<Bt;ot++){var ht=ot&1;_t[ht]!=0&&U(ke,Qe[ot],wt[ot],ot)}}{for(var Rt=0;Rt<3;Rt++){for(var ot=0;ot<Bt;++ot){var ht=ot&1;_t[ht]!=0?Re(ke,ot,Rt):(Ze=Be,He(h,T,$,ot,Rt,$e,Ze,ht),B(h,$e,Qe[ot],wt[ot],ot,Rt))}_t[0]+_t[1]==0&&h.mode==e.JOINT_STEREO&&Ke(Qe,wt,ke.mld_cb_s,ke.ATH.cb_s,h.ATHlower*ke.ATH.adjust,h.msfix,ke.npart_s);for(var ot=0;ot<Bt;++ot){var ht=ot&1;_t[ht]==0&&ne(ke,Qe[ot],wt[ot],ot,Rt)}}for(var ot=0;ot<Bt;ot++){var ht=ot&1;if(_t[ht]==0)for(var Xt=0;Xt<xe.SBMAX_s;Xt++){for(var mn=Fn(3),Rt=0;Rt<3;Rt++){var Jt=ke.thm[ot].s[Xt][Rt];if(Jt*=u,je[ot][Rt]>=2||je[ot][Rt+1]==1){var $t=Rt!=0?Rt-1:2,bn=P(ke.thm[ot].s[Xt][$t],Jt,f*at);Jt=Math.min(Jt,bn)}else if(je[ot][Rt]==1){var $t=Rt!=0?Rt-1:2,bn=P(ke.thm[ot].s[Xt][$t],Jt,m*at);Jt=Math.min(Jt,bn)}else if(Rt!=0&&je[ot][Rt-1]==3||Rt==0&&ke.nsPsy.lastAttacks[ot]==3){var $t=Rt!=2?Rt+1:0,bn=P(ke.thm[ot].s[Xt][$t],Jt,m*at);Jt=Math.min(Jt,bn)}Jt*=We[ot][Rt],mn[Rt]=Jt}for(var Rt=0;Rt<3;Rt++)ke.thm[ot].s[Xt][Rt]=mn[Rt]}}}for(var ot=0;ot<Bt;ot++)ke.nsPsy.lastAttacks[ot]=je[ot][2];Ae(h,_t,ve);for(var ot=0;ot<Bt;ot++){var Sn,En,Yt,Ht;ot>1?(Sn=ie,En=-2,Yt=xe.NORM_TYPE,(ve[0]==xe.SHORT_TYPE||ve[1]==xe.SHORT_TYPE)&&(Yt=xe.SHORT_TYPE),Ht=Q[j][ot-2]):(Sn=ce,En=0,Yt=ve[ot],Ht=J[j][ot]),Yt==xe.SHORT_TYPE?Sn[En+ot]=H(Ht,ke.masking_lower):Sn[En+ot]=he(Ht,ke.masking_lower),h.analysis&&(ke.pinfo.pe[j][ot]=Sn[En+ot])}return 0};function et(h,T){var $=h,j;return $>=0?j=-$*27:j=$*T,j<=-72?0:Math.exp(j*E)}function Je(h){var T=0,$=0;{var j=0,J,Q;for(j=0;et(j,h)>1e-20;j-=1);for(J=j,Q=0;Math.abs(Q-J)>1e-12;)j=(Q+J)/2,et(j,h)>0?Q=j:J=j;T=J}{var j=0,J,Q;for(j=0;et(j,h)>1e-20;j+=1);for(J=0,Q=j;Math.abs(Q-J)>1e-12;)j=(Q+J)/2,et(j,h)>0?J=j:Q=j;$=Q}{var ce=0,ie=1e3,le;for(le=0;le<=ie;++le){var j=T+le*($-T)/ie,ve=et(j,h);ce+=ve}{var ke=(ie+1)/(ce*($-T));return ke}}}function ze(h){var T,$,j,J;return T=h,T>=0?T*=3:T*=1.5,T>=.5&&T<=2.5?(J=T-.5,$=8*(J*J-2*J)):$=0,T+=.474,j=15.811389+7.5*T-17.5*Math.sqrt(1+T*T),j<=-60?0:(T=Math.exp(($+j)*E),T/=.6609193,T)}function ut(h){return h<0&&(h=0),h=h*.001,13*Math.atan(.76*h)+3.5*Math.atan(h*h/(7.5*7.5))}function nt(h,T,$,j,J,Q,ce,ie,le,ve,ke,Pe){var Ze=Fn(xe.CBANDS+1),ft=ie/(Pe>15?2*576:2*192),$e=Gi(xe.HBLKSIZE),dt;ie/=le;var Be=0,Qe=0;for(dt=0;dt<xe.CBANDS;dt++){var wt,We;for(wt=ut(ie*Be),Ze[dt]=ie*Be,We=Be;ut(ie*We)-wt<a&&We<=le/2;We++);for(h[dt]=We-Be,Qe=dt+1;Be<We;)xt(Be<xe.HBLKSIZE),$e[Be++]=dt;if(Be>le/2){Be=le/2,++dt;break}}xt(dt<xe.CBANDS),Ze[dt]=ie*Be;for(var at=0;at<Pe;at++){var je,_t,Bt,ot,ht;Bt=ve[at],ot=ve[at+1],je=0|Math.floor(.5+ke*(Bt-.5)),je<0&&(je=0),_t=0|Math.floor(.5+ke*(ot-.5)),_t>le/2&&(_t=le/2),$[at]=($e[je]+$e[_t])/2,T[at]=$e[_t];var Rt=ft*ot;ce[at]=(Rt-Ze[T[at]])/(Ze[T[at]+1]-Ze[T[at]]),ce[at]<0?ce[at]=0:ce[at]>1&&(ce[at]=1),ht=ut(ie*ve[at]*ke),ht=Math.min(ht,15.5)/15.5,Q[at]=Math.pow(10,1.25*(1-Math.cos(Math.PI*ht))-2.5)}Be=0;for(var Xt=0;Xt<Qe;Xt++){var mn=h[Xt],wt,Jt;wt=ut(ie*Be),Jt=ut(ie*(Be+mn-1)),j[Xt]=.5*(wt+Jt),wt=ut(ie*(Be-.5)),Jt=ut(ie*(Be+mn-.5)),J[Xt]=Jt-wt,Be+=mn}return Qe}function Ye(h,T,$,j,J,Q){var ce=Mr([xe.CBANDS,xe.CBANDS]),ie,le=0;if(Q)for(var ve=0;ve<T;ve++)for(ie=0;ie<T;ie++){var ke=ze($[ve]-$[ie])*j[ie];ce[ve][ie]=ke*J[ve]}else for(ie=0;ie<T;ie++)for(var Pe=15+Math.min(21/$[ie],12),Ze=Je(Pe),ve=0;ve<T;ve++){var ke=Ze*et($[ve]-$[ie],Pe)*j[ie];ce[ve][ie]=ke*J[ve]}for(var ve=0;ve<T;ve++){for(ie=0;ie<T&&!(ce[ve][ie]>0);ie++);for(h[ve][0]=ie,ie=T-1;ie>0&&!(ce[ve][ie]>0);ie--);h[ve][1]=ie,le+=h[ve][1]-h[ve][0]+1}for(var ft=Fn(le),$e=0,ve=0;ve<T;ve++)for(ie=h[ve][0];ie<=h[ve][1];ie++)ft[$e++]=ce[ve][ie];return ft}function W(h){var T=ut(h);return T=Math.min(T,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*T))-2.5)}this.psymodel_init=function(h){var T=h.internal_flags,$,j=!0,J=13,Q=24,ce=0,ie=0,le=-8.25,ve=-4.5,ke=Fn(xe.CBANDS),Pe=Fn(xe.CBANDS),Ze=Fn(xe.CBANDS),ft=h.out_samplerate;switch(h.experimentalZ){default:case 0:j=!0;break;case 1:j=!(h.VBR==Is.vbr_mtrh||h.VBR==Is.vbr_mt);break;case 2:j=!1;break;case 3:J=8,ce=-1.75,ie=-.0125,le=-8.25,ve=-2.25;break}for(T.ms_ener_ratio_old=.25,T.blocktype_old[0]=T.blocktype_old[1]=xe.NORM_TYPE,$=0;$<4;++$){for(var Be=0;Be<xe.CBANDS;++Be)T.nb_1[$][Be]=1e20,T.nb_2[$][Be]=1e20,T.nb_s1[$][Be]=T.nb_s2[$][Be]=1;for(var $e=0;$e<xe.SBMAX_l;$e++)T.en[$].l[$e]=1e20,T.thm[$].l[$e]=1e20;for(var Be=0;Be<3;++Be){for(var $e=0;$e<xe.SBMAX_s;$e++)T.en[$].s[$e][Be]=1e20,T.thm[$].s[$e][Be]=1e20;T.nsPsy.lastAttacks[$]=0}for(var Be=0;Be<9;Be++)T.nsPsy.last_en_subshort[$][Be]=10}for(T.loudness_sq_save[0]=T.loudness_sq_save[1]=0,T.npart_l=nt(T.numlines_l,T.bo_l,T.bm_l,ke,Pe,T.mld_l,T.PSY.bo_l_weight,ft,xe.BLKSIZE,T.scalefac_band.l,xe.BLKSIZE/(2*576),xe.SBMAX_l),xt(T.npart_l<xe.CBANDS),$=0;$<T.npart_l;$++){var dt=ce;ke[$]>=J&&(dt=ie*(ke[$]-J)/(Q-J)+ce*(Q-ke[$])/(Q-J)),Ze[$]=Math.pow(10,dt/10),T.numlines_l[$]>0?T.rnumlines_l[$]=1/T.numlines_l[$]:T.rnumlines_l[$]=0}T.s3_ll=Ye(T.s3ind,T.npart_l,ke,Pe,Ze,j);var Be=0;for($=0;$<T.npart_l;$++){var Qe;Qe=B1.MAX_VALUE;for(var wt=0;wt<T.numlines_l[$];wt++,Be++){var We=ft*Be/(1e3*xe.BLKSIZE),at;at=this.ATHformula(We*1e3,h)-20,at=Math.pow(10,.1*at),at*=T.numlines_l[$],Qe>at&&(Qe=at)}T.ATH.cb_l[$]=Qe,Qe=-20+ke[$]*20/10,Qe>6&&(Qe=100),Qe<-15&&(Qe=-15),Qe-=8,T.minval_l[$]=Math.pow(10,Qe/10)*T.numlines_l[$]}for(T.npart_s=nt(T.numlines_s,T.bo_s,T.bm_s,ke,Pe,T.mld_s,T.PSY.bo_s_weight,ft,xe.BLKSIZE_s,T.scalefac_band.s,xe.BLKSIZE_s/(2*192),xe.SBMAX_s),xt(T.npart_s<xe.CBANDS),Be=0,$=0;$<T.npart_s;$++){var Qe,dt=le;ke[$]>=J&&(dt=ve*(ke[$]-J)/(Q-J)+le*(Q-ke[$])/(Q-J)),Ze[$]=Math.pow(10,dt/10),Qe=B1.MAX_VALUE;for(var wt=0;wt<T.numlines_s[$];wt++,Be++){var We=ft*Be/(1e3*xe.BLKSIZE_s),at;at=this.ATHformula(We*1e3,h)-20,at=Math.pow(10,.1*at),at*=T.numlines_s[$],Qe>at&&(Qe=at)}T.ATH.cb_s[$]=Qe,Qe=-7+ke[$]*7/12,ke[$]>12&&(Qe*=1+Math.log(1+Qe)*3.1),ke[$]<12&&(Qe*=1+Math.log(1-Qe)*2.3),Qe<-15&&(Qe=-15),Qe-=8,T.minval_s[$]=Math.pow(10,Qe/10)*T.numlines_s[$]}T.s3_ss=Ye(T.s3ind_s,T.npart_s,ke,Pe,Ze,j),D(),n.init_fft(T),T.decay=Math.exp(-1*t/(c*ft/192));{var je;je=g,h.exp_nspsytune&2&&(je=1),Math.abs(h.msfix)>0&&(je=h.msfix),h.msfix=je;for(var _t=0;_t<T.npart_l;_t++)T.s3ind[_t][1]>T.npart_l-1&&(T.s3ind[_t][1]=T.npart_l-1)}var Bt=576*T.mode_gr/ft;if(T.ATH.decay=Math.pow(10,-12/10*Bt),T.ATH.adjust=.01,T.ATH.adjustLimit=1,xt(T.bo_l[xe.SBMAX_l-1]<=T.npart_l),xt(T.bo_s[xe.SBMAX_s-1]<=T.npart_s),h.ATHtype!=-1){var We,ot=h.out_samplerate/xe.BLKSIZE,ht=0;for(We=0,$=0;$<xe.BLKSIZE/2;++$)We+=ot,T.ATH.eql_w[$]=1/Math.pow(10,this.ATHformula(We,h)/10),ht+=T.ATH.eql_w[$];for(ht=1/ht,$=xe.BLKSIZE/2;--$>=0;)T.ATH.eql_w[$]*=ht}{for(var _t=Be=0;_t<T.npart_s;++_t)for($=0;$<T.numlines_s[_t];++$)++Be;for(var _t=Be=0;_t<T.npart_l;++_t)for($=0;$<T.numlines_l[_t];++$)++Be}for(Be=0,$=0;$<T.npart_l;$++){var We=ft*(Be+T.numlines_l[$]/2)/(1*xe.BLKSIZE);T.mld_cb_l[$]=W(We),Be+=T.numlines_l[$]}for(;$<xe.CBANDS;++$)T.mld_cb_l[$]=1;for(Be=0,$=0;$<T.npart_s;$++){var We=ft*(Be+T.numlines_s[$]/2)/(1*xe.BLKSIZE_s);T.mld_cb_s[$]=W(We),Be+=T.numlines_s[$]}for(;$<xe.CBANDS;++$)T.mld_cb_s[$]=1;return 0};function k(h,T){h<-.3&&(h=3410),h/=1e3,h=Math.max(.1,h);var $=3.64*Math.pow(h,-.8)-6.8*Math.exp(-.6*Math.pow(h-3.4,2))+6*Math.exp(-.15*Math.pow(h-8.7,2))+(.6+.04*T)*.001*Math.pow(h,4);return $}this.ATHformula=function(h,T){var $;switch(T.ATHtype){case 0:$=k(h,9);break;case 1:$=k(h,-1);break;case 2:$=k(h,0);break;case 3:$=k(h,1)+6;break;case 4:$=k(h,T.ATHcurve);break;default:$=k(h,0);break}return $}}var j2=W2,G2=ko;function z2(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=G2.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var X2=z2,Y2=ir(),I1={};I1.SFBMAX=Y2.SBMAX_s*3;var _a=I1,O1=An,q2=O1.new_float,zi=O1.new_int,xl=_a;function Z2(){this.xr=q2(576),this.l3_enc=zi(576),this.scalefac=zi(xl.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=zi(3),this.subblock_gain=zi(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=zi(xl.SFBMAX),this.window=zi(xl.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=zi(4),this.max_nonzero_coeff=0;var e=this;function n(r){return new Int32Array(r)}function t(r){return new Float32Array(r)}this.assign=function(r){e.xr=t(r.xr),e.l3_enc=n(r.l3_enc),e.scalefac=n(r.scalefac),e.xrpow_max=r.xrpow_max,e.part2_3_length=r.part2_3_length,e.big_values=r.big_values,e.count1=r.count1,e.global_gain=r.global_gain,e.scalefac_compress=r.scalefac_compress,e.block_type=r.block_type,e.mixed_block_flag=r.mixed_block_flag,e.table_select=n(r.table_select),e.subblock_gain=n(r.subblock_gain),e.region0_count=r.region0_count,e.region1_count=r.region1_count,e.preflag=r.preflag,e.scalefac_scale=r.scalefac_scale,e.count1table_select=r.count1table_select,e.part2_length=r.part2_length,e.sfb_lmax=r.sfb_lmax,e.sfb_smin=r.sfb_smin,e.psy_lmax=r.psy_lmax,e.sfbmax=r.sfbmax,e.psymax=r.psymax,e.sfbdivide=r.sfbdivide,e.width=n(r.width),e.window=n(r.window),e.count1bits=r.count1bits,e.sfb_partition_table=r.sfb_partition_table.slice(0),e.slen=n(r.slen),e.max_nonzero_coeff=r.max_nonzero_coeff}}var Hl=Z2,K2=An,D1=K2.new_int,Q2=Hl;function J2(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[D1(4),D1(4)];for(var e=0;e<2;e++)for(var n=0;n<2;n++)this.tt[e][n]=new Q2}var em=J2,N1=An,ga=N1.System,ba=N1.new_int,wa=ir();function tm(e,n,t,r){this.l=ba(1+wa.SBMAX_l),this.s=ba(1+wa.SBMAX_s),this.psfb21=ba(1+wa.PSFB21),this.psfb12=ba(1+wa.PSFB12);var i=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],ga.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),ga.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),ga.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),ga.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var F1=tm,Ul=An,Wl=Ul.new_float,nm=Ul.new_float_n,rm=Ul.new_int,$1=ir();function im(){this.last_en_subshort=nm([4,9]),this.lastAttacks=rm(4),this.pefirbuf=Wl(19),this.longfact=Wl($1.SBMAX_l),this.shortfact=Wl($1.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var sm=im;function om(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var am=om,Ds=An,lm=Ds.new_byte,um=Ds.new_double,Cr=Ds.new_float,Xi=Ds.new_float_n,Or=Ds.new_int,va=Ds.new_int_n,cm=em,fm=F1,dm=sm,hm=am,V1=A1(),Pn=ir(),pm=_a;fi.MFSIZE=3*1152+Pn.ENCDELAY-Pn.MDCTDELAY,fi.MAX_HEADER_BUF=256,fi.MAX_BITS_PER_CHANNEL=4095,fi.MAX_BITS_PER_GRANULE=7680,fi.BPC=320;function fi(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Xi([2,fi.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new cm,this.ms_ratio=Cr(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Or(2),this.CurrentStep=Or(2),this.masking_lower=0,this.bv_scf=Or(576),this.pseudohalf=Or(pm.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*fi.BPC+1),this.itime=um(2),this.sideinfo_len=0,this.sb_sample=Xi([2,2,18,Pn.SBLIMIT]),this.amp_filter=Cr(32);function n(){this.write_timing=0,this.ptr=0,this.buf=lm(e)}this.header=new Array(fi.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new fm,this.minval_l=Cr(Pn.CBANDS),this.minval_s=Cr(Pn.CBANDS),this.nb_1=Xi([4,Pn.CBANDS]),this.nb_2=Xi([4,Pn.CBANDS]),this.nb_s1=Xi([4,Pn.CBANDS]),this.nb_s2=Xi([4,Pn.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Cr(4),this.loudness_sq=Xi([2,2]),this.loudness_sq_save=Cr(2),this.mld_l=Cr(Pn.SBMAX_l),this.mld_s=Cr(Pn.SBMAX_s),this.bm_l=Or(Pn.SBMAX_l),this.bo_l=Or(Pn.SBMAX_l),this.bm_s=Or(Pn.SBMAX_s),this.bo_s=Or(Pn.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=va([Pn.CBANDS,2]),this.s3ind_s=va([Pn.CBANDS,2]),this.numlines_s=Or(Pn.CBANDS),this.numlines_l=Or(Pn.CBANDS),this.rnumlines_l=Cr(Pn.CBANDS),this.mld_cb_l=Cr(Pn.CBANDS),this.mld_cb_s=Cr(Pn.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Cr(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Or(2),this.nsPsy=new dm,this.VBR_seek_table=new hm,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=va([16,5]),this.bitrate_blockType_Hist=va([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var t=0;t<this.en.length;t++)this.en[t]=new V1;for(var t=0;t<this.thm.length;t++)this.thm[t]=new V1;for(var t=0;t<this.header.length;t++)this.header[t]=new n}var ya=fi,mm=An,Yi=mm.new_float,qi=ir();function _m(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Yi(qi.SBMAX_l),this.s=Yi(qi.SBMAX_s),this.psfb21=Yi(qi.PSFB21),this.psfb12=Yi(qi.PSFB12),this.cb_l=Yi(qi.CBANDS),this.cb_s=Yi(qi.CBANDS),this.eql_w=Yi(qi.BLKSIZE/2)}var gm=_m,x1=An,mr=x1.System,H1=x1.Arrays;Bn.STEPS_per_dB=100,Bn.MAX_dB=120,Bn.GAIN_NOT_ENOUGH_SAMPLES=-24601,Bn.GAIN_ANALYSIS_ERROR=0,Bn.GAIN_ANALYSIS_OK=1,Bn.INIT_GAIN_ANALYSIS_ERROR=0,Bn.INIT_GAIN_ANALYSIS_OK=1,Bn.YULE_ORDER=10,Bn.MAX_ORDER=Bn.YULE_ORDER,Bn.MAX_SAMP_FREQ=48e3,Bn.RMS_WINDOW_TIME_NUMERATOR=1,Bn.RMS_WINDOW_TIME_DENOMINATOR=20,Bn.MAX_SAMPLES_PER_WINDOW=Bn.MAX_SAMP_FREQ*Bn.RMS_WINDOW_TIME_NUMERATOR/Bn.RMS_WINDOW_TIME_DENOMINATOR+1;function Bn(){var e=64.82,n=.95,t=Bn.RMS_WINDOW_TIME_NUMERATOR,r=Bn.RMS_WINDOW_TIME_DENOMINATOR,i=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(f,m,g,_,E,S){for(;E--!=0;)g[_]=1e-10+f[m+0]*S[0]-g[_-1]*S[1]+f[m-1]*S[2]-g[_-2]*S[3]+f[m-2]*S[4]-g[_-3]*S[5]+f[m-3]*S[6]-g[_-4]*S[7]+f[m-4]*S[8]-g[_-5]*S[9]+f[m-5]*S[10]-g[_-6]*S[11]+f[m-6]*S[12]-g[_-7]*S[13]+f[m-7]*S[14]-g[_-8]*S[15]+f[m-8]*S[16]-g[_-9]*S[17]+f[m-9]*S[18]-g[_-10]*S[19]+f[m-10]*S[20],++_,++m}function a(f,m,g,_,E,S){for(;E--!=0;)g[_]=f[m+0]*S[0]-g[_-1]*S[1]+f[m-1]*S[2]-g[_-2]*S[3]+f[m-2]*S[4],++_,++m}function l(f,m){for(var g=0;g<MAX_ORDER;g++)f.linprebuf[g]=f.lstepbuf[g]=f.loutbuf[g]=f.rinprebuf[g]=f.rstepbuf[g]=f.routbuf[g]=0;switch(0|m){case 48e3:f.reqindex=0;break;case 44100:f.reqindex=1;break;case 32e3:f.reqindex=2;break;case 24e3:f.reqindex=3;break;case 22050:f.reqindex=4;break;case 16e3:f.reqindex=5;break;case 12e3:f.reqindex=6;break;case 11025:f.reqindex=7;break;case 8e3:f.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return f.sampleWindow=0|(m*t+r-1)/r,f.lsum=0,f.rsum=0,f.totsamp=0,H1.ill(f.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(f,m){return l(f,m)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(f.linpre=MAX_ORDER,f.rinpre=MAX_ORDER,f.lstep=MAX_ORDER,f.rstep=MAX_ORDER,f.lout=MAX_ORDER,f.rout=MAX_ORDER,H1.fill(f.B,0),INIT_GAIN_ANALYSIS_OK)};function c(f){return f*f}this.AnalyzeSamples=function(f,m,g,_,E,S,b){var v,y,A,d,p,M,L;if(S==0)return GAIN_ANALYSIS_OK;switch(L=0,p=S,b){case 1:_=m,E=g;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(S<MAX_ORDER?(mr.arraycopy(m,g,f.linprebuf,MAX_ORDER,S),mr.arraycopy(_,E,f.rinprebuf,MAX_ORDER,S)):(mr.arraycopy(m,g,f.linprebuf,MAX_ORDER,MAX_ORDER),mr.arraycopy(_,E,f.rinprebuf,MAX_ORDER,MAX_ORDER));p>0;){M=p>f.sampleWindow-f.totsamp?f.sampleWindow-f.totsamp:p,L<MAX_ORDER?(v=f.linpre+L,y=f.linprebuf,A=f.rinpre+L,d=f.rinprebuf,M>MAX_ORDER-L&&(M=MAX_ORDER-L)):(v=g+L,y=m,A=E+L,d=_),o(y,v,f.lstepbuf,f.lstep+f.totsamp,M,i[f.reqindex]),o(d,A,f.rstepbuf,f.rstep+f.totsamp,M,i[f.reqindex]),a(f.lstepbuf,f.lstep+f.totsamp,f.loutbuf,f.lout+f.totsamp,M,s[f.reqindex]),a(f.rstepbuf,f.rstep+f.totsamp,f.routbuf,f.rout+f.totsamp,M,s[f.reqindex]),v=f.lout+f.totsamp,y=f.loutbuf,A=f.rout+f.totsamp,d=f.routbuf;for(var D=M%8;D--!=0;)f.lsum+=c(y[v++]),f.rsum+=c(d[A++]);for(D=M/8;D--!=0;)f.lsum+=c(y[v+0])+c(y[v+1])+c(y[v+2])+c(y[v+3])+c(y[v+4])+c(y[v+5])+c(y[v+6])+c(y[v+7]),v+=8,f.rsum+=c(d[A+0])+c(d[A+1])+c(d[A+2])+c(d[A+3])+c(d[A+4])+c(d[A+5])+c(d[A+6])+c(d[A+7]),A+=8;if(p-=M,L+=M,f.totsamp+=M,f.totsamp==f.sampleWindow){var O=Bn.STEPS_per_dB*10*Math.log10((f.lsum+f.rsum)/f.totsamp*.5+1e-37),x=O<=0?0:0|O;x>=f.A.length&&(x=f.A.length-1),f.A[x]++,f.lsum=f.rsum=0,mr.arraycopy(f.loutbuf,f.totsamp,f.loutbuf,0,MAX_ORDER),mr.arraycopy(f.routbuf,f.totsamp,f.routbuf,0,MAX_ORDER),mr.arraycopy(f.lstepbuf,f.totsamp,f.lstepbuf,0,MAX_ORDER),mr.arraycopy(f.rstepbuf,f.totsamp,f.rstepbuf,0,MAX_ORDER),f.totsamp=0}if(f.totsamp>f.sampleWindow)return GAIN_ANALYSIS_ERROR}return S<MAX_ORDER?(mr.arraycopy(f.linprebuf,S,f.linprebuf,0,MAX_ORDER-S),mr.arraycopy(f.rinprebuf,S,f.rinprebuf,0,MAX_ORDER-S),mr.arraycopy(m,g,f.linprebuf,MAX_ORDER-S,S),mr.arraycopy(_,E,f.rinprebuf,MAX_ORDER-S,S)):(mr.arraycopy(m,g+S-MAX_ORDER,f.linprebuf,0,MAX_ORDER),mr.arraycopy(_,E+S-MAX_ORDER,f.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function u(f,m){var g,_=0;for(g=0;g<m;g++)_+=f[g];if(_==0)return GAIN_NOT_ENOUGH_SAMPLES;var E=0|Math.ceil(_*(1-n));for(g=m;g-- >0&&!((E-=f[g])<=0););return e-g/Bn.STEPS_per_dB}this.GetTitleGain=function(f){for(var m=u(f.A,f.A.length),g=0;g<f.A.length;g++)f.B[g]+=f.A[g],f.A[g]=0;for(var g=0;g<MAX_ORDER;g++)f.linprebuf[g]=f.lstepbuf[g]=f.loutbuf[g]=f.rinprebuf[g]=f.rstepbuf[g]=f.routbuf[g]=0;return f.totsamp=0,f.lsum=f.rsum=0,m}}var U1=Bn,W1=An,Ns=W1.new_float,j1=W1.new_int,_r=U1;function bm(){this.linprebuf=Ns(_r.MAX_ORDER*2),this.linpre=0,this.lstepbuf=Ns(_r.MAX_SAMPLES_PER_WINDOW+_r.MAX_ORDER),this.lstep=0,this.loutbuf=Ns(_r.MAX_SAMPLES_PER_WINDOW+_r.MAX_ORDER),this.lout=0,this.rinprebuf=Ns(_r.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=Ns(_r.MAX_SAMPLES_PER_WINDOW+_r.MAX_ORDER),this.rstep=0,this.routbuf=Ns(_r.MAX_SAMPLES_PER_WINDOW+_r.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=j1(0|_r.STEPS_per_dB*_r.MAX_dB),this.B=j1(0|_r.STEPS_per_dB*_r.MAX_dB)}var wm=bm;function vm(e){this.bits=e}var G1=vm,jl=An,z1=jl.new_float,ym=jl.new_int,X1=jl.assert,Em=G1,Y1=ir(),Sm=_a,km=ya;function Tm(e){var n=e;this.quantize=n,this.iteration_loop=function(t,r,i,s){var o=t.internal_flags,a=z1(Sm.SFBMAX),l=z1(576),c=ym(2),u=0,f,m=o.l3_side,g=new Em(u);this.quantize.rv.ResvFrameBegin(t,g),u=g.bits;for(var _=0;_<o.mode_gr;_++){f=this.quantize.qupvt.on_pe(t,r,c,u,_,_),o.mode_ext==Y1.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,_),this.quantize.qupvt.reduce_side(c,i[_],u,f));for(var E=0;E<o.channels_out;E++){var S,b,v=m.tt[_][E];v.block_type!=Y1.SHORT_TYPE?(S=0,b=o.PSY.mask_adjust-S):(S=0,b=o.PSY.mask_adjust_short-S),o.masking_lower=Math.pow(10,b*.1),this.quantize.init_outer_loop(o,v),this.quantize.init_xrpow(o,v,l)&&(this.quantize.qupvt.calc_xmin(t,s[_][E],v,a),this.quantize.outer_loop(t,v,a,l,E,c[E])),this.quantize.iteration_finish_one(o,_,E),X1(v.part2_3_length<=km.MAX_BITS_PER_CHANNEL),X1(v.part2_3_length<=c[E])}}this.quantize.rv.ResvFrameEnd(o,u)}}var Am=Tm;function on(e,n,t,r){this.xlen=e,this.linmax=n,this.table=t,this.hlen=r}var st={};st.t1HB=[1,1,1,0],st.t2HB=[1,2,1,3,1,1,3,2,0],st.t3HB=[3,2,1,1,1,1,3,2,0],st.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],st.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],st.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],st.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],st.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],st.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],st.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],st.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],st.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],st.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],st.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],st.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],st.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],st.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],st.t1l=[1,4,3,5],st.t2l=[1,4,7,4,5,7,6,7,8],st.t3l=[2,3,7,4,4,7,6,7,8],st.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],st.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],st.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],st.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],st.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],st.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],st.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],st.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],st.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],st.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],st.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],st.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],st.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],st.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],st.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],st.ht=[new on(0,0,null,null),new on(2,0,st.t1HB,st.t1l),new on(3,0,st.t2HB,st.t2l),new on(3,0,st.t3HB,st.t3l),new on(0,0,null,null),new on(4,0,st.t5HB,st.t5l),new on(4,0,st.t6HB,st.t6l),new on(6,0,st.t7HB,st.t7l),new on(6,0,st.t8HB,st.t8l),new on(6,0,st.t9HB,st.t9l),new on(8,0,st.t10HB,st.t10l),new on(8,0,st.t11HB,st.t11l),new on(8,0,st.t12HB,st.t12l),new on(16,0,st.t13HB,st.t13l),new on(0,0,null,st.t16_5l),new on(16,0,st.t15HB,st.t15l),new on(1,1,st.t16HB,st.t16l),new on(2,3,st.t16HB,st.t16l),new on(3,7,st.t16HB,st.t16l),new on(4,15,st.t16HB,st.t16l),new on(6,63,st.t16HB,st.t16l),new on(8,255,st.t16HB,st.t16l),new on(10,1023,st.t16HB,st.t16l),new on(13,8191,st.t16HB,st.t16l),new on(4,15,st.t24HB,st.t24l),new on(5,31,st.t24HB,st.t24l),new on(6,63,st.t24HB,st.t24l),new on(7,127,st.t24HB,st.t24l),new on(8,255,st.t24HB,st.t24l),new on(9,511,st.t24HB,st.t24l),new on(11,2047,st.t24HB,st.t24l),new on(13,8191,st.t24HB,st.t24l),new on(0,0,st.t32HB,st.t32l),new on(0,0,st.t33HB,st.t33l)],st.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],st.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],st.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],st.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],st.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],st.scfsi_band=[0,6,11,16,21];var Gl=st,zl,q1;function Z1(){if(q1)return zl;q1=1;var e=F1,n=An,t=n.VbrMode,r=n.Float,i=n.Util,s=n.new_float,o=n.new_int,a=n.assert,l=ir(),c=G1,u=ya;f.Q_MAX=257,f.Q_MAX2=116,f.LARGE_BITS=1e5,f.IXMAX_VAL=8206;function f(){var m=ql(),g=null,_=null,E=null;this.setModules=function(N,X,q){g=N,_=X,E=q};function S(N){return a(0<=N+f.Q_MAX2&&N<f.Q_MAX),L[N+f.Q_MAX2]}this.IPOW20=function(N){return a(0<=N&&N<f.Q_MAX),D[N]};var b=2220446049250313e-31,v=f.IXMAX_VAL,y=v+2,A=f.Q_MAX,d=f.Q_MAX2;f.LARGE_BITS;var p=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var M=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=M,this.sfBandIndex=[new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var L=s(A+d+1),D=s(A),O=s(y),x=s(y);this.adj43=x;function Y(N,X){var q=E.ATHformula(X,N);return q-=p,q=Math.pow(10,q/10+N.ATHlower),q}function R(N){for(var X=N.internal_flags.ATH.l,q=N.internal_flags.ATH.psfb21,Z=N.internal_flags.ATH.s,ne=N.internal_flags.ATH.psfb12,U=N.internal_flags,F=N.out_samplerate,C=0;C<l.SBMAX_l;C++){var P=U.scalefac_band.l[C],I=U.scalefac_band.l[C+1];X[C]=r.MAX_VALUE;for(var H=P;H<I;H++){var K=H*F/1152,he=Y(N,K);X[C]=Math.min(X[C],he)}}for(var C=0;C<l.PSFB21;C++){var P=U.scalefac_band.psfb21[C],I=U.scalefac_band.psfb21[C+1];q[C]=r.MAX_VALUE;for(var H=P;H<I;H++){var K=H*F/1152,he=Y(N,K);q[C]=Math.min(q[C],he)}}for(var C=0;C<l.SBMAX_s;C++){var P=U.scalefac_band.s[C],I=U.scalefac_band.s[C+1];Z[C]=r.MAX_VALUE;for(var H=P;H<I;H++){var K=H*F/384,he=Y(N,K);Z[C]=Math.min(Z[C],he)}Z[C]*=U.scalefac_band.s[C+1]-U.scalefac_band.s[C]}for(var C=0;C<l.PSFB12;C++){var P=U.scalefac_band.psfb12[C],I=U.scalefac_band.psfb12[C+1];ne[C]=r.MAX_VALUE;for(var H=P;H<I;H++){var K=H*F/384,he=Y(N,K);ne[C]=Math.min(ne[C],he)}ne[C]*=U.scalefac_band.s[13]-U.scalefac_band.s[12]}if(N.noATH){for(var C=0;C<l.SBMAX_l;C++)X[C]=1e-20;for(var C=0;C<l.PSFB21;C++)q[C]=1e-20;for(var C=0;C<l.SBMAX_s;C++)Z[C]=1e-20;for(var C=0;C<l.PSFB12;C++)ne[C]=1e-20}U.ATH.floor=10*Math.log10(Y(N,-1))}this.iteration_init=function(N){var X=N.internal_flags,q=X.l3_side,Z;if(X.iteration_init_init==0){for(X.iteration_init_init=1,q.main_data_begin=0,R(N),O[0]=0,Z=1;Z<y;Z++)O[Z]=Math.pow(Z,4/3);for(Z=0;Z<y-1;Z++)x[Z]=Z+1-Math.pow(.5*(O[Z]+O[Z+1]),.75);for(x[Z]=.5,Z=0;Z<A;Z++)D[Z]=Math.pow(2,(Z-210)*-.1875);for(Z=0;Z<=A+d;Z++)L[Z]=Math.pow(2,(Z-210-d)*.25);g.huffman_init(X);{var ne,U,F,C;for(Z=N.exp_nspsytune>>2&63,Z>=32&&(Z-=64),ne=Math.pow(10,Z/4/10),Z=N.exp_nspsytune>>8&63,Z>=32&&(Z-=64),U=Math.pow(10,Z/4/10),Z=N.exp_nspsytune>>14&63,Z>=32&&(Z-=64),F=Math.pow(10,Z/4/10),Z=N.exp_nspsytune>>20&63,Z>=32&&(Z-=64),C=F*Math.pow(10,Z/4/10),Z=0;Z<l.SBMAX_l;Z++){var P;Z<=6?P=ne:Z<=13?P=U:Z<=20?P=F:P=C,X.nsPsy.longfact[Z]=P}for(Z=0;Z<l.SBMAX_s;Z++){var P;Z<=5?P=ne:Z<=10?P=U:Z<=11?P=F:P=C,X.nsPsy.shortfact[Z]=P}}}},this.on_pe=function(N,X,q,Z,ne,U){var F=N.internal_flags,C=0,P,I=o(2),H,K=new c(C),he=_.ResvMaxBits(N,Z,K,U);C=K.bits;var ee=C+he;for(ee>u.MAX_BITS_PER_GRANULE&&(ee=u.MAX_BITS_PER_GRANULE),P=0,H=0;H<F.channels_out;++H)q[H]=Math.min(u.MAX_BITS_PER_CHANNEL,C/F.channels_out),I[H]=0|q[H]*X[ne][H]/700-q[H],I[H]>Z*3/4&&(I[H]=Z*3/4),I[H]<0&&(I[H]=0),I[H]+q[H]>u.MAX_BITS_PER_CHANNEL&&(I[H]=Math.max(0,u.MAX_BITS_PER_CHANNEL-q[H])),P+=I[H];if(P>he)for(H=0;H<F.channels_out;++H)I[H]=he*I[H]/P;for(H=0;H<F.channels_out;++H)q[H]+=I[H],he-=I[H];for(P=0,H=0;H<F.channels_out;++H)P+=q[H];if(P>u.MAX_BITS_PER_GRANULE){var ae=0;for(H=0;H<F.channels_out;++H)q[H]*=u.MAX_BITS_PER_GRANULE,q[H]/=P,ae+=q[H]}return ee},this.reduce_side=function(N,X,q,Z){a(N[0]+N[1]<=u.MAX_BITS_PER_GRANULE);var ne=.33*(.5-X)/.5;ne<0&&(ne=0),ne>.5&&(ne=.5);var U=0|ne*.5*(N[0]+N[1]);U>u.MAX_BITS_PER_CHANNEL-N[0]&&(U=u.MAX_BITS_PER_CHANNEL-N[0]),U<0&&(U=0),N[1]>=125&&(N[1]-U>125?(N[0]<q&&(N[0]+=U),N[1]-=U):(N[0]+=N[1]-125,N[1]=125)),U=N[0]+N[1],U>Z&&(N[0]=Z*N[0]/U,N[1]=Z*N[1]/U),a(N[0]<=u.MAX_BITS_PER_CHANNEL),a(N[1]<=u.MAX_BITS_PER_CHANNEL),a(N[0]+N[1]<=u.MAX_BITS_PER_GRANULE)},this.athAdjust=function(N,X,q){var Z=90.30873362,ne=94.82444863,U=i.FAST_LOG10_X(X,10),F=N*N,C=0;return U-=q,F>1e-20&&(C=1+i.FAST_LOG10_X(F,10/Z)),C<0&&(C=0),U*=C,U+=q+Z-ne,Math.pow(10,.1*U)},this.calc_xmin=function(N,X,q,Z){var ne=0,U=N.internal_flags,F,C=0,P=0,I=U.ATH,H=q.xr,K=N.VBR==t.vbr_mtrh?1:0,he=U.masking_lower;for((N.VBR==t.vbr_mtrh||N.VBR==t.vbr_mt)&&(he=1),F=0;F<q.psy_lmax;F++){var ee,ae,ge,Le,He,De;N.VBR==t.vbr_rh||N.VBR==t.vbr_mtrh?ae=athAdjust(I.adjust,I.l[F],I.floor):ae=I.adjust*I.l[F],He=q.width[F],ge=ae/He,Le=b,De=He>>1,ee=0;do{var Ue,be;Ue=H[C]*H[C],ee+=Ue,Le+=Ue<ge?Ue:ge,C++,be=H[C]*H[C],ee+=be,Le+=be<ge?be:ge,C++}while(--De>0);if(ee>ae&&P++,F==l.SBPSY_l){var Re=ae*U.nsPsy.longfact[F];Le<Re&&(Le=Re)}if(K!=0&&(ae=Le),!N.ATHonly){var Xe=X.en.l[F];if(Xe>0){var Re;Re=ee*X.thm.l[F]*he/Xe,K!=0&&(Re*=U.nsPsy.longfact[F]),ae<Re&&(ae=Re)}}K!=0?Z[ne++]=ae:Z[ne++]=ae*U.nsPsy.longfact[F]}var Ne=575;if(q.block_type!=l.SHORT_TYPE)for(var B=576;B--!=0&&m.EQ(H[B],0);)Ne=B;q.max_nonzero_coeff=Ne;for(var V=q.sfb_smin;F<q.psymax;V++,F+=3){var He,ye,Ae;for(N.VBR==t.vbr_rh||N.VBR==t.vbr_mtrh?Ae=athAdjust(I.adjust,I.s[V],I.floor):Ae=I.adjust*I.s[V],He=q.width[F],ye=0;ye<3;ye++){var ee=0,ae,ge,Le,De=He>>1;ge=Ae/He,Le=b;do{var Ue,be;Ue=H[C]*H[C],ee+=Ue,Le+=Ue<ge?Ue:ge,C++,be=H[C]*H[C],ee+=be,Le+=be<ge?be:ge,C++}while(--De>0);if(ee>Ae&&P++,V==l.SBPSY_s){var Re=Ae*U.nsPsy.shortfact[V];Le<Re&&(Le=Re)}if(K!=0?ae=Le:ae=Ae,!N.ATHonly&&!N.ATHshort){var Xe=X.en.s[V][ye];if(Xe>0){var Re;Re=ee*X.thm.s[V][ye]*he/Xe,K!=0&&(Re*=U.nsPsy.shortfact[V]),ae<Re&&(ae=Re)}}K!=0?Z[ne++]=ae:Z[ne++]=ae*U.nsPsy.shortfact[V]}N.useTemporal&&(Z[ne-3]>Z[ne-3+1]&&(Z[ne-3+1]+=(Z[ne-3]-Z[ne-3+1])*U.decay),Z[ne-3+1]>Z[ne-3+2]&&(Z[ne-3+2]+=(Z[ne-3+1]-Z[ne-3+2])*U.decay))}return P};function w(N){this.s=N}this.calc_noise_core=function(N,X,q,Z){var ne=0,U=X.s,F=N.l3_enc;if(U>N.count1)for(;q--!=0;){var C;C=N.xr[U],U++,ne+=C*C,C=N.xr[U],U++,ne+=C*C}else if(U>N.big_values){var P=s(2);for(P[0]=0,P[1]=Z;q--!=0;){var C;C=Math.abs(N.xr[U])-P[F[U]],U++,ne+=C*C,C=Math.abs(N.xr[U])-P[F[U]],U++,ne+=C*C}}else for(;q--!=0;){var C;C=Math.abs(N.xr[U])-O[F[U]]*Z,U++,ne+=C*C,C=Math.abs(N.xr[U])-O[F[U]]*Z,U++,ne+=C*C}return X.s=U,ne},this.calc_noise=function(N,X,q,Z,ne){var U=0,F=0,C,P,I=0,H=0,K=0,he=-20,ee=0,ae=N.scalefac,ge=0;for(Z.over_SSD=0,C=0;C<N.psymax;C++){var Le=N.global_gain-(ae[ge++]+(N.preflag!=0?M[C]:0)<<N.scalefac_scale+1)-N.subblock_gain[N.window[C]]*8,He=0;if(ne!=null&&ne.step[C]==Le)He=ne.noise[C],ee+=N.width[C],q[U++]=He/X[F++],He=ne.noise_log[C];else{var De=S(Le);if(P=N.width[C]>>1,ee+N.width[C]>N.max_nonzero_coeff){var Ue;Ue=N.max_nonzero_coeff-ee+1,Ue>0?P=Ue>>1:P=0}var be=new w(ee);He=this.calc_noise_core(N,be,P,De),ee=be.s,ne!=null&&(ne.step[C]=Le,ne.noise[C]=He),He=q[U++]=He/X[F++],He=i.FAST_LOG10(Math.max(He,1e-20)),ne!=null&&(ne.noise_log[C]=He)}if(ne!=null&&(ne.global_gain=N.global_gain),K+=He,He>0){var Re;Re=Math.max(0|He*10+.5,1),Z.over_SSD+=Re*Re,I++,H+=He}he=Math.max(he,He)}return Z.over_count=I,Z.tot_noise=K,Z.over_noise=H,Z.max_noise=he,I},this.set_pinfo=function(N,X,q,Z,ne){var U=N.internal_flags,F,C,P,I,H,K=X.scalefac_scale==0?.5:1,he=X.scalefac,ee=s(L3Side.SFBMAX),ae=s(L3Side.SFBMAX),ge=new CalcNoiseResult;calc_xmin(N,q,X,ee),calc_noise(X,ee,ae,ge,null);var Le=0;for(C=X.sfb_lmax,X.block_type!=l.SHORT_TYPE&&X.mixed_block_flag==0&&(C=22),F=0;F<C;F++){var He=U.scalefac_band.l[F],De=U.scalefac_band.l[F+1],Ue=De-He;for(I=0;Le<De;Le++)I+=X.xr[Le]*X.xr[Le];I/=Ue,H=1e15,U.pinfo.en[Z][ne][F]=H*I,U.pinfo.xfsf[Z][ne][F]=H*ee[F]*ae[F]/Ue,q.en.l[F]>0&&!N.ATHonly?I=I/q.en.l[F]:I=0,U.pinfo.thr[Z][ne][F]=H*Math.max(I*q.thm.l[F],U.ATH.l[F]),U.pinfo.LAMEsfb[Z][ne][F]=0,X.preflag!=0&&F>=11&&(U.pinfo.LAMEsfb[Z][ne][F]=-K*M[F]),F<l.SBPSY_l&&(a(he[F]>=0),U.pinfo.LAMEsfb[Z][ne][F]-=K*he[F])}if(X.block_type==l.SHORT_TYPE)for(C=F,F=X.sfb_smin;F<l.SBMAX_s;F++)for(var He=U.scalefac_band.s[F],De=U.scalefac_band.s[F+1],Ue=De-He,be=0;be<3;be++){for(I=0,P=He;P<De;P++)I+=X.xr[Le]*X.xr[Le],Le++;I=Math.max(I/Ue,1e-20),H=1e15,U.pinfo.en_s[Z][ne][3*F+be]=H*I,U.pinfo.xfsf_s[Z][ne][3*F+be]=H*ee[C]*ae[C]/Ue,q.en.s[F][be]>0?I=I/q.en.s[F][be]:I=0,(N.ATHonly||N.ATHshort)&&(I=0),U.pinfo.thr_s[Z][ne][3*F+be]=H*Math.max(I*q.thm.s[F][be],U.ATH.s[F]),U.pinfo.LAMEsfb_s[Z][ne][3*F+be]=-2*X.subblock_gain[be],F<l.SBPSY_s&&(U.pinfo.LAMEsfb_s[Z][ne][3*F+be]-=K*he[C]),C++}U.pinfo.LAMEqss[Z][ne]=X.global_gain,U.pinfo.LAMEmainbits[Z][ne]=X.part2_3_length+X.part2_length,U.pinfo.LAMEsfbits[Z][ne]=X.part2_length,U.pinfo.over[Z][ne]=ge.over_count,U.pinfo.max_noise[Z][ne]=ge.max_noise*10,U.pinfo.over_noise[Z][ne]=ge.over_noise*10,U.pinfo.tot_noise[Z][ne]=ge.tot_noise*10,U.pinfo.over_SSD[Z][ne]=ge.over_SSD}}return zl=f,zl}var Xl,K1;function Q1(){if(K1)return Xl;K1=1;var e=An,n=e.System,t=e.Arrays,r=e.new_int,i=e.assert,s=ir(),o=Gl,a=Hl,l=Z1();function c(){var u=null;this.qupvt=null,this.setModules=function(U){this.qupvt=U,u=U};function f(U){this.bits=0|U}var m=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function g(U,F,C,P,I,H){var K=.5946/F;for(U=U>>1;U--!=0;)I[H++]=K>C[P++]?0:1,I[H++]=K>C[P++]?0:1}function _(U,F,C,P,I,H){U=U>>1;var K=U%2;for(U=U>>1;U--!=0;){var he,ee,ae,ge,Le,He,De,Ue;he=C[P++]*F,ee=C[P++]*F,Le=0|he,ae=C[P++]*F,He=0|ee,ge=C[P++]*F,De=0|ae,he+=u.adj43[Le],Ue=0|ge,ee+=u.adj43[He],I[H++]=0|he,ae+=u.adj43[De],I[H++]=0|ee,ge+=u.adj43[Ue],I[H++]=0|ae,I[H++]=0|ge}if(K!=0){var he,ee,Le,He;he=C[P++]*F,ee=C[P++]*F,Le=0|he,He=0|ee,he+=u.adj43[Le],ee+=u.adj43[He],I[H++]=0|he,I[H++]=0|ee}}function E(U,F,C,P,I){var H,K,he=0,ee,ae=0,ge=0,Le=0,He=F,De=0,Ue=He,be=0,Re=U,Xe=0;for(ee=I!=null&&P.global_gain==I.global_gain,P.block_type==s.SHORT_TYPE?K=38:K=21,H=0;H<=K;H++){var Ne=-1;if((ee||P.block_type==s.NORM_TYPE)&&(Ne=P.global_gain-(P.scalefac[H]+(P.preflag!=0?u.pretab[H]:0)<<P.scalefac_scale+1)-P.subblock_gain[P.window[H]]*8),i(P.width[H]>=0),ee&&I.step[H]==Ne)ae!=0&&(_(ae,C,Re,Xe,Ue,be),ae=0),ge!=0&&(g(ge,C,Re,Xe,Ue,be),ge=0);else{var B=P.width[H];if(he+P.width[H]>P.max_nonzero_coeff){var V;V=P.max_nonzero_coeff-he+1,t.fill(F,P.max_nonzero_coeff,576,0),B=V,B<0&&(B=0),H=K+1}if(ae==0&&ge==0&&(Ue=He,be=De,Re=U,Xe=Le),I!=null&&I.sfb_count1>0&&H>=I.sfb_count1&&I.step[H]>0&&Ne>=I.step[H]?(ae!=0&&(_(ae,C,Re,Xe,Ue,be),ae=0,Ue=He,be=De,Re=U,Xe=Le),ge+=B):(ge!=0&&(g(ge,C,Re,Xe,Ue,be),ge=0,Ue=He,be=De,Re=U,Xe=Le),ae+=B),B<=0){ge!=0&&(g(ge,C,Re,Xe,Ue,be),ge=0),ae!=0&&(_(ae,C,Re,Xe,Ue,be),ae=0);break}}H<=K&&(De+=P.width[H],Le+=P.width[H],he+=P.width[H])}ae!=0&&(_(ae,C,Re,Xe,Ue,be),ae=0),ge!=0&&(g(ge,C,Re,Xe,Ue,be),ge=0)}function S(U,F,C){var P=0,I=0;do{var H=U[F++],K=U[F++];P<H&&(P=H),I<K&&(I=K)}while(F<C);return P<I&&(P=I),P}function b(U,F,C,P,I,H){var K=o.ht[P].xlen*65536+o.ht[I].xlen,he=0,ee;do{var ae=U[F++],ge=U[F++];ae!=0&&(ae>14&&(ae=15,he+=K),ae*=16),ge!=0&&(ge>14&&(ge=15,he+=K),ae+=ge),he+=o.largetbl[ae]}while(F<C);return ee=he&65535,he>>=16,he>ee&&(he=ee,P=I),H.bits+=he,P}function v(U,F,C,P){var I=0,H=o.ht[1].hlen;do{var K=U[F+0]*2+U[F+1];F+=2,I+=H[K]}while(F<C);return P.bits+=I,1}function y(U,F,C,P,I){var H=0,K,he=o.ht[P].xlen,ee;P==2?ee=o.table23:ee=o.table56;do{var ae=U[F+0]*he+U[F+1];F+=2,H+=ee[ae]}while(F<C);return K=H&65535,H>>=16,H>K&&(H=K,P++),I.bits+=H,P}function A(U,F,C,P,I){var H=0,K=0,he=0,ee=o.ht[P].xlen,ae=o.ht[P].hlen,ge=o.ht[P+1].hlen,Le=o.ht[P+2].hlen;do{var He=U[F+0]*ee+U[F+1];F+=2,H+=ae[He],K+=ge[He],he+=Le[He]}while(F<C);var De=P;return H>K&&(H=K,De++),H>he&&(H=he,De=P+2),I.bits+=H,De}var d=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function p(U,F,C,P){var I=S(U,F,C);switch(I){case 0:return I;case 1:return v(U,F,C,P);case 2:case 3:return y(U,F,C,d[I-1],P);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return A(U,F,C,d[I-1],P);default:if(I>l.IXMAX_VAL)return P.bits=l.LARGE_BITS,-1;I-=15;var H;for(H=24;H<32&&!(o.ht[H].linmax>=I);H++);var K;for(K=H-8;K<24&&!(o.ht[K].linmax>=I);K++);return b(U,F,C,K,H,P)}}this.noquant_count_bits=function(U,F,C){var P=F.l3_enc,I=Math.min(576,F.max_nonzero_coeff+2>>1<<1);for(C!=null&&(C.sfb_count1=0);I>1&&!(P[I-1]|P[I-2]);I-=2);F.count1=I;for(var H=0,K=0;I>3;I-=4){var he;if(((P[I-1]|P[I-2]|P[I-3]|P[I-4])&2147483647)>1)break;he=((P[I-4]*2+P[I-3])*2+P[I-2])*2+P[I-1],H+=o.t32l[he],K+=o.t33l[he]}var ee=H;if(F.count1table_select=0,H>K&&(ee=K,F.count1table_select=1),F.count1bits=ee,F.big_values=I,I==0)return ee;if(F.block_type==s.SHORT_TYPE)H=3*U.scalefac_band.s[3],H>F.big_values&&(H=F.big_values),K=F.big_values;else if(F.block_type==s.NORM_TYPE){if(H=F.region0_count=U.bv_scf[I-2],K=F.region1_count=U.bv_scf[I-1],i(H+K+2<s.SBPSY_l),K=U.scalefac_band.l[H+K+2],H=U.scalefac_band.l[H+1],K<I){var ae=new f(ee);F.table_select[2]=p(P,K,I,ae),ee=ae.bits}}else F.region0_count=7,F.region1_count=s.SBMAX_l-1-7-1,H=U.scalefac_band.l[8],K=I,H>K&&(H=K);if(H=Math.min(H,I),K=Math.min(K,I),0<H){var ae=new f(ee);F.table_select[0]=p(P,0,H,ae),ee=ae.bits}if(H<K){var ae=new f(ee);F.table_select[1]=p(P,H,K,ae),ee=ae.bits}if(U.use_best_huffman==2&&(F.part2_3_length=ee,best_huffman_divide(U,F),ee=F.part2_3_length),C!=null&&F.block_type==s.NORM_TYPE){for(var ge=0;U.scalefac_band.l[ge]<F.big_values;)ge++;C.sfb_count1=ge}return ee},this.count_bits=function(U,F,C,P){var I=C.l3_enc,H=l.IXMAX_VAL/u.IPOW20(C.global_gain);if(C.xrpow_max>H)return l.LARGE_BITS;if(E(F,I,u.IPOW20(C.global_gain),C,P),U.substep_shaping&2)for(var K=0,he=C.global_gain+C.scalefac_scale,ee=.634521682242439/u.IPOW20(he),ae=0;ae<C.sfbmax;ae++){var ge=C.width[ae];if(U.pseudohalf[ae]==0)K+=ge;else{var Le;for(Le=K,K+=ge;Le<K;++Le)I[Le]=F[Le]>=ee?I[Le]:0}}return this.noquant_count_bits(U,C,P)};function M(U,F,C,P,I,H,K){for(var he=F.big_values,ee=0;ee<=22;ee++)P[ee]=l.LARGE_BITS;for(var ee=0;ee<16;ee++){var ae=U.scalefac_band.l[ee+1];if(ae>=he)break;var ge=0,Le=new f(ge),He=p(C,0,ae,Le);ge=Le.bits;for(var De=0;De<8;De++){var Ue=U.scalefac_band.l[ee+De+2];if(Ue>=he)break;var be=ge;Le=new f(be);var Re=p(C,ae,Ue,Le);be=Le.bits,P[ee+De]>be&&(P[ee+De]=be,I[ee+De]=ee,H[ee+De]=He,K[ee+De]=Re)}}}function L(U,F,C,P,I,H,K,he){for(var ee=F.big_values,ae=2;ae<s.SBMAX_l+1;ae++){var ge=U.scalefac_band.l[ae];if(ge>=ee)break;var Le=I[ae-2]+F.count1bits;if(C.part2_3_length<=Le)break;var He=new f(Le),De=p(P,ge,ee,He);Le=He.bits,!(C.part2_3_length<=Le)&&(C.assign(F),C.part2_3_length=Le,C.region0_count=H[ae-2],C.region1_count=ae-2-H[ae-2],C.table_select[0]=K[ae-2],C.table_select[1]=he[ae-2],C.table_select[2]=De)}}this.best_huffman_divide=function(U,F){var C=new a,P=F.l3_enc,I=r(23),H=r(23),K=r(23),he=r(23);if(!(F.block_type==s.SHORT_TYPE&&U.mode_gr==1)){C.assign(F),F.block_type==s.NORM_TYPE&&(M(U,F,P,I,H,K,he),L(U,C,F,P,I,H,K,he));var ee=C.big_values;if(!(ee==0||(P[ee-2]|P[ee-1])>1)&&(ee=F.count1+2,!(ee>576))){C.assign(F),C.count1=ee;for(var ae=0,ge=0;ee>C.big_values;ee-=4){var Le=((P[ee-4]*2+P[ee-3])*2+P[ee-2])*2+P[ee-1];ae+=o.t32l[Le],ge+=o.t33l[Le]}if(C.big_values=ee,C.count1table_select=0,ae>ge&&(ae=ge,C.count1table_select=1),C.count1bits=ae,C.block_type==s.NORM_TYPE)L(U,C,F,P,I,H,K,he);else{if(C.part2_3_length=ae,ae=U.scalefac_band.l[8],ae>ee&&(ae=ee),ae>0){var He=new f(C.part2_3_length);C.table_select[0]=p(P,0,ae,He),C.part2_3_length=He.bits}if(ee>ae){var He=new f(C.part2_3_length);C.table_select[1]=p(P,ae,ee,He),C.part2_3_length=He.bits}F.part2_3_length>C.part2_3_length&&F.assign(C)}}}};var D=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],O=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],x=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],Y=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];c.slen1_tab=x,c.slen2_tab=Y;function R(U,F){for(var C,P=F.tt[1][U],I=F.tt[0][U],H=0;H<o.scfsi_band.length-1;H++){for(C=o.scfsi_band[H];C<o.scfsi_band[H+1]&&!(I.scalefac[C]!=P.scalefac[C]&&P.scalefac[C]>=0);C++);if(C==o.scfsi_band[H+1]){for(C=o.scfsi_band[H];C<o.scfsi_band[H+1];C++)P.scalefac[C]=-1;F.scfsi[U][H]=1}}var K=0,he=0;for(C=0;C<11;C++)P.scalefac[C]!=-1&&(he++,K<P.scalefac[C]&&(K=P.scalefac[C]));for(var ee=0,ae=0;C<s.SBPSY_l;C++)P.scalefac[C]!=-1&&(ae++,ee<P.scalefac[C]&&(ee=P.scalefac[C]));for(var H=0;H<16;H++)if(K<D[H]&&ee<O[H]){var ge=x[H]*he+Y[H]*ae;P.part2_length>ge&&(P.part2_length=ge,P.scalefac_compress=H)}}this.best_scalefac_store=function(U,F,C,P){var I=P.tt[F][C],H,K,he,ee,ae=0;for(he=0,H=0;H<I.sfbmax;H++){var ge=I.width[H];for(he+=ge,ee=-ge;ee<0&&I.l3_enc[ee+he]==0;ee++);ee==0&&(I.scalefac[H]=ae=-2)}if(I.scalefac_scale==0&&I.preflag==0){var Le=0;for(H=0;H<I.sfbmax;H++)I.scalefac[H]>0&&(Le|=I.scalefac[H]);if(!(Le&1)&&Le!=0){for(H=0;H<I.sfbmax;H++)I.scalefac[H]>0&&(I.scalefac[H]>>=1);I.scalefac_scale=ae=1}}if(I.preflag==0&&I.block_type!=s.SHORT_TYPE&&U.mode_gr==2){for(H=11;H<s.SBPSY_l&&!(I.scalefac[H]<u.pretab[H]&&I.scalefac[H]!=-2);H++);if(H==s.SBPSY_l){for(H=11;H<s.SBPSY_l;H++)I.scalefac[H]>0&&(I.scalefac[H]-=u.pretab[H]);I.preflag=ae=1}}for(K=0;K<4;K++)P.scfsi[C][K]=0;for(U.mode_gr==2&&F==1&&P.tt[0][C].block_type!=s.SHORT_TYPE&&P.tt[1][C].block_type!=s.SHORT_TYPE&&(R(C,P),ae=0),H=0;H<I.sfbmax;H++)I.scalefac[H]==-2&&(I.scalefac[H]=0);ae!=0&&(U.mode_gr==2?this.scale_bitcount(I):this.scale_bitcount_lsf(U,I))};function w(U,F){for(var C=0;C<F;++C)if(U[C]<0)return!1;return!0}var N=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],X=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],q=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(U){var F,C,P=0,I=0,H,K=U.scalefac;if(i(w(K,U.sfbmax)),U.block_type==s.SHORT_TYPE)H=N,U.mixed_block_flag!=0&&(H=X);else if(H=q,U.preflag==0){for(C=11;C<s.SBPSY_l&&!(K[C]<u.pretab[C]);C++);if(C==s.SBPSY_l)for(U.preflag=1,C=11;C<s.SBPSY_l;C++)K[C]-=u.pretab[C]}for(C=0;C<U.sfbdivide;C++)P<K[C]&&(P=K[C]);for(;C<U.sfbmax;C++)I<K[C]&&(I=K[C]);for(U.part2_length=l.LARGE_BITS,F=0;F<16;F++)P<D[F]&&I<O[F]&&U.part2_length>H[F]&&(U.part2_length=H[F],U.scalefac_compress=F);return U.part2_length==l.LARGE_BITS};var Z=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(U,F){var C,P,I,H,K,he,ee,ae,ge=r(4),Le=F.scalefac;for(F.preflag!=0?C=2:C=0,ee=0;ee<4;ee++)ge[ee]=0;if(F.block_type==s.SHORT_TYPE){P=1;var He=u.nr_of_sfb_block[C][P];for(ae=0,I=0;I<4;I++)for(H=He[I]/3,ee=0;ee<H;ee++,ae++)for(K=0;K<3;K++)Le[ae*3+K]>ge[I]&&(ge[I]=Le[ae*3+K])}else{P=0;var He=u.nr_of_sfb_block[C][P];for(ae=0,I=0;I<4;I++)for(H=He[I],ee=0;ee<H;ee++,ae++)Le[ae]>ge[I]&&(ge[I]=Le[ae])}for(he=!1,I=0;I<4;I++)ge[I]>Z[C][I]&&(he=!0);if(!he){var De,Ue,be,Re;for(F.sfb_partition_table=u.nr_of_sfb_block[C][P],I=0;I<4;I++)F.slen[I]=ne[ge[I]];switch(De=F.slen[0],Ue=F.slen[1],be=F.slen[2],Re=F.slen[3],C){case 0:F.scalefac_compress=(De*5+Ue<<4)+(be<<2)+Re;break;case 1:F.scalefac_compress=400+(De*5+Ue<<2)+be;break;case 2:F.scalefac_compress=500+De*3+Ue;break;default:n.err.printf(`intensity stereo not implemented yet
`);break}}if(!he)for(i(F.sfb_partition_table!=null),F.part2_length=0,I=0;I<4;I++)F.part2_length+=F.slen[I]*F.sfb_partition_table[I];return he};var ne=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(U){for(var F=2;F<=576;F+=2){for(var C=0,P;U.scalefac_band.l[++C]<F;);for(P=m[C][0];U.scalefac_band.l[P+1]>F;)P--;for(P<0&&(P=m[C][0]),U.bv_scf[F-2]=P,P=m[C][1];U.scalefac_band.l[P+U.bv_scf[F-2]+2]>F;)P--;P<0&&(P=m[C][1]),U.bv_scf[F-1]=P}}}return Xl=c,Xl}var Yl,J1;function ql(){if(J1)return Yl;J1=1;var e=An,n=e.System,t=e.Arrays,r=e.new_byte,i=e.new_float_n,s=e.new_int,o=e.assert,a=Q1(),l=Gl,c=ir(),u=ya;f.EQ=function(m,g){return Math.abs(m)>Math.abs(g)?Math.abs(m-g)<=Math.abs(m)*1e-6:Math.abs(m-g)<=Math.abs(g)*1e-6},f.NEQ=function(m,g){return!f.EQ(m,g)};function f(){var m=Kl(),g=this,_=32773,E=null,S=null,b=null,v=null;this.setModules=function(F,C,P,I){E=F,S=C,b=P,v=I};var y=null,A=0,d=0,p=0;this.getframebits=function(F){var C=F.internal_flags,P;C.bitrate_index!=0?P=l.bitrate_table[F.version][C.bitrate_index]:P=F.brate;var I=0|(F.version+1)*72e3*P/F.out_samplerate+C.padding;return 8*I};function M(F){n.arraycopy(F.header[F.w_ptr].buf,0,y,d,F.sideinfo_len),d+=F.sideinfo_len,A+=F.sideinfo_len*8,F.w_ptr=F.w_ptr+1&u.MAX_HEADER_BUF-1}function L(F,C,P){for(;P>0;){var I;p==0&&(p=8,d++,o(d<m.LAME_MAXMP3BUFFER),o(F.header[F.w_ptr].write_timing>=A),F.header[F.w_ptr].write_timing==A&&M(F),y[d]=0),I=Math.min(P,p),P-=I,p-=I,y[d]|=C>>P<<p,A+=I}}function D(F,C,P){for(;P>0;){var I;p==0&&(p=8,d++,o(d<m.LAME_MAXMP3BUFFER),y[d]=0),I=Math.min(P,p),P-=I,p-=I,y[d]|=C>>P<<p,A+=I}}function O(F,C){var P=F.internal_flags,I;if(C>=8&&(L(P,76,8),C-=8),C>=8&&(L(P,65,8),C-=8),C>=8&&(L(P,77,8),C-=8),C>=8&&(L(P,69,8),C-=8),C>=32){var H=b.getLameShortVersion();if(C>=32)for(I=0;I<H.length&&C>=8;++I)C-=8,L(P,H.charAt(I),8)}for(;C>=1;C-=1)L(P,P.ancillary_flag,1),P.ancillary_flag^=F.disable_reservoir?0:1}function x(F,C,P){for(var I=F.header[F.h_ptr].ptr;P>0;){var H=Math.min(P,8-(I&7));P-=H,F.header[F.h_ptr].buf[I>>3]|=C>>P<<8-(I&7)-H,I+=H}F.header[F.h_ptr].ptr=I}function Y(F,C){F<<=8;for(var P=0;P<8;P++)F<<=1,C<<=1,(C^F)&65536&&(C^=_);return C}this.CRC_writeheader=function(F,C){var P=65535;P=Y(C[2]&255,P),P=Y(C[3]&255,P);for(var I=6;I<F.sideinfo_len;I++)P=Y(C[I]&255,P);C[4]=byte(P>>8),C[5]=byte(P&255)};function R(F,C){var P=F.internal_flags,I,H,K;if(I=P.l3_side,P.header[P.h_ptr].ptr=0,t.fill(P.header[P.h_ptr].buf,0,P.sideinfo_len,0),F.out_samplerate<16e3?x(P,4094,12):x(P,4095,12),x(P,F.version,1),x(P,1,2),x(P,F.error_protection?0:1,1),x(P,P.bitrate_index,4),x(P,P.samplerate_index,2),x(P,P.padding,1),x(P,F.extension,1),x(P,F.mode.ordinal(),2),x(P,P.mode_ext,2),x(P,F.copyright,1),x(P,F.original,1),x(P,F.emphasis,2),F.error_protection&&x(P,0,16),F.version==1){for(o(I.main_data_begin>=0),x(P,I.main_data_begin,9),P.channels_out==2?x(P,I.private_bits,3):x(P,I.private_bits,5),K=0;K<P.channels_out;K++){var he;for(he=0;he<4;he++)x(P,I.scfsi[K][he],1)}for(H=0;H<2;H++)for(K=0;K<P.channels_out;K++){var ee=I.tt[H][K];x(P,ee.part2_3_length+ee.part2_length,12),x(P,ee.big_values/2,9),x(P,ee.global_gain,8),x(P,ee.scalefac_compress,4),ee.block_type!=c.NORM_TYPE?(x(P,1,1),x(P,ee.block_type,2),x(P,ee.mixed_block_flag,1),ee.table_select[0]==14&&(ee.table_select[0]=16),x(P,ee.table_select[0],5),ee.table_select[1]==14&&(ee.table_select[1]=16),x(P,ee.table_select[1],5),x(P,ee.subblock_gain[0],3),x(P,ee.subblock_gain[1],3),x(P,ee.subblock_gain[2],3)):(x(P,0,1),ee.table_select[0]==14&&(ee.table_select[0]=16),x(P,ee.table_select[0],5),ee.table_select[1]==14&&(ee.table_select[1]=16),x(P,ee.table_select[1],5),ee.table_select[2]==14&&(ee.table_select[2]=16),x(P,ee.table_select[2],5),o(0<=ee.region0_count&&ee.region0_count<16),o(0<=ee.region1_count&&ee.region1_count<8),x(P,ee.region0_count,4),x(P,ee.region1_count,3)),x(P,ee.preflag,1),x(P,ee.scalefac_scale,1),x(P,ee.count1table_select,1)}}else for(o(I.main_data_begin>=0),x(P,I.main_data_begin,8),x(P,I.private_bits,P.channels_out),H=0,K=0;K<P.channels_out;K++){var ee=I.tt[H][K];x(P,ee.part2_3_length+ee.part2_length,12),x(P,ee.big_values/2,9),x(P,ee.global_gain,8),x(P,ee.scalefac_compress,9),ee.block_type!=c.NORM_TYPE?(x(P,1,1),x(P,ee.block_type,2),x(P,ee.mixed_block_flag,1),ee.table_select[0]==14&&(ee.table_select[0]=16),x(P,ee.table_select[0],5),ee.table_select[1]==14&&(ee.table_select[1]=16),x(P,ee.table_select[1],5),x(P,ee.subblock_gain[0],3),x(P,ee.subblock_gain[1],3),x(P,ee.subblock_gain[2],3)):(x(P,0,1),ee.table_select[0]==14&&(ee.table_select[0]=16),x(P,ee.table_select[0],5),ee.table_select[1]==14&&(ee.table_select[1]=16),x(P,ee.table_select[1],5),ee.table_select[2]==14&&(ee.table_select[2]=16),x(P,ee.table_select[2],5),o(0<=ee.region0_count&&ee.region0_count<16),o(0<=ee.region1_count&&ee.region1_count<8),x(P,ee.region0_count,4),x(P,ee.region1_count,3)),x(P,ee.scalefac_scale,1),x(P,ee.count1table_select,1)}F.error_protection&&CRC_writeheader(P,P.header[P.h_ptr].buf);{var ae=P.h_ptr;o(P.header[ae].ptr==P.sideinfo_len*8),P.h_ptr=ae+1&u.MAX_HEADER_BUF-1,P.header[P.h_ptr].write_timing=P.header[ae].write_timing+C,P.h_ptr==P.w_ptr&&n.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function w(F,C){var P=l.ht[C.count1table_select+32],I,H=0,K=C.big_values,he=C.big_values;for(o(C.count1table_select<2),I=(C.count1-C.big_values)/4;I>0;--I){var ee=0,ae=0,ge;ge=C.l3_enc[K+0],ge!=0&&(ae+=8,C.xr[he+0]<0&&ee++),ge=C.l3_enc[K+1],ge!=0&&(ae+=4,ee*=2,C.xr[he+1]<0&&ee++),ge=C.l3_enc[K+2],ge!=0&&(ae+=2,ee*=2,C.xr[he+2]<0&&ee++),ge=C.l3_enc[K+3],ge!=0&&(ae++,ee*=2,C.xr[he+3]<0&&ee++),K+=4,he+=4,L(F,ee+P.table[ae],P.hlen[ae]),H+=P.hlen[ae]}return H}function N(F,C,P,I,H){var K=l.ht[C],he=0;if(C==0)return he;for(var ee=P;ee<I;ee+=2){var ae=0,ge=0,Le=K.xlen,He=K.xlen,De=0,Ue=H.l3_enc[ee],be=H.l3_enc[ee+1];if(Ue!=0&&(H.xr[ee]<0&&De++,ae--),C>15){if(Ue>14){var Re=Ue-15;o(Re<=K.linmax),De|=Re<<1,ge=Le,Ue=15}if(be>14){var Xe=be-15;o(Xe<=K.linmax),De<<=Le,De|=Xe,ge+=Le,be=15}He=16}be!=0&&(De<<=1,H.xr[ee+1]<0&&De++,ae--),Ue=Ue*He+be,ge-=ae,ae+=K.hlen[Ue],L(F,K.table[Ue],ae),L(F,De,ge),he+=ae+ge}return he}function X(F,C){var P=3*F.scalefac_band.s[3];P>C.big_values&&(P=C.big_values);var I=N(F,C.table_select[0],0,P,C);return I+=N(F,C.table_select[1],P,C.big_values,C),I}function q(F,C){var P,I,H,K;P=C.big_values;var he=C.region0_count+1;return o(he<F.scalefac_band.l.length),H=F.scalefac_band.l[he],he+=C.region1_count+1,o(he<F.scalefac_band.l.length),K=F.scalefac_band.l[he],H>P&&(H=P),K>P&&(K=P),I=N(F,C.table_select[0],0,H,C),I+=N(F,C.table_select[1],H,K,C),I+=N(F,C.table_select[2],K,P,C),I}function Z(F){var C,P,I,H,K=0,he=F.internal_flags,ee=he.l3_side;if(F.version==1)for(C=0;C<2;C++)for(P=0;P<he.channels_out;P++){var ae=ee.tt[C][P],ge=a.slen1_tab[ae.scalefac_compress],Le=a.slen2_tab[ae.scalefac_compress];for(H=0,I=0;I<ae.sfbdivide;I++)ae.scalefac[I]!=-1&&(L(he,ae.scalefac[I],ge),H+=ge);for(;I<ae.sfbmax;I++)ae.scalefac[I]!=-1&&(L(he,ae.scalefac[I],Le),H+=Le);o(H==ae.part2_length),ae.block_type==c.SHORT_TYPE?H+=X(he,ae):H+=q(he,ae),H+=w(he,ae),o(H==ae.part2_3_length+ae.part2_length),K+=H}else for(C=0,P=0;P<he.channels_out;P++){var ae=ee.tt[C][P],He,De,Ue=0;if(o(ae.sfb_partition_table!=null),H=0,I=0,De=0,ae.block_type==c.SHORT_TYPE){for(;De<4;De++){var be=ae.sfb_partition_table[De]/3,Re=ae.slen[De];for(He=0;He<be;He++,I++)L(he,Math.max(ae.scalefac[I*3+0],0),Re),L(he,Math.max(ae.scalefac[I*3+1],0),Re),L(he,Math.max(ae.scalefac[I*3+2],0),Re),Ue+=3*Re}H+=X(he,ae)}else{for(;De<4;De++){var be=ae.sfb_partition_table[De],Re=ae.slen[De];for(He=0;He<be;He++,I++)L(he,Math.max(ae.scalefac[I],0),Re),Ue+=Re}H+=q(he,ae)}H+=w(he,ae),o(H==ae.part2_3_length),o(Ue==ae.part2_length),K+=Ue+H}return K}function ne(){this.total=0}function U(F,C){var P=F.internal_flags,I,H,K,he,ee;return ee=P.w_ptr,he=P.h_ptr-1,he==-1&&(he=u.MAX_HEADER_BUF-1),I=P.header[he].write_timing-A,C.total=I,I>=0&&(H=1+he-ee,he<ee&&(H=1+he-ee+u.MAX_HEADER_BUF),I-=H*8*P.sideinfo_len),K=g.getframebits(F),I+=K,C.total+=K,C.total%8!=0?C.total=1+C.total/8:C.total=C.total/8,C.total+=d+1,I<0&&n.err.println(`strange error flushing buffer ... 
`),I}this.flush_bitstream=function(F){var C=F.internal_flags,P,I,H=C.h_ptr-1;if(H==-1&&(H=u.MAX_HEADER_BUF-1),P=C.l3_side,!((I=U(F,new ne))<0)){if(O(F,I),o(C.header[H].write_timing+this.getframebits(F)==A),C.ResvSize=0,P.main_data_begin=0,C.findReplayGain){var K=E.GetTitleGain(C.rgdata);o(NEQ(K,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),C.RadioGain=Math.floor(K*10+.5)|0}C.findPeakSample&&(C.noclipGainChange=Math.ceil(Math.log10(C.PeakSample/32767)*20*10)|0,C.noclipGainChange>0&&(EQ(F.scale,1)||EQ(F.scale,0))?C.noclipScale=Math.floor(32767/C.PeakSample*100)/100:C.noclipScale=-1)}},this.add_dummy_byte=function(F,C,P){for(var I=F.internal_flags,H;P-- >0;)for(D(I,C,8),H=0;H<u.MAX_HEADER_BUF;++H)I.header[H].write_timing+=8},this.format_bitstream=function(F){var C=F.internal_flags,P;P=C.l3_side;var I=this.getframebits(F);O(F,P.resvDrain_pre),R(F,I);var H=8*C.sideinfo_len;if(H+=Z(F),O(F,P.resvDrain_post),H+=P.resvDrain_post,P.main_data_begin+=(I-H)/8,U(F,new ne)!=C.ResvSize&&n.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),P.main_data_begin*8!=C.ResvSize&&(n.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*P.main_data_begin,C.ResvSize,P.resvDrain_post,P.resvDrain_pre,8*C.sideinfo_len,H-P.resvDrain_post-8*C.sideinfo_len,H,H%8,I),n.err.println("This is a fatal error.  It has several possible causes:"),n.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),n.err.println(" 9%%  Your system is overclocked"),n.err.println(" 1%%  bug in LAME encoding library"),C.ResvSize=P.main_data_begin*8),A>1e9){var K;for(K=0;K<u.MAX_HEADER_BUF;++K)C.header[K].write_timing-=A;A=0}return 0},this.copy_buffer=function(F,C,P,I,H){var K=d+1;if(K<=0)return 0;if(I!=0&&K>I)return-1;if(n.arraycopy(y,0,C,P,K),d=-1,p=0,H!=0){var he=s(1);if(he[0]=F.nMusicCRC,v.updateMusicCRC(he,C,P,K),F.nMusicCRC=he[0],K>0&&(F.VBR_seek_table.nBytesWritten+=K),F.decode_on_the_fly){for(var ee=i([2,1152]),ae=K,ge=-1,Le;ge!=0;)if(ge=S.hip_decode1_unclipped(F.hip,C,P,ae,ee[0],ee[1]),ae=0,ge==-1&&(ge=0),ge>0){if(F.findPeakSample){for(Le=0;Le<ge;Le++)ee[0][Le]>F.PeakSample?F.PeakSample=ee[0][Le]:-ee[0][Le]>F.PeakSample&&(F.PeakSample=-ee[0][Le]);if(F.channels_out>1)for(Le=0;Le<ge;Le++)ee[1][Le]>F.PeakSample?F.PeakSample=ee[1][Le]:-ee[1][Le]>F.PeakSample&&(F.PeakSample=-ee[1][Le])}if(F.findReplayGain&&E.AnalyzeSamples(F.rgdata,ee[0],0,ee[1],0,ge,F.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return K},this.init_bit_stream_w=function(F){y=r(m.LAME_MAXMP3BUFFER),F.h_ptr=F.w_ptr=0,F.header[F.h_ptr].write_timing=0,d=-1,p=0,A=0}}return Yl=f,Yl}var Zl,ef;function Kl(){if(ef)return Zl;ef=1;var e=An,n=e.System,t=e.VbrMode,r=e.ShortBlock,i=e.new_float,s=e.new_int_n,o=e.new_short_n,a=e.assert,l=j2,c=X2,u=ya,f=gm,m=wm,g=Am,_=ql(),E=Gl,S=ir();function b(){var v=ko,y=this,A=128*1024;b.V9=410,b.V8=420,b.V7=430,b.V6=440,b.V5=450,b.V4=460,b.V3=470,b.V2=480,b.V1=490,b.V0=500,b.R3MIX=1e3,b.STANDARD=1001,b.EXTREME=1002,b.INSANE=1003,b.STANDARD_FAST=1004,b.EXTREME_FAST=1005,b.MEDIUM=1006,b.MEDIUM_FAST=1007;var d=16384+A;b.LAME_MAXMP3BUFFER=d;var p,M,L,D,O,x=new l,Y,R,w;this.enc=new S,this.setModules=function(B,V,ye,Ae,Ke,et,Je,ze,ut){p=B,M=V,L=ye,D=Ae,O=Ke,Y=et,R=ze,w=ut,this.enc.setModules(M,x,D,Y)};function N(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=i(S.SBMAX_l),this.bo_s_weight=i(S.SBMAX_s)}function X(){this.lowerlimit=0}function q(B,V){this.lowpass=V}var Z=4294479419;function ne(B){var V;return B.class_id=Z,V=B.internal_flags=new u,B.mode=v.NOT_SET,B.original=1,B.in_samplerate=44100,B.num_channels=2,B.num_samples=-1,B.bWriteVbrTag=!0,B.quality=-1,B.short_blocks=null,V.subblock_gain=-1,B.lowpassfreq=0,B.highpassfreq=0,B.lowpasswidth=-1,B.highpasswidth=-1,B.VBR=t.vbr_off,B.VBR_q=4,B.ATHcurve=-1,B.VBR_mean_bitrate_kbps=128,B.VBR_min_bitrate_kbps=0,B.VBR_max_bitrate_kbps=0,B.VBR_hard_min=0,V.VBR_min_bitrate=1,V.VBR_max_bitrate=13,B.quant_comp=-1,B.quant_comp_short=-1,B.msfix=-1,V.resample_ratio=1,V.OldValue[0]=180,V.OldValue[1]=180,V.CurrentStep[0]=4,V.CurrentStep[1]=4,V.masking_lower=1,V.nsPsy.attackthre=-1,V.nsPsy.attackthre_s=-1,B.scale=-1,B.athaa_type=-1,B.ATHtype=-1,B.athaa_loudapprox=-1,B.athaa_sensitivity=0,B.useTemporal=null,B.interChRatio=-1,V.mf_samples_to_encode=S.ENCDELAY+S.POSTDELAY,B.encoder_padding=0,V.mf_size=S.ENCDELAY-S.MDCTDELAY,B.findReplayGain=!1,B.decode_on_the_fly=!1,V.decode_on_the_fly=!1,V.findReplayGain=!1,V.findPeakSample=!1,V.RadioGain=0,V.AudiophileGain=0,V.noclipGainChange=0,V.noclipScale=-1,B.preset=0,B.write_id3tag_automatic=!0,0}this.lame_init=function(){var B=new c;return ne(B),B.lame_allocated_gfp=1,B};function U(B){return B>1?0:B<=0?1:Math.cos(Math.PI/2*B)}this.nearestBitrateFullIndex=function(B){var V=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],ye=0,Ae=0,Ke=0,et=0;et=V[16],Ke=16,Ae=V[16],ye=16;for(var Je=0;Je<16;Je++)if(Math.max(B,V[Je+1])!=B){et=V[Je+1],Ke=Je+1,Ae=V[Je],ye=Je;break}return et-B>B-Ae?ye:Ke};function F(B,V){var ye=44100;return V>=48e3?ye=48e3:V>=44100?ye=44100:V>=32e3?ye=32e3:V>=24e3?ye=24e3:V>=22050?ye=22050:V>=16e3?ye=16e3:V>=12e3?ye=12e3:V>=11025?ye=11025:V>=8e3&&(ye=8e3),B==-1?ye:(B<=15960&&(ye=44100),B<=15250&&(ye=32e3),B<=11220&&(ye=24e3),B<=9970&&(ye=22050),B<=7230&&(ye=16e3),B<=5420&&(ye=12e3),B<=4510&&(ye=11025),B<=3970&&(ye=8e3),V<ye?V>44100?48e3:V>32e3?44100:V>24e3?32e3:V>22050?24e3:V>16e3?22050:V>12e3?16e3:V>11025?12e3:V>8e3?11025:8e3:ye)}function C(B,V){switch(B){case 44100:return V.version=1,0;case 48e3:return V.version=1,1;case 32e3:return V.version=1,2;case 22050:return V.version=0,0;case 24e3:return V.version=0,1;case 16e3:return V.version=0,2;case 11025:return V.version=0,0;case 12e3:return V.version=0,1;case 8e3:return V.version=0,2;default:return V.version=0,-1}}function P(B,V,ye){ye<16e3&&(V=2);for(var Ae=E.bitrate_table[V][1],Ke=2;Ke<=14;Ke++)E.bitrate_table[V][Ke]>0&&Math.abs(E.bitrate_table[V][Ke]-B)<Math.abs(Ae-B)&&(Ae=E.bitrate_table[V][Ke]);return Ae}function I(B,V,ye){ye<16e3&&(V=2);for(var Ae=0;Ae<=14;Ae++)if(E.bitrate_table[V][Ae]>0&&E.bitrate_table[V][Ae]==B)return Ae;return-1}function H(B,V){var ye=[new q(8,2e3),new q(16,3700),new q(24,3900),new q(32,5500),new q(40,7e3),new q(48,7500),new q(56,1e4),new q(64,11e3),new q(80,13500),new q(96,15100),new q(112,15600),new q(128,17e3),new q(160,17500),new q(192,18600),new q(224,19400),new q(256,19700),new q(320,20500)],Ae=y.nearestBitrateFullIndex(V);B.lowerlimit=ye[Ae].lowpass}function K(B){var V=B.internal_flags,ye=32,Ae=-1;if(V.lowpass1>0){for(var Ke=999,et=0;et<=31;et++){var Je=et/31;Je>=V.lowpass2&&(ye=Math.min(ye,et)),V.lowpass1<Je&&Je<V.lowpass2&&(Ke=Math.min(Ke,et))}Ke==999?V.lowpass1=(ye-.75)/31:V.lowpass1=(Ke-.75)/31,V.lowpass2=ye/31}if(V.highpass2>0&&V.highpass2<.9*(.75/31)&&(V.highpass1=0,V.highpass2=0,n.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),V.highpass2>0){for(var ze=-1,et=0;et<=31;et++){var Je=et/31;Je<=V.highpass1&&(Ae=Math.max(Ae,et)),V.highpass1<Je&&Je<V.highpass2&&(ze=Math.max(ze,et))}V.highpass1=Ae/31,ze==-1?V.highpass2=(Ae+.75)/31:V.highpass2=(ze+.75)/31}for(var et=0;et<32;et++){var ut,nt,Je=et/31;V.highpass2>V.highpass1?ut=U((V.highpass2-Je)/(V.highpass2-V.highpass1+1e-20)):ut=1,V.lowpass2>V.lowpass1?nt=U((Je-V.lowpass1)/(V.lowpass2-V.lowpass1+1e-20)):nt=1,V.amp_filter[et]=ut*nt}}function he(B){var V=B.internal_flags;switch(B.quality){default:case 9:V.psymodel=0,V.noise_shaping=0,V.noise_shaping_amp=0,V.noise_shaping_stop=0,V.use_best_huffman=0,V.full_outer_loop=0;break;case 8:B.quality=7;case 7:V.psymodel=1,V.noise_shaping=0,V.noise_shaping_amp=0,V.noise_shaping_stop=0,V.use_best_huffman=0,V.full_outer_loop=0;break;case 6:V.psymodel=1,V.noise_shaping==0&&(V.noise_shaping=1),V.noise_shaping_amp=0,V.noise_shaping_stop=0,V.subblock_gain==-1&&(V.subblock_gain=1),V.use_best_huffman=0,V.full_outer_loop=0;break;case 5:V.psymodel=1,V.noise_shaping==0&&(V.noise_shaping=1),V.noise_shaping_amp=0,V.noise_shaping_stop=0,V.subblock_gain==-1&&(V.subblock_gain=1),V.use_best_huffman=0,V.full_outer_loop=0;break;case 4:V.psymodel=1,V.noise_shaping==0&&(V.noise_shaping=1),V.noise_shaping_amp=0,V.noise_shaping_stop=0,V.subblock_gain==-1&&(V.subblock_gain=1),V.use_best_huffman=1,V.full_outer_loop=0;break;case 3:V.psymodel=1,V.noise_shaping==0&&(V.noise_shaping=1),V.noise_shaping_amp=1,V.noise_shaping_stop=1,V.subblock_gain==-1&&(V.subblock_gain=1),V.use_best_huffman=1,V.full_outer_loop=0;break;case 2:V.psymodel=1,V.noise_shaping==0&&(V.noise_shaping=1),V.substep_shaping==0&&(V.substep_shaping=2),V.noise_shaping_amp=1,V.noise_shaping_stop=1,V.subblock_gain==-1&&(V.subblock_gain=1),V.use_best_huffman=1,V.full_outer_loop=0;break;case 1:V.psymodel=1,V.noise_shaping==0&&(V.noise_shaping=1),V.substep_shaping==0&&(V.substep_shaping=2),V.noise_shaping_amp=2,V.noise_shaping_stop=1,V.subblock_gain==-1&&(V.subblock_gain=1),V.use_best_huffman=1,V.full_outer_loop=0;break;case 0:V.psymodel=1,V.noise_shaping==0&&(V.noise_shaping=1),V.substep_shaping==0&&(V.substep_shaping=2),V.noise_shaping_amp=2,V.noise_shaping_stop=1,V.subblock_gain==-1&&(V.subblock_gain=1),V.use_best_huffman=1,V.full_outer_loop=0;break}}function ee(B){var V=B.internal_flags;B.frameNum=0,B.write_id3tag_automatic&&R.id3tag_write_v2(B),V.bitrate_stereoMode_Hist=s([16,5]),V.bitrate_blockType_Hist=s([16,6]),V.PeakSample=0,B.bWriteVbrTag&&Y.InitVbrTag(B)}this.lame_init_params=function(B){var V=B.internal_flags;if(V.Class_ID=0,V.ATH==null&&(V.ATH=new f),V.PSY==null&&(V.PSY=new N),V.rgdata==null&&(V.rgdata=new m),V.channels_in=B.num_channels,V.channels_in==1&&(B.mode=v.MONO),V.channels_out=B.mode==v.MONO?1:2,V.mode_ext=S.MPG_MD_MS_LR,B.mode==v.MONO&&(B.force_ms=!1),B.VBR==t.vbr_off&&B.VBR_mean_bitrate_kbps!=128&&B.brate==0&&(B.brate=B.VBR_mean_bitrate_kbps),B.VBR==t.vbr_off||B.VBR==t.vbr_mtrh||B.VBR==t.vbr_mt||(B.free_format=!1),B.VBR==t.vbr_off&&B.brate==0&&_.EQ(B.compression_ratio,0)&&(B.compression_ratio=11.025),B.VBR==t.vbr_off&&B.compression_ratio>0&&(B.out_samplerate==0&&(B.out_samplerate=map2MP3Frequency(int(.97*B.in_samplerate))),B.brate=0|B.out_samplerate*16*V.channels_out/(1e3*B.compression_ratio),V.samplerate_index=C(B.out_samplerate,B),B.free_format||(B.brate=P(B.brate,B.version,B.out_samplerate))),B.out_samplerate!=0&&(B.out_samplerate<16e3?(B.VBR_mean_bitrate_kbps=Math.max(B.VBR_mean_bitrate_kbps,8),B.VBR_mean_bitrate_kbps=Math.min(B.VBR_mean_bitrate_kbps,64)):B.out_samplerate<32e3?(B.VBR_mean_bitrate_kbps=Math.max(B.VBR_mean_bitrate_kbps,8),B.VBR_mean_bitrate_kbps=Math.min(B.VBR_mean_bitrate_kbps,160)):(B.VBR_mean_bitrate_kbps=Math.max(B.VBR_mean_bitrate_kbps,32),B.VBR_mean_bitrate_kbps=Math.min(B.VBR_mean_bitrate_kbps,320))),B.lowpassfreq==0){var ye=16e3;switch(B.VBR){case t.vbr_off:{var Ae=new X;H(Ae,B.brate),ye=Ae.lowerlimit;break}case t.vbr_abr:{var Ae=new X;H(Ae,B.VBR_mean_bitrate_kbps),ye=Ae.lowerlimit;break}case t.vbr_rh:{var Ke=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=B.VBR_q&&B.VBR_q<=9){var et=Ke[B.VBR_q],Je=Ke[B.VBR_q+1],ze=B.VBR_q_frac;ye=linear_int(et,Je,ze)}else ye=19500;break}default:{var Ke=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=B.VBR_q&&B.VBR_q<=9){var et=Ke[B.VBR_q],Je=Ke[B.VBR_q+1],ze=B.VBR_q_frac;ye=linear_int(et,Je,ze)}else ye=19500}}B.mode==v.MONO&&(B.VBR==t.vbr_off||B.VBR==t.vbr_abr)&&(ye*=1.5),B.lowpassfreq=ye|0}if(B.out_samplerate==0&&(2*B.lowpassfreq>B.in_samplerate&&(B.lowpassfreq=B.in_samplerate/2),B.out_samplerate=F(B.lowpassfreq|0,B.in_samplerate)),B.lowpassfreq=Math.min(20500,B.lowpassfreq),B.lowpassfreq=Math.min(B.out_samplerate/2,B.lowpassfreq),B.VBR==t.vbr_off&&(B.compression_ratio=B.out_samplerate*16*V.channels_out/(1e3*B.brate)),B.VBR==t.vbr_abr&&(B.compression_ratio=B.out_samplerate*16*V.channels_out/(1e3*B.VBR_mean_bitrate_kbps)),B.bWriteVbrTag||(B.findReplayGain=!1,B.decode_on_the_fly=!1,V.findPeakSample=!1),V.findReplayGain=B.findReplayGain,V.decode_on_the_fly=B.decode_on_the_fly,V.decode_on_the_fly&&(V.findPeakSample=!0),V.findReplayGain&&p.InitGainAnalysis(V.rgdata,B.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return B.internal_flags=null,-6;switch(V.decode_on_the_fly&&!B.decode_only&&(V.hip!=null&&w.hip_decode_exit(V.hip),V.hip=w.hip_decode_init()),V.mode_gr=B.out_samplerate<=24e3?1:2,B.framesize=576*V.mode_gr,B.encoder_delay=S.ENCDELAY,V.resample_ratio=B.in_samplerate/B.out_samplerate,B.VBR){case t.vbr_mt:case t.vbr_rh:case t.vbr_mtrh:{var ut=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];B.compression_ratio=ut[B.VBR_q]}break;case t.vbr_abr:B.compression_ratio=B.out_samplerate*16*V.channels_out/(1e3*B.VBR_mean_bitrate_kbps);break;default:B.compression_ratio=B.out_samplerate*16*V.channels_out/(1e3*B.brate);break}if(B.mode==v.NOT_SET&&(B.mode=v.JOINT_STEREO),B.highpassfreq>0?(V.highpass1=2*B.highpassfreq,B.highpasswidth>=0?V.highpass2=2*(B.highpassfreq+B.highpasswidth):V.highpass2=1*2*B.highpassfreq,V.highpass1/=B.out_samplerate,V.highpass2/=B.out_samplerate):(V.highpass1=0,V.highpass2=0),B.lowpassfreq>0?(V.lowpass2=2*B.lowpassfreq,B.lowpasswidth>=0?(V.lowpass1=2*(B.lowpassfreq-B.lowpasswidth),V.lowpass1<0&&(V.lowpass1=0)):V.lowpass1=1*2*B.lowpassfreq,V.lowpass1/=B.out_samplerate,V.lowpass2/=B.out_samplerate):(V.lowpass1=0,V.lowpass2=0),K(B),V.samplerate_index=C(B.out_samplerate,B),V.samplerate_index<0)return B.internal_flags=null,-1;if(B.VBR==t.vbr_off){if(B.free_format)V.bitrate_index=0;else if(B.brate=P(B.brate,B.version,B.out_samplerate),V.bitrate_index=I(B.brate,B.version,B.out_samplerate),V.bitrate_index<=0)return B.internal_flags=null,-1}else V.bitrate_index=1;B.analysis&&(B.bWriteVbrTag=!1),V.pinfo!=null&&(B.bWriteVbrTag=!1),M.init_bit_stream_w(V);for(var nt=V.samplerate_index+3*B.version+6*(B.out_samplerate<16e3?1:0),Ye=0;Ye<S.SBMAX_l+1;Ye++)V.scalefac_band.l[Ye]=D.sfBandIndex[nt].l[Ye];for(var Ye=0;Ye<S.PSFB21+1;Ye++){var W=(V.scalefac_band.l[22]-V.scalefac_band.l[21])/S.PSFB21,k=V.scalefac_band.l[21]+Ye*W;V.scalefac_band.psfb21[Ye]=k}V.scalefac_band.psfb21[S.PSFB21]=576;for(var Ye=0;Ye<S.SBMAX_s+1;Ye++)V.scalefac_band.s[Ye]=D.sfBandIndex[nt].s[Ye];for(var Ye=0;Ye<S.PSFB12+1;Ye++){var W=(V.scalefac_band.s[13]-V.scalefac_band.s[12])/S.PSFB12,k=V.scalefac_band.s[12]+Ye*W;V.scalefac_band.psfb12[Ye]=k}V.scalefac_band.psfb12[S.PSFB12]=192,B.version==1?V.sideinfo_len=V.channels_out==1?21:36:V.sideinfo_len=V.channels_out==1?13:21,B.error_protection&&(V.sideinfo_len+=2),ee(B),V.Class_ID=Z;{var h;for(h=0;h<19;h++)V.nsPsy.pefirbuf[h]=700*V.mode_gr*V.channels_out;B.ATHtype==-1&&(B.ATHtype=4)}switch(a(B.VBR_q<=9),a(B.VBR_q>=0),B.VBR){case t.vbr_mt:B.VBR=t.vbr_mtrh;case t.vbr_mtrh:{B.useTemporal==null&&(B.useTemporal=!1),L.apply_preset(B,500-B.VBR_q*10,0),B.quality<0&&(B.quality=LAME_DEFAULT_QUALITY),B.quality<5&&(B.quality=0),B.quality>5&&(B.quality=5),V.PSY.mask_adjust=B.maskingadjust,V.PSY.mask_adjust_short=B.maskingadjust_short,B.experimentalY?V.sfb21_extra=!1:V.sfb21_extra=B.out_samplerate>44e3,V.iteration_loop=new VBRNewIterationLoop(O);break}case t.vbr_rh:{L.apply_preset(B,500-B.VBR_q*10,0),V.PSY.mask_adjust=B.maskingadjust,V.PSY.mask_adjust_short=B.maskingadjust_short,B.experimentalY?V.sfb21_extra=!1:V.sfb21_extra=B.out_samplerate>44e3,B.quality>6&&(B.quality=6),B.quality<0&&(B.quality=LAME_DEFAULT_QUALITY),V.iteration_loop=new VBROldIterationLoop(O);break}default:{var T;V.sfb21_extra=!1,B.quality<0&&(B.quality=LAME_DEFAULT_QUALITY),T=B.VBR,T==t.vbr_off&&(B.VBR_mean_bitrate_kbps=B.brate),L.apply_preset(B,B.VBR_mean_bitrate_kbps,0),B.VBR=T,V.PSY.mask_adjust=B.maskingadjust,V.PSY.mask_adjust_short=B.maskingadjust_short,T==t.vbr_off?V.iteration_loop=new g(O):V.iteration_loop=new ABRIterationLoop(O);break}}if(a(B.scale>=0),B.VBR!=t.vbr_off){if(V.VBR_min_bitrate=1,V.VBR_max_bitrate=14,B.out_samplerate<16e3&&(V.VBR_max_bitrate=8),B.VBR_min_bitrate_kbps!=0&&(B.VBR_min_bitrate_kbps=P(B.VBR_min_bitrate_kbps,B.version,B.out_samplerate),V.VBR_min_bitrate=I(B.VBR_min_bitrate_kbps,B.version,B.out_samplerate),V.VBR_min_bitrate<0)||B.VBR_max_bitrate_kbps!=0&&(B.VBR_max_bitrate_kbps=P(B.VBR_max_bitrate_kbps,B.version,B.out_samplerate),V.VBR_max_bitrate=I(B.VBR_max_bitrate_kbps,B.version,B.out_samplerate),V.VBR_max_bitrate<0))return-1;B.VBR_min_bitrate_kbps=E.bitrate_table[B.version][V.VBR_min_bitrate],B.VBR_max_bitrate_kbps=E.bitrate_table[B.version][V.VBR_max_bitrate],B.VBR_mean_bitrate_kbps=Math.min(E.bitrate_table[B.version][V.VBR_max_bitrate],B.VBR_mean_bitrate_kbps),B.VBR_mean_bitrate_kbps=Math.max(E.bitrate_table[B.version][V.VBR_min_bitrate],B.VBR_mean_bitrate_kbps)}return B.tune&&(V.PSY.mask_adjust+=B.tune_value_a,V.PSY.mask_adjust_short+=B.tune_value_a),he(B),a(B.scale>=0),B.athaa_type<0?V.ATH.useAdjust=3:V.ATH.useAdjust=B.athaa_type,V.ATH.aaSensitivityP=Math.pow(10,B.athaa_sensitivity/-10),B.short_blocks==null&&(B.short_blocks=r.short_block_allowed),B.short_blocks==r.short_block_allowed&&(B.mode==v.JOINT_STEREO||B.mode==v.STEREO)&&(B.short_blocks=r.short_block_coupled),B.quant_comp<0&&(B.quant_comp=1),B.quant_comp_short<0&&(B.quant_comp_short=0),B.msfix<0&&(B.msfix=0),B.exp_nspsytune=B.exp_nspsytune|1,B.internal_flags.nsPsy.attackthre<0&&(B.internal_flags.nsPsy.attackthre=l.NSATTACKTHRE),B.internal_flags.nsPsy.attackthre_s<0&&(B.internal_flags.nsPsy.attackthre_s=l.NSATTACKTHRE_S),a(B.scale>=0),B.scale<0&&(B.scale=1),B.ATHtype<0&&(B.ATHtype=4),B.ATHcurve<0&&(B.ATHcurve=4),B.athaa_loudapprox<0&&(B.athaa_loudapprox=2),B.interChRatio<0&&(B.interChRatio=0),B.useTemporal==null&&(B.useTemporal=!0),V.slot_lag=V.frac_SpF=0,B.VBR==t.vbr_off&&(V.slot_lag=V.frac_SpF=(B.version+1)*72e3*B.brate%B.out_samplerate|0),D.iteration_init(B),x.psymodel_init(B),a(B.scale>=0),0};function ae(B,V){(B.in_buffer_0==null||B.in_buffer_nsamples<V)&&(B.in_buffer_0=i(V),B.in_buffer_1=i(V),B.in_buffer_nsamples=V)}this.lame_encode_flush=function(B,V,ye,Ae){var Ke=B.internal_flags,et=o([2,1152]),Je=0,ze,ut,nt,Ye,W=Ke.mf_samples_to_encode-S.POSTDELAY,k=ge(B);if(Ke.mf_samples_to_encode<1)return 0;for(ze=0,B.in_samplerate!=B.out_samplerate&&(W+=16*B.out_samplerate/B.in_samplerate),nt=B.framesize-W%B.framesize,nt<576&&(nt+=B.framesize),B.encoder_padding=nt,Ye=(W+nt)/B.framesize;Ye>0&&Je>=0;){var h=k-Ke.mf_size,T=B.frameNum;h*=B.in_samplerate,h/=B.out_samplerate,h>1152&&(h=1152),h<1&&(h=1),ut=Ae-ze,Ae==0&&(ut=0),Je=this.lame_encode_buffer(B,et[0],et[1],h,V,ye,ut),ye+=Je,ze+=Je,Ye-=T!=B.frameNum?1:0}if(Ke.mf_samples_to_encode=0,Je<0||(ut=Ae-ze,Ae==0&&(ut=0),M.flush_bitstream(B),Je=M.copy_buffer(Ke,V,ye,ut,1),Je<0))return Je;if(ye+=Je,ze+=Je,ut=Ae-ze,Ae==0&&(ut=0),B.write_id3tag_automatic){if(R.id3tag_write_v1(B),Je=M.copy_buffer(Ke,V,ye,ut,0),Je<0)return Je;ze+=Je}return ze},this.lame_encode_buffer=function(B,V,ye,Ae,Ke,et,Je){var ze=B.internal_flags,ut=[null,null];if(ze.Class_ID!=Z)return-3;if(Ae==0)return 0;ae(ze,Ae),ut[0]=ze.in_buffer_0,ut[1]=ze.in_buffer_1;for(var nt=0;nt<Ae;nt++)ut[0][nt]=V[nt],ze.channels_in>1&&(ut[1][nt]=ye[nt]);return Le(B,ut[0],ut[1],Ae,Ke,et,Je)};function ge(B){var V=S.BLKSIZE+B.framesize-S.FFTOFFSET;return V=Math.max(V,512+B.framesize-32),V}function Le(B,V,ye,Ae,Ke,et,Je){var ze=B.internal_flags,ut=0,nt,Ye,W,k,h,T=[null,null],$=[null,null];if(ze.Class_ID!=Z)return-3;if(Ae==0)return 0;if(h=M.copy_buffer(ze,Ke,et,Je,0),h<0)return h;if(et+=h,ut+=h,$[0]=V,$[1]=ye,_.NEQ(B.scale,0)&&_.NEQ(B.scale,1))for(Ye=0;Ye<Ae;++Ye)$[0][Ye]*=B.scale,ze.channels_out==2&&($[1][Ye]*=B.scale);if(_.NEQ(B.scale_left,0)&&_.NEQ(B.scale_left,1))for(Ye=0;Ye<Ae;++Ye)$[0][Ye]*=B.scale_left;if(_.NEQ(B.scale_right,0)&&_.NEQ(B.scale_right,1))for(Ye=0;Ye<Ae;++Ye)$[1][Ye]*=B.scale_right;if(B.num_channels==2&&ze.channels_out==1)for(Ye=0;Ye<Ae;++Ye)$[0][Ye]=.5*($[0][Ye]+$[1][Ye]),$[1][Ye]=0;k=ge(B),T[0]=ze.mfbuf[0],T[1]=ze.mfbuf[1];for(var j=0;Ae>0;){var J=[null,null],Q=0,ce=0;J[0]=$[0],J[1]=$[1];var ie=new De;if(Ne(B,T,J,j,Ae,ie),Q=ie.n_in,ce=ie.n_out,ze.findReplayGain&&!ze.decode_on_the_fly&&p.AnalyzeSamples(ze.rgdata,T[0],ze.mf_size,T[1],ze.mf_size,ce,ze.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(Ae-=Q,j+=Q,ze.channels_out==2,ze.mf_size+=ce,a(ze.mf_size<=u.MFSIZE),ze.mf_samples_to_encode<1&&(ze.mf_samples_to_encode=S.ENCDELAY+S.POSTDELAY),ze.mf_samples_to_encode+=ce,ze.mf_size>=k){var le=Je-ut;if(Je==0&&(le=0),nt=He(B,T[0],T[1],Ke,et,le),nt<0)return nt;for(et+=nt,ut+=nt,ze.mf_size-=B.framesize,ze.mf_samples_to_encode-=B.framesize,W=0;W<ze.channels_out;W++)for(Ye=0;Ye<ze.mf_size;Ye++)T[W][Ye]=T[W][Ye+B.framesize]}}return ut}function He(B,V,ye,Ae,Ke,et){var Je=y.enc.lame_encode_mp3_frame(B,V,ye,Ae,Ke,et);return B.frameNum++,Je}function De(){this.n_in=0,this.n_out=0}function Ue(){this.num_used=0}function be(B,V){return V!=0?be(V,B%V):B}function Re(B,V,ye){var Ae=Math.PI*V;B/=ye,B<0&&(B=0),B>1&&(B=1);var Ke=B-.5,et=.42-.5*Math.cos(2*B*Math.PI)+.08*Math.cos(4*B*Math.PI);return Math.abs(Ke)<1e-9?Ae/Math.PI:et*Math.sin(ye*Ae*Ke)/(Math.PI*ye*Ke)}function Xe(B,V,ye,Ae,Ke,et,Je,ze,ut){var nt=B.internal_flags,Ye,W=0,k,h=B.out_samplerate/be(B.out_samplerate,B.in_samplerate);h>u.BPC&&(h=u.BPC);var T=Math.abs(nt.resample_ratio-Math.floor(.5+nt.resample_ratio))<1e-4?1:0,$=1/nt.resample_ratio;$>1&&($=1);var j=31;j%2==0&&--j,j+=T;var J=j+1;if(nt.fill_buffer_resample_init==0){for(nt.inbuf_old[0]=i(J),nt.inbuf_old[1]=i(J),Ye=0;Ye<=2*h;++Ye)nt.blackfilt[Ye]=i(J);for(nt.itime[0]=0,nt.itime[1]=0,W=0;W<=2*h;W++){var Q=0,ce=(W-h)/(2*h);for(Ye=0;Ye<=j;Ye++)Q+=nt.blackfilt[W][Ye]=Re(Ye-ce,$,j);for(Ye=0;Ye<=j;Ye++)nt.blackfilt[W][Ye]/=Q}nt.fill_buffer_resample_init=1}var ie=nt.inbuf_old[ut];for(k=0;k<Ae;k++){var le,ve;if(le=k*nt.resample_ratio,W=0|Math.floor(le-nt.itime[ut]),j+W-j/2>=Je)break;var ce=le-nt.itime[ut]-(W+.5*(j%2));ve=0|Math.floor(ce*2*h+h+.5);var ke=0;for(Ye=0;Ye<=j;++Ye){var Pe=0|Ye+W-j/2,Ze;Ze=Pe<0?ie[J+Pe]:Ke[et+Pe],ke+=Ze*nt.blackfilt[ve][Ye]}V[ye+k]=ke}if(ze.num_used=Math.min(Je,j+W-j/2),nt.itime[ut]+=ze.num_used-k*nt.resample_ratio,ze.num_used>=J)for(Ye=0;Ye<J;Ye++)ie[Ye]=Ke[et+ze.num_used+Ye-J];else{var ft=J-ze.num_used;for(Ye=0;Ye<ft;++Ye)ie[Ye]=ie[Ye+ze.num_used];for(W=0;Ye<J;++Ye,++W)ie[Ye]=Ke[et+W];a(W==ze.num_used)}return k}function Ne(B,V,ye,Ae,Ke,et){var Je=B.internal_flags;if(Je.resample_ratio<.9999||Je.resample_ratio>1.0001)for(var ze=0;ze<Je.channels_out;ze++){var ut=new Ue;et.n_out=Xe(B,V[ze],Je.mf_size,B.framesize,ye[ze],Ae,Ke,ut,ze),et.n_in=ut.num_used}else{et.n_out=Math.min(B.framesize,Ke),et.n_in=et.n_out;for(var nt=0;nt<et.n_out;++nt)V[0][Je.mf_size+nt]=ye[0][Ae+nt],Je.channels_out==2&&(V[1][Je.mf_size+nt]=ye[1][Ae+nt])}}}return Zl=b,Zl}var Mm=An,zr=Mm.VbrMode;function Cm(){var e=Kl();function n(u,f,m,g,_,E,S,b,v,y,A,d,p,M,L){this.vbr_q=u,this.quant_comp=f,this.quant_comp_s=m,this.expY=g,this.st_lrm=_,this.st_s=E,this.masking_adj=S,this.masking_adj_short=b,this.ath_lower=v,this.ath_curve=y,this.ath_sensitivity=A,this.interch=d,this.safejoint=p,this.sfb21mod=M,this.msfix=L}function t(u,f,m,g,_,E,S,b,v,y,A,d,p,M){this.quant_comp=f,this.quant_comp_s=m,this.safejoint=g,this.nsmsfix=_,this.st_lrm=E,this.st_s=S,this.nsbass=b,this.scale=v,this.masking_adj=y,this.ath_lower=A,this.ath_curve=d,this.interch=p,this.sfscale=M}var r;this.setModules=function(u){r=u};var i=[new n(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new n(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new n(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new n(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new n(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new n(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new n(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new n(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new n(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new n(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new n(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],s=[new n(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new n(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new n(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new n(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new n(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new n(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new n(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new n(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new n(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new n(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new n(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function o(u,f,m){var g=u.VBR==zr.vbr_rh?i:s,_=u.VBR_q_frac,E=g[f],S=g[f+1],b=E;E.st_lrm=E.st_lrm+_*(S.st_lrm-E.st_lrm),E.st_s=E.st_s+_*(S.st_s-E.st_s),E.masking_adj=E.masking_adj+_*(S.masking_adj-E.masking_adj),E.masking_adj_short=E.masking_adj_short+_*(S.masking_adj_short-E.masking_adj_short),E.ath_lower=E.ath_lower+_*(S.ath_lower-E.ath_lower),E.ath_curve=E.ath_curve+_*(S.ath_curve-E.ath_curve),E.ath_sensitivity=E.ath_sensitivity+_*(S.ath_sensitivity-E.ath_sensitivity),E.interch=E.interch+_*(S.interch-E.interch),E.msfix=E.msfix+_*(S.msfix-E.msfix),c(u,b.vbr_q),m!=0?u.quant_comp=b.quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=b.quant_comp),m!=0?u.quant_comp_short=b.quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=b.quant_comp_s),b.expY!=0&&(u.experimentalY=b.expY!=0),m!=0?u.internal_flags.nsPsy.attackthre=b.st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=b.st_lrm),m!=0?u.internal_flags.nsPsy.attackthre_s=b.st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=b.st_s),m!=0?u.maskingadjust=b.masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=b.masking_adj),m!=0?u.maskingadjust_short=b.masking_adj_short:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=b.masking_adj_short),m!=0?u.ATHlower=-b.ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-b.ath_lower/10),m!=0?u.ATHcurve=b.ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=b.ath_curve),m!=0?u.athaa_sensitivity=b.ath_sensitivity:Math.abs(u.athaa_sensitivity- -1)>0||(u.athaa_sensitivity=b.ath_sensitivity),b.interch>0&&(m!=0?u.interChRatio=b.interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=b.interch)),b.safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|b.safejoint),b.sfb21mod>0&&(u.exp_nspsytune=u.exp_nspsytune|b.sfb21mod<<20),m!=0?u.msfix=b.msfix:Math.abs(u.msfix- -1)>0||(u.msfix=b.msfix),m==0&&(u.VBR_q=f,u.VBR_q_frac=_)}var a=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function l(u,f,m){var g=f,_=r.nearestBitrateFullIndex(f);if(u.VBR=zr.vbr_abr,u.VBR_mean_bitrate_kbps=g,u.VBR_mean_bitrate_kbps=Math.min(u.VBR_mean_bitrate_kbps,320),u.VBR_mean_bitrate_kbps=Math.max(u.VBR_mean_bitrate_kbps,8),u.brate=u.VBR_mean_bitrate_kbps,u.VBR_mean_bitrate_kbps>320&&(u.disable_reservoir=!0),a[_].safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|2),a[_].sfscale>0&&(u.internal_flags.noise_shaping=2),Math.abs(a[_].nsbass)>0){var E=int(a[_].nsbass*4);E<0&&(E+=64),u.exp_nspsytune=u.exp_nspsytune|E<<2}return m!=0?u.quant_comp=a[_].quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=a[_].quant_comp),m!=0?u.quant_comp_short=a[_].quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=a[_].quant_comp_s),m!=0?u.msfix=a[_].nsmsfix:Math.abs(u.msfix- -1)>0||(u.msfix=a[_].nsmsfix),m!=0?u.internal_flags.nsPsy.attackthre=a[_].st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=a[_].st_lrm),m!=0?u.internal_flags.nsPsy.attackthre_s=a[_].st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=a[_].st_s),m!=0?u.scale=a[_].scale:Math.abs(u.scale- -1)>0||(u.scale=a[_].scale),m!=0?u.maskingadjust=a[_].masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=a[_].masking_adj),a[_].masking_adj>0?m!=0?u.maskingadjust_short=a[_].masking_adj*.9:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[_].masking_adj*.9):m!=0?u.maskingadjust_short=a[_].masking_adj*1.1:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[_].masking_adj*1.1),m!=0?u.ATHlower=-a[_].ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-a[_].ath_lower/10),m!=0?u.ATHcurve=a[_].ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=a[_].ath_curve),m!=0?u.interChRatio=a[_].interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=a[_].interch),f}this.apply_preset=function(u,f,m){switch(f){case e.R3MIX:{f=e.V3,u.VBR=zr.vbr_mtrh;break}case e.MEDIUM:{f=e.V4,u.VBR=zr.vbr_rh;break}case e.MEDIUM_FAST:{f=e.V4,u.VBR=zr.vbr_mtrh;break}case e.STANDARD:{f=e.V2,u.VBR=zr.vbr_rh;break}case e.STANDARD_FAST:{f=e.V2,u.VBR=zr.vbr_mtrh;break}case e.EXTREME:{f=e.V0,u.VBR=zr.vbr_rh;break}case e.EXTREME_FAST:{f=e.V0,u.VBR=zr.vbr_mtrh;break}case e.INSANE:return f=320,u.preset=f,l(u,f,m),u.VBR=zr.vbr_off,f}switch(u.preset=f,f){case e.V9:return o(u,9,m),f;case e.V8:return o(u,8,m),f;case e.V7:return o(u,7,m),f;case e.V6:return o(u,6,m),f;case e.V5:return o(u,5,m),f;case e.V4:return o(u,4,m),f;case e.V3:return o(u,3,m),f;case e.V2:return o(u,2,m),f;case e.V1:return o(u,1,m),f;case e.V0:return o(u,0,m),f}return 8<=f&&f<=320?l(u,f,m):(u.preset=0,f)};function c(u,f){var m=0;return 0>f&&(m=-1,f=0),9<f&&(m=-1,f=9),u.VBR_q=f,u.VBR_q_frac=0,m}}var Rm=Cm;function Lm(){this.setModules=function(e,n){}}var Pm=Lm;function Bm(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var Im=Bm,tf=An,nf=tf.new_float,Om=tf.new_int;function Dm(){this.global_gain=0,this.sfb_count1=0,this.step=Om(39),this.noise=nf(39),this.noise_log=nf(39)}var Nm=Dm,Fs=An,Mi=Fs.System,rf=Fs.VbrMode,Ql=Fs.Util,$s=Fs.Arrays,To=Fs.new_float,Ao=Fs.assert,Fm=Pm,Jl=Im,$m=Nm,an=ir(),sf=Hl,of=_a;function Vm(){var e;this.rv=null;var n;this.qupvt=null;var t,r=new Fm,i;this.setModules=function(b,v,y,A){e=b,n=v,this.rv=v,t=y,this.qupvt=y,i=A,r.setModules(t,i)},this.ms_convert=function(b,v){for(var y=0;y<576;++y){var A=b.tt[v][0].xr[y],d=b.tt[v][1].xr[y];b.tt[v][0].xr[y]=(A+d)*(Ql.SQRT2*.5),b.tt[v][1].xr[y]=(A-d)*(Ql.SQRT2*.5)}};function s(b,v,y,A){A=0;for(var d=0;d<=y;++d){var p=Math.abs(b.xr[d]);A+=p,v[d]=Math.sqrt(p*Math.sqrt(p)),v[d]>b.xrpow_max&&(b.xrpow_max=v[d])}return A}this.init_xrpow=function(b,v,y){var A=0,d=0|v.max_nonzero_coeff;if(v.xrpow_max=0,$s.fill(y,d,576,0),A=s(v,y,d,A),A>1e-20){var p=0;b.substep_shaping&2&&(p=1);for(var M=0;M<v.psymax;M++)b.pseudohalf[M]=p;return!0}return $s.fill(v.l3_enc,0,576,0),!1};function o(b,v){var y=b.ATH,A=v.xr;if(v.block_type!=an.SHORT_TYPE)for(var d=!1,p=an.PSFB21-1;p>=0&&!d;p--){var M=b.scalefac_band.psfb21[p],L=b.scalefac_band.psfb21[p+1],D=t.athAdjust(y.adjust,y.psfb21[p],y.floor);b.nsPsy.longfact[21]>1e-12&&(D*=b.nsPsy.longfact[21]);for(var O=L-1;O>=M;O--)if(Math.abs(A[O])<D)A[O]=0;else{d=!0;break}}else for(var x=0;x<3;x++)for(var d=!1,p=an.PSFB12-1;p>=0&&!d;p--){var M=b.scalefac_band.s[12]*3+(b.scalefac_band.s[13]-b.scalefac_band.s[12])*x+(b.scalefac_band.psfb12[p]-b.scalefac_band.psfb12[0]),L=M+(b.scalefac_band.psfb12[p+1]-b.scalefac_band.psfb12[p]),Y=t.athAdjust(y.adjust,y.psfb12[p],y.floor);b.nsPsy.shortfact[12]>1e-12&&(Y*=b.nsPsy.shortfact[12]);for(var O=L-1;O>=M;O--)if(Math.abs(A[O])<Y)A[O]=0;else{d=!0;break}}}this.init_outer_loop=function(b,v){v.part2_3_length=0,v.big_values=0,v.count1=0,v.global_gain=210,v.scalefac_compress=0,v.table_select[0]=0,v.table_select[1]=0,v.table_select[2]=0,v.subblock_gain[0]=0,v.subblock_gain[1]=0,v.subblock_gain[2]=0,v.subblock_gain[3]=0,v.region0_count=0,v.region1_count=0,v.preflag=0,v.scalefac_scale=0,v.count1table_select=0,v.part2_length=0,v.sfb_lmax=an.SBPSY_l,v.sfb_smin=an.SBPSY_s,v.psy_lmax=b.sfb21_extra?an.SBMAX_l:an.SBPSY_l,v.psymax=v.psy_lmax,v.sfbmax=v.sfb_lmax,v.sfbdivide=11;for(var y=0;y<an.SBMAX_l;y++)v.width[y]=b.scalefac_band.l[y+1]-b.scalefac_band.l[y],v.window[y]=3;if(v.block_type==an.SHORT_TYPE){var A=To(576);v.sfb_smin=0,v.sfb_lmax=0,v.mixed_block_flag!=0&&(v.sfb_smin=3,v.sfb_lmax=b.mode_gr*2+4),v.psymax=v.sfb_lmax+3*((b.sfb21_extra?an.SBMAX_s:an.SBPSY_s)-v.sfb_smin),v.sfbmax=v.sfb_lmax+3*(an.SBPSY_s-v.sfb_smin),v.sfbdivide=v.sfbmax-18,v.psy_lmax=v.sfb_lmax;var d=b.scalefac_band.l[v.sfb_lmax];Mi.arraycopy(v.xr,0,A,0,576);for(var y=v.sfb_smin;y<an.SBMAX_s;y++)for(var p=b.scalefac_band.s[y],M=b.scalefac_band.s[y+1],L=0;L<3;L++)for(var D=p;D<M;D++)v.xr[d++]=A[3*D+L];for(var O=v.sfb_lmax,y=v.sfb_smin;y<an.SBMAX_s;y++)v.width[O]=v.width[O+1]=v.width[O+2]=b.scalefac_band.s[y+1]-b.scalefac_band.s[y],v.window[O]=0,v.window[O+1]=1,v.window[O+2]=2,O+=3}v.count1bits=0,v.sfb_partition_table=t.nr_of_sfb_block[0][0],v.slen[0]=0,v.slen[1]=0,v.slen[2]=0,v.slen[3]=0,v.max_nonzero_coeff=575,$s.fill(v.scalefac,0),o(b,v)};function a(b){this.ordinal=b}a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2);function l(b,v,y,A,d){var p,M=b.CurrentStep[A],L=!1,D=b.OldValue[A],O=a.BINSEARCH_NONE;for(v.global_gain=D,y-=v.part2_length;;){var x;if(p=i.count_bits(b,d,v,null),M==1||p==y)break;p>y?(O==a.BINSEARCH_DOWN&&(L=!0),L&&(M/=2),O=a.BINSEARCH_UP,x=M):(O==a.BINSEARCH_UP&&(L=!0),L&&(M/=2),O=a.BINSEARCH_DOWN,x=-M),v.global_gain+=x,v.global_gain<0&&(v.global_gain=0,L=!0),v.global_gain>255&&(v.global_gain=255,L=!0)}for(Ao(v.global_gain>=0),Ao(v.global_gain<256);p>y&&v.global_gain<255;)v.global_gain++,p=i.count_bits(b,d,v,null);return b.CurrentStep[A]=D-v.global_gain>=4?4:2,b.OldValue[A]=v.global_gain,v.part2_3_length=p,p}this.trancate_smallspectrums=function(b,v,y,A){var d=To(of.SFBMAX);if(!(!(b.substep_shaping&4)&&v.block_type==an.SHORT_TYPE||b.substep_shaping&128)){t.calc_noise(v,y,d,new Jl,null);for(var M=0;M<576;M++){var p=0;v.l3_enc[M]!=0&&(p=Math.abs(v.xr[M])),A[M]=p}var M=0,L=8;v.block_type==an.SHORT_TYPE&&(L=6);do{var D,O,x,Y,R=v.width[L];if(M+=R,!(d[L]>=1)&&($s.sort(A,M-R,R),!BitStream.EQ(A[M-1],0))){D=(1-d[L])*y[L],O=0,Y=0;do{var w;for(x=1;Y+x<R&&!BitStream.NEQ(A[Y+M-R],A[Y+M+x-R]);x++);if(w=A[Y+M-R]*A[Y+M-R]*x,D<w){Y!=0&&(O=A[Y+M-R-1]);break}D-=w,Y+=x}while(Y<R);if(!BitStream.EQ(O,0))do Math.abs(v.xr[M-R])<=O&&(v.l3_enc[M-R]=0);while(--R>0)}}while(++L<v.psymax);v.part2_3_length=i.noquant_count_bits(b,v,null)}};function c(b){for(var v=0;v<b.sfbmax;v++)if(b.scalefac[v]+b.subblock_gain[b.window[v]]==0)return!1;return!0}function u(b){return Ql.FAST_LOG10(.368+.632*b*b*b)}function f(b,v){for(var y=1e-37,A=0;A<v.psymax;A++)y+=u(b[A]);return Math.max(1e-20,y)}function m(b,v,y,A,d){var p;switch(b){default:case 9:{v.over_count>0?(p=y.over_SSD<=v.over_SSD,y.over_SSD==v.over_SSD&&(p=y.bits<v.bits)):p=y.max_noise<0&&y.max_noise*10+y.bits<=v.max_noise*10+v.bits;break}case 0:p=y.over_count<v.over_count||y.over_count==v.over_count&&y.over_noise<v.over_noise||y.over_count==v.over_count&&BitStream.EQ(y.over_noise,v.over_noise)&&y.tot_noise<v.tot_noise;break;case 8:y.max_noise=f(d,A);case 1:p=y.max_noise<v.max_noise;break;case 2:p=y.tot_noise<v.tot_noise;break;case 3:p=y.tot_noise<v.tot_noise&&y.max_noise<v.max_noise;break;case 4:p=y.max_noise<=0&&v.max_noise>.2||y.max_noise<=0&&v.max_noise<0&&v.max_noise>y.max_noise-.2&&y.tot_noise<v.tot_noise||y.max_noise<=0&&v.max_noise>0&&v.max_noise>y.max_noise-.2&&y.tot_noise<v.tot_noise+v.over_noise||y.max_noise>0&&v.max_noise>-.05&&v.max_noise>y.max_noise-.1&&y.tot_noise+y.over_noise<v.tot_noise+v.over_noise||y.max_noise>0&&v.max_noise>-.1&&v.max_noise>y.max_noise-.15&&y.tot_noise+y.over_noise+y.over_noise<v.tot_noise+v.over_noise+v.over_noise;break;case 5:p=y.over_noise<v.over_noise||BitStream.EQ(y.over_noise,v.over_noise)&&y.tot_noise<v.tot_noise;break;case 6:p=y.over_noise<v.over_noise||BitStream.EQ(y.over_noise,v.over_noise)&&(y.max_noise<v.max_noise||BitStream.EQ(y.max_noise,v.max_noise)&&y.tot_noise<=v.tot_noise);break;case 7:p=y.over_count<v.over_count||y.over_noise<v.over_noise;break}return v.over_count==0&&(p=p&&y.bits<v.bits),p}function g(b,v,y,A,d){var p=b.internal_flags,M;v.scalefac_scale==0?M=1.2968395546510096:M=1.6817928305074292;for(var L=0,D=0;D<v.sfbmax;D++)L<y[D]&&(L=y[D]);var O=p.noise_shaping_amp;switch(O==3&&(d?O=2:O=1),O){case 2:break;case 1:L>1?L=Math.pow(L,.5):L*=.95;break;case 0:default:L>1?L=1:L*=.95;break}for(var x=0,D=0;D<v.sfbmax;D++){var Y=v.width[D],R;if(x+=Y,!(y[D]<L)){if(p.substep_shaping&2&&(p.pseudohalf[D]=p.pseudohalf[D]==0?1:0,p.pseudohalf[D]==0&&p.noise_shaping_amp==2))return;for(v.scalefac[D]++,R=-Y;R<0;R++)A[x+R]*=M,A[x+R]>v.xrpow_max&&(v.xrpow_max=A[x+R]);if(p.noise_shaping_amp==2)return}}}function _(b,v){for(var y=1.2968395546510096,A=0,d=0;d<b.sfbmax;d++){var p=b.width[d],M=b.scalefac[d];if(b.preflag!=0&&(M+=t.pretab[d]),A+=p,M&1){M++;for(var L=-p;L<0;L++)v[A+L]*=y,v[A+L]>b.xrpow_max&&(b.xrpow_max=v[A+L])}b.scalefac[d]=M>>1}b.preflag=0,b.scalefac_scale=1}function E(b,v,y){var A,d=v.scalefac;for(A=0;A<v.sfb_lmax;A++)if(d[A]>=16)return!0;for(var p=0;p<3;p++){var M=0,L=0;for(A=v.sfb_lmax+p;A<v.sfbdivide;A+=3)M<d[A]&&(M=d[A]);for(;A<v.sfbmax;A+=3)L<d[A]&&(L=d[A]);if(!(M<16&&L<8)){if(v.subblock_gain[p]>=7)return!0;v.subblock_gain[p]++;var D=b.scalefac_band.l[v.sfb_lmax];for(A=v.sfb_lmax+p;A<v.sfbmax;A+=3){var O,x=v.width[A],Y=d[A];if(Y=Y-(4>>v.scalefac_scale),Y>=0){d[A]=Y,D+=x*3;continue}d[A]=0;{var R=210+(Y<<v.scalefac_scale+1);O=t.IPOW20(R)}D+=x*(p+1);for(var w=-x;w<0;w++)y[D+w]*=O,y[D+w]>v.xrpow_max&&(v.xrpow_max=y[D+w]);D+=x*(3-p-1)}{var O=t.IPOW20(202);D+=v.width[A]*(p+1);for(var w=-v.width[A];w<0;w++)y[D+w]*=O,y[D+w]>v.xrpow_max&&(v.xrpow_max=y[D+w])}}}return!1}function S(b,v,y,A,d){var p=b.internal_flags;g(b,v,y,A,d);var M=c(v);return M?!1:(p.mode_gr==2?M=i.scale_bitcount(v):M=i.scale_bitcount_lsf(p,v),M?(p.noise_shaping>1&&($s.fill(p.pseudohalf,0),v.scalefac_scale==0?(_(v,A),M=!1):v.block_type==an.SHORT_TYPE&&p.subblock_gain>0&&(M=E(p,v,A)||c(v))),M||(p.mode_gr==2?M=i.scale_bitcount(v):M=i.scale_bitcount_lsf(p,v)),!M):!0)}this.outer_loop=function(b,v,y,A,d,p){var M=b.internal_flags,L=new sf,D=To(576),O=To(of.SFBMAX),x=new Jl,Y,R=new $m,w=9999999,N=!1,X=!1,q=0;if(l(M,v,p,d,A),M.noise_shaping==0)return 100;t.calc_noise(v,y,O,x,R),x.bits=v.part2_3_length,L.assign(v);var Z=0;for(Mi.arraycopy(A,0,D,0,576);!N;){do{var ne=new Jl,U,F=255;if(M.substep_shaping&2?U=20:U=3,M.sfb21_extra&&(O[L.sfbmax]>1||L.block_type==an.SHORT_TYPE&&(O[L.sfbmax+1]>1||O[L.sfbmax+2]>1))||!S(b,L,O,A,X))break;L.scalefac_scale!=0&&(F=254);var C=p-L.part2_length;if(C<=0)break;for(;(L.part2_3_length=i.count_bits(M,A,L,R))>C&&L.global_gain<=F;)L.global_gain++;if(L.global_gain>F)break;if(x.over_count==0){for(;(L.part2_3_length=i.count_bits(M,A,L,R))>w&&L.global_gain<=F;)L.global_gain++;if(L.global_gain>F)break}if(t.calc_noise(L,y,O,ne,R),ne.bits=L.part2_3_length,v.block_type!=an.SHORT_TYPE?Y=b.quant_comp:Y=b.quant_comp_short,Y=m(Y,x,ne,L,O)?1:0,Y!=0)w=v.part2_3_length,x=ne,v.assign(L),Z=0,Mi.arraycopy(A,0,D,0,576);else if(M.full_outer_loop==0&&(++Z>U&&x.over_count==0||M.noise_shaping_amp==3&&X&&Z>30||M.noise_shaping_amp==3&&X&&L.global_gain-q>15))break}while(L.global_gain+L.scalefac_scale<255);M.noise_shaping_amp==3?X?N=!0:(L.assign(v),Mi.arraycopy(D,0,A,0,576),Z=0,q=L.global_gain,X=!0):N=!0}return Ao(v.global_gain+v.scalefac_scale<=255),b.VBR==rf.vbr_rh||b.VBR==rf.vbr_mtrh?Mi.arraycopy(D,0,A,0,576):M.substep_shaping&1&&trancate_smallspectrums(M,v,y,A),x.over_count},this.iteration_finish_one=function(b,v,y){var A=b.l3_side,d=A.tt[v][y];i.best_scalefac_store(b,v,y,A),b.use_best_huffman==1&&i.best_huffman_divide(b,d),n.ResvAdjust(b,d)},this.VBR_encode_granule=function(b,v,y,A,d,p,M){var L=b.internal_flags,D=new sf,O=To(576),x=M,Y=M+1,R=(M+p)/2,w,N,X=0,q=L.sfb21_extra;Ao(x<=LameInternalFlags.MAX_BITS_PER_CHANNEL),$s.fill(D.l3_enc,0);do R>x-42?L.sfb21_extra=!1:L.sfb21_extra=q,N=outer_loop(b,v,y,A,d,R),N<=0?(X=1,Y=v.part2_3_length,D.assign(v),Mi.arraycopy(A,0,O,0,576),M=Y-32,w=M-p,R=(M+p)/2):(p=R+32,w=M-p,R=(M+p)/2,X!=0&&(X=2,v.assign(D),Mi.arraycopy(O,0,A,0,576)));while(w>12);L.sfb21_extra=q,X==2&&Mi.arraycopy(D.l3_enc,0,v.l3_enc,0,576),Ao(v.part2_3_length<=x)},this.get_framebits=function(b,v){var y=b.internal_flags;y.bitrate_index=y.VBR_min_bitrate;var A=e.getframebits(b);y.bitrate_index=1,A=e.getframebits(b);for(var d=1;d<=y.VBR_max_bitrate;d++){y.bitrate_index=d;var p=new MeanBits(A);v[d]=n.ResvFrameBegin(b,p),A=p.bits}},this.VBR_old_prepare=function(b,v,y,A,d,p,M,L,D){var O=b.internal_flags,x,Y=0,R=1,w=0;O.bitrate_index=O.VBR_max_bitrate;var N=n.ResvFrameBegin(b,new MeanBits(0))/O.mode_gr;get_framebits(b,p);for(var X=0;X<O.mode_gr;X++){var q=t.on_pe(b,v,L[X],N,X,0);O.mode_ext==an.MPG_MD_MS_LR&&(ms_convert(O.l3_side,X),t.reduce_side(L[X],y[X],N,q));for(var Z=0;Z<O.channels_out;++Z){var ne=O.l3_side.tt[X][Z];ne.block_type!=an.SHORT_TYPE?(Y=1.28/(1+Math.exp(3.5-v[X][Z]/300))-.05,x=O.PSY.mask_adjust-Y):(Y=2.56/(1+Math.exp(3.5-v[X][Z]/300))-.14,x=O.PSY.mask_adjust_short-Y),O.masking_lower=Math.pow(10,x*.1),init_outer_loop(O,ne),D[X][Z]=t.calc_xmin(b,A[X][Z],ne,d[X][Z]),D[X][Z]!=0&&(R=0),M[X][Z]=126,w+=L[X][Z]}}for(var X=0;X<O.mode_gr;X++)for(var Z=0;Z<O.channels_out;Z++)w>p[O.VBR_max_bitrate]&&(L[X][Z]*=p[O.VBR_max_bitrate],L[X][Z]/=w),M[X][Z]>L[X][Z]&&(M[X][Z]=L[X][Z]);return R},this.bitpressure_strategy=function(b,v,y,A){for(var d=0;d<b.mode_gr;d++)for(var p=0;p<b.channels_out;p++){for(var M=b.l3_side.tt[d][p],L=v[d][p],D=0,O=0;O<M.psy_lmax;O++)L[D++]*=1+.029*O*O/an.SBMAX_l/an.SBMAX_l;if(M.block_type==an.SHORT_TYPE)for(var O=M.sfb_smin;O<an.SBMAX_s;O++)L[D++]*=1+.029*O*O/an.SBMAX_s/an.SBMAX_s,L[D++]*=1+.029*O*O/an.SBMAX_s/an.SBMAX_s,L[D++]*=1+.029*O*O/an.SBMAX_s/an.SBMAX_s;A[d][p]=0|Math.max(y[d][p],.9*A[d][p])}},this.VBR_new_prepare=function(b,v,y,A,d,p){var M=b.internal_flags,L=1,D=0,O=0,x;if(b.free_format){M.bitrate_index=0;var Y=new MeanBits(D);x=n.ResvFrameBegin(b,Y),D=Y.bits,d[0]=x}else{M.bitrate_index=M.VBR_max_bitrate;var Y=new MeanBits(D);n.ResvFrameBegin(b,Y),D=Y.bits,get_framebits(b,d),x=d[M.VBR_max_bitrate]}for(var R=0;R<M.mode_gr;R++){t.on_pe(b,v,p[R],D,R,0),M.mode_ext==an.MPG_MD_MS_LR&&ms_convert(M.l3_side,R);for(var w=0;w<M.channels_out;++w){var N=M.l3_side.tt[R][w];M.masking_lower=Math.pow(10,M.PSY.mask_adjust*.1),init_outer_loop(M,N),t.calc_xmin(b,y[R][w],N,A[R][w])!=0&&(L=0),O+=p[R][w]}}for(var R=0;R<M.mode_gr;R++)for(var w=0;w<M.channels_out;w++)O>x&&(p[R][w]*=x,p[R][w]/=O);return L},this.calc_target_bits=function(b,v,y,A,d,p){var M=b.internal_flags,L=M.l3_side,D,O,x,Y,R=0;M.bitrate_index=M.VBR_max_bitrate;var w=new MeanBits(R);for(p[0]=n.ResvFrameBegin(b,w),R=w.bits,M.bitrate_index=1,R=e.getframebits(b)-M.sideinfo_len*8,d[0]=R/(M.mode_gr*M.channels_out),R=b.VBR_mean_bitrate_kbps*b.framesize*1e3,M.substep_shaping&1&&(R*=1.09),R/=b.out_samplerate,R-=M.sideinfo_len*8,R/=M.mode_gr*M.channels_out,D=.93+.07*(11-b.compression_ratio)/(11-5.5),D<.9&&(D=.9),D>1&&(D=1),O=0;O<M.mode_gr;O++){var N=0;for(x=0;x<M.channels_out;x++){if(A[O][x]=int(D*R),v[O][x]>700){var X=int((v[O][x]-700)/1.4),q=L.tt[O][x];A[O][x]=int(D*R),q.block_type==an.SHORT_TYPE&&X<R/2&&(X=R/2),X>R*3/2?X=R*3/2:X<0&&(X=0),A[O][x]+=X}A[O][x]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(A[O][x]=LameInternalFlags.MAX_BITS_PER_CHANNEL),N+=A[O][x]}if(N>LameInternalFlags.MAX_BITS_PER_GRANULE)for(x=0;x<M.channels_out;++x)A[O][x]*=LameInternalFlags.MAX_BITS_PER_GRANULE,A[O][x]/=N}if(M.mode_ext==an.MPG_MD_MS_LR)for(O=0;O<M.mode_gr;O++)t.reduce_side(A[O],y[O],R*M.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(Y=0,O=0;O<M.mode_gr;O++)for(x=0;x<M.channels_out;x++)A[O][x]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(A[O][x]=LameInternalFlags.MAX_BITS_PER_CHANNEL),Y+=A[O][x];if(Y>p[0])for(O=0;O<M.mode_gr;O++)for(x=0;x<M.channels_out;x++)A[O][x]*=p[0],A[O][x]/=Y}}var xm=Vm,Hm=An,af=Hm.assert;function Um(){var e;this.setModules=function(n){e=n},this.ResvFrameBegin=function(n,t){var r=n.internal_flags,i,s=r.l3_side,o=e.getframebits(n);t.bits=(o-r.sideinfo_len*8)/r.mode_gr;var a=8*256*r.mode_gr-8;n.brate>320?i=8*int(n.brate*1e3/(n.out_samplerate/1152)/8+.5):(i=8*1440,n.strict_ISO&&(i=8*int(32e4/(n.out_samplerate/1152)/8+.5))),r.ResvMax=i-o,r.ResvMax>a&&(r.ResvMax=a),(r.ResvMax<0||n.disable_reservoir)&&(r.ResvMax=0);var l=t.bits*r.mode_gr+Math.min(r.ResvSize,r.ResvMax);return l>i&&(l=i),af(r.ResvMax%8==0),af(r.ResvMax>=0),s.resvDrain_pre=0,r.pinfo!=null&&(r.pinfo.mean_bits=t.bits/2,r.pinfo.resvsize=r.ResvSize),l},this.ResvMaxBits=function(n,t,r,i){var s=n.internal_flags,o,a=s.ResvSize,l=s.ResvMax;i!=0&&(a+=t),s.substep_shaping&1&&(l*=.9),r.bits=t,a*10>l*9?(o=a-l*9/10,r.bits+=o,s.substep_shaping|=128):(o=0,s.substep_shaping&=127,!n.disable_reservoir&&!(s.substep_shaping&1)&&(r.bits-=.1*t));var c=a<s.ResvMax*6/10?a:s.ResvMax*6/10;return c-=o,c<0&&(c=0),c},this.ResvAdjust=function(n,t){n.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(n,t){var r,i=n.l3_side;n.ResvSize+=t*n.mode_gr;var s=0;i.resvDrain_post=0,i.resvDrain_pre=0,(r=n.ResvSize%8)!=0&&(s+=r),r=n.ResvSize-s-n.ResvMax,r>0&&(s+=r);{var o=Math.min(i.main_data_begin*8,s)/8;i.resvDrain_pre+=8*o,s-=8*o,n.ResvSize-=8*o,i.main_data_begin-=o}i.resvDrain_post+=s,n.ResvSize-=s}}var Wm=Um;function jm(){var e="http://www.mp3dev.org/",n=3,t=98,r=4,i=0,s=93;this.getLameVersion=function(){return n+"."+t+"."+r},this.getLameShortVersion=function(){return n+"."+t+"."+r},this.getLameVeryShortVersion=function(){return"LAME"+n+"."+t+"r"},this.getPsyVersion=function(){return i+"."+s},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var Gm=jm,Vs=An,zm=Vs.System,eu=Vs.VbrMode,lf=Vs.ShortBlock,Xm=Vs.Arrays,Ea=Vs.new_byte,Ym=Vs.assert;Mo.NUMTOCENTRIES=100,Mo.MAXFRAMESIZE=2880;function Mo(){var e,n,t;this.setModules=function(R,w,N){e=R,n=w,t=N};var r=1,i=2,s=4,o=8,a=Mo.NUMTOCENTRIES,l=Mo.MAXFRAMESIZE,c=a+4+4+4+4+4,u=c+9+1+1+8+1+1+3+1+1+2+4+2+2,f=128,m=64,g=32,_=null,E="Xing",S="Info",b=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function v(R,w){if(R.nVbrNumFrames++,R.sum+=w,R.seen++,!(R.seen<R.want)&&(R.pos<R.size&&(R.bag[R.pos]=R.sum,R.pos++,R.seen=0),R.pos==R.size)){for(var N=1;N<R.size;N+=2)R.bag[N/2]=R.bag[N];R.want*=2,R.pos/=2}}function y(R,w){if(!(R.pos<=0))for(var N=1;N<a;++N){var X=N/a,q,Z,ne=0|Math.floor(X*R.pos);ne>R.pos-1&&(ne=R.pos-1),q=R.bag[ne],Z=R.sum;var U=0|256*q/Z;U>255&&(U=255),w[N]=255&U}}this.addVbrFrame=function(R){var w=R.internal_flags,N=Tables.bitrate_table[R.version][w.bitrate_index];Ym(w.VBR_seek_table.bag!=null),v(w.VBR_seek_table,N)};function A(R,w){var N=R[w+0]&255;return N<<=8,N|=R[w+1]&255,N<<=8,N|=R[w+2]&255,N<<=8,N|=R[w+3]&255,N}function d(R,w,N){R[w+0]=255&(N>>24&255),R[w+1]=255&(N>>16&255),R[w+2]=255&(N>>8&255),R[w+3]=255&(N&255)}function p(R,w,N){R[w+0]=255&(N>>8&255),R[w+1]=255&(N&255)}function M(R,w){return new String(R,w,E.length(),_).equals(E)||new String(R,w,S.length(),_).equals(S)}function L(R,w,N){return 255&(R<<w|N&~(-1<<w))}function D(R,w){var N=R.internal_flags;w[0]=L(w[0],8,255),w[1]=L(w[1],3,7),w[1]=L(w[1],1,R.out_samplerate<16e3?0:1),w[1]=L(w[1],1,R.version),w[1]=L(w[1],2,1),w[1]=L(w[1],1,R.error_protection?0:1),w[2]=L(w[2],4,N.bitrate_index),w[2]=L(w[2],2,N.samplerate_index),w[2]=L(w[2],1,0),w[2]=L(w[2],1,R.extension),w[3]=L(w[3],2,R.mode.ordinal()),w[3]=L(w[3],2,N.mode_ext),w[3]=L(w[3],1,R.copyright),w[3]=L(w[3],1,R.original),w[3]=L(w[3],2,R.emphasis),w[0]=255;var X=255&(w[1]&241),q;R.version==1?q=f:R.out_samplerate<16e3?q=g:q=m,R.VBR==eu.vbr_off&&(q=R.brate);var Z;R.free_format?Z=0:Z=255&16*e.BitrateIndex(q,R.version,R.out_samplerate),R.version==1?(w[1]=255&(X|10),X=255&(w[2]&13),w[2]=255&(Z|X)):(w[1]=255&(X|2),X=255&(w[2]&13),w[2]=255&(Z|X))}this.getVbrTag=function(R){var w=new VBRTagData,N=0;w.flags=0;var X=R[N+1]>>3&1,q=R[N+2]>>2&3,Z=R[N+3]>>6&3,ne=R[N+2]>>4&15;if(ne=Tables.bitrate_table[X][ne],R[N+1]>>4==14?w.samprate=Tables.samplerate_table[2][q]:w.samprate=Tables.samplerate_table[X][q],X!=0?Z!=3?N+=36:N+=21:Z!=3?N+=21:N+=13,!M(R,N))return null;N+=4,w.hId=X;var U=w.flags=A(R,N);if(N+=4,U&r&&(w.frames=A(R,N),N+=4),U&i&&(w.bytes=A(R,N),N+=4),U&s){if(w.toc!=null)for(var F=0;F<a;F++)w.toc[F]=R[N+F];N+=a}w.vbrScale=-1,U&o&&(w.vbrScale=A(R,N),N+=4),w.headersize=(X+1)*72e3*ne/w.samprate,N+=21;var C=R[N+0]<<4;C+=R[N+1]>>4;var P=(R[N+1]&15)<<8;return P+=R[N+2]&255,(C<0||C>3e3)&&(C=-1),(P<0||P>3e3)&&(P=-1),w.encDelay=C,w.encPadding=P,w},this.InitVbrTag=function(R){var w=R.internal_flags,N;R.version==1?N=f:R.out_samplerate<16e3?N=g:N=m,R.VBR==eu.vbr_off&&(N=R.brate);var X=(R.version+1)*72e3*N/R.out_samplerate,q=w.sideinfo_len+u;if(w.VBR_seek_table.TotalFrameSize=X,X<q||X>l){R.bWriteVbrTag=!1;return}w.VBR_seek_table.nVbrNumFrames=0,w.VBR_seek_table.nBytesWritten=0,w.VBR_seek_table.sum=0,w.VBR_seek_table.seen=0,w.VBR_seek_table.want=1,w.VBR_seek_table.pos=0,w.VBR_seek_table.bag==null&&(w.VBR_seek_table.bag=new int[400],w.VBR_seek_table.size=400);var Z=Ea(l);D(R,Z);for(var ne=w.VBR_seek_table.TotalFrameSize,U=0;U<ne;++U)n.add_dummy_byte(R,Z[U]&255,1)};function O(R,w){var N=w^R;return w=w>>8^b[N&255],w}this.updateMusicCRC=function(R,w,N,X){for(var q=0;q<X;++q)R[0]=O(w[N+q],R[0])};function x(R,w,N,X,q){var Z=R.internal_flags,ne=0,U=R.encoder_delay,F=R.encoder_padding,C=100-10*R.VBR_q-R.quality,P=t.getLameVeryShortVersion(),I,H=0,K,he=[1,5,3,2,4,0,3],ee=0|(R.lowpassfreq/100+.5>255?255:R.lowpassfreq/100+.5),ae=0,ge=0,Le=0,He=R.internal_flags.noise_shaping,De=0,Ue=0,be=0,Re=0,Xe=0,Ne=(R.exp_nspsytune&1)!=0,B=(R.exp_nspsytune&2)!=0,V=!1,ye=!1,Ae=R.internal_flags.nogap_total,Ke=R.internal_flags.nogap_current,et=R.ATHtype,Je=0,ze;switch(R.VBR){case vbr_abr:ze=R.VBR_mean_bitrate_kbps;break;case vbr_off:ze=R.brate;break;default:ze=R.VBR_min_bitrate_kbps}switch(R.VBR.ordinal()<he.length?I=he[R.VBR.ordinal()]:I=0,K=16*H+I,Z.findReplayGain&&(Z.RadioGain>510&&(Z.RadioGain=510),Z.RadioGain<-510&&(Z.RadioGain=-510),ge=8192,ge|=3072,Z.RadioGain>=0?ge|=Z.RadioGain:(ge|=512,ge|=-Z.RadioGain)),Z.findPeakSample&&(ae=Math.abs(0|Z.PeakSample/32767*Math.pow(2,23)+.5)),Ae!=-1&&(Ke>0&&(ye=!0),Ke<Ae-1&&(V=!0)),Je=et+((Ne?1:0)<<4)+((B?1:0)<<5)+((V?1:0)<<6)+((ye?1:0)<<7),C<0&&(C=0),R.mode){case MONO:De=0;break;case STEREO:De=1;break;case DUAL_CHANNEL:De=2;break;case JOINT_STEREO:R.force_ms?De=4:De=3;break;case NOT_SET:default:De=7;break}R.in_samplerate<=32e3?be=0:R.in_samplerate==48e3?be=2:R.in_samplerate>48e3?be=3:be=1,(R.short_blocks==lf.short_block_forced||R.short_blocks==lf.short_block_dispensed||R.lowpassfreq==-1&&R.highpassfreq==-1||R.scale_left<R.scale_right||R.scale_left>R.scale_right||R.disable_reservoir&&R.brate<320||R.noATH||R.ATHonly||et==0||R.in_samplerate<=32e3)&&(Ue=1),Re=He+(De<<2)+(Ue<<5)+(be<<6),Xe=Z.nMusicCRC,d(N,X+ne,C),ne+=4;for(var ut=0;ut<9;ut++)N[X+ne+ut]=255&P.charAt(ut);ne+=9,N[X+ne]=255&K,ne++,N[X+ne]=255&ee,ne++,d(N,X+ne,ae),ne+=4,p(N,X+ne,ge),ne+=2,p(N,X+ne,Le),ne+=2,N[X+ne]=255&Je,ne++,ze>=255?N[X+ne]=255:N[X+ne]=255&ze,ne++,N[X+ne]=255&U>>4,N[X+ne+1]=255&(U<<4)+(F>>8),N[X+ne+2]=255&F,ne+=3,N[X+ne]=255&Re,ne++,N[X+ne++]=0,p(N,X+ne,R.preset),ne+=2,d(N,X+ne,w),ne+=4,p(N,X+ne,Xe),ne+=2;for(var nt=0;nt<ne;nt++)q=O(N[X+nt],q);return p(N,X+ne,q),ne+=2,ne}function Y(R){R.seek(0);var w=Ea(10);R.readFully(w);var N;return new String(w,"ISO-8859-1").startsWith("ID3")?N=0:N=((w[6]&127)<<21|(w[7]&127)<<14|(w[8]&127)<<7|w[9]&127)+w.length,N}this.getLameTagFrame=function(R,w){var N=R.internal_flags;if(!R.bWriteVbrTag||N.Class_ID!=Lame.LAME_ID||N.VBR_seek_table.pos<=0)return 0;if(w.length<N.VBR_seek_table.TotalFrameSize)return N.VBR_seek_table.TotalFrameSize;Xm.fill(w,0,N.VBR_seek_table.TotalFrameSize,0),D(R,w);var X=Ea(a);if(R.free_format)for(var q=1;q<a;++q)X[q]=255&255*q/100;else y(N.VBR_seek_table,X);var Z=N.sideinfo_len;R.error_protection&&(Z-=2),R.VBR==eu.vbr_off?(w[Z++]=255&S.charAt(0),w[Z++]=255&S.charAt(1),w[Z++]=255&S.charAt(2),w[Z++]=255&S.charAt(3)):(w[Z++]=255&E.charAt(0),w[Z++]=255&E.charAt(1),w[Z++]=255&E.charAt(2),w[Z++]=255&E.charAt(3)),d(w,Z,r+i+s+o),Z+=4,d(w,Z,N.VBR_seek_table.nVbrNumFrames),Z+=4;var ne=N.VBR_seek_table.nBytesWritten+N.VBR_seek_table.TotalFrameSize;d(w,Z,0|ne),Z+=4,zm.arraycopy(X,0,w,Z,X.length),Z+=X.length,R.error_protection&&n.CRC_writeheader(N,w);for(var U=0,q=0;q<Z;q++)U=O(w[q],U);return Z+=x(R,ne,w,Z,U),N.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(R,w){var N=R.internal_flags;if(N.VBR_seek_table.pos<=0||(w.seek(w.length()),w.length()==0))return-1;var X=Y(w);w.seek(X);var q=Ea(l),Z=getLameTagFrame(R,q);return Z>q.length?-1:(Z<1||w.write(q,0,Z),0)}}var qm=Mo,uf=An,cf=uf.new_byte,Zm=uf.assert,Km=Kl(),Qm=Rm,Jm=U1,e_=Z1(),t_=xm,n_=Q1(),r_=Wm,i_=ko,s_=ql();ir();var o_=Gm,a_=qm;function l_(){this.setModules=function(e,n){}}function u_(){this.setModules=function(e,n,t){}}function c_(){}function f_(){this.setModules=function(e,n){}}function d_(e,n,t){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,n=44100,t=128);var r=new Km,i=new l_,s=new Jm,o=new s_,a=new Qm,l=new e_,c=new t_,u=new a_,f=new o_,m=new f_,g=new r_,_=new n_,E=new u_,S=new c_;r.setModules(s,o,a,l,c,u,f,m,S),o.setModules(s,S,f,u),m.setModules(o,f),a.setModules(r),c.setModules(o,g,l,_),l.setModules(_,g,r.enc.psy),g.setModules(o),_.setModules(l),u.setModules(r,o,f),i.setModules(E,S),E.setModules(f,m,a);var b=r.lame_init();b.num_channels=e,b.in_samplerate=n,b.brate=t,b.mode=i_.STEREO,b.quality=3,b.bWriteVbrTag=!1,b.disable_reservoir=!0,b.write_id3tag_automatic=!1,r.lame_init_params(b);var v=1152,y=0|1.25*v+7200,A=cf(y);this.encodeBuffer=function(d,p){e==1&&(p=d),Zm(d.length==p.length),d.length>v&&(v=d.length,y=0|1.25*v+7200,A=cf(y));var M=r.lame_encode_buffer(b,d,p,d.length,A,0,y);return new Int8Array(A.subarray(0,M))},this.flush=function(){var d=r.lame_encode_flush(b,A,0,y);return new Int8Array(A.subarray(0,d))}}function Xr(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function Sa(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}Xr.RIFF=Sa("RIFF"),Xr.WAVE=Sa("WAVE"),Xr.fmt_=Sa("fmt "),Xr.data=Sa("data"),Xr.readHeader=function(e){var n=new Xr,t=e.getUint32(0,!1);if(Xr.RIFF==t&&(e.getUint32(4,!0),Xr.WAVE==e.getUint32(8,!1)&&Xr.fmt_==e.getUint32(12,!1))){var r=e.getUint32(16,!0),i=20;switch(r){case 16:case 18:n.channels=e.getUint16(i+2,!0),n.sampleRate=e.getUint32(i+4,!0);break;default:throw"extended fmt chunk not implemented"}i+=r;for(var s=Xr.data,o=0;s!=t&&(t=e.getUint32(i,!1),o=e.getUint32(i+4,!0),s!=t);)i+=o+8;return n.dataLen=o,n.dataOffset=i+8,n}};var h_=d_;const p_=e=>n=>{const t=e(n);return n.add(t),t},m_=e=>(n,t)=>(e.set(n,t),t),ff=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,df=536870912,hf=df*2,__=(e,n)=>t=>{const r=n.get(t);let i=r===void 0?t.size:r<hf?r+1:0;if(!t.has(i))return e(t,i);if(t.size<df){for(;t.has(i);)i=Math.floor(Math.random()*hf);return e(t,i)}if(t.size>ff)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;t.has(i);)i=Math.floor(Math.random()*ff);return e(t,i)},pf=new WeakMap,g_=m_(pf),tu=__(g_,pf),b_=p_(tu),w_=e=>typeof e.start=="function",mf=new WeakMap,v_=e=>({...e,connect:({call:n})=>async()=>{const{port1:t,port2:r}=new MessageChannel,i=await n("connect",{port:t},[t]);return mf.set(r,i),r},disconnect:({call:n})=>async t=>{const r=mf.get(t);if(r===void 0)throw new Error("The given port is not connected.");await n("disconnect",{portId:r})},isSupported:({call:n})=>()=>n("isSupported")}),nu=new WeakMap,y_=e=>{if(nu.has(e))return nu.get(e);const n=new Map;return nu.set(e,n),n},_f=e=>{const n=v_(e);return t=>{const r=y_(t);t.addEventListener("message",({data:a})=>{const{id:l}=a;if(l!==null&&r.has(l)){const{reject:c,resolve:u}=r.get(l);r.delete(l),a.error===void 0?u(a.result):c(new Error(a.error.message))}}),w_(t)&&t.start();const i=(a,l=null,c=[])=>new Promise((u,f)=>{const m=tu(r);r.set(m,{reject:f,resolve:u}),l===null?t.postMessage({id:m,method:a},c):t.postMessage({id:m,method:a,params:l},c)}),s=(a,l,c=[])=>{t.postMessage({id:null,method:a,params:l},c)};let o={};for(const[a,l]of Object.entries(n))o={...o,[a]:l({call:i,notify:s})};return{...o}}},gf=new Set,E_=_f({encode:({call:e})=>async(n,t)=>{const r=await e("encode",{encoderId:n,timeslice:t});return gf.delete(n),r},instantiate:({call:e})=>async(n,t)=>{const r=b_(gf),i=await e("instantiate",{encoderId:r,mimeType:n,sampleRate:t});return{encoderId:r,port:i}},register:({call:e})=>n=>e("register",{port:n},[n])}),S_=e=>{const n=new Worker(e);return E_(n)},k_=`(()=>{var e={455:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,s=2*o,a=function(e,t){return function(r){var a=t.get(r),c=void 0===a?r.size:a<s?a+1:0;if(!r.has(c))return e(r,c);if(r.size<o){for(;r.has(c);)c=Math.floor(Math.random()*s);return e(r,c)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(c);)c=Math.floor(Math.random()*n);return e(r,c)}},c=new WeakMap,i=r(c),l=a(i,c),u=t(l);e.addUniqueNumber=u,e.generateUniqueNumber=l}(t)}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}(()=>{"use strict";const e=-32603,t=-32602,n=-32601,o=(e,t)=>Object.assign(new Error(e),{status:t}),s=t=>o('The handler of the method called "'.concat(t,'" returned an unexpected result.'),e),a=(t,r)=>async a=>{let{data:{id:c,method:i,params:l}}=a;const u=r[i];try{if(void 0===u)throw(e=>o('The requested method called "'.concat(e,'" is not supported.'),n))(i);const r=void 0===l?u():u(l);if(void 0===r)throw(t=>o('The handler of the method called "'.concat(t,'" returned no required result.'),e))(i);const a=r instanceof Promise?await r:r;if(null===c){if(void 0!==a.result)throw s(i)}else{if(void 0===a.result)throw s(i);const{result:e,transferables:r=[]}=a;t.postMessage({id:c,result:e},r)}}catch(e){const{message:r,status:n=-32603}=e;t.postMessage({error:{code:n,message:r},id:c})}};var c=r(455);const i=new Map,l=(e,r,n)=>({...r,connect:t=>{let{port:n}=t;n.start();const o=e(n,r),s=(0,c.generateUniqueNumber)(i);return i.set(s,(()=>{o(),n.close(),i.delete(s)})),{result:s}},disconnect:e=>{let{portId:r}=e;const n=i.get(r);if(void 0===n)throw(e=>o('The specified parameter called "portId" with the given value "'.concat(e,'" does not identify a port connected to this worker.'),t))(r);return n(),{result:null}},isSupported:async()=>{if(await new Promise((e=>{const t=new ArrayBuffer(0),{port1:r,port2:n}=new MessageChannel;r.onmessage=t=>{let{data:r}=t;return e(null!==r)},n.postMessage(t,[t])}))){const e=n();return{result:e instanceof Promise?await e:e}}return{result:!1}}}),u=function(e,t){const r=l(u,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0),n=a(e,r);return e.addEventListener("message",n),()=>e.removeEventListener("message",n)},d=e=>{e.onmessage=null,e.close()},h=new WeakMap,f=new WeakMap,p=(e=>{const t=(r=e,{...r,connect:e=>{let{call:t}=e;return async()=>{const{port1:e,port2:r}=new MessageChannel,n=await t("connect",{port:e},[e]);return h.set(r,n),r}},disconnect:e=>{let{call:t}=e;return async e=>{const r=h.get(e);if(void 0===r)throw new Error("The given port is not connected.");await t("disconnect",{portId:r})}},isSupported:e=>{let{call:t}=e;return()=>t("isSupported")}});var r;return e=>{const r=(e=>{if(f.has(e))return f.get(e);const t=new Map;return f.set(e,t),t})(e);e.addEventListener("message",(e=>{let{data:t}=e;const{id:n}=t;if(null!==n&&r.has(n)){const{reject:e,resolve:o}=r.get(n);r.delete(n),void 0===t.error?o(t.result):e(new Error(t.error.message))}})),(e=>"function"==typeof e.start)(e)&&e.start();const n=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new Promise(((s,a)=>{const i=(0,c.generateUniqueNumber)(r);r.set(i,{reject:a,resolve:s}),null===n?e.postMessage({id:i,method:t},o):e.postMessage({id:i,method:t,params:n},o)}))},o=function(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e.postMessage({id:null,method:t,params:r},n)};let s={};for(const[e,r]of Object.entries(t))s={...s,[e]:r({call:n,notify:o})};return{...s}}})({characterize:e=>{let{call:t}=e;return()=>t("characterize")},encode:e=>{let{call:t}=e;return(e,r)=>t("encode",{recordingId:e,timeslice:r})},record:e=>{let{call:t}=e;return async(e,r,n)=>{await t("record",{recordingId:e,sampleRate:r,typedArrays:n},n.map((e=>{let{buffer:t}=e;return t})))}}}),w=async(e,t)=>{const r=p(t),n=await r.characterize(),o=n.toString();if(e.has(o))throw new Error("There is already an encoder stored which handles exactly the same mime types.");return e.set(o,[n,r]),n},m=new Map,g=(e=>t=>{const r=e.get(t);if(void 0===r)throw new Error("There was no instance of an encoder stored with the given id.");return r})(m),v=((e,t)=>r=>{const n=t(r);return e.delete(r),n})(m,g),y=new Map,M=((e,t)=>r=>{const[n,o,s,a]=t(r);return s?new Promise((t=>{o.onmessage=s=>{let{data:c}=s;0===c.length?(e(o),t(n.encode(r,null))):n.record(r,a,c)}})):n.encode(r,null)})(d,v),E=(e=>t=>{for(const[r,n]of Array.from(e.values()))if(r.test(t))return n;throw new Error("There is no encoder registered which could handle the given mimeType.")})(y),b=((e,t,r)=>(n,o,s)=>{if(t.has(n))throw new Error('There is already an encoder registered with an id called "'.concat(n,'".'));const a=r(o),{port1:c,port2:i}=new MessageChannel,l=[a,c,!0,s];return t.set(n,l),c.onmessage=t=>{let{data:r}=t;0===r.length?(e(c),l[2]=!1):a.record(n,s,r.map((e=>"number"==typeof e?new Float32Array(e):e)))},i})(d,m,E),T=(e=>(t,r)=>{const[n]=e(t);return n.encode(t,r)})(g);u(self,{encode:async e=>{let{encoderId:t,timeslice:r}=e;const n=null===r?await M(t):await T(t,r);return{result:n,transferables:n}},instantiate:e=>{let{encoderId:t,mimeType:r,sampleRate:n}=e;const o=b(t,r,n);return{result:o,transferables:[o]}},register:async e=>{let{port:t}=e;return{result:await w(y,t)}}})})()})();`,T_=new Blob([k_],{type:"application/javascript; charset=utf-8"}),bf=URL.createObjectURL(T_),ru=S_(bf),ka=ru.encode,wf=ru.instantiate,A_=ru.register;URL.revokeObjectURL(bf);const M_=e=>(n,t)=>{if(e===null)throw new Error("A native BlobEvent could not be created.");return new e(n,t)},C_=(e,n)=>(t,r,i)=>{const s=[];let o=r,a=0;for(;a<t.byteLength;)if(o===null){const l=n(t,a);if(l===null)break;const{length:c,type:u}=l;o=u,a+=c}else{const l=e(t,a,o,i);if(l===null)break;const{content:c,length:u}=l;o=null,a+=u,c!==null&&s.push(c)}return{contents:s,currentElementType:o,offset:a}},R_=(e,n)=>class{constructor(r=null){this._listeners=new WeakMap,this._nativeEventTarget=r===null?e():r}addEventListener(r,i,s){if(i!==null){let o=this._listeners.get(i);o===void 0&&(o=n(this,i),typeof i=="function"&&this._listeners.set(i,o)),this._nativeEventTarget.addEventListener(r,o,s)}}dispatchEvent(r){return this._nativeEventTarget.dispatchEvent(r)}removeEventListener(r,i,s){const o=i===null?void 0:this._listeners.get(i);this._nativeEventTarget.removeEventListener(r,o===void 0?null:o,s)}},L_=e=>()=>{if(e===null)throw new Error("A native EventTarget could not be created.");return e.document.createElement("p")},P_=(e="")=>{try{return new DOMException(e,"InvalidModificationError")}catch(n){return n.code=13,n.message=e,n.name="InvalidModificationError",n}},B_=()=>{try{return new DOMException("","InvalidStateError")}catch(e){return e.code=11,e.name="InvalidStateError",e}},I_=(e,n,t,r,i,s,o)=>class extends s{constructor(l,c={}){const{mimeType:u}=c;if(o!==null&&(u===void 0||o.isTypeSupported!==void 0&&o.isTypeSupported(u))){const f=e(o,l,c);super(f),this._internalMediaRecorder=f}else if(u!==void 0&&i.some(f=>f.test(u)))super(),o!==null&&o.isTypeSupported!==void 0&&o.isTypeSupported("audio/webm;codecs=pcm")?this._internalMediaRecorder=r(this,o,l,u):this._internalMediaRecorder=t(this,l,u);else throw o!==null&&e(o,l,c),n();this._ondataavailable=null,this._onerror=null,this._onpause=null,this._onresume=null,this._onstart=null,this._onstop=null}get mimeType(){return this._internalMediaRecorder.mimeType}get ondataavailable(){return this._ondataavailable===null?this._ondataavailable:this._ondataavailable[0]}set ondataavailable(l){if(this._ondataavailable!==null&&this.removeEventListener("dataavailable",this._ondataavailable[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("dataavailable",c),this._ondataavailable=[l,c]}else this._ondataavailable=null}get onerror(){return this._onerror===null?this._onerror:this._onerror[0]}set onerror(l){if(this._onerror!==null&&this.removeEventListener("error",this._onerror[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("error",c),this._onerror=[l,c]}else this._onerror=null}get onpause(){return this._onpause===null?this._onpause:this._onpause[0]}set onpause(l){if(this._onpause!==null&&this.removeEventListener("pause",this._onpause[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("pause",c),this._onpause=[l,c]}else this._onpause=null}get onresume(){return this._onresume===null?this._onresume:this._onresume[0]}set onresume(l){if(this._onresume!==null&&this.removeEventListener("resume",this._onresume[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("resume",c),this._onresume=[l,c]}else this._onresume=null}get onstart(){return this._onstart===null?this._onstart:this._onstart[0]}set onstart(l){if(this._onstart!==null&&this.removeEventListener("start",this._onstart[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("start",c),this._onstart=[l,c]}else this._onstart=null}get onstop(){return this._onstop===null?this._onstop:this._onstop[0]}set onstop(l){if(this._onstop!==null&&this.removeEventListener("stop",this._onstop[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("stop",c),this._onstop=[l,c]}else this._onstop=null}get state(){return this._internalMediaRecorder.state}pause(){return this._internalMediaRecorder.pause()}resume(){return this._internalMediaRecorder.resume()}start(l){return this._internalMediaRecorder.start(l)}stop(){return this._internalMediaRecorder.stop()}static isTypeSupported(l){return o!==null&&o.isTypeSupported!==void 0&&o.isTypeSupported(l)||i.some(c=>c.test(l))}},O_=e=>e!==null&&e.BlobEvent!==void 0?e.BlobEvent:null,D_=e=>e===null||e.MediaRecorder===void 0?null:e.MediaRecorder,N_=e=>(n,t,r)=>{const i=new Map,s=new WeakMap,o=new WeakMap,a=[],l=new n(t,r),c=new WeakMap;return l.addEventListener("stop",({isTrusted:u})=>{u&&setTimeout(()=>a.shift())}),l.addEventListener=(u=>(f,m,g)=>{let _=m;if(typeof m=="function")if(f==="dataavailable"){const E=[];_=S=>{const[[b,v]=[!1,!1]]=a;b&&!v?E.push(S):m.call(l,S)},i.set(m,E),s.set(m,_)}else f==="error"?(_=E=>{E instanceof ErrorEvent?m.call(l,E):m.call(l,new ErrorEvent("error",{error:E.error}))},o.set(m,_)):f==="stop"&&(_=E=>{for(const[S,b]of i.entries())if(b.length>0){const[v]=b;b.length>1&&Object.defineProperty(v,"data",{value:new Blob(b.map(({data:y})=>y),{type:v.data.type})}),b.length=0,S.call(l,v)}m.call(l,E)},c.set(m,_));return u.call(l,f,_,g)})(l.addEventListener),l.removeEventListener=(u=>(f,m,g)=>{let _=m;if(typeof m=="function"){if(f==="dataavailable"){i.delete(m);const E=s.get(m);E!==void 0&&(_=E)}else if(f==="error"){const E=o.get(m);E!==void 0&&(_=E)}else if(f==="stop"){const E=c.get(m);E!==void 0&&(_=E)}}return u.call(l,f,_,g)})(l.removeEventListener),l.start=(u=>f=>{if(r.mimeType!==void 0&&r.mimeType.startsWith("audio/")&&t.getVideoTracks().length>0)throw e();return l.state==="inactive"&&a.push([f!==void 0,!0]),f===void 0?u.call(l):u.call(l,f)})(l.start),l.stop=(u=>()=>{l.state!=="inactive"&&(a[0][1]=!1),u.call(l)})(l.stop),l},iu=()=>{try{return new DOMException("","NotSupportedError")}catch(e){return e.code=9,e.name="NotSupportedError",e}},F_=e=>(n,t,r,i=2)=>{const s=e(n,t);if(s===null)return s;const{length:o,value:a}=s;if(r==="master")return{content:null,length:o};if(t+o+a>n.byteLength)return null;if(r==="binary"){const l=(a/Float32Array.BYTES_PER_ELEMENT-1)/i,c=Array.from({length:i},()=>new Float32Array(l));for(let u=0;u<l;u+=1){const f=u*i+1;for(let m=0;m<i;m+=1)c[m][u]=n.getFloat32(t+o+(f+m)*Float32Array.BYTES_PER_ELEMENT,!0)}return{content:c,length:o+a}}return{content:null,length:o+a}},$_=e=>(n,t)=>{const r=e(n,t);if(r===null)return r;const{length:i,value:s}=r;return s===35?{length:i,type:"binary"}:s===46||s===97||s===88713574||s===106212971||s===139690087||s===172351395||s===256095861?{length:i,type:"master"}:{length:i,type:"unknown"}},V_=e=>(n,t)=>{const r=e(n,t);if(r===null)return r;const i=t+Math.floor((r-1)/8);if(i+r>n.byteLength)return null;let o=n.getUint8(i)&(1<<8-r%8)-1;for(let a=1;a<r;a+=1)o=(o<<8)+n.getUint8(i+a);return{length:r,value:o}},vf=Symbol.observable||"@@observable";function x_(e){return Symbol.observable||(typeof e=="function"&&e.prototype&&e.prototype[Symbol.observable]?(e.prototype[vf]=e.prototype[Symbol.observable],delete e.prototype[Symbol.observable]):(e[vf]=e[Symbol.observable],delete e[Symbol.observable])),e}const Ta=()=>{},yf=e=>{throw e};function H_(e){return e?e.next&&e.error&&e.complete?e:{complete:(e.complete??Ta).bind(e),error:(e.error??yf).bind(e),next:(e.next??Ta).bind(e)}:{complete:Ta,error:yf,next:Ta}}const U_=e=>(n,t,r)=>e(i=>{const s=o=>i.next(o);return n.addEventListener(t,s,r),()=>n.removeEventListener(t,s,r)}),W_=((e,n)=>{const t=()=>{},r=i=>typeof i[0]=="function";return i=>{const s=(...o)=>{const a=i(r(o)?n({next:o[0]}):n(...o));return a!==void 0?a:t};return s[Symbol.observable]=()=>({subscribe:(...o)=>({unsubscribe:s(...o)})}),e(s)}})(x_,H_),Ef=U_(W_),j_=(e,n,t)=>async r=>{const i=new e([t],{type:"application/javascript; charset=utf-8"}),s=n.createObjectURL(i);try{await r(s)}finally{n.revokeObjectURL(s)}},G_=e=>({data:n})=>{const{id:t}=n;if(t!==null){const r=e.get(t);if(r!==void 0){const{reject:i,resolve:s}=r;e.delete(t),n.error===void 0?s(n.result):i(new Error(n.error.message))}}},z_=e=>(n,t)=>(r,i=[])=>new Promise((s,o)=>{const a=e(n);n.set(a,{reject:o,resolve:s}),t.postMessage({id:a,...r},i)}),X_=(e,n,t,r)=>(i,s,o={})=>{const a=new i(s,"recorder-audio-worklet-processor",{...o,channelCountMode:"explicit",numberOfInputs:1,numberOfOutputs:0}),l=new Map,c=n(l,a.port),u=t(a.port,"message")(e(l));a.port.start();let f="inactive";return Object.defineProperties(a,{pause:{get(){return async()=>(r(["recording"],f),f="paused",c({method:"pause"}))}},port:{get(){throw new Error("The port of a RecorderAudioWorkletNode can't be accessed.")}},record:{get(){return async m=>(r(["inactive"],f),f="recording",c({method:"record",params:{encoderPort:m}},[m]))}},resume:{get(){return async()=>(r(["paused"],f),f="recording",c({method:"resume"}))}},stop:{get(){return async()=>{r(["paused","recording"],f),f="stopped";try{await c({method:"stop"})}finally{u()}}}}}),a},Y_=(e,n)=>{if(!e.includes(n))throw new Error(`Expected the state to be ${e.map(t=>`"${t}"`).join(" or ")} but it was "${n}".`)},q_=j_(Blob,URL,'(()=>{"use strict";class e extends AudioWorkletProcessor{constructor(){super(),this._encoderPort=null,this._numberOfChannels=0,this._state="inactive",this.port.onmessage=e=>{let{data:t}=e;"pause"===t.method?"active"===this._state||"recording"===this._state?(this._state="paused",this._sendAcknowledgement(t.id)):this._sendUnexpectedStateError(t.id):"record"===t.method?"inactive"===this._state?(this._encoderPort=t.params.encoderPort,this._state="active",this._sendAcknowledgement(t.id)):this._sendUnexpectedStateError(t.id):"resume"===t.method?"paused"===this._state?(this._state="active",this._sendAcknowledgement(t.id)):this._sendUnexpectedStateError(t.id):"stop"===t.method?"active"!==this._state&&"paused"!==this._state&&"recording"!==this._state||null===this._encoderPort?this._sendUnexpectedStateError(t.id):(this._stop(this._encoderPort),this._sendAcknowledgement(t.id)):"number"==typeof t.id&&this.port.postMessage({error:{code:-32601,message:"The requested method is not supported."},id:t.id})}}process(e){let[t]=e;if("inactive"===this._state||"paused"===this._state)return!0;if("active"===this._state){if(void 0===t)throw new Error("No channelData was received for the first input.");if(0===t.length)return!0;this._state="recording"}if("recording"===this._state&&null!==this._encoderPort){if(void 0===t)throw new Error("No channelData was received for the first input.");return 0===t.length?this._encoderPort.postMessage(Array.from({length:this._numberOfChannels},(()=>128))):(this._encoderPort.postMessage(t,t.map((e=>{let{buffer:t}=e;return t}))),this._numberOfChannels=t.length),!0}return!1}_sendAcknowledgement(e){this.port.postMessage({id:e,result:null})}_sendUnexpectedStateError(e){this.port.postMessage({error:{code:-32603,message:"The internal state does not allow to process the given message."},id:e})}_stop(e){e.postMessage([]),e.close(),this._encoderPort=null,this._state="stopped"}}e.parameterDescriptors=[],registerProcessor("recorder-audio-worklet-processor",e)})();'),Z_=X_(G_,z_(tu),Ef,Y_),Sf=(e,n,t)=>({endTime:n,insertTime:t,type:"exponentialRampToValue",value:e}),kf=(e,n,t)=>({endTime:n,insertTime:t,type:"linearRampToValue",value:e}),su=(e,n)=>({startTime:n,type:"setValue",value:e}),Tf=(e,n,t)=>({duration:t,startTime:n,type:"setValueCurve",values:e}),Af=(e,n,{startTime:t,target:r,timeConstant:i})=>r+(n-r)*Math.exp((t-e)/i),xs=e=>e.type==="exponentialRampToValue",Aa=e=>e.type==="linearRampToValue",Ci=e=>xs(e)||Aa(e),ou=e=>e.type==="setValue",di=e=>e.type==="setValueCurve",Ma=(e,n,t,r)=>{const i=e[n];return i===void 0?r:Ci(i)||ou(i)?i.value:di(i)?i.values[i.values.length-1]:Af(t,Ma(e,n-1,i.startTime,r),i)},Mf=(e,n,t,r,i)=>t===void 0?[r.insertTime,i]:Ci(t)?[t.endTime,t.value]:ou(t)?[t.startTime,t.value]:di(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,Ma(e,n-1,t.startTime,i)],au=e=>e.type==="cancelAndHold",lu=e=>e.type==="cancelScheduledValues",Ri=e=>au(e)||lu(e)?e.cancelTime:xs(e)||Aa(e)?e.endTime:e.startTime,Cf=(e,n,t,{endTime:r,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((e-n)/(r-n)):0,Rf=(e,n,t,{endTime:r,value:i})=>t+(e-n)/(r-n)*(i-t),K_=(e,n)=>{const t=Math.floor(n),r=Math.ceil(n);return t===r?e[t]:(1-(n-t))*e[t]+(1-(r-n))*e[r]},Q_=(e,{duration:n,startTime:t,values:r})=>{const i=(e-t)/n*(r.length-1);return K_(r,i)},Ca=e=>e.type==="setTarget";class J_{constructor(n){this._automationEvents=[],this._currenTime=0,this._defaultValue=n}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(n){const t=Ri(n);if(au(n)||lu(n)){const r=this._automationEvents.findIndex(s=>lu(n)&&di(s)?s.startTime+s.duration>=t:Ri(s)>=t),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),au(n)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Ci(i)){if(s!==void 0&&Ca(s))throw new Error("The internal list is malformed.");const o=s===void 0?i.insertTime:di(s)?s.startTime+s.duration:Ri(s),a=s===void 0?this._defaultValue:di(s)?s.values[s.values.length-1]:s.value,l=xs(i)?Cf(t,o,a,i):Rf(t,o,a,i),c=xs(i)?Sf(l,t,this._currenTime):kf(l,t,this._currenTime);this._automationEvents.push(c)}if(s!==void 0&&Ca(s)&&this._automationEvents.push(su(this.getValue(t),t)),s!==void 0&&di(s)&&s.startTime+s.duration>t){const o=t-s.startTime,a=(s.values.length-1)/s.duration,l=Math.max(2,1+Math.ceil(o*a)),c=o/(l-1)*a,u=s.values.slice(0,l);if(c<1)for(let f=1;f<l;f+=1){const m=c*f%1;u[f]=s.values[f-1]*(1-m)+s.values[f]*m}this._automationEvents[this._automationEvents.length-1]=Tf(u,s.startTime,o)}}}else{const r=this._automationEvents.findIndex(o=>Ri(o)>t),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&di(i)&&Ri(i)+i.duration>t)return!1;const s=xs(n)?Sf(n.value,n.endTime,this._currenTime):Aa(n)?kf(n.value,t,this._currenTime):n;if(r===-1)this._automationEvents.push(s);else{if(di(n)&&t+n.duration>Ri(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(n){const t=this._automationEvents.findIndex(r=>Ri(r)>n);if(t>1){const r=this._automationEvents.slice(t-1),i=r[0];Ca(i)&&r.unshift(su(Ma(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(n){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>Ri(o)>n),r=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,s=this._automationEvents[i];if(s!==void 0&&Ca(s)&&(r===void 0||!Ci(r)||r.insertTime>n))return Af(n,Ma(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&ou(s)&&(r===void 0||!Ci(r)))return s.value;if(s!==void 0&&di(s)&&(r===void 0||!Ci(r)||s.startTime+s.duration>n))return n<s.startTime+s.duration?Q_(n,s):s.values[s.values.length-1];if(s!==void 0&&Ci(s)&&(r===void 0||!Ci(r)))return s.value;if(r!==void 0&&xs(r)){const[o,a]=Mf(this._automationEvents,i,s,r,this._defaultValue);return Cf(n,o,a,r)}if(r!==void 0&&Aa(r)){const[o,a]=Mf(this._automationEvents,i,s,r,this._defaultValue);return Rf(n,o,a,r)}return this._defaultValue}}const eg=e=>({cancelTime:e,type:"cancelAndHold"}),tg=e=>({cancelTime:e,type:"cancelScheduledValues"}),ng=(e,n)=>({endTime:n,type:"exponentialRampToValue",value:e}),rg=(e,n)=>({endTime:n,type:"linearRampToValue",value:e}),ig=(e,n,t)=>({startTime:n,target:e,timeConstant:t,type:"setTarget"}),sg=()=>new DOMException("","AbortError"),og=e=>(n,t,[r,i,s],o)=>{e(n[i],[t,r,s],a=>a[0]===t&&a[1]===r,o)},ag=e=>(n,t,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);e.set(n,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},lg=e=>(n,t)=>{e.set(n,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},Hs=new WeakSet,Lf=new WeakMap,Pf=new WeakMap,Bf=new WeakMap,If=new WeakMap,Of=new WeakMap,Df=new WeakMap,uu=new WeakMap,cu=new WeakMap,fu=new WeakMap,Nf={construct(){return Nf}},ug=e=>{try{const n=new Proxy(e,Nf);new n}catch{return!1}return!0},Ff=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,$f=(e,n)=>{const t=[];let r=e.replace(/^[\s]+/,""),i=r.match(Ff);for(;i!==null;){const s=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,n).toString());t.push(o),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(Ff)}return[t.join(";"),r]},Vf=e=>{if(e!==void 0&&!Array.isArray(e))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},xf=e=>{if(!ug(e))throw new TypeError("The given value for processorCtor should be a constructor.");if(e.prototype===null||typeof e.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},cg=(e,n,t,r,i,s,o,a,l,c,u,f,m)=>{let g=0;return(_,E,S={credentials:"omit"})=>{const b=u.get(_);if(b!==void 0&&b.has(E))return Promise.resolve();const v=c.get(_);if(v!==void 0){const d=v.get(E);if(d!==void 0)return d}const y=s(_),A=y.audioWorklet===void 0?i(E).then(([d,p])=>{const[M,L]=$f(d,p),D=`${M};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${L}
})})(window,'_AWGS')`;return t(D)}).then(()=>{const d=m._AWGS.pop();if(d===void 0)throw new SyntaxError;r(y.currentTime,y.sampleRate,()=>d(class{},void 0,(p,M)=>{if(p.trim()==="")throw n();const L=cu.get(y);if(L!==void 0){if(L.has(p))throw n();xf(M),Vf(M.parameterDescriptors),L.set(p,M)}else xf(M),Vf(M.parameterDescriptors),cu.set(y,new Map([[p,M]]))},y.sampleRate,void 0,void 0))}):Promise.all([i(E),Promise.resolve(e(f,f))]).then(([[d,p],M])=>{const L=g+1;g=L;const[D,O]=$f(d,p),w=`${D};((AudioWorkletProcessor,registerProcessor)=>{${O}
})(${M?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${M?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${M?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${L}',class extends AudioWorkletProcessor{process(){return !1}})`,N=new Blob([w],{type:"application/javascript; charset=utf-8"}),X=URL.createObjectURL(N);return y.audioWorklet.addModule(X,S).then(()=>{if(a(y))return y;const q=o(y);return q.audioWorklet.addModule(X,S).then(()=>q)}).then(q=>{if(l===null)throw new SyntaxError;try{new l(q,`__sac${L}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(X))});return v===void 0?c.set(_,new Map([[E,A]])):v.set(E,A),A.then(()=>{const d=u.get(_);d===void 0?u.set(_,new Set([E])):d.add(E)}).finally(()=>{const d=c.get(_);d!==void 0&&d.delete(E)}),A}},Dr=(e,n)=>{const t=e.get(n);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},Ra=(e,n)=>{const t=Array.from(e).filter(n);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[r]=t;return e.delete(r),r},Hf=(e,n,t,r)=>{const i=Dr(e,n),s=Ra(i,o=>o[0]===t&&o[1]===r);return i.size===0&&e.delete(n),s},Co=e=>Dr(Df,e),La=e=>{if(Hs.has(e))throw new Error("The AudioNode is already stored.");Hs.add(e),Co(e).forEach(n=>n(!0))},Uf=e=>"port"in e,du=e=>{if(!Hs.has(e))throw new Error("The AudioNode is not stored.");Hs.delete(e),Co(e).forEach(n=>n(!1))},hu=(e,n)=>{!Uf(e)&&n.every(t=>t.size===0)&&du(e)},fg=(e,n,t,r,i,s,o,a,l,c,u,f,m)=>{const g=new WeakMap;return(_,E,S,b,v)=>{const{activeInputs:y,passiveInputs:A}=s(E),{outputs:d}=s(_),p=a(_),M=L=>{const D=l(E),O=l(_);if(L){const x=Hf(A,_,S,b);e(y,_,x,!1),!v&&!f(_)&&t(O,D,S,b),m(E)&&La(E)}else{const x=r(y,_,S,b);n(A,b,x,!1),!v&&!f(_)&&i(O,D,S,b);const Y=o(E);if(Y===0)u(E)&&hu(E,y);else{const R=g.get(E);R!==void 0&&clearTimeout(R),g.set(E,setTimeout(()=>{u(E)&&hu(E,y)},Y*1e3))}}};return c(d,[E,S,b],L=>L[0]===E&&L[1]===S&&L[2]===b,!0)?(p.add(M),u(_)?e(y,_,[S,b,M],!0):n(A,b,[_,S,M],!0),!0):!1}},dg=e=>(n,t,[r,i,s],o)=>{const a=n.get(r);a===void 0?n.set(r,new Set([[i,t,s]])):e(a,[i,t,s],l=>l[0]===i&&l[1]===t,o)},hg=e=>(n,t)=>{const r=e(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(r).connect(n.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(r),r.disconnect()};t.addEventListener("ended",i)},pg=e=>(n,t)=>{e(n).add(t)},Wf=(e,n)=>e.context===n,jf=e=>{try{e.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Zi=()=>new DOMException("","IndexSizeError"),mg=e=>{e.getChannelData=(n=>t=>{try{return n.call(e,t)}catch(r){throw r.code===12?Zi():r}})(e.getChannelData)},_g={numberOfChannels:1},gg=(e,n,t,r,i,s,o,a)=>{let l=null;return class yh{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:f,numberOfChannels:m,sampleRate:g}={..._g,...u};l===null&&(l=new i(1,1,44100));const _=r!==null&&n(s,s)?new r({length:f,numberOfChannels:m,sampleRate:g}):l.createBuffer(m,f,g);if(_.numberOfChannels===0)throw t();return typeof _.copyFromChannel!="function"?(o(_),mg(_)):n(jf,()=>jf(_))||a(_),e.add(_),_}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===yh.prototype||e.has(u)}}},Pa=-34028234663852886e22,pu=-Pa,Ki=e=>Hs.has(e),bg={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},wg=(e,n,t,r,i,s,o,a)=>class extends e{constructor(c,u){const f=s(c),m={...bg,...u},g=i(f,m),_=o(f),E=_?n():null;super(c,!1,g,E),this._audioBufferSourceNodeRenderer=E,this._isBufferNullified=!1,this._isBufferSet=m.buffer!==null,this._nativeAudioBufferSourceNode=g,this._onended=null,this._playbackRate=t(this,_,g.playbackRate,pu,Pa)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(c){if(this._nativeAudioBufferSourceNode.buffer=c,c!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(c){this._nativeAudioBufferSourceNode.loop=c}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(c){this._nativeAudioBufferSourceNode.loopEnd=c}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(c){this._nativeAudioBufferSourceNode.loopStart=c}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?a(this,c):null;this._nativeAudioBufferSourceNode.onended=u;const f=this._nativeAudioBufferSourceNode.onended;this._onended=f!==null&&f===u?c:f}get playbackRate(){return this._playbackRate}start(c=0,u=0,f){if(this._nativeAudioBufferSourceNode.start(c,u,f),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=f===void 0?[c,u]:[c,u,f]),this.context.state!=="closed"){La(this);const m=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",m),Ki(this)&&du(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",m)}}stop(c=0){this._nativeAudioBufferSourceNode.stop(c),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=c)}},vg=(e,n,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const l=async(c,u)=>{let f=t(c);const m=Wf(f,u);if(!m){const g={buffer:f.buffer,channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,loop:f.loop,loopEnd:f.loopEnd,loopStart:f.loopStart,playbackRate:f.playbackRate.value};f=n(u,g),o!==null&&f.start(...o),a!==null&&f.stop(a)}return s.set(u,f),m?await e(u,c.playbackRate,f.playbackRate):await r(u,c.playbackRate,f.playbackRate),await i(c,u,f),f};return{set start(c){o=c},set stop(c){a=c},render(c,u){const f=s.get(u);return f!==void 0?Promise.resolve(f):l(c,u)}}},yg=e=>"playbackRate"in e,Eg=e=>"frequency"in e&&"gain"in e,Sg=e=>"offset"in e,kg=e=>!("frequency"in e)&&"gain"in e,Tg=e=>"detune"in e&&"frequency"in e,Ag=e=>"pan"in e,or=e=>Dr(Lf,e),Ro=e=>Dr(Bf,e),mu=(e,n)=>{const{activeInputs:t}=or(e);t.forEach(i=>i.forEach(([s])=>{n.includes(e)||mu(s,[...n,e])}));const r=yg(e)?[e.playbackRate]:Uf(e)?Array.from(e.parameters.values()):Eg(e)?[e.Q,e.detune,e.frequency,e.gain]:Sg(e)?[e.offset]:kg(e)?[e.gain]:Tg(e)?[e.detune,e.frequency]:Ag(e)?[e.pan]:[];for(const i of r){const s=Ro(i);s!==void 0&&s.activeInputs.forEach(([o])=>mu(o,n))}Ki(e)&&du(e)},Mg=e=>{mu(e.destination,[])},Cg=e=>e===void 0||typeof e=="number"||typeof e=="string"&&(e==="balanced"||e==="interactive"||e==="playback"),Rg=(e,n,t,r,i,s,o,a)=>class extends e{constructor(c,u){const f=s(c),m=o(f),g=i(f,u,m),_=m?n(a):null;super(c,!1,g,_),this._isNodeOfNativeOfflineAudioContext=m,this._nativeAudioDestinationNode=g}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(c){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(c>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=c}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(c){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=c}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},Lg=e=>{const n=new WeakMap,t=async(r,i)=>{const s=i.destination;return n.set(i,s),await e(r,i,s),s};return{render(r,i){const s=n.get(i);return s!==void 0?Promise.resolve(s):t(r,i)}}},Pg=(e,n,t,r,i,s,o,a)=>(l,c)=>{const u=c.listener,f=()=>{const d=new Float32Array(1),p=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),M=o(c);let L=!1,D=[0,0,-1,0,1,0],O=[0,0,0];const x=()=>{if(L)return;L=!0;const N=r(c,256,9,0);N.onaudioprocess=({inputBuffer:X})=>{const q=[s(X,d,0),s(X,d,1),s(X,d,2),s(X,d,3),s(X,d,4),s(X,d,5)];q.some((ne,U)=>ne!==D[U])&&(u.setOrientation(...q),D=q);const Z=[s(X,d,6),s(X,d,7),s(X,d,8)];Z.some((ne,U)=>ne!==O[U])&&(u.setPosition(...Z),O=Z)},p.connect(N)},Y=N=>X=>{X!==D[N]&&(D[N]=X,u.setOrientation(...D))},R=N=>X=>{X!==O[N]&&(O[N]=X,u.setPosition(...O))},w=(N,X,q)=>{const Z=t(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:X});Z.connect(p,0,N),Z.start(),Object.defineProperty(Z.offset,"defaultValue",{get(){return X}});const ne=e({context:l},M,Z.offset,pu,Pa);return a(ne,"value",U=>()=>U.call(ne),U=>F=>{try{U.call(ne,F)}catch(C){if(C.code!==9)throw C}x(),M&&q(F)}),ne.cancelAndHoldAtTime=(U=>M?()=>{throw i()}:(...F)=>{const C=U.apply(ne,F);return x(),C})(ne.cancelAndHoldAtTime),ne.cancelScheduledValues=(U=>M?()=>{throw i()}:(...F)=>{const C=U.apply(ne,F);return x(),C})(ne.cancelScheduledValues),ne.exponentialRampToValueAtTime=(U=>M?()=>{throw i()}:(...F)=>{const C=U.apply(ne,F);return x(),C})(ne.exponentialRampToValueAtTime),ne.linearRampToValueAtTime=(U=>M?()=>{throw i()}:(...F)=>{const C=U.apply(ne,F);return x(),C})(ne.linearRampToValueAtTime),ne.setTargetAtTime=(U=>M?()=>{throw i()}:(...F)=>{const C=U.apply(ne,F);return x(),C})(ne.setTargetAtTime),ne.setValueAtTime=(U=>M?()=>{throw i()}:(...F)=>{const C=U.apply(ne,F);return x(),C})(ne.setValueAtTime),ne.setValueCurveAtTime=(U=>M?()=>{throw i()}:(...F)=>{const C=U.apply(ne,F);return x(),C})(ne.setValueCurveAtTime),ne};return{forwardX:w(0,0,Y(0)),forwardY:w(1,0,Y(1)),forwardZ:w(2,-1,Y(2)),positionX:w(6,0,R(0)),positionY:w(7,0,R(1)),positionZ:w(8,0,R(2)),upX:w(3,0,Y(3)),upY:w(4,1,Y(4)),upZ:w(5,0,Y(5))}},{forwardX:m,forwardY:g,forwardZ:_,positionX:E,positionY:S,positionZ:b,upX:v,upY:y,upZ:A}=u.forwardX===void 0?f():u;return{get forwardX(){return m},get forwardY(){return g},get forwardZ(){return _},get positionX(){return E},get positionY(){return S},get positionZ(){return b},get upX(){return v},get upY(){return y},get upZ(){return A}}},Ba=e=>"context"in e,Lo=e=>Ba(e[0]),Qi=(e,n,t,r)=>{for(const i of e)if(t(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return e.add(n),!0},Gf=(e,n,[t,r],i)=>{Qi(e,[n,t,r],s=>s[0]===n&&s[1]===t,i)},zf=(e,[n,t,r],i)=>{const s=e.get(n);s===void 0?e.set(n,new Set([[t,r]])):Qi(s,[t,r],o=>o[0]===t,i)},Xf=e=>"inputs"in e,_u=(e,n,t,r)=>{if(Xf(n)){const i=n.inputs[r];return e.connect(i,t,0),[i,t,0]}return e.connect(n,t,r),[n,t,r]},Yf=(e,n,t)=>{for(const r of e)if(r[0]===n&&r[1]===t)return e.delete(r),r;return null},Bg=(e,n,t)=>Ra(e,r=>r[0]===n&&r[1]===t),qf=(e,n)=>{if(!Co(e).delete(n))throw new Error("Missing the expected event listener.")},Zf=(e,n,t)=>{const r=Dr(e,n),i=Ra(r,s=>s[0]===t);return r.size===0&&e.delete(n),i},gu=(e,n,t,r)=>{Xf(n)?e.disconnect(n.inputs[r],t,0):e.disconnect(n,t,r)},Nr=e=>Dr(Pf,e),Po=e=>Dr(If,e),Ji=e=>uu.has(e),Ia=e=>!Hs.has(e),Kf=(e,n)=>new Promise(t=>{if(n!==null)t(!0);else{const r=e.createScriptProcessor(256,1,1),i=e.createGain(),s=e.createBuffer(1,2,44100),o=s.getChannelData(0);o[0]=1,o[1]=1;const a=e.createBufferSource();a.buffer=s,a.loop=!0,a.connect(r).connect(e.destination),a.connect(i),a.disconnect(i),r.onaudioprocess=l=>{const c=l.inputBuffer.getChannelData(0);Array.prototype.some.call(c,u=>u===1)?t(!0):t(!1),a.stop(),r.onaudioprocess=null,a.disconnect(r),r.disconnect(e.destination)},a.start()}}),bu=(e,n)=>{const t=new Map;for(const r of e)for(const i of r){const s=t.get(i);t.set(i,s===void 0?1:s+1)}t.forEach((r,i)=>n(i,r))},Oa=e=>"context"in e,Ig=e=>{const n=new Map;e.connect=(t=>(r,i=0,s=0)=>{const o=Oa(r)?t(r,i,s):t(r,i),a=n.get(r);return a===void 0?n.set(r,[{input:s,output:i}]):a.every(l=>l.input!==s||l.output!==i)&&a.push({input:s,output:i}),o})(e.connect.bind(e)),e.disconnect=(t=>(r,i,s)=>{if(t.apply(e),r===void 0)n.clear();else if(typeof r=="number")for(const[o,a]of n){const l=a.filter(c=>c.output!==r);l.length===0?n.delete(o):n.set(o,l)}else if(n.has(r))if(i===void 0)n.delete(r);else{const o=n.get(r);if(o!==void 0){const a=o.filter(l=>l.output!==i&&(l.input!==s||s===void 0));a.length===0?n.delete(r):n.set(r,a)}}for(const[o,a]of n)a.forEach(l=>{Oa(o)?e.connect(o,l.output,l.input):e.connect(o,l.output)})})(e.disconnect)},Og=(e,n,t,r)=>{const{activeInputs:i,passiveInputs:s}=Ro(n),{outputs:o}=or(e),a=Co(e),l=c=>{const u=Nr(e),f=Po(n);if(c){const m=Zf(s,e,t);Gf(i,e,m,!1),!r&&!Ji(e)&&u.connect(f,t)}else{const m=Bg(i,e,t);zf(s,m,!1),!r&&!Ji(e)&&u.disconnect(f,t)}};return Qi(o,[n,t],c=>c[0]===n&&c[1]===t,!0)?(a.add(l),Ki(e)?Gf(i,e,[t,l],!0):zf(s,[e,t,l],!0),!0):!1},Dg=(e,n,t,r)=>{const{activeInputs:i,passiveInputs:s}=or(n),o=Yf(i[r],e,t);return o===null?[Hf(s,e,t,r)[2],!1]:[o[2],!0]},Ng=(e,n,t)=>{const{activeInputs:r,passiveInputs:i}=Ro(n),s=Yf(r,e,t);return s===null?[Zf(i,e,t)[1],!1]:[s[2],!0]},wu=(e,n,t,r,i)=>{const[s,o]=Dg(e,t,r,i);if(s!==null&&(qf(e,s),o&&!n&&!Ji(e)&&gu(Nr(e),Nr(t),r,i)),Ki(t)){const{activeInputs:a}=or(t);hu(t,a)}},vu=(e,n,t,r)=>{const[i,s]=Ng(e,t,r);i!==null&&(qf(e,i),s&&!n&&!Ji(e)&&Nr(e).disconnect(Po(t),r))},Fg=(e,n)=>{const t=or(e),r=[];for(const i of t.outputs)Lo(i)?wu(e,n,...i):vu(e,n,...i),r.push(i[0]);return t.outputs.clear(),r},$g=(e,n,t)=>{const r=or(e),i=[];for(const s of r.outputs)s[1]===t&&(Lo(s)?wu(e,n,...s):vu(e,n,...s),i.push(s[0]),r.outputs.delete(s));return i},Vg=(e,n,t,r,i)=>{const s=or(e);return Array.from(s.outputs).filter(o=>o[0]===t&&(r===void 0||o[1]===r)&&(i===void 0||o[2]===i)).map(o=>(Lo(o)?wu(e,n,...o):vu(e,n,...o),s.outputs.delete(o),o[0]))},xg=(e,n,t,r,i,s,o,a,l,c,u,f,m,g,_,E)=>class extends c{constructor(b,v,y,A){super(y),this._context=b,this._nativeAudioNode=y;const d=u(b);f(d)&&t(Kf,()=>Kf(d,E))!==!0&&Ig(y),Pf.set(this,y),Df.set(this,new Set),b.state!=="closed"&&v&&La(this),e(this,A,y)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(b){this._nativeAudioNode.channelCount=b}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(b){this._nativeAudioNode.channelCountMode=b}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(b){this._nativeAudioNode.channelInterpretation=b}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(b,v=0,y=0){if(v<0||v>=this._nativeAudioNode.numberOfOutputs)throw i();const A=u(this._context),d=_(A);if(m(b)||g(b))throw s();if(Ba(b)){const L=Nr(b);try{const O=_u(this._nativeAudioNode,L,v,y),x=Ia(this);(d||x)&&this._nativeAudioNode.disconnect(...O),this.context.state!=="closed"&&!x&&Ia(b)&&La(b)}catch(O){throw O.code===12?s():O}if(n(this,b,v,y,d)){const O=l([this],b);bu(O,r(d))}return b}const p=Po(b);if(p.name==="playbackRate"&&p.maxValue===1024)throw o();try{this._nativeAudioNode.connect(p,v),(d||Ia(this))&&this._nativeAudioNode.disconnect(p,v)}catch(L){throw L.code===12?s():L}if(Og(this,b,v,d)){const L=l([this],b);bu(L,r(d))}}disconnect(b,v,y){let A;const d=u(this._context),p=_(d);if(b===void 0)A=Fg(this,p);else if(typeof b=="number"){if(b<0||b>=this.numberOfOutputs)throw i();A=$g(this,p,b)}else{if(v!==void 0&&(v<0||v>=this.numberOfOutputs)||Ba(b)&&y!==void 0&&(y<0||y>=b.numberOfInputs))throw i();if(A=Vg(this,p,b,v,y),A.length===0)throw s()}for(const M of A){const L=l([this],M);bu(L,a)}}},Hg=(e,n,t,r,i,s,o,a,l,c,u,f,m)=>(g,_,E,S=null,b=null)=>{const v=E.value,y=new J_(v),A=_?r(y):null,d={get defaultValue(){return v},get maxValue(){return S===null?E.maxValue:S},get minValue(){return b===null?E.minValue:b},get value(){return E.value},set value(p){E.value=p,d.setValueAtTime(p,g.context.currentTime)},cancelAndHoldAtTime(p){if(typeof E.cancelAndHoldAtTime=="function")A===null&&y.flush(g.context.currentTime),y.add(i(p)),E.cancelAndHoldAtTime(p);else{const M=Array.from(y).pop();A===null&&y.flush(g.context.currentTime),y.add(i(p));const L=Array.from(y).pop();E.cancelScheduledValues(p),M!==L&&L!==void 0&&(L.type==="exponentialRampToValue"?E.exponentialRampToValueAtTime(L.value,L.endTime):L.type==="linearRampToValue"?E.linearRampToValueAtTime(L.value,L.endTime):L.type==="setValue"?E.setValueAtTime(L.value,L.startTime):L.type==="setValueCurve"&&E.setValueCurveAtTime(L.values,L.startTime,L.duration))}return d},cancelScheduledValues(p){return A===null&&y.flush(g.context.currentTime),y.add(s(p)),E.cancelScheduledValues(p),d},exponentialRampToValueAtTime(p,M){if(p===0)throw new RangeError;if(!Number.isFinite(M)||M<0)throw new RangeError;const L=g.context.currentTime;return A===null&&y.flush(L),Array.from(y).length===0&&(y.add(c(v,L)),E.setValueAtTime(v,L)),y.add(o(p,M)),E.exponentialRampToValueAtTime(p,M),d},linearRampToValueAtTime(p,M){const L=g.context.currentTime;return A===null&&y.flush(L),Array.from(y).length===0&&(y.add(c(v,L)),E.setValueAtTime(v,L)),y.add(a(p,M)),E.linearRampToValueAtTime(p,M),d},setTargetAtTime(p,M,L){return A===null&&y.flush(g.context.currentTime),y.add(l(p,M,L)),E.setTargetAtTime(p,M,L),d},setValueAtTime(p,M){return A===null&&y.flush(g.context.currentTime),y.add(c(p,M)),E.setValueAtTime(p,M),d},setValueCurveAtTime(p,M,L){const D=p instanceof Float32Array?p:new Float32Array(p);if(f!==null&&f.name==="webkitAudioContext"){const O=M+L,x=g.context.sampleRate,Y=Math.ceil(M*x),R=Math.floor(O*x),w=R-Y,N=new Float32Array(w);for(let q=0;q<w;q+=1){const Z=(D.length-1)/L*((Y+q)/x-M),ne=Math.floor(Z),U=Math.ceil(Z);N[q]=ne===U?D[ne]:(1-(Z-ne))*D[ne]+(1-(U-Z))*D[U]}A===null&&y.flush(g.context.currentTime),y.add(u(N,M,L)),E.setValueCurveAtTime(N,M,L);const X=R/x;X<O&&m(d,N[N.length-1],X),m(d,D[D.length-1],O)}else A===null&&y.flush(g.context.currentTime),y.add(u(D,M,L)),E.setValueCurveAtTime(D,M,L);return d}};return t.set(d,E),n.set(d,g),e(d,A),d},Ug=e=>({replay(n){for(const t of e)if(t.type==="exponentialRampToValue"){const{endTime:r,value:i}=t;n.exponentialRampToValueAtTime(i,r)}else if(t.type==="linearRampToValue"){const{endTime:r,value:i}=t;n.linearRampToValueAtTime(i,r)}else if(t.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=t;n.setTargetAtTime(i,r,s)}else if(t.type==="setValue"){const{startTime:r,value:i}=t;n.setValueAtTime(i,r)}else if(t.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=t;n.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class Qf{constructor(n){this._map=new Map(n)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(n,t=null){return this._map.forEach((r,i)=>n.call(t,r,i,this))}get(n){return this._map.get(n)}has(n){return this._map.has(n)}keys(){return this._map.keys()}values(){return this._map.values()}}const Wg={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},jg=(e,n,t,r,i,s,o,a,l,c,u,f,m,g)=>class extends n{constructor(E,S,b){var v;const y=a(E),A=l(y),d=u({...Wg,...b});m(d);const p=cu.get(y),M=p==null?void 0:p.get(S),L=A||y.state!=="closed"?y:(v=o(y))!==null&&v!==void 0?v:y,D=i(L,A?null:E.baseLatency,c,S,M,d),O=A?r(S,d,M):null;super(E,!0,D,O);const x=[];D.parameters.forEach((R,w)=>{const N=t(this,A,R);x.push([w,N])}),this._nativeAudioWorkletNode=D,this._onprocessorerror=null,this._parameters=new Qf(x),A&&e(y,this);const{activeInputs:Y}=s(this);f(D,Y)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(E){const S=typeof E=="function"?g(this,E):null;this._nativeAudioWorkletNode.onprocessorerror=S;const b=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=b!==null&&b===S?E:b}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function Da(e,n,t,r,i){if(typeof e.copyFromChannel=="function")n[t].byteLength===0&&(n[t]=new Float32Array(128)),e.copyFromChannel(n[t],r,i);else{const s=e.getChannelData(r);if(n[t].byteLength===0)n[t]=s.slice(i,i+128);else{const o=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);n[t].set(o)}}}const Jf=(e,n,t,r,i)=>{typeof e.copyToChannel=="function"?n[t].byteLength!==0&&e.copyToChannel(n[t],r,i):n[t].byteLength!==0&&e.getChannelData(r).set(n[t],i)},Na=(e,n)=>{const t=[];for(let r=0;r<e;r+=1){const i=[],s=typeof n=="number"?n:n[r];for(let o=0;o<s;o+=1)i.push(new Float32Array(128));t.push(i)}return t},Gg=(e,n)=>{const t=Dr(fu,e),r=Nr(n);return Dr(t,r)},zg=async(e,n,t,r,i,s,o)=>{const a=n===null?Math.ceil(e.context.length/128)*128:n.length,l=r.channelCount*r.numberOfInputs,c=i.reduce((S,b)=>S+b,0),u=c===0?null:t.createBuffer(c,a,t.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const f=or(e),m=await Gg(t,e),g=Na(r.numberOfInputs,r.channelCount),_=Na(r.numberOfOutputs,i),E=Array.from(e.parameters.keys()).reduce((S,b)=>({...S,[b]:new Float32Array(128)}),{});for(let S=0;S<a;S+=128){if(r.numberOfInputs>0&&n!==null)for(let b=0;b<r.numberOfInputs;b+=1)for(let v=0;v<r.channelCount;v+=1)Da(n,g[b],v,v,S);s.parameterDescriptors!==void 0&&n!==null&&s.parameterDescriptors.forEach(({name:b},v)=>{Da(n,E,b,l+v,S)});for(let b=0;b<r.numberOfInputs;b+=1)for(let v=0;v<i[b];v+=1)_[b][v].byteLength===0&&(_[b][v]=new Float32Array(128));try{const b=g.map((y,A)=>f.activeInputs[A].size===0?[]:y),v=o(S/t.sampleRate,t.sampleRate,()=>m.process(b,_,E));if(u!==null)for(let y=0,A=0;y<r.numberOfOutputs;y+=1){for(let d=0;d<i[y];d+=1)Jf(u,_[y],d,A+d,S);A+=i[y]}if(!v)break}catch(b){e.dispatchEvent(new ErrorEvent("processorerror",{colno:b.colno,filename:b.filename,lineno:b.lineno,message:b.message}));break}}return u},Xg=(e,n,t,r,i,s,o,a,l,c,u,f,m,g,_,E)=>(S,b,v)=>{const y=new WeakMap;let A=null;const d=async(p,M)=>{let L=u(p),D=null;const O=Wf(L,M),x=Array.isArray(b.outputChannelCount)?b.outputChannelCount:Array.from(b.outputChannelCount);if(f===null){const Y=x.reduce((X,q)=>X+q,0),R=i(M,{channelCount:Math.max(1,Y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,Y)}),w=[];for(let X=0;X<p.numberOfOutputs;X+=1)w.push(r(M,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:x[X]}));const N=o(M,{channelCount:b.channelCount,channelCountMode:b.channelCountMode,channelInterpretation:b.channelInterpretation,gain:1});N.connect=n.bind(null,w),N.disconnect=l.bind(null,w),D=[R,w,N]}else O||(L=new f(M,S));if(y.set(M,D===null?L:D[2]),D!==null){if(A===null){if(v===void 0)throw new Error("Missing the processor constructor.");if(m===null)throw new Error("Missing the native OfflineAudioContext constructor.");const q=p.channelCount*p.numberOfInputs,Z=v.parameterDescriptors===void 0?0:v.parameterDescriptors.length,ne=q+Z;A=zg(p,ne===0?null:await(async()=>{const F=new m(ne,Math.ceil(p.context.length/128)*128,M.sampleRate),C=[],P=[];for(let K=0;K<b.numberOfInputs;K+=1)C.push(o(F,{channelCount:b.channelCount,channelCountMode:b.channelCountMode,channelInterpretation:b.channelInterpretation,gain:1})),P.push(i(F,{channelCount:b.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:b.channelCount}));const I=await Promise.all(Array.from(p.parameters.values()).map(async K=>{const he=s(F,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:K.value});return await g(F,K,he.offset),he})),H=r(F,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,q+Z)});for(let K=0;K<b.numberOfInputs;K+=1){C[K].connect(P[K]);for(let he=0;he<b.channelCount;he+=1)P[K].connect(H,he,K*b.channelCount+he)}for(const[K,he]of I.entries())he.connect(H,0,q+K),he.start(0);return H.connect(F.destination),await Promise.all(C.map(K=>_(p,F,K))),E(F)})(),M,b,x,v,c)}const Y=await A,R=t(M,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[w,N,X]=D;Y!==null&&(R.buffer=Y,R.start(0)),R.connect(w);for(let q=0,Z=0;q<p.numberOfOutputs;q+=1){const ne=N[q];for(let U=0;U<x[q];U+=1)w.connect(ne,Z+U,U);Z+=x[q]}return X}if(O)for(const[Y,R]of p.parameters.entries())await e(M,R,L.parameters.get(Y));else for(const[Y,R]of p.parameters.entries())await g(M,R,L.parameters.get(Y));return await _(p,M,L),L};return{render(p,M){a(M,p);const L=y.get(M);return L!==void 0?Promise.resolve(L):d(p,M)}}},Yg=(e,n)=>(t,r)=>{const i=n.get(t);if(i!==void 0)return i;const s=e.get(t);if(s!==void 0)return s;try{const o=r();return o instanceof Promise?(e.set(t,o),o.catch(()=>!1).then(a=>(e.delete(t),n.set(t,a),a))):(n.set(t,o),o)}catch{return n.set(t,!1),!1}},qg=e=>(n,t,r)=>e(t,n,r),Zg=e=>(n,t,r=0,i=0)=>{const s=n[r];if(s===void 0)throw e();return Oa(t)?s.connect(t,0,i):s.connect(t,0)},Kg=e=>n=>(e[0]=n,e[0]),Qg=(e,n,t,r,i,s,o,a)=>(l,c)=>{const u=n.get(l);if(u===void 0)throw new Error("Missing the expected cycle count.");const f=s(l.context),m=a(f);if(u===c){if(n.delete(l),!m&&o(l)){const g=r(l),{outputs:_}=t(l);for(const E of _)if(Lo(E)){const S=r(E[0]);e(g,S,E[1],E[2])}else{const S=i(E[0]);g.connect(S,E[1])}}}else n.set(l,u-c)},Jg=e=>(n,t,r,i)=>e(n[i],s=>s[0]===t&&s[1]===r),eb=e=>(n,t)=>{e(n).delete(t)},tb=e=>"delayTime"in e,nb=(e,n,t)=>function r(i,s){const o=Ba(s)?s:t(e,s);if(tb(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=n(o);return Array.from(a).map(l=>r([...i,o],l[0])).reduce((l,c)=>l.concat(c),[])},Fa=(e,n,t)=>{const r=n[t];if(r===void 0)throw e();return r},rb=e=>(n,t=void 0,r=void 0,i=0)=>t===void 0?n.forEach(s=>s.disconnect()):typeof t=="number"?Fa(e,n,t).disconnect():Oa(t)?r===void 0?n.forEach(s=>s.disconnect(t)):i===void 0?Fa(e,n,r).disconnect(t,0):Fa(e,n,r).disconnect(t,0,i):r===void 0?n.forEach(s=>s.disconnect(t)):Fa(e,n,r).disconnect(t,0),ib=e=>n=>new Promise((t,r)=>{if(e===null){r(new SyntaxError);return}const i=e.document.head;if(i===null)r(new SyntaxError);else{const s=e.document.createElement("script"),o=new Blob([n],{type:"application/javascript"}),a=URL.createObjectURL(o),l=e.onerror,c=()=>{e.onerror=l,URL.revokeObjectURL(a)};e.onerror=(u,f,m,g,_)=>{if(f===a||f===e.location.href&&m===1&&g===1)return c(),r(_),!1;if(l!==null)return l(u,f,m,g,_)},s.onerror=()=>{c(),r(new SyntaxError)},s.onload=()=>{c(),t()},s.src=a,s.type="module",i.appendChild(s)}}),sb=e=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=e(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(t,s,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(t,s===void 0?null:s,i)}},ob=e=>(n,t,r)=>{Object.defineProperties(e,{currentFrame:{configurable:!0,get(){return Math.round(n*t)}},currentTime:{configurable:!0,get(){return n}}});try{return r()}finally{e!==null&&(delete e.currentFrame,delete e.currentTime)}},ab=e=>async n=>{try{const t=await fetch(n);if(t.ok)return[await t.text(),t.url]}catch{}throw e()},lb=(e,n)=>t=>n(e,t),ub=e=>n=>{const t=e(n);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},cb=e=>n=>{var t;return(t=e.get(n))!==null&&t!==void 0?t:0},fb=e=>n=>{const t=e(n);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},db=e=>n=>e.get(n),Fr=()=>new DOMException("","InvalidStateError"),hb=e=>n=>{const t=e.get(n);if(t===void 0)throw Fr();return t},pb=(e,n)=>t=>{let r=e.get(t);if(r!==void 0)return r;if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new n(1,1,44100),e.set(t,r),r},mb=e=>n=>{const t=e.get(n);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},_b=()=>new DOMException("","InvalidAccessError"),gb=(e,n,t,r,i,s)=>o=>(a,l)=>{const c=e.get(a);if(c===void 0){if(!o&&s(a)){const u=r(a),{outputs:f}=t(a);for(const m of f)if(Lo(m)){const g=r(m[0]);n(u,g,m[1],m[2])}else{const g=i(m[0]);u.disconnect(g,m[1])}}e.set(a,l)}else e.set(a,c+l)},bb=e=>n=>e!==null&&n instanceof e,wb=e=>n=>e!==null&&typeof e.AudioNode=="function"&&n instanceof e.AudioNode,vb=e=>n=>e!==null&&typeof e.AudioParam=="function"&&n instanceof e.AudioParam,yb=e=>n=>e!==null&&n instanceof e,Eb=e=>e!==null&&e.isSecureContext,Sb=(e,n,t,r)=>class extends e{constructor(s,o){const a=t(s),l=n(a,o);if(r(a))throw new TypeError;super(s,!0,l,null),this._nativeMediaStreamAudioSourceNode=l}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},kb=(e,n,t,r,i)=>class extends r{constructor(o={}){if(i===null)throw new Error("Missing the native AudioContext constructor.");let a;try{a=new i(o)}catch(u){throw u.code===12&&u.message==="sampleRate is not in range"?n():u}if(a===null)throw t();if(!Cg(o.latencyHint))throw new TypeError(`The provided value '${o.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(o.sampleRate!==void 0&&a.sampleRate!==o.sampleRate)throw n();super(a,2);const{latencyHint:l}=o,{sampleRate:c}=a;if(this._baseLatency=typeof a.baseLatency=="number"?a.baseLatency:l==="balanced"?512/c:l==="interactive"||l===void 0?256/c:l==="playback"?1024/c:Math.max(2,Math.min(128,Math.round(l*c/128)))*128/c,this._nativeAudioContext=a,i.name==="webkitAudioContext"?(this._nativeGainNode=a.createGain(),this._nativeOscillatorNode=a.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(a.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,a.state==="running"){this._state="suspended";const u=()=>{this._state==="suspended"&&(this._state=null),a.removeEventListener("statechange",u)};a.addEventListener("statechange",u)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Mg(this)}))}resume(){return this._state==="suspended"?new Promise((o,a)=>{const l=()=>{this._nativeAudioContext.removeEventListener("statechange",l),this._nativeAudioContext.state==="running"?o():this.resume().then(o,a)};this._nativeAudioContext.addEventListener("statechange",l)}):this._nativeAudioContext.resume().catch(o=>{throw o===void 0||o.code===15?e():o})}suspend(){return this._nativeAudioContext.suspend().catch(o=>{throw o===void 0?e():o})}},Tb=(e,n,t,r,i,s)=>class extends t{constructor(a,l){super(a),this._nativeContext=a,Of.set(this,a),r(a)&&i.set(a,new Set),this._destination=new e(this,l),this._listener=n(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const l=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=l;const c=this._nativeContext.onstatechange;this._onstatechange=c!==null&&c===l?a:c}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},ed=e=>{const n=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=e.decodeAudioData(n.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},Ab=(e,n)=>(t,r,i)=>{const s=new Set;return t.connect=(o=>(a,l=0,c=0)=>{const u=s.size===0;if(n(a))return o.call(t,a,l,c),e(s,[a,l,c],f=>f[0]===a&&f[1]===l&&f[2]===c,!0),u&&r(),a;o.call(t,a,l),e(s,[a,l],f=>f[0]===a&&f[1]===l,!0),u&&r()})(t.connect),t.disconnect=(o=>(a,l,c)=>{const u=s.size>0;if(a===void 0)o.apply(t),s.clear();else if(typeof a=="number"){o.call(t,a);for(const m of s)m[1]===a&&s.delete(m)}else{n(a)?o.call(t,a,l,c):o.call(t,a,l);for(const m of s)m[0]===a&&(l===void 0||m[1]===l)&&(c===void 0||m[2]===c)&&s.delete(m)}const f=s.size===0;u&&f&&i()})(t.disconnect),t},es=(e,n,t)=>{const r=n[t];r!==void 0&&r!==e[t]&&(e[t]=r)},Bo=(e,n)=>{es(e,n,"channelCount"),es(e,n,"channelCountMode"),es(e,n,"channelInterpretation")},Mb=e=>e===null?null:e.hasOwnProperty("AudioBuffer")?e.AudioBuffer:null,yu=(e,n,t)=>{const r=n[t];r!==void 0&&r!==e[t].value&&(e[t].value=r)},Cb=e=>{e.start=(n=>{let t=!1;return(r=0,i=0,s)=>{if(t)throw Fr();n.call(e,r,i,s),t=!0}})(e.start)},td=e=>{e.start=(n=>(t=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||t<0)throw new RangeError("The parameters can't be negative.");n.call(e,t,r,i)})(e.start)},nd=e=>{e.stop=(n=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");n.call(e,t)})(e.stop)},Rb=(e,n,t,r,i,s,o,a,l,c,u)=>(f,m)=>{const g=f.createBufferSource();return Bo(g,m),yu(g,m,"playbackRate"),es(g,m,"buffer"),es(g,m,"loop"),es(g,m,"loopEnd"),es(g,m,"loopStart"),n(t,()=>t(f))||Cb(g),n(r,()=>r(f))||l(g),n(i,()=>i(f))||c(g,f),n(s,()=>s(f))||td(g),n(o,()=>o(f))||u(g,f),n(a,()=>a(f))||nd(g),e(f,g),g},Lb=e=>e===null?null:e.hasOwnProperty("AudioContext")?e.AudioContext:e.hasOwnProperty("webkitAudioContext")?e.webkitAudioContext:null,Pb=(e,n)=>(t,r,i)=>{const s=t.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=e(t,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return n(o,"channelCount",a=>()=>a.call(o),a=>l=>{a.call(o,l);try{s.channelCount=l}catch(c){if(l>s.maxChannelCount)throw c}}),n(o,"channelCountMode",a=>()=>a.call(o),a=>l=>{a.call(o,l),s.channelCountMode=l}),n(o,"channelInterpretation",a=>()=>a.call(o),a=>l=>{a.call(o,l),s.channelInterpretation=l}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o},Bb=e=>e===null?null:e.hasOwnProperty("AudioWorkletNode")?e.AudioWorkletNode:null,Ib=e=>{const{port1:n}=new MessageChannel;try{n.postMessage(e)}finally{n.close()}},Ob=(e,n,t,r,i)=>(s,o,a,l,c,u)=>{if(a!==null)try{const f=new a(s,l,u),m=new Map;let g=null;if(Object.defineProperties(f,{channelCount:{get:()=>u.channelCount,set:()=>{throw e()}},channelCountMode:{get:()=>"explicit",set:()=>{throw e()}},onprocessorerror:{get:()=>g,set:_=>{typeof g=="function"&&f.removeEventListener("processorerror",g),g=typeof _=="function"?_:null,typeof g=="function"&&f.addEventListener("processorerror",g)}}}),f.addEventListener=(_=>(...E)=>{if(E[0]==="processorerror"){const S=typeof E[1]=="function"?E[1]:typeof E[1]=="object"&&E[1]!==null&&typeof E[1].handleEvent=="function"?E[1].handleEvent:null;if(S!==null){const b=m.get(E[1]);b!==void 0?E[1]=b:(E[1]=v=>{v.type==="error"?(Object.defineProperties(v,{type:{value:"processorerror"}}),S(v)):S(new ErrorEvent(E[0],{...v}))},m.set(S,E[1]))}}return _.call(f,"error",E[1],E[2]),_.call(f,...E)})(f.addEventListener),f.removeEventListener=(_=>(...E)=>{if(E[0]==="processorerror"){const S=m.get(E[1]);S!==void 0&&(m.delete(E[1]),E[1]=S)}return _.call(f,"error",E[1],E[2]),_.call(f,E[0],E[1],E[2])})(f.removeEventListener),u.numberOfOutputs!==0){const _=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return f.connect(_).connect(s.destination),i(f,()=>_.disconnect(),()=>_.connect(s.destination))}return f}catch(f){throw f.code===11?r():f}if(c===void 0)throw r();return Ib(u),n(s,o,c,u)},Db=(e,n)=>e===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(e*n))))),Nb=e=>new Promise((n,t)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),n(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),t(s)},i.postMessage(e)}),Fb=async(e,n)=>{const t=await Nb(n);return new e(t)},$b=(e,n,t,r)=>{let i=fu.get(e);i===void 0&&(i=new WeakMap,fu.set(e,i));const s=Fb(t,r);return i.set(n,s),s},Vb=(e,n,t,r,i,s,o,a,l,c,u,f,m)=>(g,_,E,S)=>{if(S.numberOfInputs===0&&S.numberOfOutputs===0)throw l();const b=Array.isArray(S.outputChannelCount)?S.outputChannelCount:Array.from(S.outputChannelCount);if(b.some(be=>be<1))throw l();if(b.length!==S.numberOfOutputs)throw n();if(S.channelCountMode!=="explicit")throw l();const v=S.channelCount*S.numberOfInputs,y=b.reduce((be,Re)=>be+Re,0),A=E.parameterDescriptors===void 0?0:E.parameterDescriptors.length;if(v+A>6||y>6)throw l();const d=new MessageChannel,p=[],M=[];for(let be=0;be<S.numberOfInputs;be+=1)p.push(o(g,{channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,gain:1})),M.push(i(g,{channelCount:S.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:S.channelCount}));const L=[];if(E.parameterDescriptors!==void 0)for(const{defaultValue:be,maxValue:Re,minValue:Xe,name:Ne}of E.parameterDescriptors){const B=s(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:S.parameterData[Ne]!==void 0?S.parameterData[Ne]:be===void 0?0:be});Object.defineProperties(B.offset,{defaultValue:{get:()=>be===void 0?0:be},maxValue:{get:()=>Re===void 0?pu:Re},minValue:{get:()=>Xe===void 0?Pa:Xe}}),L.push(B)}const D=r(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,v+A)}),O=Db(_,g.sampleRate),x=a(g,O,v+A,Math.max(1,y)),Y=i(g,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),R=[];for(let be=0;be<S.numberOfOutputs;be+=1)R.push(r(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:b[be]}));for(let be=0;be<S.numberOfInputs;be+=1){p[be].connect(M[be]);for(let Re=0;Re<S.channelCount;Re+=1)M[be].connect(D,Re,be*S.channelCount+Re)}const w=new Qf(E.parameterDescriptors===void 0?[]:E.parameterDescriptors.map(({name:be},Re)=>{const Xe=L[Re];return Xe.connect(D,0,v+Re),Xe.start(0),[be,Xe.offset]}));D.connect(x);let N=S.channelInterpretation,X=null;const q=S.numberOfOutputs===0?[x]:R,Z={get bufferSize(){return O},get channelCount(){return S.channelCount},set channelCount(be){throw t()},get channelCountMode(){return S.channelCountMode},set channelCountMode(be){throw t()},get channelInterpretation(){return N},set channelInterpretation(be){for(const Re of p)Re.channelInterpretation=be;N=be},get context(){return x.context},get inputs(){return p},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get onprocessorerror(){return X},set onprocessorerror(be){typeof X=="function"&&Z.removeEventListener("processorerror",X),X=typeof be=="function"?be:null,typeof X=="function"&&Z.addEventListener("processorerror",X)},get parameters(){return w},get port(){return d.port2},addEventListener(...be){return x.addEventListener(be[0],be[1],be[2])},connect:e.bind(null,q),disconnect:c.bind(null,q),dispatchEvent(...be){return x.dispatchEvent(be[0])},removeEventListener(...be){return x.removeEventListener(be[0],be[1],be[2])}},ne=new Map;d.port1.addEventListener=(be=>(...Re)=>{if(Re[0]==="message"){const Xe=typeof Re[1]=="function"?Re[1]:typeof Re[1]=="object"&&Re[1]!==null&&typeof Re[1].handleEvent=="function"?Re[1].handleEvent:null;if(Xe!==null){const Ne=ne.get(Re[1]);Ne!==void 0?Re[1]=Ne:(Re[1]=B=>{u(g.currentTime,g.sampleRate,()=>Xe(B))},ne.set(Xe,Re[1]))}}return be.call(d.port1,Re[0],Re[1],Re[2])})(d.port1.addEventListener),d.port1.removeEventListener=(be=>(...Re)=>{if(Re[0]==="message"){const Xe=ne.get(Re[1]);Xe!==void 0&&(ne.delete(Re[1]),Re[1]=Xe)}return be.call(d.port1,Re[0],Re[1],Re[2])})(d.port1.removeEventListener);let U=null;Object.defineProperty(d.port1,"onmessage",{get:()=>U,set:be=>{typeof U=="function"&&d.port1.removeEventListener("message",U),U=typeof be=="function"?be:null,typeof U=="function"&&(d.port1.addEventListener("message",U),d.port1.start())}}),E.prototype.port=d.port1;let F=null;$b(g,Z,E,S).then(be=>F=be);const P=Na(S.numberOfInputs,S.channelCount),I=Na(S.numberOfOutputs,b),H=E.parameterDescriptors===void 0?[]:E.parameterDescriptors.reduce((be,{name:Re})=>({...be,[Re]:new Float32Array(128)}),{});let K=!0;const he=()=>{S.numberOfOutputs>0&&x.disconnect(Y);for(let be=0,Re=0;be<S.numberOfOutputs;be+=1){const Xe=R[be];for(let Ne=0;Ne<b[be];Ne+=1)Y.disconnect(Xe,Re+Ne,Ne);Re+=b[be]}},ee=new Map;x.onaudioprocess=({inputBuffer:be,outputBuffer:Re})=>{if(F!==null){const Xe=f(Z);for(let Ne=0;Ne<O;Ne+=128){for(let B=0;B<S.numberOfInputs;B+=1)for(let V=0;V<S.channelCount;V+=1)Da(be,P[B],V,V,Ne);E.parameterDescriptors!==void 0&&E.parameterDescriptors.forEach(({name:B},V)=>{Da(be,H,B,v+V,Ne)});for(let B=0;B<S.numberOfInputs;B+=1)for(let V=0;V<b[B];V+=1)I[B][V].byteLength===0&&(I[B][V]=new Float32Array(128));try{const B=P.map((ye,Ae)=>{if(Xe[Ae].size>0)return ee.set(Ae,O/128),ye;const et=ee.get(Ae);return et===void 0?[]:(ye.every(Je=>Je.every(ze=>ze===0))&&(et===1?ee.delete(Ae):ee.set(Ae,et-1)),ye)});K=u(g.currentTime+Ne/g.sampleRate,g.sampleRate,()=>F.process(B,I,H));for(let ye=0,Ae=0;ye<S.numberOfOutputs;ye+=1){for(let Ke=0;Ke<b[ye];Ke+=1)Jf(Re,I[ye],Ke,Ae+Ke,Ne);Ae+=b[ye]}}catch(B){K=!1,Z.dispatchEvent(new ErrorEvent("processorerror",{colno:B.colno,filename:B.filename,lineno:B.lineno,message:B.message}))}if(!K){for(let B=0;B<S.numberOfInputs;B+=1){p[B].disconnect(M[B]);for(let V=0;V<S.channelCount;V+=1)M[Ne].disconnect(D,V,B*S.channelCount+V)}if(E.parameterDescriptors!==void 0){const B=E.parameterDescriptors.length;for(let V=0;V<B;V+=1){const ye=L[V];ye.disconnect(D,0,v+V),ye.stop()}}D.disconnect(x),x.onaudioprocess=null,ae?he():He();break}}}};let ae=!1;const ge=o(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Le=()=>x.connect(ge).connect(g.destination),He=()=>{x.disconnect(ge),ge.disconnect()},De=()=>{if(K){He(),S.numberOfOutputs>0&&x.connect(Y);for(let be=0,Re=0;be<S.numberOfOutputs;be+=1){const Xe=R[be];for(let Ne=0;Ne<b[be];Ne+=1)Y.connect(Xe,Re+Ne,Ne);Re+=b[be]}}ae=!0},Ue=()=>{K&&(Le(),he()),ae=!1};return Le(),m(Z,De,Ue)},xb=(e,n)=>(t,r)=>{const i=t.createChannelMerger(r.numberOfInputs);return e!==null&&e.name==="webkitAudioContext"&&n(t,i),Bo(i,r),i},Hb=e=>{const n=e.numberOfOutputs;Object.defineProperty(e,"channelCount",{get:()=>n,set:t=>{if(t!==n)throw Fr()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw Fr()}}),Object.defineProperty(e,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw Fr()}})},rd=(e,n)=>{const t=e.createChannelSplitter(n.numberOfOutputs);return Bo(t,n),Hb(t),t},Ub=(e,n,t,r,i)=>(s,o)=>{if(s.createConstantSource===void 0)return t(s,o);const a=s.createConstantSource();return Bo(a,o),yu(a,o,"offset"),n(r,()=>r(s))||td(a),n(i,()=>i(s))||nd(a),e(s,a),a},id=(e,n)=>(e.connect=n.connect.bind(n),e.disconnect=n.disconnect.bind(n),e),Wb=(e,n,t,r)=>(i,{offset:s,...o})=>{const a=i.createBuffer(1,2,44100),l=n(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=t(i,{...o,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,l.buffer=a,l.loop=!0;const f={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(_){c.channelCount=_},get channelCountMode(){return c.channelCountMode},set channelCountMode(_){c.channelCountMode=_},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(_){c.channelInterpretation=_},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(_){l.onended=_},addEventListener(..._){return l.addEventListener(_[0],_[1],_[2])},dispatchEvent(..._){return l.dispatchEvent(_[0])},removeEventListener(..._){return l.removeEventListener(_[0],_[1],_[2])},start(_=0){l.start.call(l,_)},stop(_=0){l.stop.call(l,_)}},m=()=>l.connect(c),g=()=>l.disconnect(c);return e(i,l),r(id(f,c),m,g)},Li=(e,n)=>{const t=e.createGain();return Bo(t,n),yu(t,n,"gain"),t},jb=(e,{mediaStream:n})=>{const t=n.getAudioTracks();t.sort((s,o)=>s.id<o.id?-1:s.id>o.id?1:0);const r=t.slice(0,1),i=e.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:n}),i},Gb=e=>e===null?null:e.hasOwnProperty("OfflineAudioContext")?e.OfflineAudioContext:e.hasOwnProperty("webkitOfflineAudioContext")?e.webkitOfflineAudioContext:null,Eu=(e,n,t,r)=>e.createScriptProcessor(n,t,r),ts=()=>new DOMException("","NotSupportedError"),zb=(e,n)=>(t,r,i)=>(e(r).replay(i),n(r,t,i)),Xb=(e,n,t)=>async(r,i,s)=>{const o=e(r);await Promise.all(o.activeInputs.map((a,l)=>Array.from(a).map(async([c,u])=>{const m=await n(c).render(c,i),g=r.context.destination;!t(c)&&(r!==g||!t(r))&&m.connect(s,u,l)})).reduce((a,l)=>[...a,...l],[]))},Yb=(e,n,t)=>async(r,i,s)=>{const o=n(r);await Promise.all(Array.from(o.activeInputs).map(async([a,l])=>{const u=await e(a).render(a,i);t(a)||u.connect(s,l)}))},qb=(e,n,t,r)=>i=>e(ed,()=>ed(i))?Promise.resolve(e(r,r)).then(s=>{if(!s){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const o=n(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),s(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),Zb=e=>(n,t)=>{e.set(n,t)},Kb=e=>()=>{if(e===null)return!1;try{new e({length:1,sampleRate:44100})}catch{return!1}return!0},Qb=(e,n)=>async()=>{if(e===null)return!0;if(n===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new n(1,128,44100),i=URL.createObjectURL(t);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const a=new e(r,"a",{numberOfOutputs:0}),l=r.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>o=!0,l.connect(a),l.start(0),await r.startRendering(),await new Promise(c=>setTimeout(c))}catch{}finally{URL.revokeObjectURL(i)}return s&&!o},Jb=(e,n)=>()=>{if(n===null)return Promise.resolve(!1);const t=new n(1,1,44100),r=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{r.disconnect(),i(t.currentTime!==0)},t.startRendering()})},e3=()=>new DOMException("","UnknownError"),t3=()=>typeof window>"u"?null:window,n3=(e,n)=>t=>{t.copyFromChannel=(r,i,s=0)=>{const o=e(s),a=e(i);if(a>=t.numberOfChannels)throw n();const l=t.length,c=t.getChannelData(a),u=r.length;for(let f=o<0?-o:0;f+o<l&&f<u;f+=1)r[f]=c[f+o]},t.copyToChannel=(r,i,s=0)=>{const o=e(s),a=e(i);if(a>=t.numberOfChannels)throw n();const l=t.length,c=t.getChannelData(a),u=r.length;for(let f=o<0?-o:0;f+o<l&&f<u;f+=1)c[f+o]=r[f]}},r3=e=>n=>{n.copyFromChannel=(t=>(r,i,s=0)=>{const o=e(s),a=e(i);if(o<n.length)return t.call(n,r,a,o)})(n.copyFromChannel),n.copyToChannel=(t=>(r,i,s=0)=>{const o=e(s),a=e(i);if(o<n.length)return t.call(n,r,a,o)})(n.copyToChannel)},i3=e=>(n,t)=>{const r=t.createBuffer(1,1,44100);n.buffer===null&&(n.buffer=r),e(n,"buffer",i=>()=>{const s=i.call(n);return s===r?null:s},i=>s=>i.call(n,s===null?r:s))},s3=(e,n)=>(t,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw e()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw e()}});const i=t.createBufferSource();n(r,()=>{const a=r.numberOfInputs;for(let l=0;l<a;l+=1)i.connect(r,0,l)},()=>i.disconnect(r))},o3=(e,n,t)=>e.copyFromChannel===void 0?e.getChannelData(t)[0]:(e.copyFromChannel(n,t),n[0]),Su=(e,n,t,r)=>{let i=e;for(;!i.hasOwnProperty(n);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(e,n,{get:t(s),set:r(o)})},a3=e=>({...e,outputChannelCount:e.outputChannelCount!==void 0?e.outputChannelCount:e.numberOfInputs===1&&e.numberOfOutputs===1?[e.channelCount]:Array.from({length:e.numberOfOutputs},()=>1)}),sd=(e,n,t)=>{try{e.setValueAtTime(n,t)}catch(r){if(r.code!==9)throw r;sd(e,n,t+1e-7)}},l3=e=>{const n=e.createBufferSource();n.start();try{n.start()}catch{return!0}return!1},u3=e=>{const n=e.createBufferSource(),t=e.createBuffer(1,1,44100);n.buffer=t;try{n.start(0,1)}catch{return!1}return!0},c3=e=>{const n=e.createBufferSource();n.start();try{n.stop()}catch{return!1}return!0},od=e=>{const n=e.createOscillator();try{n.start(-1)}catch(t){return t instanceof RangeError}return!1},f3=e=>{const n=e.createBuffer(1,1,44100),t=e.createBufferSource();t.buffer=n,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},ad=e=>{const n=e.createOscillator();try{n.stop(-1)}catch(t){return t instanceof RangeError}return!1},d3=e=>{const{port1:n,port2:t}=new MessageChannel;try{n.postMessage(e)}finally{n.close(),t.close()}},h3=e=>{e.start=(n=>(t=0,r=0,i)=>{const s=e.buffer,o=s===null?r:Math.min(s.duration,r);s!==null&&o>s.duration-.5/e.context.sampleRate?n.call(e,t,0,0):n.call(e,t,o,i)})(e.start)},p3=(e,n)=>{const t=n.createGain();e.connect(t);const r=(i=>()=>{i.call(e,t),e.removeEventListener("ended",r)})(e.disconnect);e.addEventListener("ended",r),id(e,t),e.stop=(i=>{let s=!1;return(o=0)=>{if(s)try{i.call(e,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(e,o),s=!0}})(e.stop)},$a=(e,n)=>t=>{const r={value:e};return Object.defineProperties(t,{currentTarget:r,target:r}),typeof n=="function"?n.call(e,t):n.handleEvent.call(e,t)},m3=og(Qi),_3=dg(Qi),g3=Jg(Ra),b3=cb(new WeakMap),Us=Yg(new Map,new WeakMap),Yr=t3(),ld=ub(or),ku=Xb(or,ld,Ji),ns=hb(Of),Ws=Gb(Yr),hi=yb(Ws),ud=new WeakMap,cd=sb($a),Va=Lb(Yr),w3=bb(Va),fd=wb(Yr),v3=vb(Yr),Io=Bb(Yr),xa=xg(ag(Lf),fg(m3,_3,_u,g3,gu,or,b3,Co,Nr,Qi,Ki,Ji,Ia),Us,gb(uu,gu,or,Nr,Po,Ki),Zi,_b,ts,Qg(_u,uu,or,Nr,Po,ns,Ki,hi),nb(ud,or,Dr),cd,ns,w3,fd,v3,hi,Io),y3=new WeakSet,dd=Mb(Yr),hd=Kg(new Uint32Array(1)),E3=n3(hd,Zi),S3=r3(hd),k3=gg(y3,Us,ts,dd,Ws,Kb(dd),E3,S3),Tu=hg(Li),pd=Yb(ld,Ro,Ji),md=qg(pd),Ha=Rb(Tu,Us,l3,u3,c3,od,f3,ad,h3,i3(Su),p3),_d=zb(fb(Ro),pd),T3=vg(md,Ha,Nr,_d,ku),Au=Hg(lg(Bf),ud,If,Ug,eg,tg,ng,rg,ig,su,Tf,Va,sd),A3=wg(xa,T3,Au,Fr,Ha,ns,hi,$a),M3=Rg(xa,Lg,Zi,Fr,Pb(Li,Su),ns,hi,ku),Ua=Ab(Qi,fd),C3=s3(Fr,Ua),Mu=xb(Va,C3),R3=Wb(Tu,Ha,Li,Ua),Cu=Ub(Tu,Us,R3,od,ad),L3=qb(Us,Li,Eu,Jb(Li,Ws)),P3=Pg(Au,Mu,Cu,Eu,ts,o3,hi,Su),gd=new WeakMap,B3=Tb(M3,P3,cd,hi,gd,$a),bd=Eb(Yr),Ru=ob(Yr),wd=new WeakMap,I3=pb(wd,Ws),vd=bd?cg(Us,ts,ib(Yr),Ru,ab(sg),ns,I3,hi,Io,new WeakMap,new WeakMap,Qb(Io,Ws),Yr):void 0,O3=Sb(xa,jb,ns,hi),yd=mb(gd),D3=pg(yd),Ed=Zg(Zi),N3=eb(yd),Sd=rb(Zi),kd=new WeakMap,F3=lb(kd,Dr),$3=Vb(Ed,Zi,Fr,Mu,rd,Cu,Li,Eu,ts,Sd,Ru,F3,Ua),V3=Ob(Fr,$3,Li,ts,Ua),x3=Xg(md,Ed,Ha,Mu,rd,Cu,Li,N3,Sd,Ru,Nr,Io,Ws,_d,ku,L3),H3=db(wd),U3=Zb(kd),Td=bd?jg(D3,xa,Au,x3,V3,or,H3,ns,hi,Io,a3,U3,d3,$a):void 0,W3=kb(Fr,ts,e3,B3,Va),Ad="Missing AudioWorklet support. Maybe this is not running in a secure context.",j3=async(e,n,t,r,i)=>{const{encoderId:s,port:o}=await wf(i,n.sampleRate);if(Td===void 0)throw new Error(Ad);const a=new A3(n,{buffer:e}),l=new O3(n,{mediaStream:r}),c=Z_(Td,n,{channelCount:t});return{audioBufferSourceNode:a,encoderId:s,mediaStreamAudioSourceNode:l,port:o,recorderAudioWorkletNode:c}},G3=(e,n,t,r)=>(i,s,o)=>{var a;const l=(a=s.getAudioTracks()[0])===null||a===void 0?void 0:a.getSettings().sampleRate,c=new W3({latencyHint:"playback",sampleRate:l}),u=Math.max(1024,Math.ceil(c.baseLatency*c.sampleRate)),f=new k3({length:u,sampleRate:c.sampleRate}),m=[],g=q_(L=>{if(vd===void 0)throw new Error(Ad);return vd(c,L)});let _=null,E=null,S=null,b=null,v=!0;const y=L=>{i.dispatchEvent(e("dataavailable",{data:new Blob(L,{type:o})}))},A=async(L,D)=>{const O=await ka(L,D);S===null?m.push(...O):(y(O),b=A(L,D))},d=()=>(v=!0,c.resume()),p=()=>{S!==null&&(_!==null&&(s.removeEventListener("addtrack",_),s.removeEventListener("removetrack",_)),E!==null&&clearTimeout(E),S.then(async({encoderId:L,mediaStreamAudioSourceNode:D,recorderAudioWorkletNode:O})=>{b!==null&&(b.catch(()=>{}),b=null),await O.stop(),D.disconnect(O);const x=await ka(L,null);S===null&&await M(),y([...m,...x]),m.length=0,i.dispatchEvent(new Event("stop"))}),S=null)},M=()=>(v=!1,c.suspend());return M(),{get mimeType(){return o},get state(){return S===null?"inactive":v?"recording":"paused"},pause(){if(S===null)throw t();v&&(M(),i.dispatchEvent(new Event("pause")))},resume(){if(S===null)throw t();v||(d(),i.dispatchEvent(new Event("resume")))},start(L){var D;if(S!==null)throw t();if(s.getVideoTracks().length>0)throw r();i.dispatchEvent(new Event("start"));const O=s.getAudioTracks(),x=O.length===0?2:(D=O[0].getSettings().channelCount)!==null&&D!==void 0?D:2;S=Promise.all([d(),g.then(()=>j3(f,c,x,s,o))]).then(async([,{audioBufferSourceNode:R,encoderId:w,mediaStreamAudioSourceNode:N,port:X,recorderAudioWorkletNode:q}])=>(N.connect(q),await new Promise(Z=>{R.onended=Z,R.connect(q),R.start(c.currentTime+u/c.sampleRate)}),R.disconnect(q),await q.record(X),L!==void 0&&(b=A(w,L)),{encoderId:w,mediaStreamAudioSourceNode:N,recorderAudioWorkletNode:q}));const Y=s.getTracks();_=()=>{p(),i.dispatchEvent(new ErrorEvent("error",{error:n()}))},s.addEventListener("addtrack",_),s.addEventListener("removetrack",_),E=setInterval(()=>{const R=s.getTracks();(R.length!==Y.length||R.some((w,N)=>w!==Y[N]))&&_!==null&&_()},1e3)},stop:p}};class Lu{constructor(n,t=0,r){if(t<0||r!==void 0&&r<0)throw new RangeError;const i=n.reduce((u,f)=>u+f.byteLength,0);if(t>i||r!==void 0&&t+r>i)throw new RangeError;const s=[],o=r===void 0?i-t:r,a=[];let l=0,c=t;for(const u of n)if(a.length===0)if(u.byteLength>c){l=u.byteLength-c;const f=l>o?o:l;s.push(new DataView(u,c,f)),a.push(u)}else c-=u.byteLength;else if(l<o){l+=u.byteLength;const f=l>o?u.byteLength-l+o:u.byteLength;s.push(new DataView(u,0,f)),a.push(u)}this._buffers=a,this._byteLength=o,this._byteOffset=c,this._dataViews=s,this._internalBuffer=new DataView(new ArrayBuffer(8))}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get byteOffset(){return this._byteOffset}getFloat32(n,t){return this._internalBuffer.setUint8(0,this.getUint8(n+0)),this._internalBuffer.setUint8(1,this.getUint8(n+1)),this._internalBuffer.setUint8(2,this.getUint8(n+2)),this._internalBuffer.setUint8(3,this.getUint8(n+3)),this._internalBuffer.getFloat32(0,t)}getFloat64(n,t){return this._internalBuffer.setUint8(0,this.getUint8(n+0)),this._internalBuffer.setUint8(1,this.getUint8(n+1)),this._internalBuffer.setUint8(2,this.getUint8(n+2)),this._internalBuffer.setUint8(3,this.getUint8(n+3)),this._internalBuffer.setUint8(4,this.getUint8(n+4)),this._internalBuffer.setUint8(5,this.getUint8(n+5)),this._internalBuffer.setUint8(6,this.getUint8(n+6)),this._internalBuffer.setUint8(7,this.getUint8(n+7)),this._internalBuffer.getFloat64(0,t)}getInt16(n,t){return this._internalBuffer.setUint8(0,this.getUint8(n+0)),this._internalBuffer.setUint8(1,this.getUint8(n+1)),this._internalBuffer.getInt16(0,t)}getInt32(n,t){return this._internalBuffer.setUint8(0,this.getUint8(n+0)),this._internalBuffer.setUint8(1,this.getUint8(n+1)),this._internalBuffer.setUint8(2,this.getUint8(n+2)),this._internalBuffer.setUint8(3,this.getUint8(n+3)),this._internalBuffer.getInt32(0,t)}getInt8(n){const[t,r]=this._findDataViewWithOffset(n);return t.getInt8(n-r)}getUint16(n,t){return this._internalBuffer.setUint8(0,this.getUint8(n+0)),this._internalBuffer.setUint8(1,this.getUint8(n+1)),this._internalBuffer.getUint16(0,t)}getUint32(n,t){return this._internalBuffer.setUint8(0,this.getUint8(n+0)),this._internalBuffer.setUint8(1,this.getUint8(n+1)),this._internalBuffer.setUint8(2,this.getUint8(n+2)),this._internalBuffer.setUint8(3,this.getUint8(n+3)),this._internalBuffer.getUint32(0,t)}getUint8(n){const[t,r]=this._findDataViewWithOffset(n);return t.getUint8(n-r)}setFloat32(n,t,r){this._internalBuffer.setFloat32(0,t,r),this.setUint8(n,this._internalBuffer.getUint8(0)),this.setUint8(n+1,this._internalBuffer.getUint8(1)),this.setUint8(n+2,this._internalBuffer.getUint8(2)),this.setUint8(n+3,this._internalBuffer.getUint8(3))}setFloat64(n,t,r){this._internalBuffer.setFloat64(0,t,r),this.setUint8(n,this._internalBuffer.getUint8(0)),this.setUint8(n+1,this._internalBuffer.getUint8(1)),this.setUint8(n+2,this._internalBuffer.getUint8(2)),this.setUint8(n+3,this._internalBuffer.getUint8(3)),this.setUint8(n+4,this._internalBuffer.getUint8(4)),this.setUint8(n+5,this._internalBuffer.getUint8(5)),this.setUint8(n+6,this._internalBuffer.getUint8(6)),this.setUint8(n+7,this._internalBuffer.getUint8(7))}setInt16(n,t,r){this._internalBuffer.setInt16(0,t,r),this.setUint8(n,this._internalBuffer.getUint8(0)),this.setUint8(n+1,this._internalBuffer.getUint8(1))}setInt32(n,t,r){this._internalBuffer.setInt32(0,t,r),this.setUint8(n,this._internalBuffer.getUint8(0)),this.setUint8(n+1,this._internalBuffer.getUint8(1)),this.setUint8(n+2,this._internalBuffer.getUint8(2)),this.setUint8(n+3,this._internalBuffer.getUint8(3))}setInt8(n,t){const[r,i]=this._findDataViewWithOffset(n);r.setInt8(n-i,t)}setUint16(n,t,r){this._internalBuffer.setUint16(0,t,r),this.setUint8(n,this._internalBuffer.getUint8(0)),this.setUint8(n+1,this._internalBuffer.getUint8(1))}setUint32(n,t,r){this._internalBuffer.setUint32(0,t,r),this.setUint8(n,this._internalBuffer.getUint8(0)),this.setUint8(n+1,this._internalBuffer.getUint8(1)),this.setUint8(n+2,this._internalBuffer.getUint8(2)),this.setUint8(n+3,this._internalBuffer.getUint8(3))}setUint8(n,t){const[r,i]=this._findDataViewWithOffset(n);r.setUint8(n-i,t)}_findDataViewWithOffset(n){let t=0;for(const r of this._dataViews){const i=t+r.byteLength;if(n>=t&&n<i)return[r,t];t=i}throw new RangeError}}const z3=(e,n,t)=>(r,i,s,o)=>{const a=[],l=new i(s,{mimeType:"audio/webm;codecs=pcm"});let c=null,u=()=>{};const f=_=>{r.dispatchEvent(e("dataavailable",{data:new Blob(_,{type:o})}))},m=async(_,E)=>{const S=await ka(_,E);l.state==="inactive"?a.push(...S):(f(S),c=m(_,E))},g=()=>{l.state!=="inactive"&&(c!==null&&(c.catch(()=>{}),c=null),u(),u=()=>{},l.stop())};return l.addEventListener("error",_=>{g(),r.dispatchEvent(new ErrorEvent("error",{error:_.error}))}),l.addEventListener("pause",()=>r.dispatchEvent(new Event("pause"))),l.addEventListener("resume",()=>r.dispatchEvent(new Event("resume"))),l.addEventListener("start",()=>r.dispatchEvent(new Event("start"))),{get mimeType(){return o},get state(){return l.state},pause(){return l.pause()},resume(){return l.resume()},start(_){const[E]=s.getAudioTracks();if(E!==void 0&&l.state==="inactive"){const{channelCount:S,sampleRate:b}=E.getSettings();if(S===void 0)throw new Error("The channelCount is not defined.");if(b===void 0)throw new Error("The sampleRate is not defined.");let v=!1,y=!1,A=0,d=wf(o,b);u=()=>{y=!0};const p=Ef(l,"dataavailable")(({data:M})=>{A+=1;const L=M.arrayBuffer();d=d.then(async({dataView:D=null,elementType:O=null,encoderId:x,port:Y})=>{const R=await L;A-=1;const w=D===null?new Lu([R]):new Lu([...D.buffers,R],D.byteOffset);if(!v&&l.state==="recording"&&!y){const ne=t(w,0);if(ne===null)return{dataView:w,elementType:O,encoderId:x,port:Y};const{value:U}=ne;if(U!==172351395)return{dataView:D,elementType:O,encoderId:x,port:Y};v=!0}const{currentElementType:N,offset:X,contents:q}=n(w,O,S),Z=X<w.byteLength?new Lu(w.buffers,w.byteOffset+X):null;return q.forEach(ne=>Y.postMessage(ne,ne.map(({buffer:U})=>U))),A===0&&(l.state==="inactive"||y)&&(ka(x,null).then(ne=>{f([...a,...ne]),a.length=0,r.dispatchEvent(new Event("stop"))}),Y.postMessage([]),Y.close(),p()),{dataView:Z,elementType:N,encoderId:x,port:Y}})});_!==void 0&&d.then(({encoderId:M})=>c=m(M,_))}l.start(100)},stop:g}},X3=()=>typeof window>"u"?null:window,Md=(e,n)=>{if(n>=e.byteLength)return null;const t=e.getUint8(n);if(t>127)return 1;if(t>63)return 2;if(t>31)return 3;if(t>15)return 4;if(t>7)return 5;if(t>3)return 6;if(t>1)return 7;if(t>0)return 8;const r=Md(e,n+1);return r===null?null:r+8},Y3=(e,n)=>t=>{const r={value:e};return Object.defineProperties(t,{currentTarget:r,target:r}),typeof n=="function"?n.call(e,t):n.handleEvent.call(e,t)},Cd=[],Pu=X3(),q3=O_(Pu),Rd=M_(q3),Z3=G3(Rd,P_,B_,iu),Bu=V_(Md),K3=F_(Bu),Q3=$_(Bu),J3=C_(K3,Q3),e4=z3(Rd,J3,Bu),t4=L_(Pu),n4=D_(Pu),r4=I_(N_(iu),iu,Z3,e4,Cd,R_(t4,Y3),n4),i4=async e=>{Cd.push(await A_(e))},s4=_f({characterize:({call:e})=>()=>e("characterize"),encode:({call:e})=>(n,t)=>e("encode",{recordingId:n,timeslice:t}),record:({call:e})=>async(n,t,r)=>{await e("record",{recordingId:n,sampleRate:t,typedArrays:r},r.map(({buffer:i})=>i))}}),o4=e=>{const n=new Worker(e);return s4(n)},a4=`(()=>{var e={455:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,s=536870912,a=2*s,o=function(e,t){return function(r){var o=t.get(r),i=void 0===o?r.size:o<a?o+1:0;if(!r.has(i))return e(r,i);if(r.size<s){for(;r.has(i);)i=Math.floor(Math.random()*a);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,l=r(i),c=o(l,i),u=t(c);e.addUniqueNumber=u,e.generateUniqueNumber=c}(t)}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}(()=>{"use strict";const e=-32603,t=-32602,n=-32601,s=(e,t)=>Object.assign(new Error(e),{status:t}),a=t=>s('The handler of the method called "'.concat(t,'" returned an unexpected result.'),e),o=(t,r)=>async o=>{let{data:{id:i,method:l,params:c}}=o;const u=r[l];try{if(void 0===u)throw(e=>s('The requested method called "'.concat(e,'" is not supported.'),n))(l);const r=void 0===c?u():u(c);if(void 0===r)throw(t=>s('The handler of the method called "'.concat(t,'" returned no required result.'),e))(l);const o=r instanceof Promise?await r:r;if(null===i){if(void 0!==o.result)throw a(l)}else{if(void 0===o.result)throw a(l);const{result:e,transferables:r=[]}=o;t.postMessage({id:i,result:e},r)}}catch(e){const{message:r,status:n=-32603}=e;t.postMessage({error:{code:n,message:r},id:i})}};var i=r(455);const l=new Map,c=(e,r,n)=>({...r,connect:t=>{let{port:n}=t;n.start();const s=e(n,r),a=(0,i.generateUniqueNumber)(l);return l.set(a,(()=>{s(),n.close(),l.delete(a)})),{result:a}},disconnect:e=>{let{portId:r}=e;const n=l.get(r);if(void 0===n)throw(e=>s('The specified parameter called "portId" with the given value "'.concat(e,'" does not identify a port connected to this worker.'),t))(r);return n(),{result:null}},isSupported:async()=>{if(await new Promise((e=>{const t=new ArrayBuffer(0),{port1:r,port2:n}=new MessageChannel;r.onmessage=t=>{let{data:r}=t;return e(null!==r)},n.postMessage(t,[t])}))){const e=n();return{result:e instanceof Promise?await e:e}}return{result:!1}}}),u=function(e,t){const r=c(u,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0),n=o(e,r);return e.addEventListener("message",n),()=>e.removeEventListener("message",n)},d=e=>e.reduce(((e,t)=>e+t.length),0),h=(e,t)=>{const r=[];let n=0;e:for(;n<t;){const t=e.length;for(let s=0;s<t;s+=1){const t=e[s];void 0===r[s]&&(r[s]=[]);const a=t.shift();if(void 0===a)break e;r[s].push(a),0===s&&(n+=a.length)}}if(n>t){const s=n-t;r.forEach(((t,r)=>{const n=t.pop(),a=n.length-s;t.push(n.subarray(0,a)),e[r].unshift(n.subarray(a))}))}return r},f=new Map,m=(e=>(t,r,n)=>{const s=e.get(t);if(void 0===s){const s={channelDataArrays:n.map((e=>[e])),isComplete:!0,sampleRate:r};return e.set(t,s),s}return s.channelDataArrays.forEach(((e,t)=>e.push(n[t]))),s})(f),p=((e,t)=>(r,n,s,a)=>{const o=s>>3,i="subsequent"===n?0:44,l=r.length,c=e(r[0]),u=new ArrayBuffer(c*l*o+i),d=new DataView(u);return"subsequent"!==n&&t(d,s,l,"complete"===n?c:Number.POSITIVE_INFINITY,a),r.forEach(((e,t)=>{let r=i+t*o;e.forEach((e=>{const t=e.length;for(let n=0;n<t;n+=1){const t=e[n];d.setInt16(r,t<0?32768*Math.max(-1,t):32767*Math.min(1,t),!0),r+=l*o}}))})),[u]})(d,((e,t,r,n,s)=>{const a=t>>3,o=Math.min(n*r*a,4294967251);e.setUint32(0,1380533830),e.setUint32(4,o+36,!0),e.setUint32(8,1463899717),e.setUint32(12,1718449184),e.setUint32(16,16,!0),e.setUint16(20,1,!0),e.setUint16(22,r,!0),e.setUint32(24,s,!0),e.setUint32(28,s*r*a,!0),e.setUint16(32,r*a,!0),e.setUint16(34,t,!0),e.setUint32(36,1684108385),e.setUint32(40,o,!0)})),v=new Map;u(self,{characterize:()=>({result:/^audio\\/wav$/}),encode:e=>{let{recordingId:t,timeslice:r}=e;const n=v.get(t);void 0!==n&&(v.delete(t),n.reject(new Error("Another request was made to initiate an encoding.")));const s=f.get(t);if(null!==r){if(void 0===s||d(s.channelDataArrays[0])*(1e3/s.sampleRate)<r)return new Promise(((e,n)=>{v.set(t,{reject:n,resolve:e,timeslice:r})}));const e=h(s.channelDataArrays,Math.ceil(r*(s.sampleRate/1e3))),n=p(e,s.isComplete?"initial":"subsequent",16,s.sampleRate);return s.isComplete=!1,{result:n,transferables:n}}if(void 0!==s){const e=p(s.channelDataArrays,s.isComplete?"complete":"subsequent",16,s.sampleRate);return f.delete(t),{result:e,transferables:e}}return{result:[],transferables:[]}},record:e=>{let{recordingId:t,sampleRate:r,typedArrays:n}=e;const s=m(t,r,n),a=v.get(t);if(void 0!==a&&d(s.channelDataArrays[0])*(1e3/r)>=a.timeslice){const e=h(s.channelDataArrays,Math.ceil(a.timeslice*(r/1e3))),n=p(e,s.isComplete?"initial":"subsequent",16,r);s.isComplete=!1,v.delete(t),a.resolve({result:n,transferables:n})}return{result:null}}})})()})();`,l4=new Blob([a4],{type:"application/javascript; charset=utf-8"}),Ld=URL.createObjectURL(l4),u4=o4(Ld).connect;URL.revokeObjectURL(Ld);const Pd=new WeakMap;let Bd=!1,pi,Wa=[];function Id(e){const n=e<0?e*32768:e*32767;return Math.max(-32768,Math.min(32768,n))}async function c4(e){if(!e)throw new Error("Audio element not defined");if(!Bd){try{await i4(await u4())}catch({message:t}){throw new Error(`Failed to register recorder - ${t}`)}Bd=!0}let n=Pd.get(e);if(!n){const t=new AudioContext,r=t.createMediaElementSource(e);r.connect(t.destination);const i=t.createMediaStreamDestination();r.connect(i),n=i.stream,Pd.set(e,n)}pi=new r4(n,{mimeType:"audio/wav"}),pi.addEventListener("dataavailable",t=>{Wa.push(t.data)}),pi.start()}function Od(e,n=!1){return new Promise((t,r)=>{if(!pi)return t(void 0);pi.addEventListener("stop",async()=>{if(!pi||n||!Wa.length)return t(void 0);try{const i=[],o=pi.mimeType,a=new AudioContext,c=await new Blob(Wa,{type:o}).arrayBuffer(),u=await a.decodeAudioData(c),f=u.getChannelData(0),m=u.getChannelData(1),g=new Int16Array(f.length),_=new Int16Array(m.length),E=new h_(u.numberOfChannels,u.sampleRate,e);for(let b=0,{length:v}=g;b<v;b+=1)g[b]=Id(f[b]),_[b]=Id(m[b]);for(let b=0,{length:v}=g;b<v;b+=1152){const y=g.subarray(b,b+1152),A=_.subarray(b,b+1152),d=E.encodeBuffer(y,A);d.length&&i.push(d)}const S=E.flush();if(S.length&&i.push(S),i.length){const b=await new Blob(i,{type:"audio/mpeg"}).arrayBuffer();t(b)}else t(void 0)}catch({message:i}){r(new Error(`Failed to stop recorder - ${i}`))}}),pi.stop()}).finally(()=>{pi=void 0,Wa=[]})}const rs=Math.min,qr=Math.max,ja=Math.round,Ga=Math.floor,Pi=e=>({x:e,y:e}),f4={left:"right",right:"left",bottom:"top",top:"bottom"},d4={start:"end",end:"start"};function Dd(e,n,t){return qr(e,rs(n,t))}function Oo(e,n){return typeof e=="function"?e(n):e}function mi(e){return e.split("-")[0]}function za(e){return e.split("-")[1]}function Nd(e){return e==="x"?"y":"x"}function Fd(e){return e==="y"?"height":"width"}function Do(e){return["top","bottom"].includes(mi(e))?"y":"x"}function $d(e){return Nd(Do(e))}function h4(e,n,t){t===void 0&&(t=!1);const r=za(e),i=$d(e),s=Fd(i);let o=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return n.reference[s]>n.floating[s]&&(o=Xa(o)),[o,Xa(o)]}function p4(e){const n=Xa(e);return[Iu(e),n,Iu(n)]}function Iu(e){return e.replace(/start|end/g,n=>d4[n])}function m4(e,n,t){const r=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(e){case"top":case"bottom":return t?n?i:r:n?r:i;case"left":case"right":return n?s:o;default:return[]}}function _4(e,n,t,r){const i=za(e);let s=m4(mi(e),t==="start",r);return i&&(s=s.map(o=>o+"-"+i),n&&(s=s.concat(s.map(Iu)))),s}function Xa(e){return e.replace(/left|right|bottom|top/g,n=>f4[n])}function g4(e){return{top:0,right:0,bottom:0,left:0,...e}}function Vd(e){return typeof e!="number"?g4(e):{top:e,right:e,bottom:e,left:e}}function js(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function xd(e,n,t){let{reference:r,floating:i}=e;const s=Do(n),o=$d(n),a=Fd(o),l=mi(n),c=s==="y",u=r.x+r.width/2-i.width/2,f=r.y+r.height/2-i.height/2,m=r[a]/2-i[a]/2;let g;switch(l){case"top":g={x:u,y:r.y-i.height};break;case"bottom":g={x:u,y:r.y+r.height};break;case"right":g={x:r.x+r.width,y:f};break;case"left":g={x:r.x-i.width,y:f};break;default:g={x:r.x,y:r.y}}switch(za(n)){case"start":g[o]-=m*(t&&c?-1:1);break;case"end":g[o]+=m*(t&&c?-1:1);break}return g}const b4=async(e,n,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=t,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(n));let c=await o.getElementRects({reference:e,floating:n,strategy:i}),{x:u,y:f}=xd(c,r,l),m=r,g={},_=0;for(let E=0;E<a.length;E++){const{name:S,fn:b}=a[E],{x:v,y,data:A,reset:d}=await b({x:u,y:f,initialPlacement:r,placement:m,strategy:i,middlewareData:g,rects:c,platform:o,elements:{reference:e,floating:n}});u=v??u,f=y??f,g={...g,[S]:{...g[S],...A}},d&&_<=50&&(_++,typeof d=="object"&&(d.placement&&(m=d.placement),d.rects&&(c=d.rects===!0?await o.getElementRects({reference:e,floating:n,strategy:i}):d.rects),{x:u,y:f}=xd(c,m,l)),E=-1)}return{x:u,y:f,placement:m,strategy:i,middlewareData:g}};async function Hd(e,n){var t;n===void 0&&(n={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:f="floating",altBoundary:m=!1,padding:g=0}=Oo(n,e),_=Vd(g),S=a[m?f==="floating"?"reference":"floating":f],b=js(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(S)))==null||t?S:S.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),v=f==="floating"?{...o.floating,x:r,y:i}:o.reference,y=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),A=await(s.isElement==null?void 0:s.isElement(y))?await(s.getScale==null?void 0:s.getScale(y))||{x:1,y:1}:{x:1,y:1},d=js(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:v,offsetParent:y,strategy:l}):v);return{top:(b.top-d.top+_.top)/A.y,bottom:(d.bottom-b.bottom+_.bottom)/A.y,left:(b.left-d.left+_.left)/A.x,right:(d.right-b.right+_.right)/A.x}}const w4=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(n){var t,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=n,{mainAxis:u=!0,crossAxis:f=!0,fallbackPlacements:m,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:_="none",flipAlignment:E=!0,...S}=Oo(e,n);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const b=mi(i),v=mi(a)===a,y=await(l.isRTL==null?void 0:l.isRTL(c.floating)),A=m||(v||!E?[Xa(a)]:p4(a));!m&&_!=="none"&&A.push(..._4(a,E,_,y));const d=[a,...A],p=await Hd(n,S),M=[];let L=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&M.push(p[b]),f){const Y=h4(i,o,y);M.push(p[Y[0]],p[Y[1]])}if(L=[...L,{placement:i,overflows:M}],!M.every(Y=>Y<=0)){var D,O;const Y=(((D=s.flip)==null?void 0:D.index)||0)+1,R=d[Y];if(R)return{data:{index:Y,overflows:L},reset:{placement:R}};let w=(O=L.filter(N=>N.overflows[0]<=0).sort((N,X)=>N.overflows[1]-X.overflows[1])[0])==null?void 0:O.placement;if(!w)switch(g){case"bestFit":{var x;const N=(x=L.map(X=>[X.placement,X.overflows.filter(q=>q>0).reduce((q,Z)=>q+Z,0)]).sort((X,q)=>X[1]-q[1])[0])==null?void 0:x[0];N&&(w=N);break}case"initialPlacement":w=a;break}if(i!==w)return{reset:{placement:w}}}return{}}}};function Ud(e){const n=rs(...e.map(s=>s.left)),t=rs(...e.map(s=>s.top)),r=qr(...e.map(s=>s.right)),i=qr(...e.map(s=>s.bottom));return{x:n,y:t,width:r-n,height:i-t}}function v4(e){const n=e.slice().sort((i,s)=>i.y-s.y),t=[];let r=null;for(let i=0;i<n.length;i++){const s=n[i];!r||s.y-r.y>r.height/2?t.push([s]):t[t.length-1].push(s),r=s}return t.map(i=>js(Ud(i)))}const y4=function(e){return e===void 0&&(e={}),{name:"inline",options:e,async fn(n){const{placement:t,elements:r,rects:i,platform:s,strategy:o}=n,{padding:a=2,x:l,y:c}=Oo(e,n),u=Array.from(await(s.getClientRects==null?void 0:s.getClientRects(r.reference))||[]),f=v4(u),m=js(Ud(u)),g=Vd(a);function _(){if(f.length===2&&f[0].left>f[1].right&&l!=null&&c!=null)return f.find(S=>l>S.left-g.left&&l<S.right+g.right&&c>S.top-g.top&&c<S.bottom+g.bottom)||m;if(f.length>=2){if(Do(t)==="y"){const O=f[0],x=f[f.length-1],Y=mi(t)==="top",R=O.top,w=x.bottom,N=Y?O.left:x.left,X=Y?O.right:x.right,q=X-N,Z=w-R;return{top:R,bottom:w,left:N,right:X,width:q,height:Z,x:N,y:R}}const S=mi(t)==="left",b=qr(...f.map(O=>O.right)),v=rs(...f.map(O=>O.left)),y=f.filter(O=>S?O.left===v:O.right===b),A=y[0].top,d=y[y.length-1].bottom,p=v,M=b,L=M-p,D=d-A;return{top:A,bottom:d,left:p,right:M,width:L,height:D,x:p,y:A}}return m}const E=await s.getElementRects({reference:{getBoundingClientRect:_},floating:r.floating,strategy:o});return i.reference.x!==E.reference.x||i.reference.y!==E.reference.y||i.reference.width!==E.reference.width||i.reference.height!==E.reference.height?{reset:{rects:E}}:{}}}};async function E4(e,n){const{placement:t,platform:r,elements:i}=e,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=mi(t),a=za(t),l=Do(t)==="y",c=["left","top"].includes(o)?-1:1,u=s&&l?-1:1,f=Oo(n,e);let{mainAxis:m,crossAxis:g,alignmentAxis:_}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...f};return a&&typeof _=="number"&&(g=a==="end"?_*-1:_),l?{x:g*u,y:m*c}:{x:m*c,y:g*u}}const Wd=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(n){var t,r;const{x:i,y:s,placement:o,middlewareData:a}=n,l=await E4(n,e);return o===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},S4=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(n){const{x:t,y:r,placement:i}=n,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:S=>{let{x:b,y:v}=S;return{x:b,y:v}}},...l}=Oo(e,n),c={x:t,y:r},u=await Hd(n,l),f=Do(mi(i)),m=Nd(f);let g=c[m],_=c[f];if(s){const S=m==="y"?"top":"left",b=m==="y"?"bottom":"right",v=g+u[S],y=g-u[b];g=Dd(v,g,y)}if(o){const S=f==="y"?"top":"left",b=f==="y"?"bottom":"right",v=_+u[S],y=_-u[b];_=Dd(v,_,y)}const E=a.fn({...n,[m]:g,[f]:_});return{...E,data:{x:E.x-t,y:E.y-r}}}}};function Bi(e){return jd(e)?(e.nodeName||"").toLowerCase():"#document"}function kr(e){var n;return(e==null||(n=e.ownerDocument)==null?void 0:n.defaultView)||window}function _i(e){var n;return(n=(jd(e)?e.ownerDocument:e.document)||window.document)==null?void 0:n.documentElement}function jd(e){return e instanceof Node||e instanceof kr(e).Node}function gi(e){return e instanceof Element||e instanceof kr(e).Element}function Zr(e){return e instanceof HTMLElement||e instanceof kr(e).HTMLElement}function Gd(e){return typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof kr(e).ShadowRoot}function No(e){const{overflow:n,overflowX:t,overflowY:r,display:i}=Rr(e);return/auto|scroll|overlay|hidden|clip/.test(n+r+t)&&!["inline","contents"].includes(i)}function k4(e){return["table","td","th"].includes(Bi(e))}function Ou(e){const n=Du(),t=Rr(e);return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!n&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!n&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function T4(e){let n=Gs(e);for(;Zr(n)&&!Ya(n);){if(Ou(n))return n;n=Gs(n)}return null}function Du(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Ya(e){return["html","body","#document"].includes(Bi(e))}function Rr(e){return kr(e).getComputedStyle(e)}function qa(e){return gi(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Gs(e){if(Bi(e)==="html")return e;const n=e.assignedSlot||e.parentNode||Gd(e)&&e.host||_i(e);return Gd(n)?n.host:n}function zd(e){const n=Gs(e);return Ya(n)?e.ownerDocument?e.ownerDocument.body:e.body:Zr(n)&&No(n)?n:zd(n)}function Fo(e,n,t){var r;n===void 0&&(n=[]),t===void 0&&(t=!0);const i=zd(e),s=i===((r=e.ownerDocument)==null?void 0:r.body),o=kr(i);return s?n.concat(o,o.visualViewport||[],No(i)?i:[],o.frameElement&&t?Fo(o.frameElement):[]):n.concat(i,Fo(i,[],t))}function Xd(e){const n=Rr(e);let t=parseFloat(n.width)||0,r=parseFloat(n.height)||0;const i=Zr(e),s=i?e.offsetWidth:t,o=i?e.offsetHeight:r,a=ja(t)!==s||ja(r)!==o;return a&&(t=s,r=o),{width:t,height:r,$:a}}function Nu(e){return gi(e)?e:e.contextElement}function zs(e){const n=Nu(e);if(!Zr(n))return Pi(1);const t=n.getBoundingClientRect(),{width:r,height:i,$:s}=Xd(n);let o=(s?ja(t.width):t.width)/r,a=(s?ja(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const A4=Pi(0);function Yd(e){const n=kr(e);return!Du()||!n.visualViewport?A4:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function M4(e,n,t){return n===void 0&&(n=!1),!t||n&&t!==kr(e)?!1:n}function is(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=!1);const i=e.getBoundingClientRect(),s=Nu(e);let o=Pi(1);n&&(r?gi(r)&&(o=zs(r)):o=zs(e));const a=M4(s,t,r)?Yd(s):Pi(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,f=i.height/o.y;if(s){const m=kr(s),g=r&&gi(r)?kr(r):r;let _=m,E=_.frameElement;for(;E&&r&&g!==_;){const S=zs(E),b=E.getBoundingClientRect(),v=Rr(E),y=b.left+(E.clientLeft+parseFloat(v.paddingLeft))*S.x,A=b.top+(E.clientTop+parseFloat(v.paddingTop))*S.y;l*=S.x,c*=S.y,u*=S.x,f*=S.y,l+=y,c+=A,_=kr(E),E=_.frameElement}}return js({width:u,height:f,x:l,y:c})}const C4=[":popover-open",":modal"];function qd(e){return C4.some(n=>{try{return e.matches(n)}catch{return!1}})}function R4(e){let{elements:n,rect:t,offsetParent:r,strategy:i}=e;const s=i==="fixed",o=_i(r),a=n?qd(n.floating):!1;if(r===o||a&&s)return t;let l={scrollLeft:0,scrollTop:0},c=Pi(1);const u=Pi(0),f=Zr(r);if((f||!f&&!s)&&((Bi(r)!=="body"||No(o))&&(l=qa(r)),Zr(r))){const m=is(r);c=zs(r),u.x=m.x+r.clientLeft,u.y=m.y+r.clientTop}return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x,y:t.y*c.y-l.scrollTop*c.y+u.y}}function L4(e){return Array.from(e.getClientRects())}function Zd(e){return is(_i(e)).left+qa(e).scrollLeft}function P4(e){const n=_i(e),t=qa(e),r=e.ownerDocument.body,i=qr(n.scrollWidth,n.clientWidth,r.scrollWidth,r.clientWidth),s=qr(n.scrollHeight,n.clientHeight,r.scrollHeight,r.clientHeight);let o=-t.scrollLeft+Zd(e);const a=-t.scrollTop;return Rr(r).direction==="rtl"&&(o+=qr(n.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}function B4(e,n){const t=kr(e),r=_i(e),i=t.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const c=Du();(!c||c&&n==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a,y:l}}function I4(e,n){const t=is(e,!0,n==="fixed"),r=t.top+e.clientTop,i=t.left+e.clientLeft,s=Zr(e)?zs(e):Pi(1),o=e.clientWidth*s.x,a=e.clientHeight*s.y,l=i*s.x,c=r*s.y;return{width:o,height:a,x:l,y:c}}function Kd(e,n,t){let r;if(n==="viewport")r=B4(e,t);else if(n==="document")r=P4(_i(e));else if(gi(n))r=I4(n,t);else{const i=Yd(e);r={...n,x:n.x-i.x,y:n.y-i.y}}return js(r)}function Qd(e,n){const t=Gs(e);return t===n||!gi(t)||Ya(t)?!1:Rr(t).position==="fixed"||Qd(t,n)}function O4(e,n){const t=n.get(e);if(t)return t;let r=Fo(e,[],!1).filter(a=>gi(a)&&Bi(a)!=="body"),i=null;const s=Rr(e).position==="fixed";let o=s?Gs(e):e;for(;gi(o)&&!Ya(o);){const a=Rr(o),l=Ou(o);!l&&a.position==="fixed"&&(i=null),(s?!l&&!i:!l&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||No(o)&&!l&&Qd(e,o))?r=r.filter(u=>u!==o):i=a,o=Gs(o)}return n.set(e,r),r}function D4(e){let{element:n,boundary:t,rootBoundary:r,strategy:i}=e;const o=[...t==="clippingAncestors"?O4(n,this._c):[].concat(t),r],a=o[0],l=o.reduce((c,u)=>{const f=Kd(n,u,i);return c.top=qr(f.top,c.top),c.right=rs(f.right,c.right),c.bottom=rs(f.bottom,c.bottom),c.left=qr(f.left,c.left),c},Kd(n,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function N4(e){const{width:n,height:t}=Xd(e);return{width:n,height:t}}function F4(e,n,t){const r=Zr(n),i=_i(n),s=t==="fixed",o=is(e,!0,s,n);let a={scrollLeft:0,scrollTop:0};const l=Pi(0);if(r||!r&&!s)if((Bi(n)!=="body"||No(i))&&(a=qa(n)),r){const f=is(n,!0,s,n);l.x=f.x+n.clientLeft,l.y=f.y+n.clientTop}else i&&(l.x=Zd(i));const c=o.left+a.scrollLeft-l.x,u=o.top+a.scrollTop-l.y;return{x:c,y:u,width:o.width,height:o.height}}function Jd(e,n){return!Zr(e)||Rr(e).position==="fixed"?null:n?n(e):e.offsetParent}function e0(e,n){const t=kr(e);if(!Zr(e)||qd(e))return t;let r=Jd(e,n);for(;r&&k4(r)&&Rr(r).position==="static";)r=Jd(r,n);return r&&(Bi(r)==="html"||Bi(r)==="body"&&Rr(r).position==="static"&&!Ou(r))?t:r||T4(e)||t}const $4=async function(e){const n=this.getOffsetParent||e0,t=this.getDimensions;return{reference:F4(e.reference,await n(e.floating),e.strategy),floating:{x:0,y:0,...await t(e.floating)}}};function V4(e){return Rr(e).direction==="rtl"}const x4={convertOffsetParentRelativeRectToViewportRelativeRect:R4,getDocumentElement:_i,getClippingRect:D4,getOffsetParent:e0,getElementRects:$4,getClientRects:L4,getDimensions:N4,getScale:zs,isElement:gi,isRTL:V4};function H4(e,n){let t=null,r;const i=_i(e);function s(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const{left:c,top:u,width:f,height:m}=e.getBoundingClientRect();if(a||n(),!f||!m)return;const g=Ga(u),_=Ga(i.clientWidth-(c+f)),E=Ga(i.clientHeight-(u+m)),S=Ga(c),v={rootMargin:-g+"px "+-_+"px "+-E+"px "+-S+"px",threshold:qr(0,rs(1,l))||1};let y=!0;function A(d){const p=d[0].intersectionRatio;if(p!==l){if(!y)return o();p?o(!1,p):r=setTimeout(()=>{o(!1,1e-7)},100)}y=!1}try{t=new IntersectionObserver(A,{...v,root:i.ownerDocument})}catch{t=new IntersectionObserver(A,v)}t.observe(e)}return o(!0),s}function t0(e,n,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=Nu(e),u=i||s?[...c?Fo(c):[],...Fo(n)]:[];u.forEach(b=>{i&&b.addEventListener("scroll",t,{passive:!0}),s&&b.addEventListener("resize",t)});const f=c&&a?H4(c,t):null;let m=-1,g=null;o&&(g=new ResizeObserver(b=>{let[v]=b;v&&v.target===c&&g&&(g.unobserve(n),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var y;(y=g)==null||y.observe(n)})),t()}),c&&!l&&g.observe(c),g.observe(n));let _,E=l?is(e):null;l&&S();function S(){const b=is(e);E&&(b.x!==E.x||b.y!==E.y||b.width!==E.width||b.height!==E.height)&&t(),E=b,_=requestAnimationFrame(S)}return t(),()=>{var b;u.forEach(v=>{i&&v.removeEventListener("scroll",t),s&&v.removeEventListener("resize",t)}),f==null||f(),(b=g)==null||b.disconnect(),g=null,l&&cancelAnimationFrame(_)}}const U4=S4,n0=w4,W4=y4,r0=(e,n,t)=>{const r=new Map,i={platform:x4,...t},s={...i.platform,_c:r};return b4(e,n,{...i,platform:s})},j4=e=>({}),i0=e=>({});function s0(e){let n,t,r,i,s;const o=e[7].default,a=ds(o,e,e[6],null);return{c(){n=_e("div"),a&&a.c(),re(n,"class","ttu-whispersync-container popover")},m(l,c){de(l,n,c),a&&a.m(n,null),e[9](n),r=!0,i||(s=Uo(t=f2.call(null,n,e[10])),i=!0)},p(l,c){a&&a.p&&(!r||c&64)&&ps(a,o,l,l[6],r?hs(o,l[6],c,null):ms(l[6]),null),t&&Vr(t.update)&&c&2&&t.update.call(null,l[10])},i(l){r||(te(a,l),r=!0)},o(l){ue(a,l),r=!1},d(l){l&&fe(n),a&&a.d(l),e[9](null),i=!1,s()}}}function G4(e){let n,t,r,i,s,o;const a=e[7].icon,l=ds(a,e,e[6],i0);let c=e[3]&&s0(e);return{c(){n=_e("div"),t=_e("button"),l&&l.c(),r=me(),c&&c.c(),re(n,"class","flex")},m(u,f){de(u,n,f),oe(n,t),l&&l.m(t,null),e[8](t),oe(n,r),c&&c.m(n,null),i=!0,s||(o=qe(t,"click",e[4]),s=!0)},p(u,[f]){l&&l.p&&(!i||f&64)&&ps(l,a,u,u[6],i?hs(a,u[6],f,j4):ms(u[6]),i0),u[3]?c?(c.p(u,f),f&8&&te(c,1)):(c=s0(u),c.c(),te(c,1),c.m(n,null)):c&&(rn(),ue(c,1,1,()=>{c=null}),sn())},i(u){i||(te(l,u),te(c),i=!0)},o(u){ue(l,u),ue(c),i=!1},d(u){u&&fe(n),l&&l.d(u),e[8](null),c&&c.d(),s=!1,o()}}}function z4(e,n,t){let{$$slots:r={},$$scope:i}=n,{placement:s="left"}=n;function o(){u==null||u(),t(3,c=!1)}let a,l,c=!1,u;async function f(){if(c)return o();t(3,c=!0),await qn(),u=t0(a,l,m)}function m(){r0(a,l,{placement:s,middleware:[Wd(5),n0({fallbackPlacements:["right","top","left"]}),U4()]}).then(({x:S,y:b})=>{t(2,l.style.left=`${S}px`,l),t(2,l.style.top=`${b}px`,l)}).catch(()=>{})}function g(S){Gt[S?"unshift":"push"](()=>{a=S,t(1,a)})}function _(S){Gt[S?"unshift":"push"](()=>{l=S,t(2,l)})}const E=({target:S})=>{S instanceof Element&&S!==a&&!a.contains(S)&&o()};return e.$$set=S=>{"placement"in S&&t(5,s=S.placement),"$$scope"in S&&t(6,i=S.$$scope)},[o,a,l,c,f,s,i,r,g,_,E]}class $r extends vn{constructor(n){super(),wn(this,n,z4,G4,pn,{placement:5,hide:0})}get hide(){return this.$$.ctx[0]}}function X4(e){let n,t;return{c(){n=_e("div"),t=_e("div"),re(t,"class","opacity-70"),lt(t,"rounded-full",e[2]),xn(t,"width",`${Math.min(100,e[0])}%`),xn(t,"height",`${e[1]}rem`),re(n,"class","w-full bg-inverted"),lt(n,"rounded-full",e[2]),lt(n,"m-t-s",e[3]),xn(n,"height",`${e[1]}rem`)},m(r,i){de(r,n,i),oe(n,t)},p(r,[i]){i&4&&lt(t,"rounded-full",r[2]),i&1&&xn(t,"width",`${Math.min(100,r[0])}%`),i&2&&xn(t,"height",`${r[1]}rem`),i&4&&lt(n,"rounded-full",r[2]),i&8&&lt(n,"m-t-s",r[3]),i&2&&xn(n,"height",`${r[1]}rem`)},i:gt,o:gt,d(r){r&&fe(n)}}}function Y4(e,n,t){let{currentProgress:r}=n,{height:i=.625}=n,{rounded:s=!1}=n,{margin:o=!1}=n;return e.$$set=a=>{"currentProgress"in a&&t(0,r=a.currentProgress),"height"in a&&t(1,i=a.height),"rounded"in a&&t(2,s=a.rounded),"margin"in a&&t(3,o=a.margin)},[r,i,s,o]}class Fu extends vn{constructor(n){super(),wn(this,n,Y4,X4,pn,{currentProgress:0,height:1,rounded:2,margin:3})}}const{document:o0,window:$u}=ic;function a0(e,n,t){const r=e.slice();r[105]=n[t];const i=r[105]===r[19];return r[106]=i,r}function l0(e){let n,t,r=!1,i,s=!0,o,a;function l(){cancelAnimationFrame(i),n.paused||(i=rc(l),r=!0),e[51].call(n)}return{c(){n=_e("audio"),n.controls=!0,re(n,"class","hidden"),fs(n.src,t=e[21])||re(n,"src",t),e[4]===void 0&&Fi(()=>e[52].call(n))},m(c,u){de(c,n,u),n.muted=e[18],isNaN(e[19])||(n.playbackRate=e[19]),e[56](n),o||(a=[qe(n,"timeupdate",l),qe(n,"durationchange",e[52]),qe(n,"volumechange",e[53]),qe(n,"play",e[54]),qe(n,"pause",e[54]),qe(n,"ratechange",e[55]),qe(n,"loadstart",e[49]),qe(n,"loadedmetadata",e[36]),qe(n,"timeupdate",e[37]),qe(n,"pause",e[37]),qe(n,"playing",e[40]),qe(n,"error",e[50])],o=!0)},p(c,u){u[0]&2097152&&!fs(n.src,t=c[21])&&re(n,"src",t),!r&&u[0]&8&&!isNaN(c[3])&&(n.currentTime=c[3]),r=!1,u[0]&262144&&(n.muted=c[18]),u[0]&131072&&s!==(s=c[17])&&n[s?"pause":"play"](),u[0]&524288&&!isNaN(c[19])&&(n.playbackRate=c[19])},d(c){c&&fe(n),e[56](null),o=!1,_n(a)}}}function u0(e,n){let t,r=n[105]+"",i,s,o,a;function l(){return n[64](n[105])}return{key:e,first:null,c(){t=_e("button"),i=Nt(r),s=me(),t.disabled=n[2],lt(t,"color-inverted",n[106]),lt(t,"color-inverted-hover",!n[106]),this.first=t},m(c,u){de(c,t,u),oe(t,i),oe(t,s),o||(a=qe(t,"click",l),o=!0)},p(c,u){n=c,u[0]&4&&(t.disabled=n[2]),u[0]&524288|u[1]&2&&lt(t,"color-inverted",n[106]),u[0]&524288|u[1]&2&&lt(t,"color-inverted-hover",!n[106])},d(c){c&&fe(t),o=!1,a()}}}function q4(e){let n,t=[],r=new Map,i=xr(e[32]);const s=o=>o[105];for(let o=0;o<i.length;o+=1){let a=a0(e,i,o),l=s(a);r.set(l,t[o]=u0(l,a))}return{c(){n=_e("div");for(let o=0;o<t.length;o+=1)t[o].c();re(n,"class","playback-rates")},m(o,a){de(o,n,a);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(n,null)},p(o,a){a[0]&524804|a[1]&2&&(i=xr(o[32]),t=ro(t,a,s,1,o,i,r,n,Xo,u0,null,a0))},d(o){o&&fe(n);for(let a=0;a<t.length;a+=1)t[a].d()}}}function Z4(e){let n,t,r,i;return r=new At({props:{path:Fp}}),{c(){n=_e("div"),t=_e("button"),Te(r.$$.fragment),re(t,"title","Change playback speed"),t.disabled=e[2],re(n,"class","flex m-x-xs"),re(n,"slot","icon")},m(s,o){de(s,n,o),oe(n,t),Ee(r,t,null),i=!0},p(s,o){(!i||o[0]&4)&&(t.disabled=s[2])},i(s){i||(te(r.$$.fragment,s),i=!0)},o(s){ue(r.$$.fragment,s),i=!1},d(s){s&&fe(n),Se(r)}}}function K4(e){let n=e[21],t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y,R,w,N,X,q,Z=l0(e);Fi(e[57]),o=new At({props:{path:e[2]||e[17]?Ps:ji}}),c=new At({props:{path:Ip}}),m=new At({props:{path:Np}}),E=new Fu({props:{currentProgress:Math.min(100,e[12]),height:1.5}}),p=new At({props:{path:Dp}}),D=new At({props:{path:Op}}),Y=new At({props:{path:e[2]||!e[18]?jc:Gc}});let ne={placement:"top",$$slots:{icon:[Z4],default:[q4]},$$scope:{ctx:e}};return w=new $r({props:ne}),e[65](w),{c(){Z.c(),t=me(),r=me(),i=_e("div"),s=_e("button"),Te(o.$$.fragment),a=me(),l=_e("button"),Te(c.$$.fragment),u=me(),f=_e("button"),Te(m.$$.fragment),g=me(),_=_e("button"),Te(E.$$.fragment),S=me(),b=_e("span"),v=Nt(e[10]),A=me(),d=_e("button"),Te(p.$$.fragment),M=me(),L=_e("button"),Te(D.$$.fragment),O=me(),x=_e("button"),Te(Y.$$.fragment),R=me(),Te(w.$$.fragment),re(s,"title","Toggle playback"),re(s,"class","m-x-xs"),s.disabled=e[2],re(l,"class","m-x-xs"),re(l,"title",e[15]),l.disabled=e[2],re(f,"class","m-x-xs"),re(f,"title",e[16]),f.disabled=e[2],re(b,"class","w-full absolute left-0 player-progress-tooltip"),re(_,"class","w-full relative player-progress-tooltip-button m-x-xs"),_.disabled=e[2],re(_,"title",y=e[2]?"Recording in progress":null),lt(_,"recording",e[2]),re(d,"class","m-x-xs"),re(d,"title",e[14]),d.disabled=e[2],re(L,"class","m-x-xs"),re(L,"title",e[13]),L.disabled=e[2],re(x,"title","Toggle mute"),re(x,"class","m-x-xs"),x.disabled=e[2],re(i,"class","flex items-center w-full m-t-b"),lt(i,"invisible",!e[20])},m(U,F){Z.m(U,F),de(U,t,F),de(U,r,F),de(U,i,F),oe(i,s),Ee(o,s,null),oe(i,a),oe(i,l),Ee(c,l,null),oe(i,u),oe(i,f),Ee(m,f,null),oe(i,g),oe(i,_),Ee(E,_,null),oe(_,S),oe(_,b),oe(b,v),oe(i,A),oe(i,d),Ee(p,d,null),oe(i,M),oe(i,L),Ee(D,L,null),oe(i,O),oe(i,x),Ee(Y,x,null),oe(i,R),Ee(w,i,null),N=!0,X||(q=[qe($u,"blur",e[33]),qe($u,"focus",e[34]),qe($u,"keydown",e[35]),qe(o0,"visibilitychange",e[57]),qe(s,"click",e[58]),qe(l,"click",e[59]),qe(f,"click",e[60]),qe(_,"pointerenter",e[38]),qe(_,"pointermove",e[38]),qe(_,"pointerout",e[38]),qe(_,"click",e[39]),qe(d,"click",e[61]),qe(L,"click",e[62]),qe(x,"click",e[63])],X=!0)},p(U,F){F[0]&2097152&&pn(n,n=U[21])?(Z.d(1),Z=l0(U),Z.c(),Z.m(t.parentNode,t)):Z.p(U,F);const C={};F[0]&131076&&(C.path=U[2]||U[17]?Ps:ji),o.$set(C),(!N||F[0]&4)&&(s.disabled=U[2]),(!N||F[0]&32768)&&re(l,"title",U[15]),(!N||F[0]&4)&&(l.disabled=U[2]),(!N||F[0]&65536)&&re(f,"title",U[16]),(!N||F[0]&4)&&(f.disabled=U[2]);const P={};F[0]&4096&&(P.currentProgress=Math.min(100,U[12])),E.$set(P),(!N||F[0]&1024)&&en(v,U[10]),(!N||F[0]&4)&&(_.disabled=U[2]),(!N||F[0]&4&&y!==(y=U[2]?"Recording in progress":null))&&re(_,"title",y),(!N||F[0]&4)&&lt(_,"recording",U[2]),(!N||F[0]&16384)&&re(d,"title",U[14]),(!N||F[0]&4)&&(d.disabled=U[2]),(!N||F[0]&8192)&&re(L,"title",U[13]),(!N||F[0]&4)&&(L.disabled=U[2]);const I={};F[0]&262148&&(I.path=U[2]||!U[18]?jc:Gc),Y.$set(I),(!N||F[0]&4)&&(x.disabled=U[2]);const H={};F[0]&524804|F[3]&65536&&(H.$$scope={dirty:F,ctx:U}),w.$set(H),(!N||F[0]&1048576)&&lt(i,"invisible",!U[20])},i(U){N||(te(o.$$.fragment,U),te(c.$$.fragment,U),te(m.$$.fragment,U),te(E.$$.fragment,U),te(p.$$.fragment,U),te(D.$$.fragment,U),te(Y.$$.fragment,U),te(w.$$.fragment,U),N=!0)},o(U){ue(o.$$.fragment,U),ue(c.$$.fragment,U),ue(m.$$.fragment,U),ue(E.$$.fragment,U),ue(p.$$.fragment,U),ue(D.$$.fragment,U),ue(Y.$$.fragment,U),ue(w.$$.fragment,U),N=!1},d(U){U&&(fe(t),fe(r),fe(i)),Z.d(U),Se(o),Se(c),Se(m),Se(E),Se(p),Se(D),Se(Y),e[65](null),Se(w),X=!1,_n(q)}}}function Q4(e,n,t){let r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y,R,w,N,X,q,Z,ne;we(e,gn,Ve=>t(17,l=Ve)),we(e,ki,Ve=>t(2,c=Ve)),we(e,ri,Ve=>t(76,u=Ve)),we(e,ii,Ve=>t(3,f=Ve)),we(e,Xn,Ve=>t(77,m=Ve)),we(e,uo,Ve=>t(18,_=Ve)),we(e,co,Ve=>t(19,E=Ve)),we(e,Si,Ve=>t(20,b=Ve)),we(e,si,Ve=>t(4,d=Ve)),we(e,zn,Ve=>t(80,p=Ve)),we(e,kt,Ve=>t(81,M=Ve)),we(e,Es,Ve=>t(82,L=Ve)),we(e,Et,Ve=>t(83,D=Ve)),we(e,jr,Ve=>t(85,x=Ve)),we(e,dn,Ve=>t(86,X=Ve)),we(e,fo,Ve=>t(47,q=Ve)),we(e,hl,Ve=>t(48,Z=Ve)),we(e,oo,Ve=>t(21,ne=Ve));let{imageLoaded:U}=n;const F=ei(),{readerEnableAutoScroll$:C,readerEnableTrackerAutoPause$:P,playerEnableDictionaryDetection$:I,playerEnableWakeLock$:H,playerAutoPauseMode$:K,playerRewindTime$:he,playerAltRewindTime$:ee,playerFastForwardTime$:ae,playerAltFastForwardTime$:ge,exportAudioBitrate$:Le}=St;we(e,C,Ve=>t(78,g=Ve)),we(e,P,Ve=>t(79,S=Ve)),we(e,I,Ve=>t(44,v=Ve)),we(e,H,Ve=>t(46,A=Ve)),we(e,K,Ve=>t(45,y=Ve)),we(e,he,Ve=>t(8,N=Ve)),we(e,ee,Ve=>t(7,w=Ve)),we(e,ae,Ve=>t(6,R=Ve)),we(e,ge,Ve=>t(5,Y=Ve)),we(e,Le,Ve=>t(84,O=Ve));const{isIOS:He}=Ni("context"),De=[.25,.5,.75,1,1.25,1.5,1.75,2],Ue=!!+`${window.localStorage.getItem("statisticsEnabled")||"0"}`,be=new MutationObserver(wt),Re=new MutationObserver(We);let Xe,Ne,B,V,ye,Ae,Ke="",et=[],Je=[],ze=!1,ut=!1,nt=-1,Ye=-1,W=-1,k,h,T;jo(()=>{document.addEventListener("ttsu:section.change",Qe,!1),t(43,B=document.getElementById("jpdb-popup"))}),Go(()=>{document.removeEventListener("ttsu:section.change",Qe,!1),be.disconnect(),Re.disconnect(),_t()});async function $(){y!==yr.STRICT||l||c||v&&at()||(pe(gn,l=!0,l),t(11,ze=!0))}function j(){y!==yr.STRICT||!l||!ze||!v&&at()||(pe(gn,l=!1,l),t(11,ze=!1))}function J(Ve){if(X||Ve.repeat||!(Ve.ctrlKey||Ve.metaKey||Ve.altKey)||!b||c)return;const Ie=(Ve.code||Ve.key||"").toLowerCase();let Mt=ct.NONE,Tt=!0,Zt=!1,yt=m.get(u.current);if(Ve.altKey)switch(Ie){case"keyd":case"d":Mt=yt?ct.TOGGLE_PLAY_PAUSE:ct.NONE;break;case"keyq":case"q":if(yt){const jt=[...m.values()];yt=jt[Math.min(yt.subIndex+1,jt.length-1)]}Mt=yt?ct.RESTART_PLAYBACK:ct.NONE,Zt=!0;break;default:Tt=!1;break}else switch(Ie){case"space":case" ":pe(gn,l=!l,l);break;case"keyd":case"d":Mt=yt?ct.RESTART_PLAYBACK:ct.NONE;break;case"keyl":case"l":Mt=yt?ct.TOGGLE_PLAYBACK_LOOP:ct.NONE;break;case"keyq":case"q":yt&&(yt=[...m.values()][Math.max(yt.subIndex-1,0)]),Mt=yt?ct.RESTART_PLAYBACK:ct.NONE,Zt=!0;break;case"arrowleft":yt=fr(Math.max(0,f-N)),Mt=ct.RESTART_PLAYBACK,Zt=!0;break;case"arrowdown":yt=fr(Math.max(0,f-w)),Mt=ct.RESTART_PLAYBACK,Zt=!0;break;case"arrowright":yt=fr(Math.min(d,f+R)),Mt=ct.RESTART_PLAYBACK,Zt=!0;break;case"arrowup":yt=fr(Math.min(d,f+Y)),Mt=ct.RESTART_PLAYBACK,Zt=!0;break;default:Tt=!1;break}Tt&&(Ve.preventDefault(),Ve.stopPropagation()),Ln(Mt,yt,{keepPauseState:Zt})}async function Q(){if(!He)return t(0,Xe.currentTime=f,Xe),F("loaded");let Ve=0,Ie;const Mt=f,Tt=new Promise(yt=>{Ie=yt,Xe.addEventListener("loadeddata",yt,{once:!0,capture:!1})});await new Promise(yt=>{const jt=setInterval(async()=>{try{Ve+=1,Xe.play(),setTimeout(Ie,1e4),await Tt,Xe.pause(),clearInterval(jt),yt()}catch{}Ve>20&&(clearInterval(jt),Ie(void 0),yt())},500)}),ve(Mt),await qn(),F("loaded")}async function ce(){if(x!=null&&x.signal.aborted)return await Od(O,!0).catch(()=>{}),T==null||T(new wc("user aborted")),et=[],Je=[],nt=-1,ut=!1,pe(gn,l=!0,l),ke();if(nt>-1&&f>Je[nt]){const Ie=nt===Je.length-1,Mt=ut&&Ie,Tt=Mt||!Ie,Zt=nt;if(nt=-1,Tt)return nt=Mt?0:Zt+1,ve(et[nt]);if(et=[],Je=[],ut=!1,pe(gn,l=!0,l),h){const yt=await Od(O).catch(jt=>{T==null||T(jt),ke()});h(yt)}return ke()}let Ve=b;if(b||(pe(Si,b=!0,b),m.size&&$e({subtitles:[...m.values()],replaceTrack:!0}),await Promise.all([qn(),U()]),pe(Et,D=!1,D)),!(Ye>-1||!Ve)){pe(kt,M="",M);try{const Ie=f;await L.put("audioBook",{playbackPosition:Ie,title:p.title,lastAudioBookModified:Date.now()}),pe(zn,p.playbackPosition=Ie,p),document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"sync",syncType:"audioBook"}}))}catch({message:Ie}){pe(kt,M=`Failed to update current time: ${Ie}`,M)}zn.set(p)}}function ie(Ve){t(10,Ke=Rs(Pe(Ve)))}async function le(){await qn(),Ln(ct.RESTART_PLAYBACK,fr(cp(Ke)),{keepPauseState:!0})}function ve(Ve){pe(ii,f=Ve,f),Xe&&t(0,Xe.currentTime=Ve,Xe)}function ke(){h=void 0,T=void 0,Ye>-1&&ve(Ye),W>-1&&pe(co,E=W,E),k!==void 0&&pe(uo,_=k,_),Ye=-1,W=-1,k=void 0}function Pe(Ve){const Ie=Ve.currentTarget.getBoundingClientRect();return ai(0,d,Math.ceil((Ve.clientX-Ie.left)/Ie.width*d+Number.EPSILON))}function Ze(Ve){Ve==="visible"&&A&&setTimeout(je,500),!(y!==yr.MODERATE||c)&&(Ve==="hidden"&&!l&&(!v||!at())?(pe(gn,l=!0,l),t(11,ze=!0)):Ve==="visible"&&l&&ze&&(v||!at())&&(pe(gn,l=!1,l),t(11,ze=!1)))}async function ft(Ve){if(!b||!Ve.subtitles.length)return;await qn();const{action:Ie,subtitles:Mt,skipUpdates:Tt,keepPauseState:Zt}=Ve,{startSeconds:yt}=Mt[0],jt=Ie!==ct.RESTART_PLAYBACK;if({recorderSuccess:h,recorderFailure:T}=Ve,Tt||h?(Ye=Ye>-1?Ye:f,W=W>-1?W:E,k=k!==void 0?k:_):(Ye=-1,W=-1,k=void 0),!Tt&&!c&&g&&S&&Ue){const cn=[...m.values()].findLast(Oe=>yt>=Oe.startSeconds);cn&&cn.id!==u.current&&document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"pauseTracker",selector:po(cn.id)}}))}if(et=jt?Mt.map(cn=>cn.startSeconds):[],Je=jt?Mt.map(cn=>cn.endSeconds):[],nt=jt?0:-1,ut=jt?Ie===ct.TOGGLE_PLAYBACK_LOOP:!1,ve(yt),h&&T)return c4(Xe).then(()=>{pe(co,E=1,E),pe(uo,_=!1,_),pe(gn,l=!1,l)}).catch(cn=>{T==null||T(cn),ke()});Zt||pe(gn,l=!1,l)}function $e(Ve){var Zt;const{subtitles:Ie}=Ve,Mt=[...Xe.textTracks],Tt=Mt.findLast(yt=>yt.mode!=="disabled");if(Ve.replaceTrack)for(let yt=0,{length:jt}=Mt;yt<jt;yt+=1)Mt[yt].mode="disabled";if(!Ie.length)return Qe();if(Ve.replaceTrack){const yt=Xe.addTextTrack("captions","Captions","jp");for(let jt=0,{length:cn}=Ie;jt<cn;jt+=1)yt.addCue(dt(Ie[jt]));yt.mode="hidden";return}if(Tt){for(let yt=0,{length:jt}=Ie;yt<jt;yt+=1){const cn=Ie[yt],Oe=(Zt=Tt.cues)==null?void 0:Zt.getCueById(cn.id);Oe&&(Oe.removeEventListener("enter",Be,!1),Oe.removeEventListener("exit",Qe,!1),Tt.removeCue(Oe)),Tt.addCue(dt(cn))}Tt.mode="hidden"}}function dt(Ve){const Ie=new VTTCue(Ve.startSeconds,Ve.endSeconds,"");return Ie.id=Ve.id,Ie.addEventListener("enter",Be,!1),Ie.addEventListener("exit",Qe,!1),Ie}function Be(Ve){const{id:Ie}=Ve.target;Qe(Ie),Ye===-1&&g&&document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"cue",selector:po(Ie)}}))}async function Qe(Ve){var Zt;if(Ye>-1)return;const Ie=[...Xe.textTracks].findLast(yt=>yt.mode!=="disabled"),Mt=[...(Ie==null?void 0:Ie.activeCues)||[]].map(yt=>yt.id);if(Ie&&!Mt.length&&typeof Ve=="string"&&He){const yt=((Zt=[...m.values()].findLast(jt=>f>=jt.startSeconds))==null?void 0:Zt.id)||"";yt&&Mt.push(yt)}const Tt=document.querySelectorAll(`${oa()}.active${Mt.length?`,${Mt.map(yt=>po(yt)).join(",")}`:""}`);for(let yt=0,{length:jt}=Tt;yt<jt;yt+=1){const cn=Tt[yt],Oe=vc(cn);Oe!=="not existing"&&Mt.find(Lt=>Lt===Oe)?cn.classList.add("active"):cn.classList.remove("active")}Mt.length?pe(ri,u={previous:u.current,current:Mt[Mt.length-1],useTimeFallback:!1},u):pe(ri,u={previous:u.current,current:"",useTimeFallback:!0},u)}function wt(){t(42,Ne=document.querySelector(".yomichan-popup,.yomichan-float,.yomitan-popup,.yomitan-float")),Ne&&be.disconnect()}function We(){if(!B&&!Ne||c)return;const Ve=at();Ve&&!l?(pe(gn,l=!0,l),t(11,ze=!0)):!Ve&&l&&ze&&(pe(gn,l=!1,l),t(11,ze=!1))}function at(){return Ne&&Ne.style.visibility!=="hidden"||B&&B.style.opacity!=="0"}async function je(){V&&!V.released||(V=await navigator.wakeLock.request().catch(()=>{}),V&&V.addEventListener("release",_t,!1))}async function _t(){V&&!V.released&&await V.release().catch(()=>{}),V=void 0}function Bt(Ve){cr.call(this,e,Ve)}function ot(Ve){cr.call(this,e,Ve)}function ht(){f=this.currentTime,ii.set(f)}function Rt(){d=this.duration,si.set(d)}function Xt(){_=this.muted,uo.set(_)}function mn(){l=this.paused,gn.set(l)}function Jt(){E=this.playbackRate,co.set(E)}function $t(Ve){Gt[Ve?"unshift":"push"](()=>{Xe=Ve,t(0,Xe)})}function bn(){t(1,Ae=o0.visibilityState)}const Sn=()=>{pe(gn,l=!l,l),t(11,ze=!1)},En=()=>Ln(ct.RESTART_PLAYBACK,fr(Math.max(0,f-w)),{keepPauseState:!0}),Yt=()=>Ln(ct.RESTART_PLAYBACK,fr(Math.max(0,f-N)),{keepPauseState:!0}),Ht=()=>Ln(ct.RESTART_PLAYBACK,fr(Math.min(d,f+R)),{keepPauseState:!0}),Vt=()=>Ln(ct.RESTART_PLAYBACK,fr(Math.min(d,f+Y)),{keepPauseState:!0}),Ft=()=>pe(uo,_=!_,_),Ge=Ve=>{pe(co,E=Ve,E),ye.hide()};function bt(Ve){Gt[Ve?"unshift":"push"](()=>{ye=Ve,t(9,ye)})}return e.$$set=Ve=>{"imageLoaded"in Ve&&t(41,U=Ve.imageLoaded)},e.$$.update=()=>{e.$$.dirty[0]&260&&t(16,r=c?"Recording in progress":`Rewind ${N} seconds`),e.$$.dirty[0]&132&&t(15,i=c?"Recording in progress":`Rewind ${w} seconds`),e.$$.dirty[0]&68&&t(14,s=c?"Recording in progress":`Fast-Forward ${R} seconds`),e.$$.dirty[0]&36&&t(13,o=c?"Recording in progress":`Fast-Forward ${Y} seconds`),e.$$.dirty[0]&24&&t(12,a=d?Math.min(100,mo(f,d)):0),e.$$.dirty[0]&2&&Ze(Ae),e.$$.dirty[1]&131072&&ft(Z),e.$$.dirty[0]&1|e.$$.dirty[1]&65536&&Xe&&q&&$e(q),e.$$.dirty[1]&30720&&(y!==yr.DISABLED&&!v?(Ne||t(42,Ne=document.querySelector(".yomichan-popup,.yomichan-float,.yomitan-popup,.yomitan-float")),Ne?Re.observe(Ne,{attributes:!0}):be.observe(document.body,{childList:!0,subtree:!1}),B&&Re.observe(B,{attributes:!0})):(y===yr.DISABLED||v||!B&&!Ne)&&(be.disconnect(),Re.disconnect())),e.$$.dirty[1]&32768&&(A?je():_t())},[Xe,Ae,c,f,d,Y,R,w,N,ye,Ke,ze,a,o,s,i,r,l,_,E,b,ne,C,P,I,H,K,he,ee,ae,ge,Le,De,$,j,J,Q,ce,ie,le,je,U,Ne,B,v,y,A,q,Z,Bt,ot,ht,Rt,Xt,mn,Jt,$t,bn,Sn,En,Yt,Ht,Vt,Ft,Ge,bt]}class J4 extends vn{constructor(n){super(),wn(this,n,Q4,K4,pn,{imageLoaded:41},null,[-1,-1,-1,-1])}}function e5(e){let n,t,r,i,s,o;return t=new At({props:{path:e[0]}}),{c(){n=_e("button"),Te(t.$$.fragment),re(n,"class",e[3]),n.disabled=r=e[1]!==e[2],re(n,"title",e[1])},m(a,l){de(a,n,l),Ee(t,n,null),i=!0,s||(o=qe(n,"click",e[5]),s=!0)},p(a,[l]){const c={};l&1&&(c.path=a[0]),t.$set(c),(!i||l&8)&&re(n,"class",a[3]),(!i||l&6&&r!==(r=a[1]!==a[2]))&&(n.disabled=r),(!i||l&2)&&re(n,"title",a[1])},i(a){i||(te(t.$$.fragment,a),i=!0)},o(a){ue(t.$$.fragment,a),i=!1},d(a){a&&fe(n),Se(t),s=!1,o()}}}function t5(e,n,t){let{path:r}=n,{title:i}=n,{action:s}=n,{buttonClasses:o="m-y-xs"}=n,{subtitle:a=void 0}=n;const l=()=>Ln(s,a);return e.$$set=c=>{"path"in c&&t(0,r=c.path),"title"in c&&t(1,i=c.title),"action"in c&&t(2,s=c.action),"buttonClasses"in c&&t(3,o=c.buttonClasses),"subtitle"in c&&t(4,a=c.subtitle)},[r,i,s,o,a,l]}class Wn extends vn{constructor(n){super(),wn(this,n,t5,e5,pn,{path:0,title:1,action:2,buttonClasses:3,subtitle:4})}}function n5(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d;return t=new Wn({props:{title:e[19](e[5],e[6],e[0]),action:ct.RESTART_PLAYBACK,path:xc,subtitle:e[0]}}),i=new Wn({props:{buttonClasses:"m-t-xs",title:e[19](e[7],e[6],e[0]),action:ct.TOGGLE_PLAY_PAUSE,path:kl,subtitle:e[0]}}),o=new Wn({props:{buttonClasses:"m-t-xs",title:e[19](e[8],e[6],e[0]),action:ct.TOGGLE_PLAYBACK_LOOP,path:Tl,subtitle:e[0]}}),c=new Wn({props:{title:e[19](e[9],e[6],e[0]),action:ct.TOGGLE_BOOKMARK,path:e[3],subtitle:e[0]}}),f=new Wn({props:{buttonClasses:"m-t-xs",title:e[19](e[10],e[6],e[0]),action:ct.TOGGLE_MERGE,path:e[2],subtitle:e[0]}}),g=new Wn({props:{buttonClasses:"m-t-xs",title:e[19](e[11],e[6],e[0]),action:ct.EDIT_SUBTITLE,path:Fc,subtitle:e[0]}}),S=new Wn({props:{title:e[19](e[4],e[6],e[0]),action:ct.RESTORE_SUBTITLE,path:bo,subtitle:e[0]}}),v=new Wn({props:{buttonClasses:"m-t-xs",title:e[19](e[12],e[6],e[0]),action:ct.EXPORT_NEW,path:yl,subtitle:e[0]}}),A=new Wn({props:{buttonClasses:"m-t-xs",title:e[19](e[13],e[6],e[0]),action:ct.EXPORT_UPDATE,path:El,subtitle:e[0]}}),{c(){n=_e("div"),Te(t.$$.fragment),r=me(),Te(i.$$.fragment),s=me(),Te(o.$$.fragment),a=me(),l=_e("div"),Te(c.$$.fragment),u=me(),Te(f.$$.fragment),m=me(),Te(g.$$.fragment),_=me(),E=_e("div"),Te(S.$$.fragment),b=me(),Te(v.$$.fragment),y=me(),Te(A.$$.fragment),re(n,"class","flex flex-col"),re(l,"class","flex flex-col"),re(E,"class","flex flex-col")},m(p,M){de(p,n,M),Ee(t,n,null),oe(n,r),Ee(i,n,null),oe(n,s),Ee(o,n,null),de(p,a,M),de(p,l,M),Ee(c,l,null),oe(l,u),Ee(f,l,null),oe(l,m),Ee(g,l,null),de(p,_,M),de(p,E,M),Ee(S,E,null),oe(E,b),Ee(v,E,null),oe(E,y),Ee(A,E,null),d=!0},p(p,M){const L={};M&97&&(L.title=p[19](p[5],p[6],p[0])),M&1&&(L.subtitle=p[0]),t.$set(L);const D={};M&193&&(D.title=p[19](p[7],p[6],p[0])),M&1&&(D.subtitle=p[0]),i.$set(D);const O={};M&321&&(O.title=p[19](p[8],p[6],p[0])),M&1&&(O.subtitle=p[0]),o.$set(O);const x={};M&577&&(x.title=p[19](p[9],p[6],p[0])),M&8&&(x.path=p[3]),M&1&&(x.subtitle=p[0]),c.$set(x);const Y={};M&1089&&(Y.title=p[19](p[10],p[6],p[0])),M&4&&(Y.path=p[2]),M&1&&(Y.subtitle=p[0]),f.$set(Y);const R={};M&2113&&(R.title=p[19](p[11],p[6],p[0])),M&1&&(R.subtitle=p[0]),g.$set(R);const w={};M&81&&(w.title=p[19](p[4],p[6],p[0])),M&1&&(w.subtitle=p[0]),S.$set(w);const N={};M&4161&&(N.title=p[19](p[12],p[6],p[0])),M&1&&(N.subtitle=p[0]),v.$set(N);const X={};M&8257&&(X.title=p[19](p[13],p[6],p[0])),M&1&&(X.subtitle=p[0]),A.$set(X)},i(p){d||(te(t.$$.fragment,p),te(i.$$.fragment,p),te(o.$$.fragment,p),te(c.$$.fragment,p),te(f.$$.fragment,p),te(g.$$.fragment,p),te(S.$$.fragment,p),te(v.$$.fragment,p),te(A.$$.fragment,p),d=!0)},o(p){ue(t.$$.fragment,p),ue(i.$$.fragment,p),ue(o.$$.fragment,p),ue(c.$$.fragment,p),ue(f.$$.fragment,p),ue(g.$$.fragment,p),ue(S.$$.fragment,p),ue(v.$$.fragment,p),ue(A.$$.fragment,p),d=!1},d(p){p&&(fe(n),fe(a),fe(l),fe(_),fe(E)),Se(t),Se(i),Se(o),Se(c),Se(f),Se(g),Se(S),Se(v),Se(A)}}}function r5(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A;n=new Wn({props:{title:e[19](e[5],e[6],e[0]),action:ct.RESTART_PLAYBACK,path:xc,buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}}),r=new Wn({props:{title:e[19](e[7],e[6],e[0]),action:ct.TOGGLE_PLAY_PAUSE,path:kl,buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}}),s=new Wn({props:{title:e[19](e[8],e[6],e[0]),action:ct.TOGGLE_PLAYBACK_LOOP,path:Tl,buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}}),a=new Wn({props:{title:e[19](e[9],e[6],e[0]),action:ct.TOGGLE_BOOKMARK,path:e[3],buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}}),c=new Wn({props:{title:e[19](e[10],e[6],e[0]),action:ct.TOGGLE_MERGE,path:e[2],buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}}),f=new Wn({props:{title:e[19](e[11],e[6],e[0]),action:ct.EDIT_SUBTITLE,path:Fc,buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}}),g=new Wn({props:{title:e[19](e[4],e[6],e[0]),action:ct.RESTORE_SUBTITLE,path:bo,buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}}),E=new Wn({props:{title:e[19](e[12],e[6],e[0]),action:ct.EXPORT_NEW,path:yl,buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}}),b=new Wn({props:{title:e[19](e[13],e[6],e[0]),action:ct.EXPORT_UPDATE,path:El,buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}});let d=e[14]&&c0(e);return{c(){Te(n.$$.fragment),t=me(),Te(r.$$.fragment),i=me(),Te(s.$$.fragment),o=me(),Te(a.$$.fragment),l=me(),Te(c.$$.fragment),u=me(),Te(f.$$.fragment),m=me(),Te(g.$$.fragment),_=me(),Te(E.$$.fragment),S=me(),Te(b.$$.fragment),v=me(),d&&d.c(),y=ur()},m(p,M){Ee(n,p,M),de(p,t,M),Ee(r,p,M),de(p,i,M),Ee(s,p,M),de(p,o,M),Ee(a,p,M),de(p,l,M),Ee(c,p,M),de(p,u,M),Ee(f,p,M),de(p,m,M),Ee(g,p,M),de(p,_,M),Ee(E,p,M),de(p,S,M),Ee(b,p,M),de(p,v,M),d&&d.m(p,M),de(p,y,M),A=!0},p(p,M){const L={};M&97&&(L.title=p[19](p[5],p[6],p[0])),M&1&&(L.subtitle=p[0]),n.$set(L);const D={};M&193&&(D.title=p[19](p[7],p[6],p[0])),M&1&&(D.subtitle=p[0]),r.$set(D);const O={};M&321&&(O.title=p[19](p[8],p[6],p[0])),M&1&&(O.subtitle=p[0]),s.$set(O);const x={};M&577&&(x.title=p[19](p[9],p[6],p[0])),M&8&&(x.path=p[3]),M&1&&(x.subtitle=p[0]),a.$set(x);const Y={};M&1089&&(Y.title=p[19](p[10],p[6],p[0])),M&4&&(Y.path=p[2]),M&1&&(Y.subtitle=p[0]),c.$set(Y);const R={};M&2113&&(R.title=p[19](p[11],p[6],p[0])),M&1&&(R.subtitle=p[0]),f.$set(R);const w={};M&81&&(w.title=p[19](p[4],p[6],p[0])),M&1&&(w.subtitle=p[0]),g.$set(w);const N={};M&4161&&(N.title=p[19](p[12],p[6],p[0])),M&1&&(N.subtitle=p[0]),E.$set(N);const X={};M&8257&&(X.title=p[19](p[13],p[6],p[0])),M&1&&(X.subtitle=p[0]),b.$set(X),p[14]?d?(d.p(p,M),M&16384&&te(d,1)):(d=c0(p),d.c(),te(d,1),d.m(y.parentNode,y)):d&&(rn(),ue(d,1,1,()=>{d=null}),sn())},i(p){A||(te(n.$$.fragment,p),te(r.$$.fragment,p),te(s.$$.fragment,p),te(a.$$.fragment,p),te(c.$$.fragment,p),te(f.$$.fragment,p),te(g.$$.fragment,p),te(E.$$.fragment,p),te(b.$$.fragment,p),te(d),A=!0)},o(p){ue(n.$$.fragment,p),ue(r.$$.fragment,p),ue(s.$$.fragment,p),ue(a.$$.fragment,p),ue(c.$$.fragment,p),ue(f.$$.fragment,p),ue(g.$$.fragment,p),ue(E.$$.fragment,p),ue(b.$$.fragment,p),ue(d),A=!1},d(p){p&&(fe(t),fe(i),fe(o),fe(l),fe(u),fe(m),fe(_),fe(S),fe(v),fe(y)),Se(n,p),Se(r,p),Se(s,p),Se(a,p),Se(c,p),Se(f,p),Se(g,p),Se(E,p),Se(b,p),d&&d.d(p)}}}function c0(e){let n,t;return n=new Wn({props:{title:e[15],action:ct.CANCEL_EXPORT,path:Nc,buttonClasses:e[16]?"m-y-xs":"m-x-xs",subtitle:e[0]}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},p(r,i){const s={};i&32768&&(s.title=r[15]),i&1&&(s.subtitle=r[0]),n.$set(s)},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function i5(e){let n,t,r,i;const s=[r5,n5],o=[];function a(l,c){return l[1]?0:1}return n=a(e),t=o[n]=s[n](e),{c(){t.c(),r=ur()},m(l,c){o[n].m(l,c),de(l,r,c),i=!0},p(l,[c]){let u=n;n=a(l),n===u?o[n].p(l,c):(rn(),ue(o[u],1,1,()=>{o[u]=null}),sn(),t=o[n],t?t.p(l,c):(t=o[n]=s[n](l),t.c()),te(t,1),t.m(r.parentNode,r))},i(l){i||(te(t),i=!0)},o(l){ue(t),i=!1},d(l){l&&fe(r),o[n].d(l)}}}function s5(e,n,t){let r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d;we(e,si,Y=>t(22,s=Y)),we(e,lo,Y=>t(4,l=Y)),we(e,ra,Y=>t(20,c=Y)),we(e,na,Y=>t(21,u=Y)),we(e,As,Y=>t(5,f=Y)),we(e,Xn,Y=>t(6,m=Y)),we(e,Ms,Y=>t(7,g=Y)),we(e,Cs,Y=>t(8,_=Y)),we(e,Jo,Y=>t(9,E=Y)),we(e,ea,Y=>t(10,S=Y)),we(e,ao,Y=>t(11,b=Y)),we(e,Hi,Y=>t(12,v=Y)),we(e,Ui,Y=>t(13,y=Y)),we(e,jr,Y=>t(14,A=Y)),we(e,ta,Y=>t(15,d=Y));let{subtitle:p}=n,{isReaderMenu:M=!1}=n;const{isVertical:L}=Ni("context"),{subtitlesGlobalStartPadding$:D,subtitlesGlobalEndPadding$:O}=St;we(e,D,Y=>t(24,a=Y)),we(e,O,Y=>t(23,o=Y));function x(Y,R,w){if(R.size)if(p){if(Y===l){const N=a/1e3,X=o/1e3,q=Math.max(0,p.originalStartSeconds+N),Z=s?ai(0,s,p.originalEndSeconds+X):Math.max(0,p.originalEndSeconds+X);return p.text!==p.originalText||Number.isFinite(p.adjustedStartSeconds)&&p.adjustedStartSeconds!==q||Number.isFinite(p.adjustedEndSeconds)&&p.adjustedEndSeconds!==Z?Y:"No data to restore"}}else return"No matching subtitle";else return"Subtitle file required";return Y}return e.$$set=Y=>{"subtitle"in Y&&t(0,p=Y.subtitle),"isReaderMenu"in Y&&t(1,M=Y.isReaderMenu)},e.$$.update=()=>{e.$$.dirty&2097153&&t(3,r=p&&u.has(p.id)?Cl:Rl),e.$$.dirty&1048577&&t(2,i=p&&c.has(p.id)?Ml:Al)},[p,M,i,r,l,f,m,g,_,E,S,b,v,y,A,d,L,D,O,x,c,u]}class f0 extends vn{constructor(n){super(),wn(this,n,s5,i5,pn,{subtitle:0,isReaderMenu:1})}}function o5(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d0={exports:{}},Dn=d0.exports={},Kr,Qr;function Vu(){throw new Error("setTimeout has not been defined")}function xu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Kr=setTimeout:Kr=Vu}catch{Kr=Vu}try{typeof clearTimeout=="function"?Qr=clearTimeout:Qr=xu}catch{Qr=xu}})();function h0(e){if(Kr===setTimeout)return setTimeout(e,0);if((Kr===Vu||!Kr)&&setTimeout)return Kr=setTimeout,setTimeout(e,0);try{return Kr(e,0)}catch{try{return Kr.call(null,e,0)}catch{return Kr.call(this,e,0)}}}function a5(e){if(Qr===clearTimeout)return clearTimeout(e);if((Qr===xu||!Qr)&&clearTimeout)return Qr=clearTimeout,clearTimeout(e);try{return Qr(e)}catch{try{return Qr.call(null,e)}catch{return Qr.call(this,e)}}}var bi=[],Xs=!1,ss,Za=-1;function l5(){!Xs||!ss||(Xs=!1,ss.length?bi=ss.concat(bi):Za=-1,bi.length&&p0())}function p0(){if(!Xs){var e=h0(l5);Xs=!0;for(var n=bi.length;n;){for(ss=bi,bi=[];++Za<n;)ss&&ss[Za].run();Za=-1,n=bi.length}ss=null,Xs=!1,a5(e)}}Dn.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];bi.push(new m0(e,n)),bi.length===1&&!Xs&&h0(p0)};function m0(e,n){this.fun=e,this.array=n}m0.prototype.run=function(){this.fun.apply(null,this.array)},Dn.title="browser",Dn.browser=!0,Dn.env={},Dn.argv=[],Dn.version="",Dn.versions={};function wi(){}Dn.on=wi,Dn.addListener=wi,Dn.once=wi,Dn.off=wi,Dn.removeListener=wi,Dn.removeAllListeners=wi,Dn.emit=wi,Dn.prependListener=wi,Dn.prependOnceListener=wi,Dn.listeners=function(e){return[]},Dn.binding=function(e){throw new Error("process.binding is not supported")},Dn.cwd=function(){return"/"},Dn.chdir=function(e){throw new Error("process.chdir is not supported")},Dn.umask=function(){return 0};var u5=d0.exports;const Ys=o5(u5);function qs(e,n,t){let r=t.initialDeps??[],i;return()=>{var s,o,a,l;let c;t.key&&((s=t.debug)!=null&&s.call(t))&&(c=Date.now());const u=e();if(!(u.length!==r.length||u.some((g,_)=>r[_]!==g)))return i;r=u;let m;if(t.key&&((o=t.debug)!=null&&o.call(t))&&(m=Date.now()),i=n(...u),t.key&&((a=t.debug)!=null&&a.call(t))){const g=Math.round((Date.now()-c)*100)/100,_=Math.round((Date.now()-m)*100)/100,E=_/16,S=(b,v)=>{for(b=String(b);b.length<v;)b=" "+b;return b};console.info(`%c⏱ ${S(_,5)} /${S(g,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*E,120))}deg 100% 31%);`,t==null?void 0:t.key)}return(l=t==null?void 0:t.onChange)==null||l.call(t,i),i}}function Hu(e,n){if(e===void 0)throw new Error(`Unexpected undefined${n?`: ${n}`:""}`);return e}const c5=(e,n)=>Math.abs(e-n)<1,f5=e=>e,d5=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),r=[];for(let i=n;i<=t;i++)r.push(i);return r},h5=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=s=>{const{width:o,height:a}=s;n({width:Math.round(o),height:Math.round(a)})};if(r(t.getBoundingClientRect()),typeof ResizeObserver>"u")return()=>{};const i=new ResizeObserver(s=>{const o=s[0];if(o!=null&&o.borderBoxSize){const a=o.borderBoxSize[0];if(a){r({width:a.inlineSize,height:a.blockSize});return}}r(t.getBoundingClientRect())});return i.observe(t,{box:"border-box"}),()=>{i.unobserve(t)}},p5=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=()=>{n(t[e.options.horizontal?"scrollLeft":"scrollTop"])};return r(),t.addEventListener("scroll",r,{passive:!0}),()=>{t.removeEventListener("scroll",r)}},m5=(e,n,t)=>{if(n!=null&&n.borderBoxSize){const r=n.borderBoxSize[0];if(r)return Math.round(r[t.options.horizontal?"inlineSize":"blockSize"])}return Math.round(e.getBoundingClientRect()[t.options.horizontal?"width":"height"])},_5=(e,{adjustments:n=0,behavior:t},r)=>{var i,s;const o=e+n;(s=(i=r.scrollElement)==null?void 0:i.scrollTo)==null||s.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:t})};class g5{constructor(n){this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.isScrollingTimeoutId=null,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=(()=>{let t=null;const r=()=>t||(typeof ResizeObserver<"u"?t=new ResizeObserver(i=>{i.forEach(s=>{this._measureElement(s.target,s)})}):null);return{disconnect:()=>{var i;return(i=r())==null?void 0:i.disconnect()},observe:i=>{var s;return(s=r())==null?void 0:s.observe(i,{box:"border-box"})},unobserve:i=>{var s;return(s=r())==null?void 0:s.unobserve(i)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([r,i])=>{typeof i>"u"&&delete t[r]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:f5,rangeExtractor:d5,onChange:()=>{},measureElement:m5,initialRect:{width:0,height:0},scrollMargin:0,scrollingDelay:150,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,...t}},this.notify=t=>{var r,i;(i=(r=this.options).onChange)==null||i.call(r,this,t)},this.maybeNotify=qs(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:Ys.env.NODE_ENV!=="production"&&"maybeNotify",debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.scrollElement=null},this._didMount=()=>(this.measureElementCache.forEach(this.observer.observe),()=>{this.observer.disconnect(),this.cleanup()}),this._willUpdate=()=>{const t=this.options.getScrollElement();this.scrollElement!==t&&(this.cleanup(),this.scrollElement=t,this._scrollToOffset(this.scrollOffset,{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,r=>{this.scrollRect=r,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,r=>{this.scrollAdjustments=0,this.scrollOffset!==r&&(this.isScrollingTimeoutId!==null&&(clearTimeout(this.isScrollingTimeoutId),this.isScrollingTimeoutId=null),this.isScrolling=!0,this.scrollDirection=this.scrollOffset<r?"forward":"backward",this.scrollOffset=r,this.maybeNotify(),this.isScrollingTimeoutId=setTimeout(()=>{this.isScrollingTimeoutId=null,this.isScrolling=!1,this.scrollDirection=null,this.maybeNotify()},this.options.scrollingDelay))})))},this.getSize=()=>this.scrollRect[this.options.horizontal?"width":"height"],this.memoOptions=qs(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey],(t,r,i,s)=>(this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:r,scrollMargin:i,getItemKey:s}),{key:!1}),this.getFurthestMeasurement=(t,r)=>{const i=new Map,s=new Map;for(let o=r-1;o>=0;o--){const a=t[o];if(i.has(a.lane))continue;const l=s.get(a.lane);if(l==null||a.end>l.end?s.set(a.lane,a):a.end<l.end&&i.set(a.lane,!0),i.size===this.options.lanes)break}return s.size===this.options.lanes?Array.from(s.values()).sort((o,a)=>o.end===a.end?o.index-a.index:o.end-a.end)[0]:void 0},this.getMeasurements=qs(()=>[this.memoOptions(),this.itemSizeCache],({count:t,paddingStart:r,scrollMargin:i,getItemKey:s},o)=>{const a=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const l=this.measurementsCache.slice(0,a);for(let c=a;c<t;c++){const u=s(c),f=this.options.lanes===1?l[c-1]:this.getFurthestMeasurement(l,c),m=f?f.end:r+i,g=o.get(u),_=typeof g=="number"?g:this.options.estimateSize(c),E=m+_,S=f?f.lane:c%this.options.lanes;l[c]={index:c,start:m,size:_,end:E,key:u,lane:S}}return this.measurementsCache=l,l},{key:Ys.env.NODE_ENV!=="production"&&"getMeasurements",debug:()=>this.options.debug}),this.calculateRange=qs(()=>[this.getMeasurements(),this.getSize(),this.scrollOffset],(t,r,i)=>this.range=t.length>0&&r>0?b5({measurements:t,outerSize:r,scrollOffset:i}):null,{key:Ys.env.NODE_ENV!=="production"&&"calculateRange",debug:()=>this.options.debug}),this.getIndexes=qs(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(t,r,i,s)=>r===null?[]:t({...r,overscan:i,count:s}),{key:Ys.env.NODE_ENV!=="production"&&"getIndexes",debug:()=>this.options.debug}),this.indexFromElement=t=>{const r=this.options.indexAttribute,i=t.getAttribute(r);return i?parseInt(i,10):(console.warn(`Missing attribute name '${r}={index}' on measured element.`),-1)},this._measureElement=(t,r)=>{const i=this.measurementsCache[this.indexFromElement(t)];if(!i||!t.isConnected){this.measureElementCache.forEach((a,l)=>{a===t&&(this.observer.unobserve(t),this.measureElementCache.delete(l))});return}const s=this.measureElementCache.get(i.key);s!==t&&(s&&this.observer.unobserve(s),this.observer.observe(t),this.measureElementCache.set(i.key,t));const o=this.options.measureElement(t,r,this);this.resizeItem(i,o)},this.resizeItem=(t,r)=>{const i=this.itemSizeCache.get(t.key)??t.size,s=r-i;s!==0&&(t.start<this.scrollOffset+this.scrollAdjustments&&(Ys.env.NODE_ENV!=="production"&&this.options.debug&&console.info("correction",s),this._scrollToOffset(this.scrollOffset,{adjustments:this.scrollAdjustments+=s,behavior:void 0})),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,r)),this.notify(!1))},this.measureElement=t=>{t&&this._measureElement(t,void 0)},this.getVirtualItems=qs(()=>[this.getIndexes(),this.getMeasurements()],(t,r)=>{const i=[];for(let s=0,o=t.length;s<o;s++){const a=t[s],l=r[a];i.push(l)}return i},{key:Ys.env.NODE_ENV!=="production"&&"getIndexes",debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const r=this.getMeasurements();return Hu(r[_0(0,r.length-1,i=>Hu(r[i]).start,t)])},this.getOffsetForAlignment=(t,r)=>{const i=this.getSize();r==="auto"&&(t<=this.scrollOffset?r="start":t>=this.scrollOffset+i?r="end":r="start"),r==="start"?t=t:r==="end"?t=t-i:r==="center"&&(t=t-i/2);const s=this.options.horizontal?"scrollWidth":"scrollHeight",a=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[s]:this.scrollElement[s]:0)-this.getSize();return Math.max(Math.min(a,t),0)},this.getOffsetForIndex=(t,r="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const i=Hu(this.getMeasurements()[t]);if(r==="auto")if(i.end>=this.scrollOffset+this.getSize()-this.options.scrollPaddingEnd)r="end";else if(i.start<=this.scrollOffset+this.options.scrollPaddingStart)r="start";else return[this.scrollOffset,r];const s=r==="end"?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(s,r),r]},this.isDynamicMode=()=>this.measureElementCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&(clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(t,{align:r="start",behavior:i}={})=>{this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,r),{adjustments:void 0,behavior:i})},this.scrollToIndex=(t,{align:r="auto",behavior:i}={})=>{t=Math.max(0,Math.min(t,this.options.count-1)),this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const[s,o]=this.getOffsetForIndex(t,r);this._scrollToOffset(s,{adjustments:void 0,behavior:i}),i!=="smooth"&&this.isDynamicMode()&&(this.scrollToIndexTimeoutId=setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.measureElementCache.has(this.options.getItemKey(t))){const[l]=this.getOffsetForIndex(t,o);c5(l,this.scrollOffset)||this.scrollToIndex(t,{align:o,behavior:i})}else this.scrollToIndex(t,{align:o,behavior:i})}))},this.scrollBy=(t,{behavior:r}={})=>{this.cancelScrollToIndex(),r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.scrollOffset+t,{adjustments:void 0,behavior:r})},this.getTotalSize=()=>{var t;const r=this.getMeasurements();let i;return r.length===0?i=this.options.paddingStart:i=this.options.lanes===1?((t=r[r.length-1])==null?void 0:t.end)??0:Math.max(...r.slice(-this.options.lanes).map(s=>s.end)),i-this.options.scrollMargin+this.options.paddingEnd},this._scrollToOffset=(t,{adjustments:r,behavior:i})=>{this.options.scrollToFn(t,{behavior:i,adjustments:r},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(n),this.scrollRect=this.options.initialRect,this.scrollOffset=this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(t=>{this.itemSizeCache.set(t.key,t.size)}),this.maybeNotify()}}const _0=(e,n,t,r)=>{for(;e<=n;){const i=(e+n)/2|0,s=t(i);if(s<r)e=i+1;else if(s>r)n=i-1;else return i}return e>0?e-1:0};function b5({measurements:e,outerSize:n,scrollOffset:t}){const r=e.length-1,s=_0(0,r,a=>e[a].start,t);let o=s;for(;o<r&&e[o].end<t+n;)o++;return{startIndex:s,endIndex:o}}function w5(e){const n=new g5(e),t=n.setOptions;let r;const i=s=>{const o={...n.options,...s,onChange:s.onChange};t({...o,onChange:(a,l)=>{var c;r.set(a),(c=o.onChange)==null||c.call(o,a,l)}}),n._willUpdate()};return r=Tn(n,()=>(i(e),n._didMount())),np(r,s=>Object.assign(s,{setOptions:i}))}function v5(e){return w5({observeElementRect:h5,observeElementOffset:p5,scrollToFn:_5,...e})}function g0(e,n,t){const r=e.slice();return r[53]=n[t],r[54]=n,r[55]=t,r}function b0(e){let n,t,r=[],i=new Map,s,o,a=xr(e[8]);const l=c=>c[53].key;for(let c=0;c<a.length;c+=1){let u=g0(e,a,c),f=l(u);i.set(f,r[c]=w0(f,u))}return{c(){var c;n=_e("div"),t=_e("div");for(let u=0;u<r.length;u+=1)r[u].c();re(t,"class","absolute top-0 left-0 w-full"),re(t,"style",s=`transform: translateY(${((c=e[8][0])==null?void 0:c.start)||0}px); font-family: "${e[23]}", "Lora", "Noto Serif JP", serif; font-size: ${e[24]}px; line-height: ${e[25]};`),re(n,"class","relative w-full"),xn(n,"height",`${e[4].getTotalSize()}px`)},m(c,u){de(c,n,u),oe(n,t);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(t,null);o=!0},p(c,u){var f;u[0]&201330469&&(a=xr(c[8]),rn(),r=ro(r,u,l,1,c,a,i,t,Lh,w0,null,g0),sn()),(!o||u[0]&256&&s!==(s=`transform: translateY(${((f=c[8][0])==null?void 0:f.start)||0}px); font-family: "${c[23]}", "Lora", "Noto Serif JP", serif; font-size: ${c[24]}px; line-height: ${c[25]};`))&&re(t,"style",s),u[0]&16&&xn(n,"height",`${c[4].getTotalSize()}px`)},i(c){if(!o){for(let u=0;u<a.length;u+=1)te(r[u]);o=!0}},o(c){for(let u=0;u<r.length;u+=1)ue(r[u]);o=!1},d(c){c&&fe(n);for(let u=0;u<r.length;u+=1)r[u].d()}}}function w0(e,n){let t,r,i=n[0][n[53].index].text+"",s,o,a,l,c,u,f,m=n[55],g,_,E;c=new f0({props:{subtitle:n[0][n[53].index]}});const S=()=>n[31](t,m),b=()=>n[31](null,m);return{key:e,first:null,c(){t=_e("div"),r=_e("div"),s=Nt(i),a=me(),l=_e("div"),Te(c.$$.fragment),u=me(),re(r,"tabindex","0"),re(r,"role","button"),re(r,"class","flex-1 p-b"),re(r,"title",o=n[11]?"Recording in progress":null),lt(r,"cursor-not-allowed",n[11]),re(l,"class","flex invisible m-x-xs m-y-b sub-action"),lt(l,"show",n[10]===Qn.ALWAYS),lt(l,"hidden",n[10]===Qn.HIDDEN),re(t,"class","flex items-center sub"),re(t,"data-index",f=n[53].index),lt(t,"active",n[5].current===n[53].key),lt(t,"on-hover",n[10]===Qn.HOVER&&!n[9]),this.first=t},m(v,y){de(v,t,y),oe(t,r),oe(r,s),oe(t,a),oe(t,l),Ee(c,l,null),oe(t,u),S(),g=!0,_||(E=[qe(r,"click",n[26]),qe(r,"pointerdown",n[27]),qe(r,"keyup",E5)],_=!0)},p(v,y){n=v,(!g||y[0]&257)&&i!==(i=n[0][n[53].index].text+"")&&en(s,i),(!g||y[0]&2048&&o!==(o=n[11]?"Recording in progress":null))&&re(r,"title",o),(!g||y[0]&2048)&&lt(r,"cursor-not-allowed",n[11]);const A={};y[0]&257&&(A.subtitle=n[0][n[53].index]),c.$set(A),(!g||y[0]&1024)&&lt(l,"show",n[10]===Qn.ALWAYS),(!g||y[0]&1024)&&lt(l,"hidden",n[10]===Qn.HIDDEN),(!g||y[0]&256&&f!==(f=n[53].index))&&re(t,"data-index",f),m!==n[55]&&(b(),m=n[55],S()),(!g||y[0]&288)&&lt(t,"active",n[5].current===n[53].key),(!g||y[0]&1536)&&lt(t,"on-hover",n[10]===Qn.HOVER&&!n[9])},i(v){g||(te(c.$$.fragment,v),g=!0)},o(v){ue(c.$$.fragment,v),g=!1},d(v){v&&fe(t),Se(c),b(),_=!1,_n(E)}}}function y5(e){let n,t,r,i,s=e[7]>0&&e[1]&&b0(e);return{c(){n=_e("div"),s&&s.c(),re(n,"class","ttu-whispersync-container subtitle-container h-full w-full"),xn(n,"height",e[7]?`${e[7]}px`:null)},m(o,a){de(o,n,a),s&&s.m(n,null),e[32](n),t=!0,r||(i=[qe(n,"pointerdown",e[33]),qe(n,"pointerup",e[34])],r=!0)},p(o,a){o[7]>0&&o[1]?s?(s.p(o,a),a[0]&130&&te(s,1)):(s=b0(o),s.c(),te(s,1),s.m(n,null)):s&&(rn(),ue(s,1,1,()=>{s=null}),sn()),a[0]&128&&xn(n,"height",o[7]?`${o[7]}px`:null)},i(o){t||(te(s),t=!0)},o(o){ue(s),t=!1},d(o){o&&fe(n),s&&s.d(),e[32](null),r=!1,_n(i)}}}const E5=()=>{};function S5(e,n,t){let r,i,s=gt,o=()=>(s(),s=Jr(H,Ae=>t(4,i=Ae)),H),a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M;we(e,xi,Ae=>t(9,u=Ae)),we(e,ri,Ae=>t(5,m=Ae)),we(e,kt,Ae=>t(30,g=Ae)),we(e,Xn,Ae=>t(45,A=Ae)),we(e,ii,Ae=>t(46,d=Ae)),we(e,ki,Ae=>t(11,M=Ae)),e.$$.on_destroy.push(()=>s());let{subtitles:L}=n;async function D(...Ae){K&&(t(7,ge=0),await qn(),H||o(t(1,H=v5({count:L.length,overscan:10,estimateSize:()=>150,getScrollElement:()=>K,getItemKey:Ke=>L[Ke].id}))),i.measure(),t(7,ge=Math.floor(K.getBoundingClientRect().height)),await qn(),O())}async function O(Ae=!1){if(M||!i||!L.length||!Ae&&(!p||!m.previous&&!m.current&&!m.useTimeFallback))return;const{previous:Ke,current:et,useTimeFallback:Je}=m,ze=d;let ut=-1;if(et&&A.has(et)?ut=L.findIndex(nt=>nt.id===et):Ke&&A.has(Ke)&&(ut=L.findIndex(nt=>nt.id===Ke)),ut===-1&&(Ae||Je)&&(ut=ze?L.findLastIndex(nt=>ze>=nt.startSeconds):0),ut!==-1){for(;!i.itemSizeCache.has(L[ut].id);)Xe(),i.scrollToIndex(ut,{align:"auto"}),await new Promise(nt=>setTimeout(nt));Xe(),i.scrollToIndex(ut,{align:"auto"})}}const{subtitlesEnableAutoScroll$:x,subtitlePreventActionOnSelection$:Y,subtitlesCopyFontFamily$:R,subtitlesCopyFontSize$:w,subtitlesCopyLineHeight$:N,subtitlesFontFamily$:X,subtitlesFontSize$:q,subtitlesLineHeight$:Z,subtitlesClickAction$:ne,subtitlesActionsVisibility$:U,subtitlesActionsVisibilityTime$:F}=St;we(e,x,Ae=>t(47,p=Ae)),we(e,Y,Ae=>t(36,a=Ae)),we(e,R,Ae=>t(44,y=Ae)),we(e,w,Ae=>t(42,b=Ae)),we(e,N,Ae=>t(40,E=Ae)),we(e,X,Ae=>t(43,v=Ae)),we(e,q,Ae=>t(41,S=Ae)),we(e,Z,Ae=>t(39,_=Ae)),we(e,ne,Ae=>t(37,l=Ae)),we(e,U,Ae=>t(10,f=Ae)),we(e,F,Ae=>t(38,c=Ae));const C=y?window.localStorage.getItem("fontFamilyGroupOne")||"Noto Serif JP":v,P=b?Number.parseInt(window.localStorage.getItem("fontSize")||"16",10):S,I=E?Number.parseFloat(window.localStorage.getItem("lineHeight")||"1.65"):_;let H,K,he=[],ee,ae=!1,ge=0;jo(D);function Le(Ae){Ae.button!==0||l===ct.NONE||f===Qn.TOGGLE||Ue()||(be(),Ln(l,L[Number.parseInt(Ae.currentTarget.parentElement.dataset.index,10)]))}function He(Ae){var et;if(Ae.button!==0||f!==Qn.TOGGLE)return;a&&u&&((et=window.getSelection())==null||et.removeAllRanges(),document.body.style.userSelect="none");const{currentTarget:Ke}=Ae;Ke.addEventListener("pointerup",De,!1),ee=window.setTimeout(()=>{var Je;be(Ke),Ue()||(Je=Ke.nextElementSibling)==null||Je.classList.toggle("show")},c)}function De(){be(this),!Ue()&&Ln(l,L[Number.parseInt(this.parentElement.dataset.index,10)])}function Ue(){var Ke;return a?!!((Ke=window.getSelection())==null?void 0:Ke.toString().trim()):!1}function be(Ae){clearTimeout(ee),Ae==null||Ae.removeEventListener("pointerup",De,!1),document.body.style.userSelect="auto"}async function Re(){i&&(i.setOptions({count:L.length}),i.scrollToOffset(0),t(8,r=i.getVirtualItems()),i.measure(),O())}function Xe(){for(let Ae=0,{length:Ke}=he;Ae<Ke;Ae+=1)i.measureElement(he[Ae])}function Ne(Ae,Ke){Gt[Ae?"unshift":"push"](()=>{he[Ke]=Ae,t(2,he)})}function B(Ae){Gt[Ae?"unshift":"push"](()=>{K=Ae,t(6,K)})}const V=()=>t(3,ae=!0),ye=()=>t(3,ae=!1);return e.$$set=Ae=>{"subtitles"in Ae&&t(0,L=Ae.subtitles)},e.$$.update=()=>{e.$$.dirty[0]&18&&t(8,r=H?i.getVirtualItems():[]),e.$$.dirty[0]&1073741824&&D(g),e.$$.dirty[0]&1&&L&&Re(),e.$$.dirty[0]&32&&m&&O(),e.$$.dirty[0]&12&&he.length&&!ae&&Xe()},[L,H,he,ae,i,m,K,ge,r,u,f,M,x,Y,R,w,N,X,q,Z,ne,U,F,C,P,I,Le,He,D,O,g,Ne,B,V,ye]}class k5 extends vn{constructor(n){super(),wn(this,n,S5,y5,pn,{subtitles:0,onResetList:28,scrollToSubtitle:29},null,[-1,-1])}get onResetList(){return this.$$.ctx[28]}get scrollToSubtitle(){return this.$$.ctx[29]}}function T5(e){let n,t,r,i,s,o,a;return{c(){n=_e("div"),t=Di("svg"),r=Di("g"),i=Di("g"),s=Di("path"),re(s,"d","M448 80c8.8 0 16 7.2 16 16V415.8l-5-6.5-136-176c-4.5-5.9-11.6-9.3-19-9.3s-14.4 3.4-19 9.3L202 340.7l-30.5-42.7C167 291.7 159.8 288 152 288s-15 3.7-19.5 10.1l-80 112L48 416.3l0-.3V96c0-8.8 7.2-16 16-16H448zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm80 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"),re(s,"fill","currentColor"),re(s,"transform","translate(-256 -256)"),re(i,"transform","translate(0,0) scale(1,1)"),re(r,"transform","translate(256 256)"),re(r,"transform-origin","128 0"),re(t,"width","100%"),re(t,"height","100%"),re(t,"viewBox","0 0 512 512"),re(t,"aria-hidden","true"),re(t,"role","img"),re(t,"xmlns","http://www.w3.org/2000/svg"),re(n,"class","cover")},m(l,c){de(l,n,c),oe(n,t),oe(t,r),oe(r,i),oe(i,s),o||(a=qe(t,"load",function(){Vr(e[43])&&e[43].apply(this,arguments)}),o=!0)},p(l,c){e=l},d(l){l&&fe(n),o=!1,a()}}}function A5(e){let n,t,r,i;return{c(){n=_e("img"),re(n,"class","cover"),fs(n.src,t=e[50])||re(n,"src",t),re(n,"alt","cover")},m(s,o){de(s,n,o),r||(i=qe(n,"load",function(){Vr(e[43])&&e[43].apply(this,arguments)}),r=!0)},p(s,o){e=s,o[1]&524288&&!fs(n.src,t=e[50])&&re(n,"src",t)},d(s){s&&fe(n),r=!1,i()}}}function v0(e){let n,t,r,i,s,o,a;return t=new At({props:{path:Wc}}),{c(){n=_e("button"),Te(t.$$.fragment),re(n,"class","m-l-s"),re(n,"title",r=e[13]?"Export in progress":"Drop subtitle file"),n.disabled=i=!!e[13]},m(l,c){de(l,n,c),Ee(t,n,null),s=!0,o||(a=qe(n,"click",e[78]),o=!0)},p(l,c){(!s||c[0]&8192&&r!==(r=l[13]?"Export in progress":"Drop subtitle file"))&&re(n,"title",r),(!s||c[0]&8192&&i!==(i=!!l[13]))&&(n.disabled=i)},i(l){s||(te(t.$$.fragment,l),s=!0)},o(l){ue(t.$$.fragment,l),s=!1},d(l){l&&fe(n),Se(t),o=!1,a()}}}function y0(e){let n,t,r,i,s,o,a;return t=new At({props:{path:Mp}}),{c(){n=_e("button"),Te(t.$$.fragment),re(n,"class","m-l-s"),re(n,"title",r=e[13]?"Export in progress":"Drop persisted subtitles"),n.disabled=i=!!e[13]},m(l,c){de(l,n,c),Ee(t,n,null),s=!0,o||(a=qe(n,"click",e[66]),o=!0)},p(l,c){(!s||c[0]&8192&&r!==(r=l[13]?"Export in progress":"Drop persisted subtitles"))&&re(n,"title",r),(!s||c[0]&8192&&i!==(i=!!l[13]))&&(n.disabled=i)},i(l){s||(te(t.$$.fragment,l),s=!0)},o(l){ue(t.$$.fragment,l),s=!1},d(l){l&&fe(n),Se(t),o=!1,a()}}}function M5(e){var S,b;let n,t=(((S=e[11])==null?void 0:S.name)||"None selected")+"",r,i,s,o,a,l,c,u,f,m,g;o=new At({props:{path:e[11]?ua:ca}});let _=(e[7].lastSubtitle||((b=e[17])==null?void 0:b.value)||e[24])&&v0(e),E=e[7].subtitleData&&e[7].subtitleData.subtitles.length&&y0(e);return{c(){n=_e("div"),r=Nt(t),i=me(),s=_e("button"),Te(o.$$.fragment),l=me(),_&&_.c(),c=me(),E&&E.c(),u=ur(),re(s,"title",e[26]),s.disabled=a=!!e[13]},m(v,y){de(v,n,y),oe(n,r),de(v,i,y),de(v,s,y),Ee(o,s,null),de(v,l,y),_&&_.m(v,y),de(v,c,y),E&&E.m(v,y),de(v,u,y),f=!0,m||(g=qe(s,"click",e[62]),m=!0)},p(v,y){var d,p;(!f||y[0]&2048)&&t!==(t=(((d=v[11])==null?void 0:d.name)||"None selected")+"")&&en(r,t);const A={};y[0]&2048&&(A.path=v[11]?ua:ca),o.$set(A),(!f||y[0]&67108864)&&re(s,"title",v[26]),(!f||y[0]&8192&&a!==(a=!!v[13]))&&(s.disabled=a),v[7].lastSubtitle||(p=v[17])!=null&&p.value||v[24]?_?(_.p(v,y),y[0]&16908416&&te(_,1)):(_=v0(v),_.c(),te(_,1),_.m(c.parentNode,c)):_&&(rn(),ue(_,1,1,()=>{_=null}),sn()),v[7].subtitleData&&v[7].subtitleData.subtitles.length?E?(E.p(v,y),y[0]&128&&te(E,1)):(E=y0(v),E.c(),te(E,1),E.m(u.parentNode,u)):E&&(rn(),ue(E,1,1,()=>{E=null}),sn())},i(v){f||(te(o.$$.fragment,v),te(_),te(E),f=!0)},o(v){ue(o.$$.fragment,v),ue(_),ue(E),f=!1},d(v){v&&(fe(n),fe(i),fe(s),fe(l),fe(c),fe(u)),Se(o),_&&_.d(v),E&&E.d(v),m=!1,g()}}}function C5(e){let n,t,r;return t=new At({props:{path:Vp}}),{c(){n=_e("div"),Te(t.$$.fragment),re(n,"slot","icon"),re(n,"title","Show subtitle file")},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p:gt,i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function R5(e){let n;return{c(){n=_e("div"),n.textContent="Book not matched yet"},m(t,r){de(t,n,r)},p:gt,d(t){t&&fe(n)}}}function L5(e){let n,t,r,i=e[15].matchedBy+"",s,o,a,l=e[15].matchedOn&&E0(e);return{c(){n=_e("div"),n.textContent="Matched by",t=me(),r=_e("div"),s=Nt(i),o=me(),l&&l.c(),a=ur()},m(c,u){de(c,n,u),de(c,t,u),de(c,r,u),oe(r,s),de(c,o,u),l&&l.m(c,u),de(c,a,u)},p(c,u){u[0]&32768&&i!==(i=c[15].matchedBy+"")&&en(s,i),c[15].matchedOn?l?l.p(c,u):(l=E0(c),l.c(),l.m(a.parentNode,a)):l&&(l.d(1),l=null)},d(c){c&&(fe(n),fe(t),fe(r),fe(o),fe(a)),l&&l.d(c)}}}function E0(e){let n,t,r=Ec(new Date(e[15].matchedOn))+"",i;return{c(){n=_e("div"),t=Nt("On: "),i=Nt(r),re(n,"class","m-t-xs")},m(s,o){de(s,n,o),oe(n,t),oe(n,i)},p(s,o){o[0]&32768&&r!==(r=Ec(new Date(s[15].matchedOn))+"")&&en(i,r)},d(s){s&&fe(n)}}}function P5(e){let n;function t(s,o){return s[15].matchedBy?L5:R5}let r=t(e),i=r(e);return{c(){i.c(),n=ur()},m(s,o){i.m(s,o),de(s,n,o)},p(s,o){r===(r=t(s))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(n.parentNode,n)))},d(s){s&&fe(n),i.d(s)}}}function B5(e){let n,t,r;return t=new At({props:{path:Vc}}),{c(){n=_e("div"),Te(t.$$.fragment),re(n,"slot","icon"),re(n,"title","Show matched subtitle file")},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p:gt,i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function S0(e){let n,t,r,i,s,o,a;return t=new At({props:{path:Wc}}),{c(){n=_e("button"),Te(t.$$.fragment),re(n,"class","m-l-s"),re(n,"title",r=e[13]?"Export in progress":"Drop audio file"),n.disabled=i=!!e[13]},m(l,c){de(l,n,c),Ee(t,n,null),s=!0,o||(a=qe(n,"click",e[80]),o=!0)},p(l,c){(!s||c[0]&8192&&r!==(r=l[13]?"Export in progress":"Drop audio file"))&&re(n,"title",r),(!s||c[0]&8192&&i!==(i=!!l[13]))&&(n.disabled=i)},i(l){s||(te(t.$$.fragment,l),s=!0)},o(l){ue(t.$$.fragment,l),s=!1},d(l){l&&fe(n),Se(t),o=!1,a()}}}function I5(e){var _,E;let n,t=(((_=e[16])==null?void 0:_.name)||"None selected")+"",r,i,s,o,a,l,c,u,f,m;o=new At({props:{path:e[16]?ua:ca}});let g=(e[7].lastAudio||((E=e[18])==null?void 0:E.value)||e[25])&&S0(e);return{c(){n=_e("div"),r=Nt(t),i=me(),s=_e("button"),Te(o.$$.fragment),l=me(),g&&g.c(),c=ur(),re(s,"title",e[28]),s.disabled=a=!!e[13]},m(S,b){de(S,n,b),oe(n,r),de(S,i,b),de(S,s,b),Ee(o,s,null),de(S,l,b),g&&g.m(S,b),de(S,c,b),u=!0,f||(m=qe(s,"click",e[63]),f=!0)},p(S,b){var y,A;(!u||b[0]&65536)&&t!==(t=(((y=S[16])==null?void 0:y.name)||"None selected")+"")&&en(r,t);const v={};b[0]&65536&&(v.path=S[16]?ua:ca),o.$set(v),(!u||b[0]&268435456)&&re(s,"title",S[28]),(!u||b[0]&8192&&a!==(a=!!S[13]))&&(s.disabled=a),S[7].lastAudio||(A=S[18])!=null&&A.value||S[25]?g?(g.p(S,b),b[0]&33816704&&te(g,1)):(g=S0(S),g.c(),te(g,1),g.m(c.parentNode,c)):g&&(rn(),ue(g,1,1,()=>{g=null}),sn())},i(S){u||(te(o.$$.fragment,S),te(g),u=!0)},o(S){ue(o.$$.fragment,S),ue(g),u=!1},d(S){S&&(fe(n),fe(i),fe(s),fe(l),fe(c)),Se(o),g&&g.d(S),f=!1,m()}}}function O5(e){let n,t,r;return t=new At({props:{path:Tp}}),{c(){n=_e("div"),Te(t.$$.fragment),re(n,"slot","icon"),re(n,"title","Show audio file")},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p:gt,i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function D5(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y;function A(O){e[91](O)}let d={defaultValue:0,max:e[44]};e[40]!==void 0&&(d.value=e[40]),t=new Br({props:d}),Gt.push(()=>Kn(t,"value",A));function p(O){e[92](O)}let M={defaultValue:0};e[41]!==void 0&&(M.value=e[41]),a=new Br({props:M}),Gt.push(()=>Kn(a,"value",p));function L(O){e[93](O)}let D={defaultValue:0};return e[42]!==void 0&&(D.value=e[42]),m=new Br({props:D}),Gt.push(()=>Kn(m,"value",L)),S=new At({props:{path:Ap}}),{c(){n=_e("div"),Te(t.$$.fragment),i=me(),s=_e("span"),s.textContent=":",o=me(),Te(a.$$.fragment),c=me(),u=_e("span"),u.textContent=":",f=me(),Te(m.$$.fragment),_=me(),E=_e("button"),Te(S.$$.fragment),re(E,"title","Jump to time"),re(E,"class","m-x-s"),E.disabled=e[14],re(n,"class","flex")},m(O,x){de(O,n,x),Ee(t,n,null),oe(n,i),oe(n,s),oe(n,o),Ee(a,n,null),oe(n,c),oe(n,u),oe(n,f),Ee(m,n,null),oe(n,_),oe(n,E),Ee(S,E,null),b=!0,v||(y=qe(E,"click",e[70]),v=!0)},p(O,x){const Y={};x[1]&8192&&(Y.max=O[44]),!r&&x[1]&512&&(r=!0,Y.value=O[40],Zn(()=>r=!1)),t.$set(Y);const R={};!l&&x[1]&1024&&(l=!0,R.value=O[41],Zn(()=>l=!1)),a.$set(R);const w={};!g&&x[1]&2048&&(g=!0,w.value=O[42],Zn(()=>g=!1)),m.$set(w),(!b||x[0]&16384)&&(E.disabled=O[14])},i(O){b||(te(t.$$.fragment,O),te(a.$$.fragment,O),te(m.$$.fragment,O),te(S.$$.fragment,O),b=!0)},o(O){ue(t.$$.fragment,O),ue(a.$$.fragment,O),ue(m.$$.fragment,O),ue(S.$$.fragment,O),b=!1},d(O){O&&fe(n),Se(t),Se(a),Se(m),Se(S),v=!1,y()}}}function N5(e){let n,t,r=Rs(e[49])+"",i,s,o=Rs(e[8])+"",a,l,c,u;return{c(){n=_e("div"),t=_e("button"),i=Nt(r),s=Nt(" / "),a=Nt(o),re(t,"title",l=e[14]?"Recording in progress":"Change playback position"),t.disabled=e[14],re(n,"slot","icon")},m(f,m){de(f,n,m),oe(n,t),oe(t,i),oe(t,s),oe(t,a),c||(u=qe(t,"click",e[90]),c=!0)},p(f,m){m[1]&262144&&r!==(r=Rs(f[49])+"")&&en(i,r),m[0]&256&&o!==(o=Rs(f[8])+"")&&en(a,o),m[0]&16384&&l!==(l=f[14]?"Recording in progress":"Change playback position")&&re(t,"title",l),m[0]&16384&&(t.disabled=f[14])},d(f){f&&fe(n),c=!1,u()}}}function k0(e){let n,t,r,i;return t=new At({props:{path:Cp}}),t.$on("click",e[95]),{c(){n=_e("button"),Te(t.$$.fragment),re(n,"class","m-l-s"),re(n,"title",r=e[14]?"Recording in progress":"Scroll to current playback position"),n.disabled=e[14]},m(s,o){de(s,n,o),Ee(t,n,null),i=!0},p(s,o){(!i||o[0]&16384&&r!==(r=s[14]?"Recording in progress":"Scroll to current playback position"))&&re(n,"title",r),(!i||o[0]&16384)&&(n.disabled=s[14])},i(s){i||(te(t.$$.fragment,s),i=!0)},o(s){ue(t.$$.fragment,s),i=!1},d(s){s&&fe(n),Se(t)}}}function T0(e){let n,t;return n=new $h({props:{multiple:!0,allowRootFiles:!0,preferNativeFilesystem:!0,height:"100%",dragClasses:"on-drag",filePickerId:"ttu-whispersync-file",label:e[12]?"Click this zone / above icons to select subtitle/audio files":"Click this zone / above icons or drag-and-drop to select subtitle/audio files",disabled:!!e[13],fileFormats:[...e[56],...e[57]],oldHandles:[...e[7].lastSubtitle?[]:[],...e[7].lastAudio?[]:[]],oldFiles:[...e[11]?[]:[],...e[16]?[]:[]]}}),n.$on("start",e[58]),n.$on("stop",e[96]),n.$on("result",e[59]),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},p(r,i){const s={};i[0]&4096&&(s.label=r[12]?"Click this zone / above icons to select subtitle/audio files":"Click this zone / above icons or drag-and-drop to select subtitle/audio files"),i[0]&8192&&(s.disabled=!!r[13]),i[0]&128&&(s.oldHandles=[...r[7].lastSubtitle?[]:[],...r[7].lastAudio?[]:[]]),i[0]&67584&&(s.oldFiles=[...r[11]?[]:[],...r[16]?[]:[]]),n.$set(s)},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function A0(e){let n,t,r,i,s,o,a,l,c,u,f;t=new Fu({props:{currentProgress:e[52],rounded:!0,margin:!0}}),s=new At({props:{path:Nc}});let m={subtitles:e[3]};return l=new k5({props:m}),e[98](l),{c(){var g;n=_e("div"),Te(t.$$.fragment),r=me(),i=_e("button"),Te(s.$$.fragment),a=me(),Te(l.$$.fragment),re(i,"class","m-l-s"),re(i,"title","Cancel export"),i.disabled=o=(g=e[13])==null?void 0:g.signal.aborted,re(n,"class","flex match-btns m-b-s"),lt(n,"invisible",!e[13])},m(g,_){de(g,n,_),Ee(t,n,null),oe(n,r),oe(n,i),Ee(s,i,null),de(g,a,_),Ee(l,g,_),c=!0,u||(f=qe(i,"click",e[97]),u=!0)},p(g,_){var b;const E={};_[1]&2097152&&(E.currentProgress=g[52]),t.$set(E),(!c||_[0]&8192&&o!==(o=(b=g[13])==null?void 0:b.signal.aborted))&&(i.disabled=o),(!c||_[0]&8192)&&lt(n,"invisible",!g[13]);const S={};_[0]&8&&(S.subtitles=g[3]),l.$set(S)},i(g){c||(te(t.$$.fragment,g),te(s.$$.fragment,g),te(l.$$.fragment,g),c=!0)},o(g){ue(t.$$.fragment,g),ue(s.$$.fragment,g),ue(l.$$.fragment,g),c=!1},d(g){g&&(fe(n),fe(a)),Se(t),Se(s),e[98](null),Se(l,g),u=!1,f()}}}function M0(e){let n,t,r={imageLoaded:e[43]};return n=new J4({props:r}),e[99](n),n.$on("loadstart",e[71]),n.$on("loaded",e[100]),n.$on("error",e[101]),{c(){Te(n.$$.fragment)},m(i,s){Ee(n,i,s),t=!0},p(i,s){const o={};s[1]&4096&&(o.imageLoaded=i[43]),n.$set(o)},i(i){t||(te(n.$$.fragment,i),t=!0)},o(i){ue(n.$$.fragment,i),t=!1},d(i){e[99](null),Se(n,i)}}}function F5(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y,R,w,N,X,q,Z,ne,U,F,C,P,I,H,K,he,ee,ae,ge,Le,He,De,Ue,be,Re,Xe,Ne,B,V,ye,Ae,Ke,et,Je,ze,ut,nt,Ye,W,k,h,T,$,j,J,Q,ce,ie,le,ve,ke,Pe,Ze,ft,$e,dt,Be,Qe,wt,We,at,je,_t,Bt,ot,ht,Rt,Xt;function mn(Ge,bt){return Ge[50]?A5:T5}let Jt=mn(e),$t=Jt(e);o=new At({props:{path:xp}}),c=new At({props:{path:Ls}});let bn={placement:"bottom",$$slots:{icon:[C5],default:[M5]},$$scope:{ctx:e}};g=new $r({props:bn}),e[79](g),E=new $r({props:{placement:"bottom",$$slots:{icon:[B5],default:[P5]},$$scope:{ctx:e}}}),v=new At({props:{path:Lp}});let Sn={placement:"bottom",$$slots:{icon:[O5],default:[I5]},$$scope:{ctx:e}};d=new $r({props:Sn}),e[81](d),L=new At({props:{path:Ll}}),w=new At({props:{path:Rp}}),Z=new At({props:{path:Sl}}),C=new At({props:{path:bo}}),K=new At({props:{path:e[1]?Cl:Rl}}),ge=new At({props:{path:e[2]?Ml:Al}}),Ue=new At({props:{path:kl}}),Ne=new At({props:{path:Tl}}),Ke=new At({props:{path:yl}}),ut=new At({props:{path:El}}),k=new At({props:{path:Ls}}),$=new At({props:{path:Ls}}),Q=new At({props:{path:Ls}}),le=new At({props:{path:Ls}}),Pe=new At({props:{path:Ls}});let En={placement:"bottom",$$slots:{icon:[N5],default:[D5]},$$scope:{ctx:e}};$e=new $r({props:En}),e[94]($e);let Yt=e[6].size&&k0(e),Ht=!e[6].size&&T0(e),Vt=e[0]&&e[51]===nn.AUDIOBOOK&&e[6].size&&A0(e),Ft=e[10]&&M0(e);return{c(){n=_e("div"),$t.c(),t=me(),r=_e("div"),i=_e("div"),s=_e("button"),Te(o.$$.fragment),a=me(),l=_e("button"),Te(c.$$.fragment),m=me(),Te(g.$$.fragment),_=me(),Te(E.$$.fragment),S=me(),b=_e("button"),Te(v.$$.fragment),A=me(),Te(d.$$.fragment),p=me(),M=_e("button"),Te(L.$$.fragment),x=me(),Y=_e("div"),R=_e("button"),Te(w.$$.fragment),X=me(),q=_e("button"),Te(Z.$$.fragment),U=me(),F=_e("button"),Te(C.$$.fragment),I=me(),H=_e("button"),Te(K.$$.fragment),ee=me(),ae=_e("button"),Te(ge.$$.fragment),He=me(),De=_e("button"),Te(Ue.$$.fragment),Re=me(),Xe=_e("button"),Te(Ne.$$.fragment),V=me(),ye=_e("div"),Ae=_e("button"),Te(Ke.$$.fragment),Je=me(),ze=_e("button"),Te(ut.$$.fragment),Ye=me(),W=_e("button"),Te(k.$$.fragment),h=me(),T=_e("button"),Te($.$$.fragment),j=me(),J=_e("button"),Te(Q.$$.fragment),ce=me(),ie=_e("button"),Te(le.$$.fragment),ve=me(),ke=_e("button"),Te(Pe.$$.fragment),Ze=me(),ft=_e("div"),Te($e.$$.fragment),dt=me(),Yt&&Yt.c(),Be=me(),Qe=_e("div"),wt=_e("div"),Ht&&Ht.c(),We=me(),Vt&&Vt.c(),at=me(),Ft&&Ft.c(),je=me(),_t=_e("input"),Bt=me(),ot=_e("input"),re(s,"title","Export book to text file"),re(l,"title",u=e[6].size?"Save subtitles to file":"Subtitle file required"),l.disabled=f=!e[6].size,re(b,"title",e[27]),b.disabled=y=!!e[13]||!e[9].htmlBackup,re(M,"title",D=e[13]?"Export in progress":"Reset all & reload page"),M.disabled=O=!!e[13],re(i,"class","flex justify-between w-full header-icons"),re(R,"title",e[29]),R.disabled=N=e[29]!=="Reset playback position",re(q,"title",e[30]),q.disabled=ne=e[14]||!e[4]||!e[15].matchedBy,re(F,"title",e[31]),F.disabled=P=e[14]||!e[4],re(H,"title",e[32]),H.disabled=he=!e[6].size,re(ae,"title",e[33]),ae.disabled=Le=!e[6].size,re(De,"title",e[34]),De.disabled=be=!e[45]||!e[1]&&!e[2],re(Xe,"title",e[35]),Xe.disabled=B=!e[45]||!e[1]&&!e[2],re(Y,"class","flex justify-between w-full m-t-s header-icons"),re(Ae,"title",e[36]),Ae.disabled=et=!e[38],re(ze,"title",e[37]),ze.disabled=nt=!e[39],re(W,"class","invisible"),re(T,"class","invisible"),re(J,"class","invisible"),re(ie,"class","invisible"),re(ke,"class","invisible"),re(ye,"class","flex justify-between w-full m-t-s header-icons"),re(ft,"class","flex flex-1"),xn(ft,"align-items","flex-end"),lt(ft,"hidden",!e[5]),re(r,"class","flex flex-1 flex-col"),re(n,"class","flex m-y-s"),re(wt,"class","flex flex-col flex-1"),re(Qe,"class","flex flex-col flex-1"),re(_t,"type","file"),re(_t,"class","hidden"),re(_t,"accept",`application/x-subrip,text/vtt,text/plain,${e[56].join(",")}`),re(ot,"type","file"),re(ot,"class","hidden"),re(ot,"accept",`audio/mp4,audio/mpeg,${e[57].join(",")}`)},m(Ge,bt){de(Ge,n,bt),$t.m(n,null),oe(n,t),oe(n,r),oe(r,i),oe(i,s),Ee(o,s,null),oe(i,a),oe(i,l),Ee(c,l,null),oe(i,m),Ee(g,i,null),oe(i,_),Ee(E,i,null),oe(i,S),oe(i,b),Ee(v,b,null),oe(i,A),Ee(d,i,null),oe(i,p),oe(i,M),Ee(L,M,null),oe(r,x),oe(r,Y),oe(Y,R),Ee(w,R,null),oe(Y,X),oe(Y,q),Ee(Z,q,null),oe(Y,U),oe(Y,F),Ee(C,F,null),oe(Y,I),oe(Y,H),Ee(K,H,null),oe(Y,ee),oe(Y,ae),Ee(ge,ae,null),oe(Y,He),oe(Y,De),Ee(Ue,De,null),oe(Y,Re),oe(Y,Xe),Ee(Ne,Xe,null),oe(r,V),oe(r,ye),oe(ye,Ae),Ee(Ke,Ae,null),oe(ye,Je),oe(ye,ze),Ee(ut,ze,null),oe(ye,Ye),oe(ye,W),Ee(k,W,null),oe(ye,h),oe(ye,T),Ee($,T,null),oe(ye,j),oe(ye,J),Ee(Q,J,null),oe(ye,ce),oe(ye,ie),Ee(le,ie,null),oe(ye,ve),oe(ye,ke),Ee(Pe,ke,null),oe(r,Ze),oe(r,ft),Ee($e,ft,null),oe(ft,dt),Yt&&Yt.m(ft,null),de(Ge,Be,bt),de(Ge,Qe,bt),oe(Qe,wt),Ht&&Ht.m(wt,null),oe(wt,We),Vt&&Vt.m(wt,null),oe(Qe,at),Ft&&Ft.m(Qe,null),de(Ge,je,bt),de(Ge,_t,bt),e[102](_t),de(Ge,Bt,bt),de(Ge,ot,bt),e[103](ot),ht=!0,Rt||(Xt=[qe(s,"click",e[60]),qe(l,"click",e[61]),qe(b,"click",e[67]),qe(M,"click",e[69]),qe(R,"click",e[68]),qe(q,"click",e[82]),qe(F,"click",e[83]),qe(H,"click",e[84]),qe(ae,"click",e[85]),qe(De,"click",e[86]),qe(Xe,"click",e[87]),qe(Ae,"click",e[88]),qe(ze,"click",e[89]),qe(_t,"change",e[64]),qe(ot,"change",e[64])],Rt=!0)},p(Ge,bt){Jt===(Jt=mn(Ge))&&$t?$t.p(Ge,bt):($t.d(1),$t=Jt(Ge),$t&&($t.c(),$t.m(n,t))),(!ht||bt[0]&64&&u!==(u=Ge[6].size?"Save subtitles to file":"Subtitle file required"))&&re(l,"title",u),(!ht||bt[0]&64&&f!==(f=!Ge[6].size))&&(l.disabled=f);const Ve={};bt[0]&84027520|bt[3]&1048576&&(Ve.$$scope={dirty:bt,ctx:Ge}),g.$set(Ve);const Ie={};bt[0]&32768|bt[3]&1048576&&(Ie.$$scope={dirty:bt,ctx:Ge}),E.$set(Ie),(!ht||bt[0]&134217728)&&re(b,"title",Ge[27]),(!ht||bt[0]&8704&&y!==(y=!!Ge[13]||!Ge[9].htmlBackup))&&(b.disabled=y);const Mt={};bt[0]&302325888|bt[3]&1048576&&(Mt.$$scope={dirty:bt,ctx:Ge}),d.$set(Mt),(!ht||bt[0]&8192&&D!==(D=Ge[13]?"Export in progress":"Reset all & reload page"))&&re(M,"title",D),(!ht||bt[0]&8192&&O!==(O=!!Ge[13]))&&(M.disabled=O),(!ht||bt[0]&536870912)&&re(R,"title",Ge[29]),(!ht||bt[0]&536870912&&N!==(N=Ge[29]!=="Reset playback position"))&&(R.disabled=N),(!ht||bt[0]&1073741824)&&re(q,"title",Ge[30]),(!ht||bt[0]&49168&&ne!==(ne=Ge[14]||!Ge[4]||!Ge[15].matchedBy))&&(q.disabled=ne),(!ht||bt[1]&1)&&re(F,"title",Ge[31]),(!ht||bt[0]&16400&&P!==(P=Ge[14]||!Ge[4]))&&(F.disabled=P);const Tt={};bt[0]&2&&(Tt.path=Ge[1]?Cl:Rl),K.$set(Tt),(!ht||bt[1]&2)&&re(H,"title",Ge[32]),(!ht||bt[0]&64&&he!==(he=!Ge[6].size))&&(H.disabled=he);const Zt={};bt[0]&4&&(Zt.path=Ge[2]?Ml:Al),ge.$set(Zt),(!ht||bt[1]&4)&&re(ae,"title",Ge[33]),(!ht||bt[0]&64&&Le!==(Le=!Ge[6].size))&&(ae.disabled=Le),(!ht||bt[1]&8)&&re(De,"title",Ge[34]),(!ht||bt[0]&6|bt[1]&16384&&be!==(be=!Ge[45]||!Ge[1]&&!Ge[2]))&&(De.disabled=be),(!ht||bt[1]&16)&&re(Xe,"title",Ge[35]),(!ht||bt[0]&6|bt[1]&16384&&B!==(B=!Ge[45]||!Ge[1]&&!Ge[2]))&&(Xe.disabled=B),(!ht||bt[1]&32)&&re(Ae,"title",Ge[36]),(!ht||bt[1]&128&&et!==(et=!Ge[38]))&&(Ae.disabled=et),(!ht||bt[1]&64)&&re(ze,"title",Ge[37]),(!ht||bt[1]&256&&nt!==(nt=!Ge[39]))&&(ze.disabled=nt);const yt={};bt[0]&16640|bt[1]&273920|bt[3]&1048576&&(yt.$$scope={dirty:bt,ctx:Ge}),$e.$set(yt),Ge[6].size?Yt?(Yt.p(Ge,bt),bt[0]&64&&te(Yt,1)):(Yt=k0(Ge),Yt.c(),te(Yt,1),Yt.m(ft,null)):Yt&&(rn(),ue(Yt,1,1,()=>{Yt=null}),sn()),(!ht||bt[0]&32)&&lt(ft,"hidden",!Ge[5]),Ge[6].size?Ht&&(rn(),ue(Ht,1,1,()=>{Ht=null}),sn()):Ht?(Ht.p(Ge,bt),bt[0]&64&&te(Ht,1)):(Ht=T0(Ge),Ht.c(),te(Ht,1),Ht.m(wt,We)),Ge[0]&&Ge[51]===nn.AUDIOBOOK&&Ge[6].size?Vt?(Vt.p(Ge,bt),bt[0]&65|bt[1]&1048576&&te(Vt,1)):(Vt=A0(Ge),Vt.c(),te(Vt,1),Vt.m(wt,null)):Vt&&(rn(),ue(Vt,1,1,()=>{Vt=null}),sn()),Ge[10]?Ft?(Ft.p(Ge,bt),bt[0]&1024&&te(Ft,1)):(Ft=M0(Ge),Ft.c(),te(Ft,1),Ft.m(Qe,null)):Ft&&(rn(),ue(Ft,1,1,()=>{Ft=null}),sn())},i(Ge){ht||(te(o.$$.fragment,Ge),te(c.$$.fragment,Ge),te(g.$$.fragment,Ge),te(E.$$.fragment,Ge),te(v.$$.fragment,Ge),te(d.$$.fragment,Ge),te(L.$$.fragment,Ge),te(w.$$.fragment,Ge),te(Z.$$.fragment,Ge),te(C.$$.fragment,Ge),te(K.$$.fragment,Ge),te(ge.$$.fragment,Ge),te(Ue.$$.fragment,Ge),te(Ne.$$.fragment,Ge),te(Ke.$$.fragment,Ge),te(ut.$$.fragment,Ge),te(k.$$.fragment,Ge),te($.$$.fragment,Ge),te(Q.$$.fragment,Ge),te(le.$$.fragment,Ge),te(Pe.$$.fragment,Ge),te($e.$$.fragment,Ge),te(Yt),te(Ht),te(Vt),te(Ft),ht=!0)},o(Ge){ue(o.$$.fragment,Ge),ue(c.$$.fragment,Ge),ue(g.$$.fragment,Ge),ue(E.$$.fragment,Ge),ue(v.$$.fragment,Ge),ue(d.$$.fragment,Ge),ue(L.$$.fragment,Ge),ue(w.$$.fragment,Ge),ue(Z.$$.fragment,Ge),ue(C.$$.fragment,Ge),ue(K.$$.fragment,Ge),ue(ge.$$.fragment,Ge),ue(Ue.$$.fragment,Ge),ue(Ne.$$.fragment,Ge),ue(Ke.$$.fragment,Ge),ue(ut.$$.fragment,Ge),ue(k.$$.fragment,Ge),ue($.$$.fragment,Ge),ue(Q.$$.fragment,Ge),ue(le.$$.fragment,Ge),ue(Pe.$$.fragment,Ge),ue($e.$$.fragment,Ge),ue(Yt),ue(Ht),ue(Vt),ue(Ft),ht=!1},d(Ge){Ge&&(fe(n),fe(Be),fe(Qe),fe(je),fe(_t),fe(Bt),fe(ot)),$t.d(),Se(o),Se(c),e[79](null),Se(g),Se(E),Se(v),e[81](null),Se(d),Se(L),Se(w),Se(Z),Se(C),Se(K),Se(ge),Se(Ue),Se(Ne),Se(Ke),Se(ut),Se(k),Se($),Se(Q),Se(le),Se(Pe),e[94](null),Se($e),Yt&&Yt.d(),Ht&&Ht.d(),Vt&&Vt.d(),Ft&&Ft.d(),e[102](null),e[103](null),Rt=!1,_n(Xt)}}}function $5(e,n,t){let r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y,R,w,N,X,q;we(e,Si,Oe=>t(5,o=Oe)),we(e,ra,Oe=>t(73,a=Oe)),we(e,na,Oe=>t(74,l=Oe)),we(e,Xn,Oe=>t(6,c=Oe)),we(e,zn,Oe=>t(7,u=Oe)),we(e,Es,Oe=>t(104,f=Oe)),we(e,si,Oe=>t(8,m=Oe)),we(e,dn,Oe=>t(46,g=Oe)),we(e,Et,Oe=>t(47,_=Oe)),we(e,Pr,Oe=>t(9,E=Oe)),we(e,kt,Oe=>t(48,S=Oe)),we(e,gn,Oe=>t(105,b=Oe)),we(e,ri,Oe=>t(106,v=Oe)),we(e,ii,Oe=>t(49,y=Oe)),we(e,oo,Oe=>t(10,A=Oe)),we(e,ks,Oe=>t(50,d=Oe)),we(e,ni,Oe=>t(11,M=Oe)),we(e,xi,Oe=>t(12,L=Oe)),we(e,jr,Oe=>t(13,x=Oe)),we(e,Ko,Oe=>t(77,Y=Oe)),we(e,ki,Oe=>t(14,R=Oe)),we(e,Ss,Oe=>t(15,w=Oe)),we(e,so,Oe=>t(16,N=Oe)),we(e,Wi,Oe=>t(51,X=Oe)),we(e,Qo,Oe=>t(52,q=Oe));let{showMenu:Z}=n;function ne(){De==null||De.onResetList()}const{subtitlesEnablePersist$:U,ankiSentenceField$:F,ankiSoundField$:C}=St;we(e,U,Oe=>t(107,p=Oe)),we(e,F,Oe=>t(75,D=Oe)),we(e,C,Oe=>t(76,O=Oe));const{sandboxElement:P,supportsFileSystem:I,isIOS:H}=Ni("context"),K=[".srt",".vtt",".txt"],he=[".m4a",".m4b",".mp3"];let ee,ae,ge,Le,He,De,Ue,be=!1,Re=!1,Xe="",Ne="",B="",V="",ye="",Ae="",Ke="",et="",Je="",ze="",ut="",nt="",Ye=!1,W=!1,k=!1,h=!1,T=0,$=0,j=0,J,Q=[];function ce(){pe(gn,b=!0,b),pe(Et,_=!0,_),pe(dn,g=!0,g),pe(kt,S="",S),ge.hide(),Le.hide()}async function ie({detail:{files:Oe,errors:Lt}}){const Ot=[],Dt=[];let tn,hn;ce();for(let zt=0,{length:Ce}=Oe;zt<Ce;zt+=1){const Ct=Oe[zt];Ct.extension===".srt"||Ct.extension===".vtt"||Ct.extension===".txt"?Ot.push(Ct):Dt.push(Ct)}let er=Ot.length>1||Dt.length>1;Ot.length>1&&Lt.push("Only 1 subtitle file is allowed"),Dt.length>1&&Lt.push("Only 1 audio file is allowed");try{if(er||!Ot.length&&!Dt.length)throw new Error("Stop process");if([tn]=Ot,[hn]=Dt,!await h1([tn==null?void 0:tn.handle,hn==null?void 0:hn.handle]).catch(({message:Ce})=>(Lt.push(`Access check failed: ${Ce}`),!1)))throw new Error("Stop process")}catch{pe(kt,S=Lt.join("; "),S),pe(Et,_=!1,_),pe(dn,g=!1,g);return}if(tn){try{const zt=await pa(tn.file,document);tn.handle&&await We(tn.handle,"lastSubtitle"),p&&await Ti({name:tn.file.name,subtitles:[...zt.values()]}).catch(({message:Ce})=>Lt.push(Ce)),li(tn.file,zt),t(24,be=!0)}catch({message:zt}){Lt.push(`Failed to process subtitle: ${zt}`)}hn||pe(Et,_=!1,_)}if(hn)try{const zt=await Bs(hn.file,P);hn.handle&&await We(hn.handle,"lastAudio"),await Ai(d,A,hn.file,zt),t(25,Re=!0)}catch({message:zt}){Lt.push(`Failed to process audio: ${zt}`),pe(Et,_=!1,_)}pe(kt,S=Lt.join("; "),S),pe(dn,g=!1,g)}async function le(){pe(Et,_=!0,_),pe(kt,S="",S);try{await new Promise(Dt=>setTimeout(Dt,100));const Oe=sa(new DOMParser,E.htmlBackup||E.elementHtml);let Lt="";const Ot=document.createTreeWalker(Oe,NodeFilter.SHOW_TEXT,{acceptNode(Dt){var er;const tn=(((er=Dt.parentElement)==null?void 0:er.tagName)||"").toLowerCase(),hn=(Dt.textContent||"").replace(/\s/g,"").trim();return!ia.has(tn)&&hn&&(Lt+=`${Dt.textContent}
`),NodeFilter.FILTER_ACCEPT}});for(;Ot.nextNode(););Lt&&ml(document,new Blob([Lt],{type:"text/plain;charset=utf-8"}),`${E.title}.txt`,H)}catch({message:Oe}){pe(kt,S=`Failed to export text: ${Oe}`,S)}pe(Et,_=!1,_)}async function ve(){pe(Et,_=!0,_),await new Promise(Ot=>setTimeout(Ot,100));const Oe=[...c.values()];let Lt="";for(let Ot=0,{length:Dt}=Oe;Ot<Dt;Ot+=1){const tn=Oe[Ot];Lt+=`${tn.id}
${tn.startTime} --> ${tn.endTime}
${tn.text}

`}Lt&&ml(document,new Blob([Lt],{type:`${H?"text/plain":"application/x-subrip"};charset=utf-8`}),`${M.name.split(/\.(?=[^\.]+$)/)[0]}.srt`,H),pe(Et,_=!1,_)}async function ke(){if(ge.hide(),I){pe(dn,g=!0,g),pe(Et,_=!0,_),pe(kt,S="",S);try{const{handle:Oe,file:Lt}=await p1(window,"Subtitle",K,u.lastSubtitle);if(Lt){const Ot=await pa(Lt,document);await We(Oe,"lastSubtitle"),p&&await Ti({name:Oe.name,subtitles:[...Ot.values()]}),li(Lt,Ot),t(24,be=!1)}}catch(Oe){Oe.name!=="AbortError"&&pe(kt,S=`Failed to process subtitle: ${Oe.message}`,S)}pe(Et,_=!1,_),pe(dn,g=!1,g)}else ee.click()}async function Pe(){if(Le.hide(),I){pe(dn,g=!0,g),pe(Et,_=!0,_),pe(kt,S="",S);try{const{handle:Oe,file:Lt}=await p1(window,"Audio",he,u.lastAudio);if(Lt){const Ot=await Bs(Lt,P);await We(Oe,"lastAudio"),await Ai(d,A,Lt,Ot),t(25,Re=!1)}else pe(Et,_=!1,_)}catch(Oe){Oe.name!=="AbortError"&&pe(kt,S=`Failed to process audio: ${Oe.message}`,S),pe(Et,_=!1,_)}pe(dn,g=!1,g)}else ae.click()}async function Ze(Oe){const Lt=Oe.target,Ot=Lt.accept.includes(".srt"),[Dt]=Lt.files||[];if(Dt){pe(dn,g=!0,g),pe(Et,_=!0,_),pe(kt,S="",S);try{if(Ot){const tn=await pa(Dt,document,!0);p&&await Ti({name:Dt.name,subtitles:[...tn.values()]}),pe(Et,_=!1,_),t(24,be=!1)}else await Bs(Dt,P,!0,!1,d,A),t(25,Re=!1)}catch({message:tn}){pe(kt,S=`Failed to process ${Ot?"subtitle":"audio"}: ${tn}`,S),pe(Et,_=!1,_)}pe(dn,g=!1,g)}}async function ft(Oe){if(Oe==="lastSubtitle"?ge.hide():Le.hide(),pe(dn,g=!0,g),pe(Et,_=!0,_),pe(kt,S="",S),pe(gn,b=!0,b),I)try{Oe==="lastSubtitle"?(await f.delete("handle",[u.title,"subtitle"]),(!u.subtitleData||!u.subtitleData.subtitles.length)&&li(),t(24,be=!1)):Oe==="lastAudio"&&(await f.delete("handle",[u.title,"audioBook"]),await Ai(d,A),t(25,Re=!1)),delete u[Oe]}catch({message:Lt}){pe(kt,S=`Failed to drop file: ${Lt}`,S)}else Oe==="lastSubtitle"?((!u.subtitleData||!u.subtitleData.subtitles.length)&&li(),t(17,ee.value="",ee),t(24,be=!1)):Oe==="lastAudio"&&(await Ai(d,A),t(18,ae.value="",ae),t(25,Re=!1));pe(Et,_=!1,_),pe(dn,g=!1,g),zn.set(u)}async function $e(){ge.hide(),pe(Et,_=!0,_),pe(dn,g=!0,g),pe(kt,S="",S);try{const Oe={name:u.subtitleData.name,subtitles:[]};await f.put("subtitle",{subtitleData:Oe,title:u.title,lastSubtitleDataModified:Date.now()}),!u.lastSubtitle&&!ee.value&&!be&&(pe(gn,b=!0,b),li()),pe(zn,u.subtitleData=Oe,u),document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"sync",syncType:"subtitle"}}))}catch({message:Oe}){pe(kt,S=`Failed to drop persisted subtitles: ${Oe}`,S)}pe(Et,_=!1,_),pe(dn,g=!1,g),zn.set(u)}async function dt(){pe(dn,g=!0,g),pe(Et,_=!0,_),pe(gn,b=!0,b);const{elementHtml:Oe,htmlBackup:Lt,lastBookModified:Ot}=E;try{pe(Pr,E.elementHtml=Lt,E),pe(Pr,E.lastBookModified=Date.now(),E),delete E.htmlBackup,await f.put("data",E),window.location.reload()}catch({message:Dt}){pe(kt,S=`Failed to reset book: ${Dt}`,S),pe(Pr,E={...E,elementHtml:Oe,htmlBackup:Lt,lastBookModified:Ot},E)}pe(Et,_=!1,_),pe(dn,g=!1,g)}async function Be(){pe(dn,g=!0,g),pe(Et,_=!0,_),pe(gn,b=!0,b);try{await f.put("audioBook",{title:u.title,playbackPosition:0,lastAudioBookModified:Date.now()}),pe(ii,y=0,y),pe(zn,u.playbackPosition=0,u),pe(ri,v={previous:"",current:"",useTimeFallback:!0},v)}catch({message:Oe}){pe(kt,S=`Failed to reset playback position: ${Oe}`,S)}pe(Et,_=!1,_),pe(dn,g=!1,g),zn.set(u)}async function Qe(){pe(dn,g=!0,g),pe(Et,_=!0,_),pe(gn,b=!0,b);const Oe=f.transaction(["data","audioBook","subtitle","handle"],"readwrite"),{elementHtml:Lt,htmlBackup:Ot,lastBookModified:Dt}=E,tn=Date.now(),hn=u.subtitleData,er=u.playbackPosition;try{if(Ot&&(pe(Pr,E.elementHtml=Ot,E),pe(Pr,E.lastBookModified=tn,E),delete E.htmlBackup,await Oe.objectStore("data").put(E)),hn){const zt={name:hn.name,subtitles:[]};await Oe.objectStore("subtitle").put({subtitleData:zt,title:E.title,lastSubtitleDataModified:tn}),pe(zn,u.subtitleData=zt,u)}await Oe.objectStore("audioBook").put({title:E.title,playbackPosition:0,lastAudioBookModified:tn}),await Oe.objectStore("handle").delete(IDBKeyRange.bound([E.title],[E.title,[]])),await Oe.done,pe(zn,u.playbackPosition=0,u),window.location.reload()}catch({message:zt}){try{Oe.abort(),await Oe.done}catch{}pe(kt,S=`Failed to reset Data: ${zt}`,S),pe(Pr,E={...E,elementHtml:Lt,htmlBackup:Ot,lastBookModified:Dt},E),pe(zn,u={...u,playbackPosition:er,subtitleData:hn},u)}pe(Et,_=!1,_),pe(dn,g=!1,g)}function wt(){He.hide(),Ln(ct.RESTART_PLAYBACK,fr(ai(0,m,(T||0)*3600+($||0)*60+(j||0))),{keepPauseState:!0})}async function We(Oe,Lt){try{await f.put("handle",{handle:Oe,title:u.title,lastHandleModified:Date.now(),dataType:Lt==="lastSubtitle"?"subtitle":"audioBook"}),pe(zn,u[Lt]=Oe,u)}catch({message:Ot}){throw new Error(`Failed to update extension data - ${Ot}`)}finally{zn.set(u)}}async function at(...Oe){t(3,Q=[...c.values()].filter(Lt=>(!k||l.has(Lt.id))&&(!h||a.has(Lt.id)))),await qn(),t(4,r=Q.length>0)}function je(...Oe){pe(Si,o=!1,o),new Promise(Ot=>t(43,J=Ot));const Lt=document.querySelectorAll(`${oa()}.active`);for(let Ot=0,{length:Dt}=Lt;Ot<Dt;Ot+=1)Lt[Ot].classList.remove("active")}const _t=()=>ft("lastSubtitle");function Bt(Oe){Gt[Oe?"unshift":"push"](()=>{ge=Oe,t(19,ge)})}const ot=()=>ft("lastAudio");function ht(Oe){Gt[Oe?"unshift":"push"](()=>{Le=Oe,t(20,Le)})}const Rt=async()=>{pe(Et,_=!0,_),await Ln(ct.ALIGN_SUBTITLE,Q),pe(Et,_=!1,_)},Xt=async()=>{pe(Et,_=!0,_),await Ln(ct.RESTORE_SUBTITLE,Q),pe(Et,_=!1,_)},mn=()=>t(1,k=!k),Jt=()=>t(2,h=!h),$t=()=>Ln(ct.TOGGLE_PLAY_PAUSE,Q,{skipUpdates:!0}),bn=()=>Ln(ct.TOGGLE_PLAYBACK_LOOP,Q,{skipUpdates:!0}),Sn=()=>Ln(ct.EXPORT_NEW,Q,{mergeSubtitles:h}),En=()=>Ln(ct.EXPORT_UPDATE,Q,{mergeSubtitles:!0}),Yt=()=>t(40,[T,$,j]=oi(y),T,t(41,$),t(42,j));function Ht(Oe){T=Oe,t(40,T)}function Vt(Oe){$=Oe,t(41,$)}function Ft(Oe){j=Oe,t(42,j)}function Ge(Oe){Gt[Oe?"unshift":"push"](()=>{He=Oe,t(21,He)})}const bt=()=>De==null?void 0:De.scrollToSubtitle(!0),Ve=()=>{pe(Et,_=!1,_),pe(dn,g=!1,g)},Ie=()=>Ln(ct.CANCEL_EXPORT,Q);function Mt(Oe){Gt[Oe?"unshift":"push"](()=>{De=Oe,t(22,De)})}function Tt(Oe){Gt[Oe?"unshift":"push"](()=>{Ue=Oe,t(23,Ue)})}const Zt=()=>De==null?void 0:De.onResetList(),yt=()=>{Ai(d,d).finally(()=>{pe(kt,S="Unable to play audio - try a different codec/format",S),pe(Et,_=!1,_)})};function jt(Oe){Gt[Oe?"unshift":"push"](()=>{ee=Oe,t(17,ee)})}function cn(Oe){Gt[Oe?"unshift":"push"](()=>{ae=Oe,t(18,ae)})}return e.$$set=Oe=>{"showMenu"in Oe&&t(0,Z=Oe.showMenu)},e.$$.update=()=>{e.$$.dirty[0]&2048&&M&&(t(1,k=!1),t(2,h=!1)),e.$$.dirty[0]&70&&at(c,k,h),e.$$.dirty[0]&8&&t(4,r=Q.length>0),e.$$.dirty[0]&16432&&t(45,i=o&&r&&!R),e.$$.dirty[0]&256&&t(44,s=m?Math.floor(m/3600):999),e.$$.dirty[0]&76288&&(x?(t(26,Xe="Export in progress"),t(27,Ne="Export in progress"),t(28,B="Export in progress")):(t(26,Xe=`${M?"Change":"Set"} subtitle file`),t(27,Ne=E.htmlBackup?"Reset book & reload page":"No data to reset"),t(28,B=`${N?"Change":"Set"} audio file`))),e.$$.dirty[0]&8320&&(!Number.isFinite(u.playbackPosition)||u.playbackPosition===0?t(29,V="No data to reset"):x?t(29,V="Export in progress"):t(29,V="Reset playback position")),e.$$.dirty[0]&49238&&(c.size?R?t(30,ye="Recording in progress"):r?w.matchedBy?t(30,ye=`Align${k||h?" selected":" all"} subtitles with book text`):t(30,ye="Matched book required"):t(30,ye="No subtitle matches current filter"):t(30,ye="Subtitle file required")),e.$$.dirty[0]&16470&&(c.size?R?t(31,Ae="Recording in progress"):r?t(31,Ae=`Restore original time and text for${k||h?" selected":" all"} subtitles`):t(31,Ae="No subtitle matches current filter"):t(31,Ae="Subtitle file required")),e.$$.dirty[0]&70&&(c.size?(t(32,Ke=k?"Show all subtitles":"Show only bookmarked subtitles"),t(33,et=h?"Show all subtitles":"Show only subtitles for merge")):(t(32,Ke="Subtitle file required"),t(33,et="Subtitle file required"))),e.$$.dirty[0]&16502&&(c.size?o?R?(t(34,Je="Recording in progress"),t(35,ze="Recording in progress")):r?!k&&!h?(t(34,Je="Bookmark or merge filter required"),t(35,ze="Bookmark or merge filter required")):(t(34,Je="Toggle play and pause for selected subtitles"),t(35,ze="Toggle playback loop for selected subtitles")):(t(34,Je="No subtitle matches current filter"),t(35,ze="No subtitle matches current filter")):(t(34,Je="Audio file required"),t(35,ze="Audio file required")):(t(34,Je="Subtitle file required"),t(35,ze="Subtitle file required"))),e.$$.dirty[0]&12406|e.$$.dirty[2]&57344&&(Y?x?(t(36,ut="Export in progress"),t(37,nt="Export in progress"),t(38,Ye=!1),t(39,W=!1)):c.size?O&&!o&&!D?(t(36,ut="Audio file required"),t(37,nt="Audio file required"),t(38,Ye=!1),t(39,W=!1)):r?(h?(t(36,ut="Merge selected subtitles and create new Card for selected subtitles"),t(38,Ye=!0)):k?(t(36,ut="Create new cards for selected subtitles"),t(38,Ye=!0)):(t(36,ut="Bookmark or merge filter required"),t(38,Ye=!1)),L?(t(37,nt="Device not supported"),t(39,W=!1)):h?(t(37,nt="Merge selected subtitles and update last card"),t(39,W=!0)):(t(37,nt="Merge filter required"),t(39,W=!1))):(t(36,ut="No subtitle matches current filter"),t(37,nt="No subtitle matches current filter"),t(38,Ye=!1),t(39,W=!1)):(t(36,ut="Subtitle file required"),t(37,nt="Subtitle file required"),t(38,Ye=!1),t(39,W=!1)):(t(36,ut="Anki configuration required"),t(37,nt="Anki configuration required"),t(38,Ye=!1),t(39,W=!1))),e.$$.dirty[0]&2|e.$$.dirty[2]&4096&&k&&at(l),e.$$.dirty[0]&4|e.$$.dirty[2]&2048&&h&&at(a),e.$$.dirty[0]&1024&&(A||je())},[Z,k,h,Q,r,o,c,u,m,E,A,M,L,x,R,w,N,ee,ae,ge,Le,He,De,Ue,be,Re,Xe,Ne,B,V,ye,Ae,Ke,et,Je,ze,ut,nt,Ye,W,T,$,j,J,s,i,g,_,S,y,d,X,q,U,F,C,K,he,ce,ie,le,ve,ke,Pe,Ze,ft,$e,dt,Be,Qe,wt,je,ne,a,l,D,O,Y,_t,Bt,ot,ht,Rt,Xt,mn,Jt,$t,bn,Sn,En,Yt,Ht,Vt,Ft,Ge,bt,Ve,Ie,Mt,Tt,Zt,yt,jt,cn]}class V5 extends vn{constructor(n){super(),wn(this,n,$5,F5,pn,{showMenu:0,resetSubtitleContainerHeight:72},null,[-1,-1,-1,-1])}get resetSubtitleContainerHeight(){return this.$$.ctx[72]}}function C0(e,n,t){const r=e.slice();return r[12]=n[t],r[13]=n,r[14]=t,r}function R0(e,n){let t,r,i=n[12].label+"",s,o,a,l=n[12].startText+"",c,u,f,m=n[14],g,_;const E=()=>n[8](t,m),S=()=>n[8](null,m);function b(){return n[9](n[12])}return{key:e,first:null,c(){t=_e("button"),r=_e("div"),s=Nt(i),o=me(),a=_e("div"),c=Nt(l),u=me(),re(a,"class","audio-time"),re(t,"class","m-y-xs p-b"),t.disabled=n[4],re(t,"title",f=n[4]?"Recording in progress":"Play from chapter"),lt(t,"inactive-chapter",n[2]>n[14]),lt(t,"recording",n[4]),this.first=t},m(v,y){de(v,t,y),oe(t,r),oe(r,s),oe(t,o),oe(t,a),oe(a,c),oe(t,u),E(),g||(_=qe(t,"click",b),g=!0)},p(v,y){n=v,y&8&&i!==(i=n[12].label+"")&&en(s,i),y&8&&l!==(l=n[12].startText+"")&&en(c,l),y&16&&(t.disabled=n[4]),y&16&&f!==(f=n[4]?"Recording in progress":"Play from chapter")&&re(t,"title",f),m!==n[14]&&(S(),m=n[14],E()),y&12&&lt(t,"inactive-chapter",n[2]>n[14]),y&16&&lt(t,"recording",n[4])},d(v){v&&fe(t),S(),g=!1,_()}}}function x5(e){let n,t=[],r=new Map,i=xr(e[3]);const s=o=>o[12].key;for(let o=0;o<i.length;o+=1){let a=C0(e,i,o),l=s(a);r.set(l,t[o]=R0(l,a))}return{c(){n=_e("div");for(let o=0;o<t.length;o+=1)t[o].c();re(n,"class","flex flex-col")},m(o,a){de(o,n,a);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(n,null);e[10](n)},p(o,[a]){a&62&&(i=xr(o[3]),t=ro(t,a,s,1,o,i,r,n,Xo,R0,null,C0))},i:gt,o:gt,d(o){o&&fe(n);for(let a=0;a<t.length;a+=1)t[a].d();e[10](null)}}}function H5(e,n,t){let r,i,s,o,a;we(e,ii,E=>t(11,r=E)),we(e,Ts,E=>t(3,i=E)),we(e,ri,E=>t(6,s=E)),we(e,Wi,E=>t(7,o=E)),we(e,ki,E=>t(4,a=E));let l,c=[],u=-1;function f(){t(2,u=i.findLastIndex(E=>r>=E.startSeconds)),!(u===-1||!c[u])&&(c[u].scrollIntoViewIfNeeded?c[u].scrollIntoViewIfNeeded():c[u].scrollIntoView())}function m(E,S){Gt[E?"unshift":"push"](()=>{c[S]=E,t(1,c)})}const g=E=>{Ln(ct.RESTART_PLAYBACK,fr(E.startSeconds),{keepPauseState:!0}).then(qn).then(f)};function _(E){Gt[E?"unshift":"push"](()=>{l=E,t(0,l)})}return e.$$.update=()=>{e.$$.dirty&192&&o===nn.CHAPTERS&&s&&f()},[l,c,u,i,a,f,s,o,m,g,_]}class U5 extends vn{constructor(n){super(),wn(this,n,H5,x5,pn,{})}}function W5(e){let n;return{c(){n=Nt(e[0])},m(t,r){de(t,n,r)},p(t,r){r&1&&en(n,t[0])},d(t){t&&fe(n)}}}function j5(e){let n,t;return{c(){n=_e("p"),t=Nt(e[1]),re(n,"style",e[2])},m(r,i){de(r,n,i),oe(n,t)},p(r,i){i&2&&en(t,r[1]),i&4&&re(n,"style",r[2])},d(r){r&&fe(n)}}}function G5(e){let n,t,r,i,s,o;return{c(){n=_e("div"),t=_e("button"),t.textContent="Cancel",r=me(),i=_e("button"),i.textContent="Confirm",lt(t,"invisible",!e[3]),re(n,"class","flex grow justify-between"),re(n,"slot","footer")},m(a,l){de(a,n,l),oe(n,t),oe(n,r),oe(n,i),s||(o=[qe(t,"click",e[6]),qe(i,"click",e[7])],s=!0)},p(a,l){l&8&&lt(t,"invisible",!a[3])},d(a){a&&fe(n),s=!1,_n(o)}}}function z5(e){let n,t;return n=new la({props:{$$slots:{footer:[G5],content:[j5],header:[W5]},$$scope:{ctx:e}}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},p(r,[i]){const s={};i&527&&(s.$$scope={dirty:i,ctx:r}),n.$set(s)},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function X5(e,n,t){let{dialogHeader:r}=n,{dialogMessage:i}=n,{contentStyles:s}=n,{showCancel:o=!0}=n,{resolver:a}=n;const l=ei();function c(m=!1){a(m),l("close")}const u=()=>c(!0),f=()=>c();return e.$$set=m=>{"dialogHeader"in m&&t(0,r=m.dialogHeader),"dialogMessage"in m&&t(1,i=m.dialogMessage),"contentStyles"in m&&t(2,s=m.contentStyles),"showCancel"in m&&t(3,o=m.showCancel),"resolver"in m&&t(5,a=m.resolver)},[r,i,s,o,c,a,u,f]}class Y5 extends vn{constructor(n){super(),wn(this,n,X5,z5,pn,{dialogHeader:0,dialogMessage:1,contentStyles:2,showCancel:3,resolver:5})}}function L0(e){let n,t,r,i,s,o,a,l,c;const u=[Z5,q5],f=[];function m(g,_){return typeof g[0].component=="string"?0:1}return s=m(e),o=f[s]=u[s](e),{c(){n=_e("div"),t=_e("div"),r=me(),i=_e("div"),o.c(),re(t,"tabindex","0"),re(t,"role","button"),re(t,"class","absolute inset-0 tap-highlight-transparent bg-black/[.32]"),re(i,"class","ttu-whispersync-container dialog-container relative top-1/2 left-1/2 inline-block -translate-x-1/2 -translate-y-1/2"),re(n,"class","ttu-whispersync-dialog writing-horizontal-tb fixed inset-0 w-full h-full"),xn(n,"z-index",e[1])},m(g,_){de(g,n,_),oe(n,t),oe(n,r),oe(n,i),f[s].m(i,null),a=!0,l||(c=qe(n,"wheel",Js(e[4]),{passive:!0}),l=!0)},p(g,_){let E=s;s=m(g),s===E?f[s].p(g,_):(rn(),ue(f[E],1,1,()=>{f[E]=null}),sn(),o=f[s],o?o.p(g,_):(o=f[s]=u[s](g),o.c()),te(o,1),o.m(i,null)),_&2&&xn(n,"z-index",g[1])},i(g){a||(te(o),a=!0)},o(g){ue(o),a=!1},d(g){g&&fe(n),f[s].d(),l=!1,c()}}}function q5(e){let n,t,r;const i=[e[0].props];var s=e[0].component;function o(a,l){let c={};if(l!==void 0&&l&1)c=fc(i,[dc(a[0].props)]);else for(let u=0;u<i.length;u+=1)c=Vn(c,i[u]);return{props:c}}return s&&(n=ac(s,o(e)),n.$on("close",e[2])),{c(){n&&Te(n.$$.fragment),t=ur()},m(a,l){n&&Ee(n,a,l),de(a,t,l),r=!0},p(a,l){if(l&1&&s!==(s=a[0].component)){if(n){rn();const c=n;ue(c.$$.fragment,1,0,()=>{Se(c,1)}),sn()}s?(n=ac(s,o(a,l)),n.$on("close",a[2]),Te(n.$$.fragment),te(n.$$.fragment,1),Ee(n,t.parentNode,t)):n=null}else if(s){const c=l&1?fc(i,[dc(a[0].props)]):{};n.$set(c)}},i(a){r||(n&&te(n.$$.fragment,a),r=!0)},o(a){n&&ue(n.$$.fragment,a),r=!1},d(a){a&&fe(t),n&&Se(n,a)}}}function Z5(e){let n,t=e[0].component+"",r;return{c(){n=new Ah(!1),r=ur(),n.a=r},m(i,s){n.m(t,i,s),de(i,r,s)},p(i,s){s&1&&t!==(t=i[0].component+"")&&n.p(t)},i:gt,o:gt,d(i){i&&(fe(r),n.d())}}}function K5(e){let n,t,r=e[0]&&L0(e);return{c(){r&&r.c(),n=ur()},m(i,s){r&&r.m(i,s),de(i,n,s),t=!0},p(i,[s]){i[0]?r?(r.p(i,s),s&1&&te(r,1)):(r=L0(i),r.c(),te(r,1),r.m(n.parentNode,n)):r&&(rn(),ue(r,1,1,()=>{r=null}),sn())},i(i){t||(te(r),t=!0)},o(i){ue(r),t=!1},d(i){i&&fe(n),r&&r.d(i)}}}function Q5(e,n,t){let r,i;we(e,dn,u=>t(5,r=u)),we(e,io,u=>t(3,i=u));let s,o="";function a(){pe(io,i=i.slice(0,-1),i),l()}function l(){var f;const u=i.length-1;t(0,s=i[u]),t(1,o=((f=i[u])==null?void 0:f.zIndex)||""),pe(dn,r=!!s,r)}function c(u){cr.call(this,e,u)}return e.$$.update=()=>{e.$$.dirty&9&&i.length&&!s&&l()},[s,o,a,i,c]}class J5 extends vn{constructor(n){super(),wn(this,n,Q5,K5,pn,{})}}const Uu=(e,n)=>n.some(t=>e instanceof t);let P0,B0;function e6(){return P0||(P0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function t6(){return B0||(B0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Wu=new WeakMap,ju=new WeakMap,Ka=new WeakMap;function n6(e){const n=new Promise((t,r)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",o)},s=()=>{t(os(e.result)),i()},o=()=>{r(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",o)});return Ka.set(n,e),n}function r6(e){if(Wu.has(e))return;const n=new Promise((t,r)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",o),e.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",o),e.addEventListener("abort",o)});Wu.set(e,n)}let Gu={get(e,n,t){if(e instanceof IDBTransaction){if(n==="done")return Wu.get(e);if(n==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return os(e[n])},set(e,n,t){return e[n]=t,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function I0(e){Gu=e(Gu)}function i6(e){return t6().includes(e)?function(...n){return e.apply(zu(this),n),os(this.request)}:function(...n){return os(e.apply(zu(this),n))}}function s6(e){return typeof e=="function"?i6(e):(e instanceof IDBTransaction&&r6(e),Uu(e,e6())?new Proxy(e,Gu):e)}function os(e){if(e instanceof IDBRequest)return n6(e);if(ju.has(e))return ju.get(e);const n=s6(e);return n!==e&&(ju.set(e,n),Ka.set(n,e)),n}const zu=e=>Ka.get(e);function o6(e,n,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,n),a=os(o);return r&&o.addEventListener("upgradeneeded",l=>{r(os(o.result),l.oldVersion,l.newVersion,os(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const a6=["get","getKey","getAll","getAllKeys","count"],l6=["put","add","delete","clear"],Xu=new Map;function O0(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(Xu.get(n))return Xu.get(n);const t=n.replace(/FromIndex$/,""),r=n!==t,i=l6.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||a6.includes(t)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return Xu.set(n,s),s}I0(e=>({...e,get:(n,t,r)=>O0(n,t)||e.get(n,t,r),has:(n,t)=>!!O0(n,t)||e.has(n,t)}));const u6=["continue","continuePrimaryKey","advance"],D0={},Yu=new WeakMap,N0=new WeakMap,c6={get(e,n){if(!u6.includes(n))return e[n];let t=D0[n];return t||(t=D0[n]=function(...r){Yu.set(this,N0.get(this)[n](...r))}),t}};async function*f6(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;n=n;const t=new Proxy(n,c6);for(N0.set(t,n),Ka.set(t,zu(n));n;)yield t,n=await(Yu.get(t)||n.continue()),Yu.delete(t)}function F0(e,n){return n===Symbol.asyncIterator&&Uu(e,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&Uu(e,[IDBIndex,IDBObjectStore])}I0(e=>({...e,get(n,t,r){return F0(n,t)?f6:e.get(n,t,r)},has(n,t){return F0(n,t)||e.has(n,t)}}));async function d6(e){try{const n=await o6("books",e);if(!n)throw new Error("failed to open db");Es.set(n)}catch({message:n}){throw new Error(`Error accessing books db - ${n}`)}}function h6(e){let n,t;return{c(){n=_e("div"),t=Nt(e[2])},m(r,i){de(r,n,i),oe(n,t)},p(r,i){i&4&&en(t,r[2])},d(r){r&&fe(n)}}}function p6(e){let n,t,r;return t=new At({props:{path:go}}),{c(){n=_e("div"),Te(t.$$.fragment),re(n,"slot","icon")},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p:gt,i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function m6(e){let n,t,r,i,s,o,a,l,c;return o=new $r({props:{$$slots:{icon:[p6],default:[h6]},$$scope:{ctx:e}}}),{c(){n=_e("label"),t=Nt(e[1]),r=me(),i=_e("input"),s=me(),Te(o.$$.fragment),re(n,"for",e[4]),re(i,"type","checkbox"),re(i,"id",e[4])},m(u,f){de(u,n,f),oe(n,t),de(u,r,f),de(u,i,f),i.checked=e[3],de(u,s,f),Ee(o,u,f),a=!0,l||(c=[qe(i,"change",e[6]),qe(i,"change",e[5])],l=!0)},p(u,[f]){(!a||f&2)&&en(t,u[1]),f&8&&(i.checked=u[3]);const m={};f&132&&(m.$$scope={dirty:f,ctx:u}),o.$set(m)},i(u){a||(te(o.$$.fragment,u),a=!0)},o(u){ue(o.$$.fragment,u),a=!1},d(u){u&&(fe(n),fe(r),fe(i),fe(s)),Se(o,u),l=!1,_n(c)}}}function _6(e,n,t){let r,i=gt,s=()=>(i(),i=Jr(o,m=>t(3,r=m)),o);e.$$.on_destroy.push(()=>i());let{targetStore$:o}=n;s();let{label:a}=n,{helpText:l}=n;const c=o.key();function u(m){cr.call(this,e,m)}function f(){r=this.checked,o.set(r)}return e.$$set=m=>{"targetStore$"in m&&s(t(0,o=m.targetStore$)),"label"in m&&t(1,a=m.label),"helpText"in m&&t(2,l=m.helpText)},[o,a,l,r,c,u,f]}class jn extends vn{constructor(n){super(),wn(this,n,_6,m6,pn,{targetStore$:0,label:1,helpText:2})}}function g6(e){let n,t;return{c(){n=_e("div"),t=Nt(e[2])},m(r,i){de(r,n,i),oe(n,t)},p(r,i){i&4&&en(t,r[2])},d(r){r&&fe(n)}}}function b6(e){let n,t,r;return t=new At({props:{path:go}}),{c(){n=_e("div"),Te(t.$$.fragment),re(n,"slot","icon")},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p:gt,i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function w6(e){let n,t,r,i,s,o,a,l,c,u;return a=new $r({props:{$$slots:{icon:[b6],default:[g6]},$$scope:{ctx:e}}}),{c(){n=_e("label"),t=Nt(e[1]),r=me(),i=_e("input"),o=me(),Te(a.$$.fragment),re(n,"for",e[10]),re(i,"type","number"),i.value=e[8],re(i,"id",e[10]),i.disabled=e[3],re(i,"min",e[4]),re(i,"max",e[5]),re(i,"step",e[6])},m(f,m){de(f,n,m),oe(n,t),de(f,r,m),de(f,i,m),de(f,o,m),Ee(a,f,m),l=!0,c||(u=[qe(i,"change",e[11]),qe(i,"blur",e[12]),Uo(s=Il.call(null,i,{document,isSkipped:e[9]}))],c=!0)},p(f,[m]){(!l||m&2)&&en(t,f[1]),(!l||m&256&&i.value!==f[8])&&(i.value=f[8]),(!l||m&8)&&(i.disabled=f[3]),(!l||m&16)&&re(i,"min",f[4]),(!l||m&32)&&re(i,"max",f[5]),(!l||m&64)&&re(i,"step",f[6]),s&&Vr(s.update)&&m&512&&s.update.call(null,{document,isSkipped:f[9]});const g={};m&8196&&(g.$$scope={dirty:m,ctx:f}),a.$set(g)},i(f){l||(te(a.$$.fragment,f),l=!0)},o(f){ue(a.$$.fragment,f),l=!1},d(f){f&&(fe(n),fe(r),fe(i),fe(o)),Se(a,f),c=!1,_n(u)}}}function v6(e,n,t){let r,i=gt,s=()=>(i(),i=Jr(a,v=>t(8,r=v)),a),o;we(e,dn,v=>t(9,o=v)),e.$$.on_destroy.push(()=>i());let{targetStore$:a}=n;s();let{label:l}=n,{helpText:c}=n,{disabled:u=void 0}=n,{min:f=void 0}=n,{max:m=void 0}=n,{step:g=100}=n,{blurHandler:_=void 0}=n;const E=a.key(),S=v=>{_||yc(v,a)},b=v=>{_&&_(v,a)};return e.$$set=v=>{"targetStore$"in v&&s(t(0,a=v.targetStore$)),"label"in v&&t(1,l=v.label),"helpText"in v&&t(2,c=v.helpText),"disabled"in v&&t(3,u=v.disabled),"min"in v&&t(4,f=v.min),"max"in v&&t(5,m=v.max),"step"in v&&t(6,g=v.step),"blurHandler"in v&&t(7,_=v.blurHandler)},[a,l,c,u,f,m,g,_,r,o,E,S,b]}class gr extends vn{constructor(n){super(),wn(this,n,v6,w6,pn,{targetStore$:0,label:1,helpText:2,disabled:3,min:4,max:5,step:6,blurHandler:7})}}function $0(e,n,t){const r=e.slice();return r[3]=n[t],r}function y6(e){let n;return{c(){n=Nt("Differences")},m(t,r){de(t,n,r)},d(t){t&&fe(n)}}}function V0(e,n){let t,r=n[3].id+"",i,s,o,a=n[3].original+"",l,c,u,f=n[3].adjusted+"",m;return{key:e,first:null,c(){t=_e("div"),i=Nt(r),s=me(),o=_e("div"),l=Nt(a),c=me(),u=_e("div"),m=Nt(f),this.first=t},m(g,_){de(g,t,_),oe(t,i),de(g,s,_),de(g,o,_),oe(o,l),de(g,c,_),de(g,u,_),oe(u,m)},p(g,_){n=g,_&1&&r!==(r=n[3].id+"")&&en(i,r),_&1&&a!==(a=n[3].original+"")&&en(l,a),_&1&&f!==(f=n[3].adjusted+"")&&en(m,f)},d(g){g&&(fe(t),fe(s),fe(o),fe(c),fe(u))}}}function E6(e){let n,t,r,i,s,o,a,l,c=[],u=new Map,f=xr(e[0]);const m=g=>g[3].id;for(let g=0;g<f.length;g+=1){let _=$0(e,f,g),E=m(_);u.set(E,c[g]=V0(E,_))}return{c(){n=_e("div"),t=_e("div"),r=_e("div"),r.textContent="Id",i=me(),s=_e("div"),s.textContent="Original",o=me(),a=_e("div"),a.textContent="Adjusted",l=me();for(let g=0;g<c.length;g+=1)c[g].c();re(t,"class","diff-grid"),re(n,"class","overflow-auto p-s")},m(g,_){de(g,n,_),oe(n,t),oe(t,r),oe(t,i),oe(t,s),oe(t,o),oe(t,a),oe(t,l);for(let E=0;E<c.length;E+=1)c[E]&&c[E].m(t,null)},p(g,_){_&1&&(f=xr(g[0]),c=ro(c,_,m,1,g,f,u,t,Xo,V0,null,$0))},d(g){g&&fe(n);for(let _=0;_<c.length;_+=1)c[_].d()}}}function S6(e){let n,t,r,i;return{c(){n=_e("div"),t=_e("button"),t.textContent="Close",re(n,"slot","footer")},m(s,o){de(s,n,o),oe(n,t),r||(i=qe(t,"click",e[2]),r=!0)},p:gt,d(s){s&&fe(n),r=!1,i()}}}function k6(e){let n,t;return n=new la({props:{$$slots:{footer:[S6],content:[E6],header:[y6]},$$scope:{ctx:e}}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},p(r,[i]){const s={};i&65&&(s.$$scope={dirty:i,ctx:r}),n.$set(s)},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function T6(e,n,t){let{diffDetails:r}=n;const i=ei(),s=()=>i("close");return e.$$set=o=>{"diffDetails"in o&&t(0,r=o.diffDetails)},[r,i,s]}class A6 extends vn{constructor(n){super(),wn(this,n,T6,k6,pn,{diffDetails:0})}}var qu={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.stringSimilarity=void 0;var n=function(t,r,i,s){if(i===void 0&&(i=2),s===void 0&&(s=!1),s||(t=t.toLowerCase(),r=r.toLowerCase()),t.length<i||r.length<i)return 0;for(var o=new Map,a=0;a<t.length-(i-1);a++){var l=t.substr(a,i);o.set(l,o.has(l)?o.get(l)+1:1)}for(var c=0,u=0;u<r.length-(i-1);u++){var f=r.substr(u,i),m=o.has(f)?o.get(f):0;m>0&&(o.set(f,m-1),c++)}return c*2/(t.length+r.length-(i-1)*2)};e.stringSimilarity=n,e.default=e.stringSimilarity})(qu);function x0(e,n,t){const r=e.slice();return r[12]=n[t],r}function H0(e,n){let t,r=n[12]+"",i,s,o;return{key:e,first:null,c(){t=_e("option"),i=Nt(r),s=me(),t.__value=o=n[12],_s(t,t.__value),this.first=t},m(a,l){de(a,t,l),oe(t,i),oe(t,s)},p(a,l){n=a,l&2&&r!==(r=n[12]+"")&&en(i,r),l&2&&o!==(o=n[12])&&(t.__value=o,_s(t,t.__value))},d(a){a&&fe(t)}}}function M6(e){let n;return{c(){n=_e("div")},m(t,r){de(t,n,r)},p:gt,i:gt,o:gt,d(t){t&&fe(n)}}}function C6(e){let n,t,r;return t=new At({props:{path:e[4]}}),t.$on("click",e[11]),{c(){n=_e("button"),Te(t.$$.fragment),re(n,"title",e[5])},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p(i,s){const o={};s&16&&(o.path=i[4]),t.$set(o),(!r||s&32)&&re(n,"title",i[5])},i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function R6(e){let n,t;return n=new $r({props:{$$slots:{icon:[P6],default:[L6]},$$scope:{ctx:e}}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},p(r,i){const s={};i&32776&&(s.$$scope={dirty:i,ctx:r}),n.$set(s)},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function L6(e){let n,t;return{c(){n=_e("div"),t=Nt(e[3])},m(r,i){de(r,n,i),oe(n,t)},p(r,i){i&8&&en(t,r[3])},d(r){r&&fe(n)}}}function P6(e){let n,t,r;return t=new At({props:{path:go}}),{c(){n=_e("div"),Te(t.$$.fragment),re(n,"slot","icon")},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p:gt,i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function B6(e){let n,t,r,i,s=[],o=new Map,a,l,c,u,f,m,g,_,E=xr(e[1]);const S=A=>A[12];for(let A=0;A<E.length;A+=1){let d=x0(e,E,A),p=S(d);o.set(p,s[A]=H0(p,d))}const b=[R6,C6,M6],v=[];function y(A,d){return A[3]?0:A[4]?1:2}return c=y(e),u=v[c]=b[c](e),{c(){n=_e("label"),t=Nt(e[2]),r=me(),i=_e("select");for(let A=0;A<s.length;A+=1)s[A].c();l=me(),u.c(),f=ur(),re(n,"for",e[8]),i.disabled=a=!e[1].length||e[6],re(i,"id",e[8]),e[7]===void 0&&Fi(()=>e[10].call(i))},m(A,d){de(A,n,d),oe(n,t),de(A,r,d),de(A,i,d);for(let p=0;p<s.length;p+=1)s[p]&&s[p].m(i,null);oc(i,e[7],!0),de(A,l,d),v[c].m(A,d),de(A,f,d),m=!0,g||(_=[qe(i,"change",e[10]),qe(i,"change",e[9])],g=!0)},p(A,[d]){(!m||d&4)&&en(t,A[2]),d&2&&(E=xr(A[1]),s=ro(s,d,S,1,A,E,o,i,Xo,H0,null,x0)),(!m||d&66&&a!==(a=!A[1].length||A[6]))&&(i.disabled=a),d&130&&oc(i,A[7]);let p=c;c=y(A),c===p?v[c].p(A,d):(rn(),ue(v[p],1,1,()=>{v[p]=null}),sn(),u=v[c],u?u.p(A,d):(u=v[c]=b[c](A),u.c()),te(u,1),u.m(f.parentNode,f))},i(A){m||(te(u),m=!0)},o(A){ue(u),m=!1},d(A){A&&(fe(n),fe(r),fe(i),fe(l),fe(f));for(let d=0;d<s.length;d+=1)s[d].d();v[c].d(A),g=!1,_n(_)}}}function I6(e,n,t){let r,i=gt,s=()=>(i(),i=Jr(o,b=>t(7,r=b)),o);e.$$.on_destroy.push(()=>i());let{targetStore$:o}=n;s();let{options:a}=n,{label:l}=n,{helpText:c=""}=n,{buttonIcon:u=""}=n,{buttonTitle:f=""}=n,{disabled:m=!1}=n;const g=o.key();function _(b){cr.call(this,e,b)}function E(){r=kh(this),o.set(r),t(1,a)}function S(b){cr.call(this,e,b)}return e.$$set=b=>{"targetStore$"in b&&s(t(0,o=b.targetStore$)),"options"in b&&t(1,a=b.options),"label"in b&&t(2,l=b.label),"helpText"in b&&t(3,c=b.helpText),"buttonIcon"in b&&t(4,u=b.buttonIcon),"buttonTitle"in b&&t(5,f=b.buttonTitle),"disabled"in b&&t(6,m=b.disabled)},[o,a,l,c,u,f,m,r,g,_,E,S]}class ar extends vn{constructor(n){super(),wn(this,n,I6,B6,pn,{targetStore$:0,options:1,label:2,helpText:3,buttonIcon:4,buttonTitle:5,disabled:6})}}function O6(e){let n;return{c(){n=_e("div"),n.textContent="Indicates # of lines which passed the similiarity check but are not equal to the book text"},m(t,r){de(t,n,r)},p:gt,d(t){t&&fe(n)}}}function D6(e){let n,t,r;return t=new At({props:{path:go}}),{c(){n=_e("div"),Te(t.$$.fragment),re(n,"slot","icon")},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p:gt,i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function U0(e){let n,t,r,i,s,o,a;return{c(){n=_e("button"),n.textContent="Show Diff",t=me(),r=_e("div"),i=me(),s=_e("div")},m(l,c){de(l,n,c),de(l,t,c),de(l,r,c),de(l,i,c),de(l,s,c),o||(a=qe(n,"click",e[23]),o=!0)},p:gt,d(l){l&&(fe(n),fe(t),fe(r),fe(i),fe(s)),o=!1,a()}}}function W0(e){let n,t,r,i,s;return{c(){n=_e("button"),t=Nt("Cancel"),re(n,"class","btn m-r-s"),n.disabled=r=e[1].aborted},m(o,a){de(o,n,a),oe(n,t),i||(s=qe(n,"click",e[18]),i=!0)},p(o,a){a[0]&2&&r!==(r=o[1].aborted)&&(n.disabled=r)},d(o){o&&fe(n),i=!1,s()}}}function j0(e){let n,t,r,i,s,o;return{c(){n=_e("button"),t=Nt("Save & reload page"),re(n,"class","btn m-r-s"),n.disabled=r=!!e[10],re(n,"title",i=e[10]?"Export in progress":null)},m(a,l){de(a,n,l),oe(n,t),s||(o=qe(n,"click",e[20]),s=!0)},p(a,l){l[0]&1024&&r!==(r=!!a[10])&&(n.disabled=r),l[0]&1024&&i!==(i=a[10]?"Export in progress":null)&&re(n,"title",i)},d(a){a&&fe(n),s=!1,o()}}}function G0(e){let n,t,r;return{c(){n=_e("button"),n.textContent="Download",re(n,"class","btn m-r-s")},m(i,s){de(i,n,s),t||(r=qe(n,"click",e[19]),t=!0)},p:gt,d(i){i&&fe(n),t=!1,r()}}}function N6(e){let n;return{c(){n=_e("div"),n.textContent=`By matching the subtitles to the book you can enable extra functionality like the reader menu, auto scroll
			etc.`},m(t,r){de(t,n,r)},p:gt,d(t){t&&fe(n)}}}function F6(e){let n,t,r;return t=new At({props:{path:Vc}}),{c(){n=_e("div"),Te(t.$$.fragment),re(n,"slot","icon")},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p:gt,i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function $6(e){let n,t,r,i,s,o=e[9].size+"",a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y,R,w,N,X,q,Z,ne,U,F,C,P,I,H,K,he,ee,ae,ge,Le,He,De;M=new $r({props:{$$slots:{icon:[D6],default:[O6]},$$scope:{ctx:e}}});let Ue=!e[3]&&e[8].length&&U0(e);O=new jn({props:{label:"Ignore rp elements",helpText:"If enabled the content of rp elements will be ignored for the similiarity check",targetStore$:e[11]}}),Y=new ar({props:{label:"Line space mode",helpText:e[7],targetStore$:e[12],options:e[16]}}),w=new gr({props:{label:"Line lookahead",helpText:`Determines the extra amount of characters added from 50% length of a subtitle line up to this value
		which is used for the similiarity check`,min:1,max:30,step:1,targetStore$:e[13]}}),X=new gr({props:{label:"Line similiarity %",helpText:"Determines the % threshold for which a book text line is considered a match (1 being identical)",min:.1,max:1,step:.1,targetStore$:e[14]}}),Z=new gr({props:{label:"Line match attempts",helpText:"Determines how many book text lines are tested before skipping the current subtitle line as unmatched",min:1,step:1,targetStore$:e[15]}});let be=e[3]&&W0(e),Re=e[0]&&!e[3]&&j0(e),Xe=e[6]&&!e[3]&&G0(e);return ee=new $r({props:{placement:"top",$$slots:{icon:[F6],default:[N6]},$$scope:{ctx:e}}}),ge=new Fu({props:{currentProgress:e[2],rounded:!0,margin:!0}}),{c(){n=_e("div"),t=_e("div"),r=_e("div"),r.textContent="Lines to match",i=me(),s=_e("div"),a=Nt(o),l=me(),c=_e("div"),u=me(),f=_e("div"),f.textContent="Line match rate",m=me(),g=_e("div"),_=Nt(e[4]),E=me(),S=_e("div"),b=me(),v=_e("div"),v.textContent="Book diff rate",y=me(),A=_e("div"),d=Nt(e[5]),p=me(),Te(M.$$.fragment),L=me(),Ue&&Ue.c(),D=me(),Te(O.$$.fragment),x=me(),Te(Y.$$.fragment),R=me(),Te(w.$$.fragment),N=me(),Te(X.$$.fragment),q=me(),Te(Z.$$.fragment),ne=me(),U=_e("div"),be&&be.c(),F=me(),Re&&Re.c(),C=me(),Xe&&Xe.c(),P=me(),I=_e("button"),H=Nt("Parse"),he=me(),Te(ee.$$.fragment),ae=me(),Te(ge.$$.fragment),re(t,"class","settings-grid"),re(n,"class","flex-1"),re(I,"class","btn m-r-s"),I.disabled=K=e[3]>0,re(U,"class","flex justify-end match-btns")},m(Ne,B){de(Ne,n,B),oe(n,t),oe(t,r),oe(t,i),oe(t,s),oe(s,a),oe(t,l),oe(t,c),oe(t,u),oe(t,f),oe(t,m),oe(t,g),oe(g,_),oe(t,E),oe(t,S),oe(t,b),oe(t,v),oe(t,y),oe(t,A),oe(A,d),oe(t,p),Ee(M,t,null),oe(t,L),Ue&&Ue.m(t,null),oe(t,D),Ee(O,t,null),oe(t,x),Ee(Y,t,null),oe(t,R),Ee(w,t,null),oe(t,N),Ee(X,t,null),oe(t,q),Ee(Z,t,null),de(Ne,ne,B),de(Ne,U,B),be&&be.m(U,null),oe(U,F),Re&&Re.m(U,null),oe(U,C),Xe&&Xe.m(U,null),oe(U,P),oe(U,I),oe(I,H),oe(U,he),Ee(ee,U,null),de(Ne,ae,B),Ee(ge,Ne,B),Le=!0,He||(De=qe(I,"click",e[17]),He=!0)},p(Ne,B){(!Le||B[0]&512)&&o!==(o=Ne[9].size+"")&&en(a,o),(!Le||B[0]&16)&&en(_,Ne[4]),(!Le||B[0]&32)&&en(d,Ne[5]);const V={};B[1]&256&&(V.$$scope={dirty:B,ctx:Ne}),M.$set(V),!Ne[3]&&Ne[8].length?Ue?Ue.p(Ne,B):(Ue=U0(Ne),Ue.c(),Ue.m(t,D)):Ue&&(Ue.d(1),Ue=null);const ye={};B[0]&128&&(ye.helpText=Ne[7]),Y.$set(ye),Ne[3]?be?be.p(Ne,B):(be=W0(Ne),be.c(),be.m(U,F)):be&&(be.d(1),be=null),Ne[0]&&!Ne[3]?Re?Re.p(Ne,B):(Re=j0(Ne),Re.c(),Re.m(U,C)):Re&&(Re.d(1),Re=null),Ne[6]&&!Ne[3]?Xe?Xe.p(Ne,B):(Xe=G0(Ne),Xe.c(),Xe.m(U,P)):Xe&&(Xe.d(1),Xe=null),(!Le||B[0]&8&&K!==(K=Ne[3]>0))&&(I.disabled=K);const Ae={};B[1]&256&&(Ae.$$scope={dirty:B,ctx:Ne}),ee.$set(Ae);const Ke={};B[0]&4&&(Ke.currentProgress=Ne[2]),ge.$set(Ke)},i(Ne){Le||(te(M.$$.fragment,Ne),te(O.$$.fragment,Ne),te(Y.$$.fragment,Ne),te(w.$$.fragment,Ne),te(X.$$.fragment,Ne),te(Z.$$.fragment,Ne),te(ee.$$.fragment,Ne),te(ge.$$.fragment,Ne),Le=!0)},o(Ne){ue(M.$$.fragment,Ne),ue(O.$$.fragment,Ne),ue(Y.$$.fragment,Ne),ue(w.$$.fragment,Ne),ue(X.$$.fragment,Ne),ue(Z.$$.fragment,Ne),ue(ee.$$.fragment,Ne),ue(ge.$$.fragment,Ne),Le=!1},d(Ne){Ne&&(fe(n),fe(ne),fe(U),fe(ae)),Se(M),Ue&&Ue.d(),Se(O),Se(Y),Se(w),Se(X),Se(Z),be&&be.d(),Re&&Re.d(),Xe&&Xe.d(),Se(ee),Se(ge,Ne),He=!1,De()}}}function V6(e,n,t){let r,i,s,o,a,l,c,u,f,m,g,_,E;we(e,Et,K=>t(27,s=K)),we(e,kt,K=>t(28,o=K)),we(e,Es,K=>t(29,a=K)),we(e,Pr,K=>t(30,l=K)),we(e,ni,K=>t(31,c=K)),we(e,Xn,K=>t(9,g=K)),we(e,jr,K=>t(10,E=K));const S=new Set(["rt"]),{matchLineIgnoreRp$:b,matchLineSpaceMode$:v,matchLineLookAhead$:y,matchLineSimilarityThreshold$:A,matchLineMaxAttempts$:d}=St;we(e,b,K=>t(22,_=K)),we(e,v,K=>t(21,i=K)),we(e,y,K=>t(32,u=K)),we(e,A,K=>t(33,f=K)),we(e,d,K=>t(34,m=K));const{isIOS:p}=Ni("context"),M=[ti.ORIGINAL,ti.LEADING_TRAILING,ti.ALL];let L,D=new AbortController,O=D.signal,x=0,Y=0,R="n/a",w="n/a",N=0,X="",q=[],Z=[];async function ne(){pe(Et,s=!0,s),t(4,R="n/a"),t(5,w="n/a"),t(6,N=0),q=[],t(8,Z=[]),t(3,Y=g.size);try{const K=[],he=[...g.values()],ee=Math.min(he.length,m);let ae=[],ge="",Le="",He=0,De=he[He].text,Ue=[...De].length,be=Ue+Math.ceil(Math.min(u,Ue/2));t(0,L=sa(new DOMParser,l.elementHtml));const Re=document.createTreeWalker(L,NodeFilter.SHOW_TEXT,{acceptNode(Ae){return(Ae.textContent||"").replace(/\s/g,"").trim()&&K.push(Ae),NodeFilter.FILTER_ACCEPT}});for(;Re.nextNode(););let Xe=K.length,Ne=0,B=0,V=0,ye=1;for(;Ne<Xe;){aa(O);const Ae=mo(He+1,Y);let Ke=K[Ne],et=Ke.parentElement,Je=et.tagName.toLowerCase();if(Ae!==x&&(t(2,x=Ae),await new Promise(ut=>setTimeout(ut))),r.has(Je)||(ge+=P(Ke.textContent)),[...ge].length>=Ue){const ut=ge.slice(0,be),nt=[...ut].length,Ye=I(De),W=I(ut),k=Ye===W?1:qu.stringSimilarity(Ye,W);for(ae.push(Ke),Ne+=1;r.has(Je)&&Ne<Xe;)Ke=K[Ne],et=Ke.parentElement,Je=et.tagName.toLowerCase(),r.has(Je)&&ae.push(Ke),Ne+=1;if(Ne-=1,k>f){let h=nt,T=k;if(T!==1)for(let le=nt-1;le>0;le-=1){const ve=ut.slice(0,le),ke=I(ve),Pe=Ye===ke?1:qu.stringSimilarity(Ye,ke);Pe>T&&(h=le,T=Pe)}let $=h,j=0,J=!1;for(let le=0,{length:ve}=ae;le<ve;le+=1){const ke=ae[le],Pe=ke.parentElement,Ze=Pe.tagName.toLowerCase(),ft=P(ke.textContent),$e=[...ft].length,dt=document.createElement("span"),Be=ft.slice(0,$),Qe=document.createTextNode(Be),wt=[...Be].length,We=$e-wt;if($){const at=he[He];dt.classList.add(ap(at.id)),dt.appendChild(Qe),Pe.replaceChild(dt,ke),ia.has(Ze)||(Le+=Be)}if(j+=r.has(Ze)?0:wt,$=h-j,!$&&We){const at=[];le+=wt?0:1;let je=wt;for(;le<ve;){const _t=ae[le],Bt=P(_t.textContent),ot=Bt.slice(je),ht=document.createTextNode(ot);if(!Bt)throw new Error("charactersToProcess without remaining text found");Pe.appendChild(ht),at.push(ht),le+=1,je=0}at.length&&K.splice(Ne,at.length,...at),J=!0}}const Q=he[He],ce=De.replace(/\s/g,"").trim().toLowerCase(),ie=Le.replace(/\s/g,"").trim().toLowerCase();q.push({...Q}),ce!==ie&&(q[q.length-1].text=Le.trim(),t(6,N+=1),Z.push({id:Q.id,original:De,adjusted:Le})),ge="",Le="",J||(Ne+=1),B=Ne,He+=1,V+=1,ye=1,He<he.length&&(De=he[He].text,Ue=[...De].length,be=Ue+Math.ceil(Math.min(u,Ue/2)))}else{ye+=1,Ne+=1,ge="",Le="";const h=Ne>K.length,T=ye>ee;(T||h)&&(ye=1,He+=1,console.log(T?`max match attempts for ${De} reached - reset`:"End of Text before max attempt reached - reset"),He<he.length?(Ne=B,De=he[He].text,Ue=[...De].length,be=Ue+Math.ceil(Math.min(16,Ue/2))):Ne=Xe)}ae=[]}else ae.push(Ke),Ne+=1;Xe=K.length}t(4,R=`${V} / ${he.length} (${mo(V,he.length,!1)}%)`),t(5,w=`${N} / ${q.length} (${q.length?mo(N,q.length,!1):0}%)`),L.firstElementChild instanceof HTMLElement&&(t(0,L.firstElementChild.dataset.ttuWhispersyncMatchedBy=c.name,L),t(0,L.firstElementChild.dataset.ttuWhispersyncMatchedOn=`${Date.now()}`,L))}catch(K){t(4,R="n/a"),t(5,w="n/a"),t(6,N=0),t(0,L=void 0),q=[],t(8,Z=[]),!D.signal.aborted&&K.name!=="AbortError"&&pe(kt,o=`Failed to match: ${K.message}`,o)}t(2,x=0),t(3,Y=0),D=new AbortController,t(1,O=D.signal),pe(Et,s=!1,s)}function U(){O.aborted||D.abort("user aborted")}function F(){pe(Et,s=!0,s),pe(kt,o="",o);let K="";for(let he=0,{length:ee}=q;he<ee;he+=1){const ae=q[he];K+=`${ae.id}
${ae.startTime} --> ${ae.endTime}
${ae.text}

`}ml(document,new Blob([K],{type:`${p?"text/plain":"application/x-subrip"};charset=utf-8`}),`${c.name.split(/\.(?=[^\.]+$)/)[0]}_adjusted.srt`,p),pe(Et,s=!1,s)}async function C(){pe(Et,s=!0,s);try{const K={...l,htmlBackup:l.elementHtml,elementHtml:L.innerHTML,lastBookModified:Date.now()};await a.put("data",K),window.location.reload()}catch({message:K}){pe(kt,o=`Failed to save data: ${K}`,o),pe(Et,s=!1,s)}}function P(K){return K?i===ti.ORIGINAL?K:K.trim():""}function I(K){return i===ti.ORIGINAL?K:i===ti.LEADING_TRAILING?K.trim():K.replace(/\s/g,"").trim()}const H=()=>io.add({component:A6,props:{diffDetails:Z}});return e.$$.update=()=>{e.$$.dirty[0]&4194304&&(r=_?ia:S),e.$$.dirty[0]&2097152&&(i===ti.ORIGINAL?t(7,X="Lines and book text will be compared as is"):t(7,X=i===ti.LEADING_TRAILING?"Leading and trailing whitespace of lines and book text will be ignored for the comparison":"All whitespaces of lines and book text will be ignored for the comparison"))},[L,O,x,Y,R,w,N,X,Z,g,E,b,v,y,A,d,M,ne,U,F,C,i,_,H]}class x6 extends vn{constructor(n){super(),wn(this,n,V6,$6,pn,{},null,[-1,-1])}}function H6(e){let n,t,r,i,s,o,a,l,c,u,f,m;return r=new At({props:{path:$c}}),o=new At({props:{path:e[4]?Ps:ji}}),c=new f0({props:{isReaderMenu:!0,subtitle:e[1]}}),{c(){n=_e("div"),t=_e("button"),Te(r.$$.fragment),i=me(),s=_e("button"),Te(o.$$.fragment),l=me(),Te(c.$$.fragment),re(t,"title","Close menu"),lt(t,"m-y-xs",e[5]),lt(t,"m-x-xs",!e[5]),re(s,"title",e[3]),s.disabled=a=e[3]!=="Toggle playback",lt(s,"m-y-xs",e[5]),lt(s,"m-x-xs",!e[5]),re(n,"class","ttu-whispersync-container popover flex"),lt(n,"flex-col",e[5]),lt(n,"hidden",!e[0])},m(g,_){de(g,n,_),oe(n,t),Ee(r,t,null),oe(n,i),oe(n,s),Ee(o,s,null),oe(n,l),Ee(c,n,null),e[13](n),u=!0,f||(m=[qe(t,"click",e[11]),qe(s,"click",e[12])],f=!0)},p(g,[_]){const E={};_&16&&(E.path=g[4]?Ps:ji),o.$set(E),(!u||_&8)&&re(s,"title",g[3]),(!u||_&8&&a!==(a=g[3]!=="Toggle playback"))&&(s.disabled=a);const S={};_&2&&(S.subtitle=g[1]),c.$set(S),(!u||_&1)&&lt(n,"hidden",!g[0])},i(g){u||(te(r.$$.fragment,g),te(o.$$.fragment,g),te(c.$$.fragment,g),u=!0)},o(g){ue(r.$$.fragment,g),ue(o.$$.fragment,g),ue(c.$$.fragment,g),u=!1},d(g){g&&fe(n),Se(r),Se(o),Se(c),e[13](null),f=!1,_n(m)}}}function U6(e,n,t){let r,i,s,o;we(e,ki,O=>t(8,r=O)),we(e,Si,O=>t(9,i=O)),we(e,Xn,O=>t(10,s=O)),we(e,gn,O=>t(4,o=O));let{range:a}=n,{subtitle:l}=n;function c(O){return!O||!b?!1:b.contains(O)}const{bookContentElement:u,isVertical:f,isPaginated:m}=Ni("context"),g=f?"left-start":"top-start",_=f?["right-start","left-end","right-end"]:["bottom-start","top-end","bottom-end"],E=ei();let S,b,v,y="";Go(()=>S==null?void 0:S());async function A(O){S==null||S(),O&&(await qn(),S=t0(O,b,d))}function d(){a&&r0({getBoundingClientRect:()=>a.getBoundingClientRect(),getClientRects:()=>{if(!m)return a.getClientRects();const O=p(),x=[...a.getClientRects()],Y=x.filter(w=>w.bottom>O.top&&w.right>O.left&&w.top<O.bottom&&w.left<O.right),R=(Y.length?Y:x).filter(w=>{var X;return!((X=document.elementFromPoint(w.x,w.y))==null?void 0:X.closest("rt"))});return R.length?R:x}},b,{placement:g,middleware:[Wd(5),W4(),n0({fallbackPlacements:_})]}).then(({x:O,y:x})=>{t(2,b.style.left=`${O}px`,b),t(2,b.style.top=`${x}px`,b)}).catch(()=>{})}function p(){v||(v=window.getComputedStyle(u));const O=u.getBoundingClientRect(),x=f?O.top:O.top+Number.parseFloat(v.paddingTop.replace("px","")),Y=f?O.right-Number.parseFloat(v.paddingRight.replace("px","")):O.right,R=f?O.bottom:O.bottom-Number.parseFloat(v.paddingBottom.replace("px","")),w=f?O.left+Number.parseFloat(v.paddingLeft.replace("px","")):O.left;return{top:x,right:Y,left:w,bottom:R}}const M=()=>E("close"),L=()=>pe(gn,o=!o,o);function D(O){Gt[O?"unshift":"push"](()=>{b=O,t(2,b)})}return e.$$set=O=>{"range"in O&&t(0,a=O.range),"subtitle"in O&&t(1,l=O.subtitle)},e.$$.update=()=>{e.$$.dirty&1794&&(l?i?r?t(3,y="Recording in progress"):t(3,y="Toggle playback"):t(3,y="Audio file required"):t(3,y=s.size?"No matching subtitle":"Subtitle file required")),e.$$.dirty&1&&A(a)},[a,l,b,y,o,f,E,c,r,i,s,M,L,D]}class W6 extends vn{constructor(n){super(),wn(this,n,U6,H6,pn,{range:0,subtitle:1,isInReaderMenu:7})}get isInReaderMenu(){return this.$$.ctx[7]}}function j6(e){let n,t,r,i,s,o,a,l,c,u;return a=new At({props:{path:Uc}}),{c(){n=_e("label"),t=Nt(e[1]),r=me(),i=_e("input"),s=me(),o=_e("button"),Te(a.$$.fragment),re(n,"for",e[3]),re(i,"type","color"),re(i,"id",e[3]),re(o,"title","Reset Color")},m(f,m){de(f,n,m),oe(n,t),de(f,r,m),de(f,i,m),_s(i,e[2]),de(f,s,m),de(f,o,m),Ee(a,o,null),l=!0,c||(u=[qe(i,"input",e[6]),qe(i,"change",e[5]),qe(o,"click",e[7])],c=!0)},p(f,[m]){(!l||m&2)&&en(t,f[1]),m&4&&_s(i,f[2])},i(f){l||(te(a.$$.fragment,f),l=!0)},o(f){ue(a.$$.fragment,f),l=!1},d(f){f&&(fe(n),fe(r),fe(i),fe(s),fe(o)),Se(a),c=!1,_n(u)}}}function G6(e,n,t){let r,i=gt,s=()=>(i(),i=Jr(o,g=>t(2,r=g)),o);e.$$.on_destroy.push(()=>i());let{targetStore$:o}=n;s();let{label:a}=n;const l=o.key(),c=ei();function u(g){cr.call(this,e,g)}function f(){r=this.value,o.set(r)}const m=()=>{o.set(Zo(l)),c("reset")};return e.$$set=g=>{"targetStore$"in g&&s(t(0,o=g.targetStore$)),"label"in g&&t(1,a=g.label)},[o,a,r,l,c,u,f,m]}class z0 extends vn{constructor(n){super(),wn(this,n,G6,j6,pn,{targetStore$:0,label:1})}}function z6(e){let n,t,r,i,s,o=e[2]?" for active subtitle":"",a,l,c;return{c(){n=_e("div"),t=Nt(e[0]),r=me(),i=_e("div"),s=Nt(e[1]),a=Nt(o),l=me(),c=_e("div")},m(u,f){de(u,n,f),oe(n,t),de(u,r,f),de(u,i,f),oe(i,s),oe(i,a),de(u,l,f),de(u,c,f)},p(u,[f]){f&1&&en(t,u[0]),f&2&&en(s,u[1]),f&4&&o!==(o=u[2]?" for active subtitle":"")&&en(a,o)},i:gt,o:gt,d(u){u&&(fe(n),fe(r),fe(i),fe(l),fe(c))}}}function X6(e,n,t){let{key:r}=n,{description:i}=n,{extendDescription:s=!0}=n;return e.$$set=o=>{"key"in o&&t(0,r=o.key),"description"in o&&t(1,i=o.description),"extendDescription"in o&&t(2,s=o.extendDescription)},[r,i,s]}class br extends vn{constructor(n){super(),wn(this,n,X6,z6,pn,{key:0,description:1,extendDescription:2})}}function Y6(e){let n,t,r,i,s,o,a,l;const c=e[5].default,u=ds(c,e,e[4],null);return{c(){n=_e("details"),t=_e("summary"),r=Nt(e[0]),i=me(),s=_e("div"),u&&u.c(),re(s,"class","settings-grid"),n.open=e[1]},m(f,m){de(f,n,m),oe(n,t),oe(t,r),oe(n,i),oe(n,s),u&&u.m(s,null),o=!0,a||(l=qe(t,"click",Js(Wo(e[2]))),a=!0)},p(f,[m]){(!o||m&1)&&en(r,f[0]),u&&u.p&&(!o||m&16)&&ps(u,c,f,f[4],o?hs(c,f[4],m,null):ms(f[4]),null),(!o||m&2)&&(n.open=f[1])},i(f){o||(te(u,f),o=!0)},o(f){ue(u,f),o=!1},d(f){f&&fe(n),u&&u.d(f),a=!1,l()}}}function q6(e,n,t){let r,{$$slots:i={},$$scope:s}=n,{openSettingsMenu:o}=n,{settingsMenu:a}=n;function l(){t(3,o=r?Ur.NONE:a)}return e.$$set=c=>{"openSettingsMenu"in c&&t(3,o=c.openSettingsMenu),"settingsMenu"in c&&t(0,a=c.settingsMenu),"$$scope"in c&&t(4,s=c.$$scope)},e.$$.update=()=>{e.$$.dirty&9&&t(1,r=o===a)},[a,r,l,o,s,i]}class Zs extends vn{constructor(n){super(),wn(this,n,q6,Y6,pn,{openSettingsMenu:3,settingsMenu:0})}}function Z6(e){let n;return{c(){n=_e("div")},m(t,r){de(t,n,r)},p:gt,i:gt,o:gt,d(t){t&&fe(n)}}}function K6(e){let n,t,r;return t=new At({props:{path:e[3]}}),t.$on("click",e[10]),{c(){n=_e("button"),Te(t.$$.fragment),re(n,"title",e[4])},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p(i,s){const o={};s&8&&(o.path=i[3]),t.$set(o),(!r||s&16)&&re(n,"title",i[4])},i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function Q6(e){let n,t;return n=new $r({props:{$$slots:{icon:[e8],default:[J6]},$$scope:{ctx:e}}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},p(r,i){const s={};i&2052&&(s.$$scope={dirty:i,ctx:r}),n.$set(s)},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function J6(e){let n,t;return{c(){n=_e("div"),t=Nt(e[2])},m(r,i){de(r,n,i),oe(n,t)},p(r,i){i&4&&en(t,r[2])},d(r){r&&fe(n)}}}function e8(e){let n,t,r;return t=new At({props:{path:go}}),{c(){n=_e("div"),Te(t.$$.fragment),re(n,"slot","icon")},m(i,s){de(i,n,s),Ee(t,n,null),r=!0},p:gt,i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){ue(t.$$.fragment,i),r=!1},d(i){i&&fe(n),Se(t)}}}function t8(e){let n,t,r,i,s,o,a,l,c,u,f,m;const g=[Q6,K6,Z6],_=[];function E(S,b){return S[2]?0:S[3]?1:2}return a=E(e),l=_[a]=g[a](e),{c(){n=_e("label"),t=Nt(e[1]),r=me(),i=_e("input"),o=me(),l.c(),c=ur(),re(n,"for",e[7]),i.value=e[5],re(i,"id",e[7])},m(S,b){de(S,n,b),oe(n,t),de(S,r,b),de(S,i,b),de(S,o,b),_[a].m(S,b),de(S,c,b),u=!0,f||(m=[qe(i,"blur",e[8]),qe(i,"change",e[9]),Uo(s=Il.call(null,i,{document,isSkipped:e[6]}))],f=!0)},p(S,[b]){(!u||b&2)&&en(t,S[1]),(!u||b&32&&i.value!==S[5])&&(i.value=S[5]),s&&Vr(s.update)&&b&64&&s.update.call(null,{document,isSkipped:S[6]});let v=a;a=E(S),a===v?_[a].p(S,b):(rn(),ue(_[v],1,1,()=>{_[v]=null}),sn(),l=_[a],l?l.p(S,b):(l=_[a]=g[a](S),l.c()),te(l,1),l.m(c.parentNode,c))},i(S){u||(te(l),u=!0)},o(S){ue(l),u=!1},d(S){S&&(fe(n),fe(r),fe(i),fe(o),fe(c)),_[a].d(S),f=!1,_n(m)}}}function n8(e,n,t){let r,i=gt,s=()=>(i(),i=Jr(a,S=>t(5,r=S)),a),o;we(e,dn,S=>t(6,o=S)),e.$$.on_destroy.push(()=>i());let{targetStore$:a}=n;s();let{label:l}=n,{helpText:c=""}=n,{buttonIcon:u=""}=n,{buttonTitle:f=""}=n;const m=a.key();function g(S){cr.call(this,e,S)}const _=S=>up(S,a);function E(S){cr.call(this,e,S)}return e.$$set=S=>{"targetStore$"in S&&s(t(0,a=S.targetStore$)),"label"in S&&t(1,l=S.label),"helpText"in S&&t(2,c=S.helpText),"buttonIcon"in S&&t(3,u=S.buttonIcon),"buttonTitle"in S&&t(4,f=S.buttonTitle)},[a,l,c,u,f,r,o,m,g,_,E]}class Qa extends vn{constructor(n){super(),wn(this,n,n8,t8,pn,{targetStore$:0,label:1,helpText:2,buttonIcon:3,buttonTitle:4})}}function r8(e){let n,t;return n=new jn({props:{label:"Enable auto reload",helpText:"If enabled the reader will attempt to reload last used files from filesystem automatically without the need for opening the side menu",targetStore$:St.readerEnableAutoReload$}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function X0(e){let n,t;return n=new jn({props:{label:"Enable tracker pause",helpText:"If enabled user triggered changes to the playback position (e. g. click action, player controls etc.) will auto pause and unpause the reading tracker",targetStore$:St.readerEnableTrackerAutoPause$}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function Y0(e){let n,t;return n=new jn({props:{label:"Prevent action on selection",helpText:"If enabled click/hold will not execute any action / open the reader menu in case any text is selected",targetStore$:St.readerPreventActionOnSelection$}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function q0(e){let n,t;return n=new ar({props:{label:"Click Action",helpText:"Determines the action executed when clicking on book text - requires matched book/line and subtitle/audio file",targetStore$:St.readerClickAction$,options:e[28]}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},p:gt,i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function Z0(e){let n,t;return n=new ar({props:{label:"Menu pause",helpText:"Determines if playback is automatilcally paused when opening the reader menu or not",targetStore$:St.readerMenuPauseMode$,options:e[30]}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},p:gt,i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function K0(e){let n,t;return n=new gr({props:{label:"Menu open time",helpText:"# of ms to hold down on book text to open the reader menu - requires matched book/line. If released earlier the configured click action is executed instead",targetStore$:St.readerMenuOpenTime$,min:100}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function i8(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b;n=new z0({props:{label:"Line highlight",targetStore$:e[36]}}),n.$on("change",e[65]),n.$on("reset",e[65]),r=new z0({props:{label:"Line text color",targetStore$:e[37]}}),r.$on("change",e[65]),r.$on("reset",e[65]),s=new jn({props:{label:"Enable line highlight",helpText:"If enabled active subtitles will be highlighted in the reader - requires matched book/line and subtitle/audio file",targetStore$:e[38]}});let v=e[27]&&r8();l=new jn({props:{label:"Enable auto scroll",helpText:"If enabled the reader will automatically scroll to active subtitles - requires matched book/line and subtitle/audio file",targetStore$:e[39]}});let y=e[11]&&X0(),A=(e[12]!==ct.NONE||e[13]!==rr.DISABLED)&&Y0(),d=e[13]!==rr.CLICK&&q0(e);g=new ar({props:{label:"Menu mode",helpText:"Determines the action for opening the reader menu - requires matched book/line",targetStore$:e[41],options:e[29]}});let p=e[13]!==rr.DISABLED&&Z0(e),M=e[13]===rr.HOLD&&K0();return{c(){Te(n.$$.fragment),t=me(),Te(r.$$.fragment),i=me(),Te(s.$$.fragment),o=me(),v&&v.c(),a=me(),Te(l.$$.fragment),c=me(),y&&y.c(),u=me(),A&&A.c(),f=me(),d&&d.c(),m=me(),Te(g.$$.fragment),_=me(),p&&p.c(),E=me(),M&&M.c(),S=ur()},m(L,D){Ee(n,L,D),de(L,t,D),Ee(r,L,D),de(L,i,D),Ee(s,L,D),de(L,o,D),v&&v.m(L,D),de(L,a,D),Ee(l,L,D),de(L,c,D),y&&y.m(L,D),de(L,u,D),A&&A.m(L,D),de(L,f,D),d&&d.m(L,D),de(L,m,D),Ee(g,L,D),de(L,_,D),p&&p.m(L,D),de(L,E,D),M&&M.m(L,D),de(L,S,D),b=!0},p(L,D){L[11]?y?D[0]&2048&&te(y,1):(y=X0(),y.c(),te(y,1),y.m(u.parentNode,u)):y&&(rn(),ue(y,1,1,()=>{y=null}),sn()),L[12]!==ct.NONE||L[13]!==rr.DISABLED?A?D[0]&12288&&te(A,1):(A=Y0(),A.c(),te(A,1),A.m(f.parentNode,f)):A&&(rn(),ue(A,1,1,()=>{A=null}),sn()),L[13]!==rr.CLICK?d?(d.p(L,D),D[0]&8192&&te(d,1)):(d=q0(L),d.c(),te(d,1),d.m(m.parentNode,m)):d&&(rn(),ue(d,1,1,()=>{d=null}),sn()),L[13]!==rr.DISABLED?p?(p.p(L,D),D[0]&8192&&te(p,1)):(p=Z0(L),p.c(),te(p,1),p.m(E.parentNode,E)):p&&(rn(),ue(p,1,1,()=>{p=null}),sn()),L[13]===rr.HOLD?M?D[0]&8192&&te(M,1):(M=K0(),M.c(),te(M,1),M.m(S.parentNode,S)):M&&(rn(),ue(M,1,1,()=>{M=null}),sn())},i(L){b||(te(n.$$.fragment,L),te(r.$$.fragment,L),te(s.$$.fragment,L),te(v),te(l.$$.fragment,L),te(y),te(A),te(d),te(g.$$.fragment,L),te(p),te(M),b=!0)},o(L){ue(n.$$.fragment,L),ue(r.$$.fragment,L),ue(s.$$.fragment,L),ue(v),ue(l.$$.fragment,L),ue(y),ue(A),ue(d),ue(g.$$.fragment,L),ue(p),ue(M),b=!1},d(L){L&&(fe(t),fe(i),fe(o),fe(a),fe(c),fe(u),fe(f),fe(m),fe(_),fe(E),fe(S)),Se(n,L),Se(r,L),Se(s,L),v&&v.d(L),Se(l,L),y&&y.d(L),A&&A.d(L),d&&d.d(L),Se(g,L),p&&p.d(L),M&&M.d(L)}}}function Q0(e){let n,t;return n=new jn({props:{label:"Prevent action on selection",helpText:"If enabled click/hold will not execute any action / open the subtitle action list in case any text is selected",targetStore$:St.subtitlePreventActionOnSelection$}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function J0(e){let n,t;return n=new gr({props:{label:"Visibility toggle time",helpText:"# of ms to hold down to toggle the action list. If released earlier the configured click action is executed instead",targetStore$:St.subtitlesActionsVisibilityTime$,min:100}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function eh(e){let n,t;return n=new Qa({props:{label:"Font",helpText:"Font name to use for the subtitle list - needs to be installed on the device or via reader",targetStore$:St.subtitlesFontFamily$}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function th(e){let n,t;return n=new gr({props:{label:"Font size",helpText:"Font size to use for the subtitle list",targetStore$:St.subtitlesFontSize$,min:1,step:1}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function nh(e){let n,t;return n=new gr({props:{label:"Line height",helpText:"Line height to use for the subtitle list",targetStore$:St.subtitlesLineHeight$,min:1,step:.05}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function s8(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L;n=new jn({props:{label:"Persist subtitles",helpText:"If enabled loading subtitles or changes to them will be stored locally in your browser and can be used as data fallback/source. May takes more storage quota and increased update times",targetStore$:e[42]}}),n.$on("change",e[66]),r=new jn({props:{label:"Enable auto scroll",helpText:"If enabled the subtitle list will automatically scroll to active subtitles",targetStore$:St.subtitlesEnableAutoScroll$}}),s=new jn({props:{label:"Copy font",helpText:"If enabled the configured font of the reader is used for the subtitle list",targetStore$:e[43]}}),a=new jn({props:{label:"Copy font size",helpText:"If enabled the configured font size of the reader is used for the subtitle list",targetStore$:e[44]}}),c=new jn({props:{label:"Copy line height",helpText:"If enabled the configured line height of the reader is used for the subtitle list",targetStore$:e[45]}});let D=(e[14]!==ct.NONE||e[15]===Qn.TOGGLE)&&Q0();m=new ar({props:{label:"Click Action",helpText:"Determines the action executed when clicking on a subtitle",targetStore$:e[46],options:e[28]}}),_=new ar({props:{label:"Actions visibility",helpText:"Determines the conditions for showing actions in the subtitle list",targetStore$:e[47],options:e[31]}});let O=e[15]===Qn.TOGGLE&&J0();b=new gr({props:{label:"Global start padding",helpText:"# of ms by which all subtitle start times are shifted",disabled:!!e[16],targetStore$:e[48],blurHandler:e[67]}}),y=new gr({props:{label:"Global end padding",helpText:"# of ms by which all subtitle end times are shifted",disabled:!!e[16],targetStore$:e[49],blurHandler:e[67]}});let x=!e[17]&&eh(),Y=!e[18]&&th(),R=!e[19]&&nh();return{c(){Te(n.$$.fragment),t=me(),Te(r.$$.fragment),i=me(),Te(s.$$.fragment),o=me(),Te(a.$$.fragment),l=me(),Te(c.$$.fragment),u=me(),D&&D.c(),f=me(),Te(m.$$.fragment),g=me(),Te(_.$$.fragment),E=me(),O&&O.c(),S=me(),Te(b.$$.fragment),v=me(),Te(y.$$.fragment),A=me(),x&&x.c(),d=me(),Y&&Y.c(),p=me(),R&&R.c(),M=ur()},m(w,N){Ee(n,w,N),de(w,t,N),Ee(r,w,N),de(w,i,N),Ee(s,w,N),de(w,o,N),Ee(a,w,N),de(w,l,N),Ee(c,w,N),de(w,u,N),D&&D.m(w,N),de(w,f,N),Ee(m,w,N),de(w,g,N),Ee(_,w,N),de(w,E,N),O&&O.m(w,N),de(w,S,N),Ee(b,w,N),de(w,v,N),Ee(y,w,N),de(w,A,N),x&&x.m(w,N),de(w,d,N),Y&&Y.m(w,N),de(w,p,N),R&&R.m(w,N),de(w,M,N),L=!0},p(w,N){w[14]!==ct.NONE||w[15]===Qn.TOGGLE?D?N[0]&49152&&te(D,1):(D=Q0(),D.c(),te(D,1),D.m(f.parentNode,f)):D&&(rn(),ue(D,1,1,()=>{D=null}),sn()),w[15]===Qn.TOGGLE?O?N[0]&32768&&te(O,1):(O=J0(),O.c(),te(O,1),O.m(S.parentNode,S)):O&&(rn(),ue(O,1,1,()=>{O=null}),sn());const X={};N[0]&65536&&(X.disabled=!!w[16]),b.$set(X);const q={};N[0]&65536&&(q.disabled=!!w[16]),y.$set(q),w[17]?x&&(rn(),ue(x,1,1,()=>{x=null}),sn()):x?N[0]&131072&&te(x,1):(x=eh(),x.c(),te(x,1),x.m(d.parentNode,d)),w[18]?Y&&(rn(),ue(Y,1,1,()=>{Y=null}),sn()):Y?N[0]&262144&&te(Y,1):(Y=th(),Y.c(),te(Y,1),Y.m(p.parentNode,p)),w[19]?R&&(rn(),ue(R,1,1,()=>{R=null}),sn()):R?N[0]&524288&&te(R,1):(R=nh(),R.c(),te(R,1),R.m(M.parentNode,M))},i(w){L||(te(n.$$.fragment,w),te(r.$$.fragment,w),te(s.$$.fragment,w),te(a.$$.fragment,w),te(c.$$.fragment,w),te(D),te(m.$$.fragment,w),te(_.$$.fragment,w),te(O),te(b.$$.fragment,w),te(y.$$.fragment,w),te(x),te(Y),te(R),L=!0)},o(w){ue(n.$$.fragment,w),ue(r.$$.fragment,w),ue(s.$$.fragment,w),ue(a.$$.fragment,w),ue(c.$$.fragment,w),ue(D),ue(m.$$.fragment,w),ue(_.$$.fragment,w),ue(O),ue(b.$$.fragment,w),ue(y.$$.fragment,w),ue(x),ue(Y),ue(R),L=!1},d(w){w&&(fe(t),fe(i),fe(o),fe(l),fe(u),fe(f),fe(g),fe(E),fe(S),fe(v),fe(A),fe(d),fe(p),fe(M)),Se(n,w),Se(r,w),Se(s,w),Se(a,w),Se(c,w),D&&D.d(w),Se(m,w),Se(_,w),O&&O.d(w),Se(b,w),Se(y,w),x&&x.d(w),Y&&Y.d(w),R&&R.d(w)}}}function rh(e){let n,t;return n=new jn({props:{label:"Dictionary detection",helpText:"If enabled auto pause is skipped if open yomitan/jpdb-browser-reader was detected - yomitan requires disabled 'Secure Container' settings",targetStore$:St.playerEnableDictionaryDetection$}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function o8(e){let n,t;return n=new jn({props:{label:"Enable WakeLock",helpText:"If enabled the sites attempts to request a WakeLock during audio play that prevents device screens from dimming or locking",targetStore$:St.playerEnableWakeLock$}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function a8(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b=e[2]!==yr.DISABLED&&rh();t=new jn({props:{label:"Enable cover",helpText:"If enabled the audio file is searched through for a cover with a cost of slightly longer loading time",targetStore$:e[50]}}),t.$on("change",e[68]),i=new jn({props:{label:"Enable chapters",helpText:"If enabled the audio file is searched through for chapter metadata with a cost of slightly longer loading time",targetStore$:e[51]}}),i.$on("change",e[69]);let v=e[26]&&o8();return a=new ar({props:{label:"Auto pause",helpText:e[3],targetStore$:e[52],options:e[32]}}),c=new gr({props:{label:"Rewind",helpText:"# of seconds used for the regular rewind action",targetStore$:St.playerRewindTime$,min:1,step:1}}),f=new gr({props:{label:"Rewind #2",helpText:"# of seconds used for the alternative rewind action",targetStore$:St.playerAltRewindTime$,min:1,step:1}}),g=new gr({props:{label:"Fast-Forward",helpText:"# of seconds used for the regular fast-forward action",targetStore$:St.playerFastForwardTime$,min:1,step:1}}),E=new gr({props:{label:"Fast-Forward #2",helpText:"# of seconds used for the alternative fast-forward action",targetStore$:St.playerAltFastForwardTime$,min:1,step:1}}),{c(){b&&b.c(),n=me(),Te(t.$$.fragment),r=me(),Te(i.$$.fragment),s=me(),v&&v.c(),o=me(),Te(a.$$.fragment),l=me(),Te(c.$$.fragment),u=me(),Te(f.$$.fragment),m=me(),Te(g.$$.fragment),_=me(),Te(E.$$.fragment)},m(y,A){b&&b.m(y,A),de(y,n,A),Ee(t,y,A),de(y,r,A),Ee(i,y,A),de(y,s,A),v&&v.m(y,A),de(y,o,A),Ee(a,y,A),de(y,l,A),Ee(c,y,A),de(y,u,A),Ee(f,y,A),de(y,m,A),Ee(g,y,A),de(y,_,A),Ee(E,y,A),S=!0},p(y,A){y[2]!==yr.DISABLED?b?A[0]&4&&te(b,1):(b=rh(),b.c(),te(b,1),b.m(n.parentNode,n)):b&&(rn(),ue(b,1,1,()=>{b=null}),sn());const d={};A[0]&8&&(d.helpText=y[3]),a.$set(d)},i(y){S||(te(b),te(t.$$.fragment,y),te(i.$$.fragment,y),te(v),te(a.$$.fragment,y),te(c.$$.fragment,y),te(f.$$.fragment,y),te(g.$$.fragment,y),te(E.$$.fragment,y),S=!0)},o(y){ue(b),ue(t.$$.fragment,y),ue(i.$$.fragment,y),ue(v),ue(a.$$.fragment,y),ue(c.$$.fragment,y),ue(f.$$.fragment,y),ue(g.$$.fragment,y),ue(E.$$.fragment,y),S=!1},d(y){y&&(fe(n),fe(r),fe(s),fe(o),fe(l),fe(u),fe(m),fe(_)),b&&b.d(y),Se(t,y),Se(i,y),v&&v.d(y),Se(a,y),Se(c,y),Se(f,y),Se(g,y),Se(E,y)}}}function ih(e){let n,t;return n=new jn({props:{label:"Enable FFMPEG log",helpText:"If enabled ffmpeg logs will be printed out on console during export",targetStore$:St.enableFFMPEGLog$}}),{c(){Te(n.$$.fragment)},m(r,i){Ee(n,r,i),t=!0},i(r){t||(te(n.$$.fragment,r),t=!0)},o(r){ue(n.$$.fragment,r),t=!1},d(r){Se(n,r)}}}function l8(e){let n,t,r,i,s,o,a,l,c,u;n=new ar({props:{label:"Field mode",helpText:"Determines if the card data will be added before/after any current field value or if it will replace it",targetStore$:St.exportFieldMode$,options:e[33]}}),r=new ar({props:{label:"Audio processor",helpText:e[8],disabled:!!e[16],targetStore$:e[57],options:e[34]}}),r.$on("change",e[70]),s=new ar({props:{label:"Audio Format",helpText:"Audio format used for exported audio",targetStore$:e[58],options:e[7]}}),a=new gr({props:{label:"Bitrate",helpText:"Approximate Kbps bitrate target used for exported audio",disabled:!!e[16],targetStore$:St.exportAudioBitrate$,min:64,step:10}});let f=e[1]===Jn.FFMPEG&&ih();return{c(){Te(n.$$.fragment),t=me(),Te(r.$$.fragment),i=me(),Te(s.$$.fragment),o=me(),Te(a.$$.fragment),l=me(),f&&f.c(),c=ur()},m(m,g){Ee(n,m,g),de(m,t,g),Ee(r,m,g),de(m,i,g),Ee(s,m,g),de(m,o,g),Ee(a,m,g),de(m,l,g),f&&f.m(m,g),de(m,c,g),u=!0},p(m,g){const _={};g[0]&256&&(_.helpText=m[8]),g[0]&65536&&(_.disabled=!!m[16]),r.$set(_);const E={};g[0]&128&&(E.options=m[7]),s.$set(E);const S={};g[0]&65536&&(S.disabled=!!m[16]),a.$set(S),m[1]===Jn.FFMPEG?f?g[0]&2&&te(f,1):(f=ih(),f.c(),te(f,1),f.m(c.parentNode,c)):f&&(rn(),ue(f,1,1,()=>{f=null}),sn())},i(m){u||(te(n.$$.fragment,m),te(r.$$.fragment,m),te(s.$$.fragment,m),te(a.$$.fragment,m),te(f),u=!0)},o(m){ue(n.$$.fragment,m),ue(r.$$.fragment,m),ue(s.$$.fragment,m),ue(a.$$.fragment,m),ue(f),u=!1},d(m){m&&(fe(t),fe(i),fe(o),fe(l),fe(c)),Se(n,m),Se(r,m),Se(s,m),Se(a,m),f&&f.d(m)}}}function u8(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A;return n=new jn({props:{label:"Add subtitle tag",helpText:"If enabled the name of the current loaded subtitle file will be added to the card tag list",targetStore$:St.ankiAddSubtitleTag$}}),r=new jn({props:{label:"Add audio tag",helpText:"If enabled the name of the current loaded audio file will be added to the card tag list",targetStore$:St.ankiAddAudioTag$}}),s=new Qa({props:{label:"Card tags",helpText:"Comma separated list of tags added to the card tag list",targetStore$:St.ankiTagList$}}),a=new ar({props:{label:"Check duplicates",helpText:"Sets the respective options for Anki-Connect - works only on desktop and for creating new cards",targetStore$:St.ankiDuplicateMode$,options:e[35]}}),c=new Qa({props:{label:"Anki url",buttonTitle:"Reload Anki data",targetStore$:e[59],buttonIcon:Uc}}),c.$on("click",e[78]),f=new Qa({props:{helpText:"Anki API key",label:"Anki key",targetStore$:e[60]}}),f.$on("blur",e[79]),g=new ar({props:{label:"Anki deck",helpText:"Target anki deck for exporting",targetStore$:e[61],options:e[4]}}),E=new ar({props:{label:"Anki model",helpText:"Target anki model for exporting",targetStore$:e[62],options:e[5]}}),E.$on("change",e[72]),b=new ar({props:{label:"Sentence field",buttonTitle:"Clear field",targetStore$:e[63],buttonIcon:Ll,options:e[6]}}),b.$on("click",e[80]),y=new ar({props:{label:"Sound field",buttonTitle:"Clear field",targetStore$:e[64],buttonIcon:Ll,options:e[6]}}),y.$on("click",e[81]),{c(){Te(n.$$.fragment),t=me(),Te(r.$$.fragment),i=me(),Te(s.$$.fragment),o=me(),Te(a.$$.fragment),l=me(),Te(c.$$.fragment),u=me(),Te(f.$$.fragment),m=me(),Te(g.$$.fragment),_=me(),Te(E.$$.fragment),S=me(),Te(b.$$.fragment),v=me(),Te(y.$$.fragment)},m(d,p){Ee(n,d,p),de(d,t,p),Ee(r,d,p),de(d,i,p),Ee(s,d,p),de(d,o,p),Ee(a,d,p),de(d,l,p),Ee(c,d,p),de(d,u,p),Ee(f,d,p),de(d,m,p),Ee(g,d,p),de(d,_,p),Ee(E,d,p),de(d,S,p),Ee(b,d,p),de(d,v,p),Ee(y,d,p),A=!0},p(d,p){const M={};p[0]&16&&(M.options=d[4]),g.$set(M);const L={};p[0]&32&&(L.options=d[5]),E.$set(L);const D={};p[0]&64&&(D.options=d[6]),b.$set(D);const O={};p[0]&64&&(O.options=d[6]),y.$set(O)},i(d){A||(te(n.$$.fragment,d),te(r.$$.fragment,d),te(s.$$.fragment,d),te(a.$$.fragment,d),te(c.$$.fragment,d),te(f.$$.fragment,d),te(g.$$.fragment,d),te(E.$$.fragment,d),te(b.$$.fragment,d),te(y.$$.fragment,d),A=!0)},o(d){ue(n.$$.fragment,d),ue(r.$$.fragment,d),ue(s.$$.fragment,d),ue(a.$$.fragment,d),ue(c.$$.fragment,d),ue(f.$$.fragment,d),ue(g.$$.fragment,d),ue(E.$$.fragment,d),ue(b.$$.fragment,d),ue(y.$$.fragment,d),A=!1},d(d){d&&(fe(t),fe(i),fe(o),fe(l),fe(u),fe(m),fe(_),fe(S),fe(v)),Se(n,d),Se(r,d),Se(s,d),Se(a,d),Se(c,d),Se(f,d),Se(g,d),Se(E,d),Se(b,d),Se(y,d)}}}function sh(e){let n,t,r;function i(o){e[83](o)}let s={settingsMenu:Ur.KEYBINDINGS,$$slots:{default:[c8]},$$scope:{ctx:e}};return e[0]!==void 0&&(s.openSettingsMenu=e[0]),n=new Zs({props:s}),Gt.push(()=>Kn(n,"openSettingsMenu",i)),{c(){Te(n.$$.fragment)},m(o,a){Ee(n,o,a),r=!0},p(o,a){const l={};a[0]&62914560|a[3]&8192&&(l.$$scope={dirty:a,ctx:o}),!t&&a[0]&1&&(t=!0,l.openSettingsMenu=o[0],Zn(()=>t=!1)),n.$set(l)},i(o){r||(te(n.$$.fragment,o),r=!0)},o(o){ue(n.$$.fragment,o),r=!1},d(o){Se(n,o)}}}function c8(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y;return n=new br({props:{key:"Cmd + Space",description:"Toggle playback",extendDescription:!1}}),r=new br({props:{key:"Cmd + d",description:ct.RESTART_PLAYBACK}}),s=new br({props:{key:"Alt + d",description:ct.TOGGLE_PLAY_PAUSE}}),a=new br({props:{key:"Cmd + l",description:ct.TOGGLE_PLAYBACK_LOOP}}),c=new br({props:{key:"Cmd + b",description:ct.TOGGLE_BOOKMARK}}),f=new br({props:{key:"Cmd + m",description:ct.TOGGLE_MERGE}}),g=new br({props:{key:"Cmd + e",description:ct.EXPORT_NEW}}),E=new br({props:{key:"Alt + e",description:ct.EXPORT_UPDATE}}),b=new br({props:{key:"Cmd + q",description:"Go to previous subtitle",extendDescription:!1}}),y=new br({props:{key:"Alt + q",description:"Go to next subtitle",extendDescription:!1}}),d=new br({props:{key:"Cmd + Arrow Left",description:`Rewind ${e[22]} seconds`,extendDescription:!1}}),M=new br({props:{key:"Cmd + Arrow Down",description:`Rewind ${e[23]} seconds`,extendDescription:!1}}),D=new br({props:{key:"Cmd + Arrow Right",description:`Fast-Forward ${e[24]} seconds`,extendDescription:!1}}),x=new br({props:{key:"Cmd + Arrow Up",description:`Fast-Forward ${e[25]} seconds`,extendDescription:!1}}),{c(){Te(n.$$.fragment),t=me(),Te(r.$$.fragment),i=me(),Te(s.$$.fragment),o=me(),Te(a.$$.fragment),l=me(),Te(c.$$.fragment),u=me(),Te(f.$$.fragment),m=me(),Te(g.$$.fragment),_=me(),Te(E.$$.fragment),S=me(),Te(b.$$.fragment),v=me(),Te(y.$$.fragment),A=me(),Te(d.$$.fragment),p=me(),Te(M.$$.fragment),L=me(),Te(D.$$.fragment),O=me(),Te(x.$$.fragment)},m(R,w){Ee(n,R,w),de(R,t,w),Ee(r,R,w),de(R,i,w),Ee(s,R,w),de(R,o,w),Ee(a,R,w),de(R,l,w),Ee(c,R,w),de(R,u,w),Ee(f,R,w),de(R,m,w),Ee(g,R,w),de(R,_,w),Ee(E,R,w),de(R,S,w),Ee(b,R,w),de(R,v,w),Ee(y,R,w),de(R,A,w),Ee(d,R,w),de(R,p,w),Ee(M,R,w),de(R,L,w),Ee(D,R,w),de(R,O,w),Ee(x,R,w),Y=!0},p(R,w){const N={};w[0]&4194304&&(N.description=`Rewind ${R[22]} seconds`),d.$set(N);const X={};w[0]&8388608&&(X.description=`Rewind ${R[23]} seconds`),M.$set(X);const q={};w[0]&16777216&&(q.description=`Fast-Forward ${R[24]} seconds`),D.$set(q);const Z={};w[0]&33554432&&(Z.description=`Fast-Forward ${R[25]} seconds`),x.$set(Z)},i(R){Y||(te(n.$$.fragment,R),te(r.$$.fragment,R),te(s.$$.fragment,R),te(a.$$.fragment,R),te(c.$$.fragment,R),te(f.$$.fragment,R),te(g.$$.fragment,R),te(E.$$.fragment,R),te(b.$$.fragment,R),te(y.$$.fragment,R),te(d.$$.fragment,R),te(M.$$.fragment,R),te(D.$$.fragment,R),te(x.$$.fragment,R),Y=!0)},o(R){ue(n.$$.fragment,R),ue(r.$$.fragment,R),ue(s.$$.fragment,R),ue(a.$$.fragment,R),ue(c.$$.fragment,R),ue(f.$$.fragment,R),ue(g.$$.fragment,R),ue(E.$$.fragment,R),ue(b.$$.fragment,R),ue(y.$$.fragment,R),ue(d.$$.fragment,R),ue(M.$$.fragment,R),ue(D.$$.fragment,R),ue(x.$$.fragment,R),Y=!1},d(R){R&&(fe(t),fe(i),fe(o),fe(l),fe(u),fe(m),fe(_),fe(S),fe(v),fe(A),fe(p),fe(L),fe(O)),Se(n,R),Se(r,R),Se(s,R),Se(a,R),Se(c,R),Se(f,R),Se(g,R),Se(E,R),Se(b,R),Se(y,R),Se(d,R),Se(M,R),Se(D,R),Se(x,R)}}}function f8(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b;function v(R){e[74](R)}let y={settingsMenu:Ur.READER,$$slots:{default:[i8]},$$scope:{ctx:e}};e[0]!==void 0&&(y.openSettingsMenu=e[0]),t=new Zs({props:y}),Gt.push(()=>Kn(t,"openSettingsMenu",v));function A(R){e[75](R)}let d={settingsMenu:Ur.SUBTITLES,$$slots:{default:[s8]},$$scope:{ctx:e}};e[0]!==void 0&&(d.openSettingsMenu=e[0]),s=new Zs({props:d}),Gt.push(()=>Kn(s,"openSettingsMenu",A));function p(R){e[76](R)}let M={settingsMenu:Ur.PLAYER,$$slots:{default:[a8]},$$scope:{ctx:e}};e[0]!==void 0&&(M.openSettingsMenu=e[0]),l=new Zs({props:M}),Gt.push(()=>Kn(l,"openSettingsMenu",p));function L(R){e[77](R)}let D={settingsMenu:Ur.EXPORT,$$slots:{default:[l8]},$$scope:{ctx:e}};e[0]!==void 0&&(D.openSettingsMenu=e[0]),f=new Zs({props:D}),Gt.push(()=>Kn(f,"openSettingsMenu",L));function O(R){e[82](R)}let x={settingsMenu:Ur.ANKI,$$slots:{default:[u8]},$$scope:{ctx:e}};e[0]!==void 0&&(x.openSettingsMenu=e[0]),_=new Zs({props:x}),Gt.push(()=>Kn(_,"openSettingsMenu",O));let Y=!e[21]&&sh(e);return{c(){n=_e("div"),Te(t.$$.fragment),i=me(),Te(s.$$.fragment),a=me(),Te(l.$$.fragment),u=me(),Te(f.$$.fragment),g=me(),Te(_.$$.fragment),S=me(),Y&&Y.c()},m(R,w){de(R,n,w),Ee(t,n,null),oe(n,i),Ee(s,n,null),oe(n,a),Ee(l,n,null),oe(n,u),Ee(f,n,null),oe(n,g),Ee(_,n,null),oe(n,S),Y&&Y.m(n,null),b=!0},p(R,w){const N={};w[0]&14336|w[3]&8192&&(N.$$scope={dirty:w,ctx:R}),!r&&w[0]&1&&(r=!0,N.openSettingsMenu=R[0],Zn(()=>r=!1)),t.$set(N);const X={};w[0]&1032192|w[3]&8192&&(X.$$scope={dirty:w,ctx:R}),!o&&w[0]&1&&(o=!0,X.openSettingsMenu=R[0],Zn(()=>o=!1)),s.$set(X);const q={};w[0]&12|w[3]&8192&&(q.$$scope={dirty:w,ctx:R}),!c&&w[0]&1&&(c=!0,q.openSettingsMenu=R[0],Zn(()=>c=!1)),l.$set(q);const Z={};w[0]&65922|w[3]&8192&&(Z.$$scope={dirty:w,ctx:R}),!m&&w[0]&1&&(m=!0,Z.openSettingsMenu=R[0],Zn(()=>m=!1)),f.$set(Z);const ne={};w[0]&1050224|w[3]&8192&&(ne.$$scope={dirty:w,ctx:R}),!E&&w[0]&1&&(E=!0,ne.openSettingsMenu=R[0],Zn(()=>E=!1)),_.$set(ne),R[21]?Y&&(rn(),ue(Y,1,1,()=>{Y=null}),sn()):Y?(Y.p(R,w),w[0]&2097152&&te(Y,1)):(Y=sh(R),Y.c(),te(Y,1),Y.m(n,null))},i(R){b||(te(t.$$.fragment,R),te(s.$$.fragment,R),te(l.$$.fragment,R),te(f.$$.fragment,R),te(_.$$.fragment,R),te(Y),b=!0)},o(R){ue(t.$$.fragment,R),ue(s.$$.fragment,R),ue(l.$$.fragment,R),ue(f.$$.fragment,R),ue(_.$$.fragment,R),ue(Y),b=!1},d(R){R&&fe(n),Se(t),Se(s),Se(l),Se(f),Se(_),Y&&Y.d()}}}function d8(e,n,t){let r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y,R,w,N,X,q,Z,ne,U,F,C,P,I,H,K,he;we(e,Et,Ie=>t(84,s=Ie)),we(e,kt,Ie=>t(85,o=Ie)),we(e,so,Ie=>t(89,g=Ie)),we(e,Ts,Ie=>t(90,_=Ie)),we(e,ks,Ie=>t(93,b=Ie)),we(e,ni,Ie=>t(94,v=Ie)),we(e,Xn,Ie=>t(96,A=Ie)),we(e,si,Ie=>t(97,d=Ie)),we(e,jr,Ie=>t(16,Z=Ie)),we(e,xi,Ie=>t(21,P=Ie));const ee="wakeLock"in navigator,{supportsFileSystem:ae,sandboxElement:ge}=Ni("context"),Le=[ct.NONE,ct.RESTART_PLAYBACK,ct.TOGGLE_PLAY_PAUSE,ct.TOGGLE_PLAYBACK_LOOP,ct.TOGGLE_BOOKMARK,ct.TOGGLE_MERGE,ct.EXPORT_NEW,ct.EXPORT_UPDATE,ct.ALIGN_SUBTITLE,ct.EDIT_SUBTITLE,ct.RESTORE_SUBTITLE],He=[rr.DISABLED,rr.CLICK,rr.HOLD],De=[qo.DISABLED,qo.PAUSE],Ue=[Qn.HIDDEN,Qn.ALWAYS,Qn.HOVER,Qn.TOGGLE],be=[yr.DISABLED,yr.MODERATE,yr.STRICT],Re=[Vi.BEFORE,Vi.AFTER,Vi.REPLACE],Xe=[Jn.RECORDER,Jn.FFMPEG],Ne=[Wr.DISABLED,Wr.DECK,Wr.SUBDECK,Wr.COLLECTION],{readerLineHighlightColor$:B,readerLineTextHighlightColor$:V,readerEnableLineHighlight$:ye,readerEnableAutoScroll$:Ae,readerClickAction$:Ke,readerMenuOpenMode$:et,subtitlesEnablePersist$:Je,subtitlesCopyFontFamily$:ze,subtitlesCopyFontSize$:ut,subtitlesCopyLineHeight$:nt,subtitlesClickAction$:Ye,subtitlesActionsVisibility$:W,subtitlesGlobalStartPadding$:k,subtitlesGlobalEndPadding$:h,playerEnableCover$:T,playerEnableChapters$:$,playerAutoPauseMode$:j,playerRewindTime$:J,playerAltRewindTime$:Q,playerFastForwardTime$:ce,playerAltFastForwardTime$:ie,exportAudioProcessor$:le,exportAudioFormat$:ve,ankiUrl$:ke,ankiKey$:Pe,ankiDeck$:Ze,ankiModel$:ft,ankiSentenceField$:$e,ankiSoundField$:dt}=St;we(e,B,Ie=>t(100,L=Ie)),we(e,V,Ie=>t(101,D=Ie)),we(e,ye,Ie=>t(73,O=Ie)),we(e,Ae,Ie=>t(11,R=Ie)),we(e,Ke,Ie=>t(12,w=Ie)),we(e,et,Ie=>t(13,N=Ie)),we(e,Je,Ie=>t(95,y=Ie)),we(e,ze,Ie=>t(17,ne=Ie)),we(e,ut,Ie=>t(18,U=Ie)),we(e,nt,Ie=>t(19,F=Ie)),we(e,Ye,Ie=>t(14,X=Ie)),we(e,W,Ie=>t(15,q=Ie)),we(e,k,Ie=>t(99,M=Ie)),we(e,h,Ie=>t(98,p=Ie)),we(e,T,Ie=>t(92,S=Ie)),we(e,$,Ie=>t(91,E=Ie)),we(e,j,Ie=>t(2,Y=Ie)),we(e,J,Ie=>t(22,I=Ie)),we(e,Q,Ie=>t(23,H=Ie)),we(e,ce,Ie=>t(24,K=Ie)),we(e,ie,Ie=>t(25,he=Ie)),we(e,le,Ie=>t(1,m=Ie)),we(e,ve,Ie=>t(102,x=Ie)),we(e,ke,Ie=>t(87,u=Ie)),we(e,Pe,Ie=>t(20,C=Ie)),we(e,Ze,Ie=>t(88,f=Ie)),we(e,ft,Ie=>t(86,c=Ie)),we(e,$e,Ie=>t(10,l=Ie)),we(e,dt,Ie=>t(9,a=Ie));const Be=new Map;let Qe=Ur.READER,wt="",We=[],at=[],je=[];async function _t(Ie){await qn();const Mt="ttu-whispersync-color-styles",Tt=document.createTextNode(`${O?"span[class^='ttu-whispersync-line-highlight-'].active,":""}span[class^='ttu-whispersync-line-highlight-'].menu-open {color: ${D};background-color: ${L};}`);let Zt=document.getElementById(Mt);if(Zt)return Zt.replaceChild(Tt,Zt.firstChild);Zt=document.createElement("style"),Zt.id=Mt,Zt.appendChild(Tt),document.head.append(Zt)}async function Bt(){!y||!v||(pe(Et,s=!0,s),pe(kt,o="",o),await Ti({name:v.name,subtitles:[...A.values()]}).catch(({message:Ie})=>pe(kt,o=Ie,o)),pe(Et,s=!1,s))}async function ot(Ie,Mt){pe(Et,s=!0,s);const Tt=M,Zt=p;if(await yc(Ie,Mt),!A.size||Tt===M&&Zt===p){pe(Et,s=!1,s);return}const yt=[],jt=new Map,cn=[...A.entries()],Oe=M/1e3,Lt=p/1e3;for(let Ot=0,{length:Dt}=cn;Ot<Dt;Ot+=1){const[tn,hn]=cn[Ot],er=hn.adjustedStartSeconds??Math.max(0,hn.originalStartSeconds+Oe),zt=hn.adjustedEndSeconds??(d?ai(0,d,hn.originalEndSeconds+Lt):Math.max(0,hn.originalEndSeconds+Lt)),Ce={...hn,startSeconds:er,startTime:dr(er),endSeconds:zt,endTime:dr(zt)};yt.push(Ce),jt.set(tn,Ce)}pe(Xn,A=jt,A),fo.set({subtitles:yt,replaceTrack:!0}),y&&(pe(kt,o="",o),await Ti({name:v.name,subtitles:yt}).catch(({message:Ot})=>pe(kt,o=Ot,o))),pe(Et,s=!1,s)}async function ht(){pe(Et,s=!0,s),pe(kt,o="",o);try{await(ge?pl(ge,{action:"setMediaInfoInstance",enableCover:S,url:chrome.runtime.getURL("src/assets/js/MediaInfoModule_0.2.1.wasm")}):Dl(S,!0,""))}catch({message:Ie}){pe(kt,o=`MediaInfo failure: ${Ie}`,o),pe(Et,s=!1,s);return}if(S&&g)try{const{coverUrl:Ie}=await Bs(g,ge,!1,!0);URL.revokeObjectURL(b),pe(ks,b=Ie,b)}catch({message:Ie}){pe(kt,o=`Failed to set cover: ${Ie}`,o)}else S||(URL.revokeObjectURL(b),pe(ks,b="",b));pe(Et,s=!1,s)}async function Rt(){pe(Et,s=!0,s),pe(kt,o="",o);try{await(ge?pl(ge,{action:"setMediaInfoInstance",enableCover:S,url:chrome.runtime.getURL("src/assets/js/MediaInfoModule_0.2.1.wasm")}):Dl(S,!0,""))}catch({message:Ie}){pe(kt,o=`MediaInfo failure: ${Ie}`,o),pe(Et,s=!1,s);return}if(E&&g)try{const{chapters:Ie}=await Bs(g,ge,!1,!0);pe(Ts,_=Ie,_)}catch({message:Ie}){pe(kt,o=`Failed to set chapters: ${Ie}`,o)}else E||pe(Ts,_=[],_);pe(Et,s=!1,s)}async function Xt({currentTarget:Ie}){if(!(Ie instanceof HTMLSelectElement))return;pe(Et,s=!0,s),pe(kt,o="",o);let Mt=Jn.RECORDER;if(m===Jn.FFMPEG)try{await Ac(),await Mc(g),Mt=Jn.FFMPEG}catch({message:Tt}){pe(kt,o=`Update to FFMPEG failed: ${Tt}`,o)}if(Mt===Jn.RECORDER)try{dp()}catch{}Ie.value=Mt,pe(le,m=Mt,m),pe(Et,s=!1,s)}async function mn(Ie=!1){if(!(!Ie&&We.length&&at.length)){pe(Et,s=!0,s),pe(kt,o="",o);try{(Ie||!We.length||!at.length)&&t(4,[We,at]=await Lc(u),We,t(5,at)),f&&!We.find(Mt=>Mt===f)&&pe(Ze,f="",f),c&&!at.find(Mt=>Mt===c)&&pe(ft,c="",c),Ie&&Be.clear(),c&&await Jt()}catch({message:Mt}){pe(kt,o=`Failed to get Anki data: ${Mt}`,o),$t()}pe(Et,s=!1,s)}}async function Jt(){pe(Et,s=!0,s),pe(kt,o="",o);try{t(6,je=await(Be.has(c)?Promise.resolve(Be.get(c)):Pc(u,c))),l&&!je.find(Ie=>Ie===l)&&pe($e,l="",l),a&&!je.find(Ie=>Ie===a)&&pe(dt,a="",a)}catch({message:Ie}){pe(kt,o=`Failed to get Anki data: ${Ie}`,o),$t()}pe(Et,s=!1,s)}function $t(){Bc(),Be.clear(),t(4,We=[]),t(5,at=[]),t(6,je=[])}function bn(Ie){Qe=Ie,t(0,Qe)}function Sn(Ie){Qe=Ie,t(0,Qe)}function En(Ie){Qe=Ie,t(0,Qe)}function Yt(Ie){Qe=Ie,t(0,Qe)}const Ht=()=>mn(!0),Vt=()=>{gp(C)},Ft=()=>pe($e,l="",l),Ge=()=>pe(dt,a="",a);function bt(Ie){Qe=Ie,t(0,Qe)}function Ve(Ie){Qe=Ie,t(0,Qe)}return e.$$.update=()=>{e.$$.dirty[0]&2&&t(8,r=m===Jn.RECORDER?"Use realtime audio recording - requires to block certain actions during export":"Use background transcoding (file limit ~1.8 GB) - has certain performance requirements and may crash the site but is non blocking. Reload the page/use recorder in case of issues"),e.$$.dirty[0]&2&&t(7,i=m===Jn.FFMPEG?[Ei.MP3,Ei.OGG,Ei.OPUS]:[Ei.MP3]),e.$$.dirty[0]&4&&(Y===yr.DISABLED?t(3,wt="Player does not auto pause"):t(3,wt=Y===yr.MODERATE?"Player will auto pause when the browser tab loses focus":"Player will auto pause on any kind of site focus loss (e. g. different window etc.)")),e.$$.dirty[0]&2&&m===Jn.RECORDER&&pe(ve,x=Ei.MP3,x),e.$$.dirty[0]&1&&Qe===Ur.ANKI&&mn(),e.$$.dirty[2]&2048&&_t()},[Qe,m,Y,wt,We,at,je,i,r,a,l,R,w,N,X,q,Z,ne,U,F,C,P,I,H,K,he,ee,ae,Le,He,De,Ue,be,Re,Xe,Ne,B,V,ye,Ae,Ke,et,Je,ze,ut,nt,Ye,W,k,h,T,$,j,J,Q,ce,ie,le,ve,ke,Pe,Ze,ft,$e,dt,_t,Bt,ot,ht,Rt,Xt,mn,Jt,O,bn,Sn,En,Yt,Ht,Vt,Ft,Ge,bt,Ve]}class h8 extends vn{constructor(n){super(),wn(this,n,d8,f8,pn,{},null,[-1,-1,-1,-1])}}const{window:oh}=ic;function ah(e){let n,t,r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p=e[2].size&&!e[3].matchedBy&&lh(e),M=e[17].length&&uh(e),L={showMenu:e[9]};return c=new V5({props:L}),e[67](c),m=new x6({}),E=new U5({}),v=new h8({}),{c(){n=_e("div"),t=_e("button"),t.textContent=`${nn.AUDIOBOOK}`,r=me(),p&&p.c(),i=me(),M&&M.c(),s=me(),o=_e("button"),o.textContent=`${nn.SETTINGS}`,a=me(),l=_e("div"),Te(c.$$.fragment),u=me(),f=_e("div"),Te(m.$$.fragment),g=me(),_=_e("div"),Te(E.$$.fragment),S=me(),b=_e("div"),Te(v.$$.fragment),re(t,"title","Switch to Audiobook tab"),lt(t,"tab-active",e[16]===nn.AUDIOBOOK),re(o,"title","Switch to Settings tab"),lt(o,"tab-active",e[16]===nn.SETTINGS),re(n,"class","flex justify-between w-full tabs m-b-s"),re(l,"class","flex-col flex-1 m-b-s"),lt(l,"hidden",e[16]!==nn.AUDIOBOOK),lt(l,"flex",e[16]===nn.AUDIOBOOK),re(f,"class","flex flex-col flex-1"),lt(f,"hidden",e[16]!==nn.MATCH),re(_,"class","overflow-auto"),lt(_,"hidden",e[16]!==nn.CHAPTERS),re(b,"class","overflow-auto"),lt(b,"hidden",e[16]!==nn.SETTINGS)},m(D,O){de(D,n,O),oe(n,t),oe(n,r),p&&p.m(n,null),oe(n,i),M&&M.m(n,null),oe(n,s),oe(n,o),de(D,a,O),de(D,l,O),Ee(c,l,null),de(D,u,O),de(D,f,O),Ee(m,f,null),de(D,g,O),de(D,_,O),Ee(E,_,null),de(D,S,O),de(D,b,O),Ee(v,b,null),y=!0,A||(d=[qe(t,"click",e[63]),qe(o,"click",e[66])],A=!0)},p(D,O){(!y||O[0]&65536)&&lt(t,"tab-active",D[16]===nn.AUDIOBOOK),D[2].size&&!D[3].matchedBy?p?p.p(D,O):(p=lh(D),p.c(),p.m(n,i)):p&&(p.d(1),p=null),D[17].length?M?M.p(D,O):(M=uh(D),M.c(),M.m(n,s)):M&&(M.d(1),M=null),(!y||O[0]&65536)&&lt(o,"tab-active",D[16]===nn.SETTINGS);const x={};O[0]&512&&(x.showMenu=D[9]),c.$set(x),(!y||O[0]&65536)&&lt(l,"hidden",D[16]!==nn.AUDIOBOOK),(!y||O[0]&65536)&&lt(l,"flex",D[16]===nn.AUDIOBOOK),(!y||O[0]&65536)&&lt(f,"hidden",D[16]!==nn.MATCH),(!y||O[0]&65536)&&lt(_,"hidden",D[16]!==nn.CHAPTERS),(!y||O[0]&65536)&&lt(b,"hidden",D[16]!==nn.SETTINGS)},i(D){y||(te(c.$$.fragment,D),te(m.$$.fragment,D),te(E.$$.fragment,D),te(v.$$.fragment,D),y=!0)},o(D){ue(c.$$.fragment,D),ue(m.$$.fragment,D),ue(E.$$.fragment,D),ue(v.$$.fragment,D),y=!1},d(D){D&&(fe(n),fe(a),fe(l),fe(u),fe(f),fe(g),fe(_),fe(S),fe(b)),p&&p.d(),M&&M.d(),e[67](null),Se(c),Se(m),Se(E),Se(v),A=!1,_n(d)}}}function lh(e){let n,t,r;return{c(){n=_e("button"),n.textContent=`${nn.MATCH}`,re(n,"title","Switch to Match tab"),lt(n,"tab-active",e[16]===nn.MATCH)},m(i,s){de(i,n,s),t||(r=qe(n,"click",e[64]),t=!0)},p(i,s){s[0]&65536&&lt(n,"tab-active",i[16]===nn.MATCH)},d(i){i&&fe(n),t=!1,r()}}}function uh(e){let n,t,r;return{c(){n=_e("button"),n.textContent=`${nn.CHAPTERS}`,re(n,"title","Switch to Chapters tab"),lt(n,"tab-active",e[16]===nn.CHAPTERS)},m(i,s){de(i,n,s),t||(r=qe(n,"click",e[65]),t=!0)},p(i,s){s[0]&65536&&lt(n,"tab-active",i[16]===nn.CHAPTERS)},d(i){i&&fe(n),t=!1,r()}}}function p8(e){var U,F;let n,t,r,i,s,o,a,l,c,u,f=(e[1]||e[13])+"",m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y,R,w,N,X,q;t=new At({props:{path:Pp}}),i=new J5({});let Z={range:e[0],subtitle:e[8]};o=new W6({props:Z}),e[57](o),o.$on("close",e[58]),S=new At({props:{path:$c}}),y=new At({props:{path:$p}}),M=new At({props:{path:Bp}}),O=new At({props:{path:kp}});let ne=!e[1]&&((U=e[15])==null?void 0:U.elementHtml)&&((F=e[14])==null?void 0:F.title)&&ah(e);return{c(){n=_e("button"),Te(t.$$.fragment),r=me(),Te(i.$$.fragment),s=me(),Te(o.$$.fragment),a=me(),l=_e("div"),c=_e("div"),u=_e("button"),m=Nt(f),g=me(),_=_e("div"),E=_e("button"),Te(S.$$.fragment),b=me(),v=_e("button"),Te(y.$$.fragment),d=me(),p=_e("button"),Te(M.$$.fragment),L=me(),D=_e("button"),Te(O.$$.fragment),x=me(),Y=_e("div"),ne&&ne.c(),R=me(),w=_e("div"),w.innerHTML='<span class="spinner"></span>',re(n,"class","h-full hover:opacity-70"),lt(n,"text-red-500",e[1]||e[13]),lt(n,"animate-pulse",e[1]||e[13]),re(E,"title","Close menu"),lt(E,"m-l-b",e[11]),lt(E,"m-r-b",!e[11]),re(v,"title",A=`Switch menu position to ${e[11]?"right":"left"}`),re(v,"class","side-menu-only"),lt(v,"m-l-s",e[11]),lt(v,"m-r-s",!e[11]),re(p,"title","Reset menu width"),re(p,"class","side-menu-only"),lt(p,"m-l-s",e[11]),lt(p,"m-r-s",!e[11]),re(D,"title","Resize menu width"),re(D,"class","resize-cursor side-menu-only"),lt(D,"m-l-s",e[11]),lt(D,"m-r-s",!e[11]),re(_,"class","flex right-menu"),lt(_,"left-menu",e[11]),re(c,"class","flex justify-between right-menu p-4"),lt(c,"left-menu",e[11]),re(Y,"class","flex flex-col flex-1 p-x-b p-y-s"),lt(Y,"overflow-auto",e[16]===nn.SETTINGS||e[16]===nn.CHAPTERS),re(w,"class","backdrop"),lt(w,"hidden",!e[12]),re(l,"class","ttu-whispersync-container side-menu flex-col justify-between fixed top-0 left-0 h-full writing-horizontal-tb z-[60]"),lt(l,"left-0",e[11]),lt(l,"right-0",!e[11]),lt(l,"hidden",!e[9]),lt(l,"flex",e[9]),xn(l,"width",e[10]||null)},m(C,P){de(C,n,P),Ee(t,n,null),de(C,r,P),Ee(i,C,P),de(C,s,P),Ee(o,C,P),de(C,a,P),de(C,l,P),oe(l,c),oe(c,u),oe(u,m),oe(c,g),oe(c,_),oe(_,E),Ee(S,E,null),oe(_,b),oe(_,v),Ee(y,v,null),oe(_,d),oe(_,p),Ee(M,p,null),oe(_,L),oe(_,D),Ee(O,D,null),oe(l,x),oe(l,Y),ne&&ne.m(Y,null),oe(l,R),oe(l,w),e[68](l),N=!0,X||(q=[qe(oh,"resize",e[33]),qe(oh,"keydown",e[32]),qe(n,"click",Js(e[56])),qe(u,"click",e[59]),qe(E,"click",e[60]),qe(v,"click",e[61]),qe(p,"click",e[62]),qe(D,"pointerdown",Wo(e[34])),qe(l,"wheel",Js(e[55]),{passive:!0})],X=!0)},p(C,P){var H,K;(!N||P[0]&8194)&&lt(n,"text-red-500",C[1]||C[13]),(!N||P[0]&8194)&&lt(n,"animate-pulse",C[1]||C[13]);const I={};P[0]&1&&(I.range=C[0]),P[0]&256&&(I.subtitle=C[8]),o.$set(I),(!N||P[0]&8194)&&f!==(f=(C[1]||C[13])+"")&&en(m,f),(!N||P[0]&2048)&&lt(E,"m-l-b",C[11]),(!N||P[0]&2048)&&lt(E,"m-r-b",!C[11]),(!N||P[0]&2048&&A!==(A=`Switch menu position to ${C[11]?"right":"left"}`))&&re(v,"title",A),(!N||P[0]&2048)&&lt(v,"m-l-s",C[11]),(!N||P[0]&2048)&&lt(v,"m-r-s",!C[11]),(!N||P[0]&2048)&&lt(p,"m-l-s",C[11]),(!N||P[0]&2048)&&lt(p,"m-r-s",!C[11]),(!N||P[0]&2048)&&lt(D,"m-l-s",C[11]),(!N||P[0]&2048)&&lt(D,"m-r-s",!C[11]),(!N||P[0]&2048)&&lt(_,"left-menu",C[11]),(!N||P[0]&2048)&&lt(c,"left-menu",C[11]),!C[1]&&((H=C[15])!=null&&H.elementHtml)&&((K=C[14])!=null&&K.title)?ne?(ne.p(C,P),P[0]&49154&&te(ne,1)):(ne=ah(C),ne.c(),te(ne,1),ne.m(Y,null)):ne&&(rn(),ue(ne,1,1,()=>{ne=null}),sn()),(!N||P[0]&65536)&&lt(Y,"overflow-auto",C[16]===nn.SETTINGS||C[16]===nn.CHAPTERS),(!N||P[0]&4096)&&lt(w,"hidden",!C[12]),(!N||P[0]&2048)&&lt(l,"left-0",C[11]),(!N||P[0]&2048)&&lt(l,"right-0",!C[11]),(!N||P[0]&512)&&lt(l,"hidden",!C[9]),(!N||P[0]&512)&&lt(l,"flex",C[9]),P[0]&1024&&xn(l,"width",C[10]||null)},i(C){N||(te(t.$$.fragment,C),te(i.$$.fragment,C),te(o.$$.fragment,C),te(S.$$.fragment,C),te(y.$$.fragment,C),te(M.$$.fragment,C),te(O.$$.fragment,C),te(ne),N=!0)},o(C){ue(t.$$.fragment,C),ue(i.$$.fragment,C),ue(o.$$.fragment,C),ue(S.$$.fragment,C),ue(y.$$.fragment,C),ue(M.$$.fragment,C),ue(O.$$.fragment,C),ue(ne),N=!1},d(C){C&&(fe(n),fe(r),fe(s),fe(a),fe(l)),Se(t),Se(i,C),e[57](null),Se(o,C),Se(S),Se(y),Se(M),Se(O),ne&&ne.d(),e[68](null),X=!1,_n(q)}}}const Ja="ttu-whispersync-side-menu-width";function m8(e,n,t){let r,i,s,o,a,l,c,u,f,m,g,_,E,S,b,v,y,A,d,p,M,L,D,O,x,Y,R,w,N,X,q,Z,ne,U,F,C,P,I,H,K,he,ee,ae,ge,Le,He,De,Ue;we(e,Xn,Ce=>t(2,a=Ce)),we(e,xi,Ce=>t(42,c=Ce)),we(e,Et,Ce=>t(12,u=Ce)),we(e,kt,Ce=>t(13,f=Ce)),we(e,zn,Ce=>t(14,m=Ce)),we(e,si,Ce=>t(76,g=Ce)),we(e,ni,Ce=>t(43,S=Ce)),we(e,oo,Ce=>t(79,b=Ce)),we(e,ks,Ce=>t(80,v=Ce)),we(e,dn,Ce=>t(82,A=Ce)),we(e,ii,Ce=>t(83,d=Ce)),we(e,Pr,Ce=>t(15,p=Ce)),we(e,Ss,Ce=>t(3,M=Ce)),we(e,Es,Ce=>t(84,L=Ce)),we(e,jr,Ce=>t(44,D=Ce)),we(e,ri,Ce=>t(85,O=Ce)),we(e,gn,Ce=>t(86,x=Ce)),we(e,ki,Ce=>t(45,Y=Ce)),we(e,ta,Ce=>t(87,w=Ce)),we(e,Ui,Ce=>t(88,N=Ce)),we(e,Hi,Ce=>t(89,X=Ce)),we(e,Si,Ce=>t(48,Z=Ce)),we(e,Ko,Ce=>t(50,U=Ce)),we(e,ea,Ce=>t(90,F=Ce)),we(e,Jo,Ce=>t(91,C=Ce)),we(e,lo,Ce=>t(92,P=Ce)),we(e,ao,Ce=>t(93,I=Ce)),we(e,Cs,Ce=>t(94,H=Ce)),we(e,Ms,Ce=>t(95,K=Ce)),we(e,As,Ce=>t(96,he=Ce)),we(e,gc,Ce=>t(4,He=Ce)),we(e,Wi,Ce=>t(16,De=Ce)),we(e,Ts,Ce=>t(17,Ue=Ce));let{bookContentElement:be}=n,{sandboxElement:Re}=n,{currentBookId:Xe}=n;const Ne="showOpenFilePicker"in window,B=(window.localStorage.getItem("writingMode")||"vertical-rl")==="vertical-rl",V=(window.localStorage.getItem("viewMode")||"paginated")==="paginated",ye=`-${window.localStorage.getItem("firstDimensionMargin")||0}px`,Ae=V?void 0:new IntersectionObserver(Ve,{rootMargin:B?`0px ${ye} 0px ${ye}`:`${ye} 0px ${ye} 0px`}),Ke=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="iPad"||navigator.platform==="iPhone"||navigator.platform==="iPod",{readerEnableAutoReload$:et,readerPreventActionOnSelection$:Je,readerClickAction$:ze,readerMenuOpenMode$:ut,readerMenuPauseMode$:nt,readerMenuOpenTime$:Ye,subtitlesGlobalStartPadding$:W,subtitlesGlobalEndPadding$:k,ankiUrl$:h,ankiDeck$:T,ankiModel$:$,ankiSoundField$:j,ankiSentenceField$:J,exportAudioProcessor$:Q}=St;we(e,et,Ce=>t(81,y=Ce)),we(e,Je,Ce=>t(74,o=Ce)),we(e,ze,Ce=>t(40,i=Ce)),we(e,ut,Ce=>t(41,s=Ce)),we(e,nt,Ce=>t(46,R=Ce)),we(e,Ye,Ce=>t(75,l=Ce)),we(e,W,Ce=>t(78,E=Ce)),we(e,k,Ce=>t(77,_=Ce)),we(e,h,Ce=>t(54,Le=Ce)),we(e,T,Ce=>t(53,ge=Ce)),we(e,$,Ce=>t(52,ae=Ce)),we(e,j,Ce=>t(49,ne=Ce)),we(e,J,Ce=>t(47,q=Ce)),we(e,Q,Ce=>t(51,ee=Ce));let ce,ie,le,ve,ke,Pe,Ze,ft=!1,$e="",dt=window.matchMedia("(min-width: 1000px)").matches&&window.localStorage.getItem(Ja)||"",Be=0,Qe=0,wt;pe(xi,c=navigator.maxTouchPoints>0,c),Mh("context",{bookContentElement:be,sandboxElement:Re,isVertical:B,isPaginated:V,supportsFileSystem:Ne,isIOS:Ke}),jo(ot),Go(()=>{Yt(),document.removeEventListener("ttsu:skipKeyListener",ht,!1),document.removeEventListener("ttsu:page.change",Rt,!1),Ae==null||Ae.disconnect(),D&&D.abort("user aborted"),Ai(v,b)});function We(Ce){var qt;if(A||Ce.repeat||!(Ce.ctrlKey||Ce.metaKey||Ce.altKey)||!a.has(O.current))return;const Ct=a.get(O.current),un=Ce.code||((qt=Ce.key)==null?void 0:qt.toLowerCase());let Kt;if(Ce.altKey)switch(un){case"KeyE":case"e":Kt=D?ct.NONE:ct.EXPORT_UPDATE;break;default:Kt=ct.NONE;break}else switch(un){case"KeyB":case"b":Kt=ct.TOGGLE_BOOKMARK;break;case"KeyM":case"m":Kt=ct.TOGGLE_MERGE;break;case"KeyE":case"e":Kt=D?ct.NONE:ct.EXPORT_NEW;break;default:Kt=ct.NONE;break}Kt!==ct.NONE&&(Ce.preventDefault(),Ce.stopPropagation(),Ln(Kt,Ct))}function at(){window.clearTimeout(wt),wt=window.setTimeout(()=>{wt=void 0,t(10,dt=window.matchMedia("(min-width: 1000px)").matches&&window.localStorage.getItem(Ja)||""),ie==null||ie.resetSubtitleContainerHeight()},1e3)}function je(Ce){Be=ce.getBoundingClientRect().width,Qe=Ce.pageX,window.addEventListener("pointermove",_t,!1),window.addEventListener("pointerup",Bt,!1)}function _t(Ce){t(10,dt=r?`${Be+(Ce.pageX-Qe)}px`:`${Be-(Ce.pageX-Qe)}px`)}function Bt(){window.removeEventListener("pointermove",_t,!1),window.removeEventListener("pointerup",Bt,!1),window.localStorage.setItem(Ja,dt),ie==null||ie.resetSubtitleContainerHeight()}async function ot(){let Ce;document.addEventListener("ttsu:skipKeyListener",ht,!1),pe(Et,u=!0,u);try{if(!L){const Mn=await new Promise((lr,us)=>{document.addEventListener("ttsu:db.version",({detail:Ks})=>{if(Ks>5)return lr(Ks);us(new Error("Invalid ttu version"))},{once:!0,capture:!1}),document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"dbVersion"}})),setTimeout(()=>us(new Error("Invalid ttu version")),5e3)});await d6(Mn)}await new Promise(Mn=>{document.addEventListener("ttsu:synced",Mn,{once:!0,capture:!1}),document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"waitForSync"}}))});const Ct=await L.get("data",Xe);if(!Ct||!Ct.title||!Ct.elementHtml)throw new Error(`required data for id ${Xe} not found`);Ce=sa(new DOMParser,Ct.elementHtml);const un=Ce.firstElementChild,[Kt,qt,Nn,Gn]=await Promise.all([L.get("audioBook",Ct.title),L.get("subtitle",Ct.title),...Ne?[L.get("handle",[Ct.title,"audioBook"]),L.get("handle",[Ct.title,"subtitle"])]:[]]);un instanceof HTMLElement&&pe(Ss,M={matchedBy:un.dataset.ttuWhispersyncMatchedBy||"",matchedOn:Number.parseInt(un.dataset.ttuWhispersyncMatchedOn||"0",10)},M),pe(Pr,p=Ct,p),pe(zn,m={title:Ct.title,lastAudio:(Nn==null?void 0:Nn.handle)instanceof FileSystemFileHandle?Nn.handle:void 0,lastSubtitle:(Gn==null?void 0:Gn.handle)instanceof FileSystemFileHandle?Gn.handle:void 0,playbackPosition:(Kt==null?void 0:Kt.playbackPosition)||0,subtitleData:qt==null?void 0:qt.subtitleData},m),pe(ii,d=(Kt==null?void 0:Kt.playbackPosition)||0,d)}catch({message:Ct}){t(1,$e=`Initialization failed: ${Ct}`)}if($e){pe(Et,u=!1,u);return}V&&document.addEventListener("ttsu:page.change",Rt,!1),await Xt()}function ht({detail:Ce}){pe(dn,A=Ce,A)}function Rt(){Ft()}async function Xt(Ce=!1){Ce&&pe(Et,u=!0,u),(y||Ce)&&await mn(),await Jt(!b||Ce)}async function mn(Ce=!0){const Ct=!S&&m.lastSubtitle?m.lastSubtitle:void 0,un=!b&&m.lastAudio?m.lastAudio:void 0;if(!Ne||!Ct&&!un)return;try{await h1([Ct,un])}catch({message:qt}){if(!qt.includes("activation is required"))pe(kt,f=`Failed to reload file(s): ${qt}`,f);else{if(Ce)return await new Promise(Gn=>io.add({component:Y5,props:{dialogHeader:"Reopen files",dialogMessage:"Click confirm to reopen files",resolver:Gn}}))?void 0:mn(!1);pe(kt,f=`Failed to acccess files: ${qt}`,f)}}if(f)return;const Kt=[];if(Ct)try{const qt=await Ct.getFile();await pa(qt,document,!0)}catch({message:qt}){Kt.push(`Failed to load subtitle file: ${qt}`),li()}if(un)try{const qt=await un.getFile();await Bs(qt,Re,!0)}catch({message:qt}){Kt.push(`Failed to load audio file: ${qt}`),await Ai(v,b)}Kt.length&&pe(kt,f=Kt.join("; "),f)}async function Jt(Ce=!1){if(f||S||!m.subtitleData||!m.subtitleData.subtitles.length){Ce&&pe(Et,u=!1,u);return}try{const Ct=new Map,un=E/1e3,Kt=_/1e3;for(let Nn=0,{length:Gn}=m.subtitleData.subtitles;Nn<Gn;Nn+=1){const Mn=m.subtitleData.subtitles[Nn],lr=Math.max(0,Mn.adjustedStartSeconds??Mn.originalStartSeconds+un),us=g?ai(0,g,Mn.adjustedEndSeconds??Mn.originalEndSeconds+Kt):Math.max(0,Mn.adjustedEndSeconds??Mn.originalEndSeconds+Kt);Ct.set(Mn.id,{...Mn,startSeconds:lr,startTime:dr(lr),endSeconds:us,endTime:dr(us)})}const qt=new Blob([""],{type:"application/x-subrip;charset=utf-8"});li(new File([qt],m.subtitleData.name,{type:qt.type}),Ct)}catch({message:Ct}){pe(kt,f=`Failed to load persisted subtitle: ${Ct}`,f),li()}Ce&&pe(Et,u=!1,u)}function $t(Ce,Ct,un){Yt(),Ft(),Ce===rr.CLICK||Ce===rr.DISABLED&&Ct!==ct.NONE?be.addEventListener("click",bn,!1):Ce===rr.HOLD&&be.addEventListener("pointerdown",Sn,!1)}function bn(Ce){Ce.button!==0||!Vt(Ce)||bt()}function Sn(Ce){var Ct;Ce.button!==0||!Vt(Ce)||(o&&c&&((Ct=window.getSelection())==null||Ct.removeAllRanges(),document.body.style.userSelect="none"),be.addEventListener("pointerup",En,!1),le=window.setTimeout(bt,l))}function En(){var Ce;Ht(),(!o||!((Ce=window.getSelection())!=null&&Ce.toString().trim()))&&(Ge(),Ln(i,Ze)),Ft()}function Yt(){Ht(),be.removeEventListener("click",bn,!1),be.removeEventListener("pointerdown",Sn,!1)}function Ht(){clearTimeout(le),be.removeEventListener("pointerup",En,!1),document.body.style.userSelect="auto"}function Vt(Ce){const Ct=document.elementFromPoint(Ce.x,Ce.y),un=Ct==null?void 0:Ct.closest(oa());return un instanceof HTMLSpanElement?ve=un:Pe!=null&&Pe.isInReaderMenu(Ct)||Ft(),ve}function Ft(Ce=!0){const Ct=be.querySelectorAll(`${oa()}.menu-open`);for(let un=0,{length:Kt}=Ct;un<Kt;un+=1)Ct[un].classList.remove("menu-open");Ae==null||Ae.disconnect(),Ce&&(ve=void 0,t(0,ke=void 0),t(8,Ze=void 0))}function Ge(){if(!ve)return["",""];const Ce=vc(ve),Ct=Ze==null?void 0:Ze.id;return t(8,Ze=a.get(Ce)),[Ct,Ce]}function bt(){var Gn;if(Ht(),!ve||o&&((Gn=window.getSelection())!=null&&Gn.toString().trim()))return Ft();if(s===rr.DISABLED&&i!==ct.NONE)return En();const[Ce,Ct]=Ge();if(Ce===Ct)return;const un=[...be.querySelectorAll(po(Ct))],Kt=un[0],qt=un[un.length-1],Nn=document.createRange();Nn.setStart(Kt,0),Nn.setEnd(qt,qt.childNodes.length),Ft(!1);for(let Mn=0,{length:lr}=un;Mn<lr;Mn+=1)un[Mn].classList.add("menu-open");t(0,ke=Nn),Ae==null||Ae.observe(qt)}function Ve(Ce){Ce.every(Ct=>!Ct.isIntersecting)&&Ft()}function Ie(Ce){Ze&&t(8,Ze=Ce.get(Ze.id))}function Mt(Ce){cr.call(this,e,Ce)}const Tt=()=>{t(9,ft=!0),!$e&&!u&&Xt(!0)};function Zt(Ce){Gt[Ce?"unshift":"push"](()=>{Pe=Ce,t(7,Pe)})}const yt=()=>Ft(),jt=()=>pe(kt,f="",f),cn=()=>t(9,ft=!1),Oe=()=>pe(gc,He=r?"right":"left",He),Lt=()=>{t(10,dt=`${36*parseFloat(window.getComputedStyle(document.documentElement).fontSize)}px`),window.localStorage.removeItem(Ja),ie==null||ie.resetSubtitleContainerHeight()},Ot=()=>pe(Wi,De=nn.AUDIOBOOK,De),Dt=()=>pe(Wi,De=nn.MATCH,De),tn=()=>pe(Wi,De=nn.CHAPTERS,De),hn=()=>pe(Wi,De=nn.SETTINGS,De);function er(Ce){Gt[Ce?"unshift":"push"](()=>{ie=Ce,t(6,ie)})}function zt(Ce){Gt[Ce?"unshift":"push"](()=>{ce=Ce,t(5,ce)})}return e.$$set=Ce=>{"bookContentElement"in Ce&&t(37,be=Ce.bookContentElement),"sandboxElement"in Ce&&t(38,Re=Ce.sandboxElement),"currentBookId"in Ce&&t(39,Xe=Ce.currentBookId)},e.$$.update=()=>{e.$$.dirty[0]&16&&t(11,r=He==="left"),e.$$.dirty[1]&15138816&&pe(Ko,U=!!Le&&!!ge&&!!ae&&!!(ne&&Z||q),U),e.$$.dirty[1]&1056768&&pe(ki,Y=ee===Jn.RECORDER&&!!D,Y),e.$$.dirty[0]&4|e.$$.dirty[1]&147456&&(a.size?Z?Y?(pe(As,he="Recording in progress",he),pe(Ms,K="Recording in progress",K),pe(Cs,H="Recording in progress",H)):(pe(As,he=ct.RESTART_PLAYBACK,he),pe(Ms,K=ct.TOGGLE_PLAY_PAUSE,K),pe(Cs,H=ct.TOGGLE_PLAYBACK_LOOP,H)):(pe(As,he="Audio file required",he),pe(Ms,K="Audio file required",K),pe(Cs,H="Audio file required",H)):(pe(As,he="Subtitle file required",he),pe(Ms,K="Subtitle file required",K),pe(Cs,H="Subtitle file required",H))),e.$$.dirty[0]&4|e.$$.dirty[1]&8192&&(a.size?D?(pe(ao,I="Export in progress",I),pe(lo,P="Export in progress",P)):(pe(ao,I=ct.EDIT_SUBTITLE,I),pe(lo,P=ct.RESTORE_SUBTITLE,P)):(pe(ao,I="Subtitle file required",I),pe(lo,P="Subtitle file required",P))),e.$$.dirty[0]&4&&(a.size?(pe(Jo,C=ct.TOGGLE_BOOKMARK,C),pe(ea,F=ct.TOGGLE_MERGE,F)):(pe(Jo,C="Subtitle file required",C),pe(ea,F="Subtitle file required",F))),e.$$.dirty[0]&4|e.$$.dirty[1]&993280&&(U?a.size?ne&&!Z&&!q?(pe(Hi,X="Audio file required",X),pe(Ui,N="Audio file required",N)):D?(pe(Hi,X="Export in progress",X),pe(Ui,N="Export in progress",N),pe(ta,w=ct.CANCEL_EXPORT,w)):(pe(Hi,X=ct.EXPORT_NEW,X),pe(Ui,N=c?"Device not supported":ct.EXPORT_UPDATE,N),pe(ta,w="Export not started",w)):(pe(Hi,X="Subtitle file required",X),pe(Ui,N="Subtitle file required",N)):(pe(Hi,X="Anki configuration required",X),pe(Ui,N="Anki configuration required",N))),e.$$.dirty[0]&10|e.$$.dirty[1]&5632&&!$e&&M.matchedBy&&$t(s,i),e.$$.dirty[0]&1|e.$$.dirty[1]&49152&&ke&&R===qo.PAUSE&&!Y&&pe(gn,x=!0,x),e.$$.dirty[0]&4&&Ie(a)},[ke,$e,a,M,He,ce,ie,Pe,Ze,ft,dt,r,u,f,m,p,De,Ue,et,Je,ze,ut,nt,Ye,W,k,h,T,$,j,J,Q,We,at,je,Xt,Ft,be,Re,Xe,i,s,c,S,D,Y,R,q,Z,ne,U,ee,ae,ge,Le,Mt,Tt,Zt,yt,jt,cn,Oe,Lt,Ot,Dt,tn,hn,er,zt]}class _8 extends vn{constructor(n){super(),wn(this,n,m8,p8,pn,{bookContentElement:37,sandboxElement:38,currentBookId:39},null,[-1,-1,-1,-1])}}const g8=".ttu-whispersync-container,.ttu-whispersync-container input:not([type=checkbox]),.ttu-whispersync-container select,.ttu-whispersync-container .player-progress-tooltip{background-color:var(--ttu-whispersync-background-color);color:var(--ttu-whispersync-color)}.ttu-whispersync-container .tabs button:not(.tab-active),.ttu-whispersync-container button:disabled,.ttu-whispersync-container .btn:not(:disabled):hover,.ttu-whispersync-container button.inactive-chapter{opacity:.5}.ttu-whispersync-container button:not(:disabled):hover,.ttu-whispersync-container .dropzone:hover{opacity:.7}.ttu-whispersync-container button{text-align:left}.ttu-whispersync-container button:disabled,.ttu-whispersync-container select:disabled,.ttu-whispersync-container button:disabled [role=button]{cursor:not-allowed}.ttu-whispersync-container .m-b{margin:1rem}.ttu-whispersync-container .m-y-xs{margin-top:.25rem;margin-bottom:.25rem}.ttu-whispersync-container .m-y-s{margin-top:.5rem;margin-bottom:.5rem}.ttu-whispersync-container .m-y-b{margin-top:1rem;margin-bottom:1rem}.ttu-whispersync-container .m-x-xs{margin-left:.25rem;margin-right:.25rem}.ttu-whispersync-container .m-x-s{margin-left:.5rem;margin-right:.5rem}.ttu-whispersync-container .m-t-xs{margin-top:.25rem}.ttu-whispersync-container .m-t-s{margin-top:.5rem}.ttu-whispersync-container .m-t-b{margin-top:1rem}.ttu-whispersync-container .m-r-s{margin-right:.5rem}.ttu-whispersync-container .m-r-b{margin-right:.75rem}.ttu-whispersync-container .m-b-s{margin-bottom:.5rem}.ttu-whispersync-container .m-l-s{margin-left:.5rem}.ttu-whispersync-container .m-l-b{margin-left:.75rem}.ttu-whispersync-container .p-s{padding:.5rem}.ttu-whispersync-container .p-b{padding:1rem}.ttu-whispersync-container .p-y-s{padding-top:.5rem;padding-bottom:.5rem}.ttu-whispersync-container .p-x-xs{padding-left:.25rem;padding-right:.25rem}.ttu-whispersync-container .p-x-b{padding-right:1rem;padding-left:1rem}.ttu-whispersync-container .backdrop{flex-direction:column;position:absolute;width:100%;height:100%;top:0;left:0;z-index:100;background-color:#00000052;justify-content:center;align-items:center}.ttu-whispersync-container .backdrop:not(.hidden){display:flex}.ttu-whispersync-container .backdrop .spinner{width:48px;height:48px;border:5px solid;border-radius:50%;border-bottom-color:var(--ttu-whispersync-background-color);display:inline-block;box-sizing:border-box;animation:ttu-whispersync-spinner-rotation 1s linear infinite}.ttu-whispersync-dialog{z-index:70}.ttu-whispersync-container .slot-content{max-height:70vh;overflow:auto}.ttu-whispersync-container.popover{position:absolute;width:max-content;max-width:100%;top:0;left:0;padding:.25rem;margin:.25rem;border:1px solid;border-radius:4px;word-break:break-word;z-index:50;background-color:var(--ttu-whispersync-background-color);color:var(--ttu-whispersync-color)}.ttu-whispersync-container .waveform{width:100;margin:1.5rem 0rem}.ttu-whispersync-container .waveform ::part(region){opacity:.1}.ttu-whispersync-container .waveform ::part(region active){opacity:.5;z-index:10}.ttu-whispersync-container .time-edit span:not(.m-b){margin:.5rem}.ttu-whispersync-container .time-edit>div{flex-direction:column;align-items:center}.ttu-whispersync-container .time-input{width:70px;height:35px;text-align:center}.ttu-whispersync-container .side-menu-only{display:none}.ttu-whispersync-container.side-menu{cursor:initial;width:100vw;border:1px solid}.ttu-whispersync-container div.right-menu{flex-direction:row-reverse}.ttu-whispersync-container div.left-menu{flex-direction:row}.ttu-whispersync-container .resize-cursor,.ttu-whispersync-container .resize-cursor [role=button]{cursor:w-resize}.ttu-whispersync-container.subtitle-container{overflow-y:auto}.ttu-whispersync-container .sub-action.show,.ttu-whispersync-container .sub.on-hover:hover .sub-action{visibility:visible}.ttu-whispersync-container .audio-time{font-size:smaller;font-style:italic}.ttu-whispersync-container .bg-inverted{background-color:var(--ttu-whispersync-color)}.ttu-whispersync-container .bg-inverted>div{background-color:var(--ttu-whispersync-background-color)}.ttu-whispersync-container .color-inverted,.ttu-whispersync-container .color-inverted-hover:hover{background-color:var(--ttu-whispersync-color);color:var(--ttu-whispersync-background-color)}.ttu-whispersync-container .dropzone{border:1px solid transparent}.ttu-whispersync-container .dropzone.on-drag{border-color:var(--ttu-whispersync-color)}.ttu-whispersync-container .tabs button:not(.tab-active):not(:disabled):hover,.ttu-whispersync-container button:not(.recording).inactive-chapter:hover{opacity:1}.ttu-whispersync-container .header-icons{align-items:flex-start;flex-wrap:wrap}.ttu-whispersync-container .cover{width:110px;height:110px;align-self:center;margin-right:1rem}.ttu-whispersync-container .match-btns{z-index:200;position:relative}.ttu-whispersync-container .diff-grid{display:grid;grid-template-columns:auto auto auto;grid-column-gap:2rem;grid-row-gap:.5rem}.ttu-whispersync-container .btn{padding:.4rem;border-radius:5px;border:1px solid}.ttu-whispersync-container .sub{cursor:pointer;border-left:1px solid transparent}.ttu-whispersync-container .sub.active{border-color:var(--ttu-whispersync-color)}.ttu-whispersync-container .player-progress-tooltip{display:none;position:absolute;top:-2rem;border:1px solid}.ttu-whispersync-container .player-progress-tooltip-button:not(.recording){opacity:1!important}.ttu-whispersync-container .playback-rates{display:flex;flex-direction:column}.ttu-whispersync-container .playback-rates button{width:3rem}.ttu-whispersync-container details{margin-bottom:1rem}.ttu-whispersync-container summary{cursor:pointer}.ttu-whispersync-container .settings-grid{display:grid;grid-template-columns:1fr 200px .2fr;gap:.75rem;align-items:center;margin-right:.5rem}@keyframes ttu-whispersync-spinner-rotation{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media screen and (min-width: 1000px){.ttu-whispersync-container .diff-grid{max-width:70vw}.ttu-whispersync-container .time-edit>div{flex-direction:row}.ttu-whispersync-container .side-menu-only{display:block}.ttu-whispersync-container.side-menu{width:36rem;min-width:425px;max-width:40vw}.ttu-whispersync-container .header-icon{display:block}.ttu-whispersync-container .cover{width:160px;height:160px}.ttu-whispersync-container .waveform{width:70vw}.ttu-whispersync-container .player-progress-tooltip-button:not(.recording):hover .player-progress-tooltip{display:block;text-align:center}}";let Zu=!1,Ku=0,el,$o;async function ch(){var t;if($o)return;$o=window.setTimeout(()=>$o=void 0,1e3);const e=new URL(window.location.href),n=e.href.startsWith("https://reader.ttsu.app/b")||e.href.startsWith("http://localhost:5173/b")?e.searchParams.has("id"):!1;if(n&&!Zu){Zu=!0;let r=document.querySelector(".book-content");await new Promise(E=>{if(r)return E();const S=setInterval(()=>{r=document.querySelector(".book-content"),r&&(clearInterval(S),E())},500)});const i=document.querySelector(".z-10.flex.h-8.w-full");if(!r||!i||!i.firstElementChild)return;Ku=Number.parseInt(e.searchParams.get("id")||"0",10);const s=document.querySelector(":root"),o=document.createElement("div"),a="ttu-whispersync-styles",l="ttu-whispersync-sandbox",[c,u,f]=(((t=r.style.color.match(/rgb[a]{0,1}\((.+)\)/))==null?void 0:t[1])||"0,0,0,1").split(",").map(E=>parseFloat(E.trim()));let m=document.getElementById(l),g=document.getElementById(a),_="";g||(g=document.createElement("style"),g.id=a,g.innerText=g8,document.head.appendChild(g)),!m&&window.chrome&&chrome.runtime&&chrome.runtime.id&&(m=document.createElement("iframe"),m.id=l,m.style.display="none",m.src=chrome.runtime.getURL("src/sandbox/sandbox.html"),await new Promise(E=>{m.addEventListener("load",E,!1),document.body.appendChild(m)})),o.classList.add("flex","h-full","w-8","items-center","justify-center","text-sm","sm:text-lg"),o.addEventListener("click",b8,!1),i.classList.remove("justify-between"),i.firstElementChild.insertAdjacentElement("beforebegin",o),await new Promise(E=>{const S=setInterval(()=>{_=document.body.style.backgroundColor,_&&(clearInterval(S),E())},500)}),s.style.setProperty("--ttu-whispersync-background-color",_),s.style.setProperty("--ttu-whispersync-color",`rgb(${c},${u},${f})`),el=new _8({target:o,props:{bookContentElement:r,sandboxElement:m,currentBookId:Ku}})}else n||(el==null||el.$destroy(),clearTimeout($o),Ku=0,Zu=!1,$o=void 0)}function b8(e){e.stopPropagation()}new MutationObserver(ch).observe(document.body,{attributes:!0}),ch()})();
